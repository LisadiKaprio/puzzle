import{d as ie,r as L,o as g,c as w,a as s,b as ee,w as re,e as G,f as m,g as te,n as Ie,t as F,F as ae,h as ye,i as Xe,j,v as Re,k as Ue,l as be,m as zo,p as Do,q as Bo,s as Gs,u as Is,x as Pt,y as Go,z as Ss,A as Io,B as xo,C as Yo}from"./vendor.4bfcbb49.js";const Wo=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}};Wo();var se=(e,t)=>{const o=e.__vccOpts||e;for(const[n,i]of t)o[n]=i;return o};const Fo=ie({name:"app",computed:{showNav(){return!["game","replay"].includes(String(this.$route.name))}}}),Zo={id:"app"},Ho={key:0,class:"nav"},jo=m("Games overview"),Ko=m("New game"),qo=s("li",null,[s("a",{href:"https://ec.europa.eu/info/strategy/priorities-2019-2024/stronger-europe-world/eu-solidarity-ukraine/eu-assistance-ukraine/eu-stands-ukraine_en",class:"btn btn-ukraine",target:"_blank"},[s("i",{class:"icon icon-ukraine-heart"}),m(" Stand with Ukraine "),s("i",{class:"icon icon-ukraine-heart"})])],-1);function Xo(e,t,o,n,i,r){const a=L("router-link"),u=L("router-view");return g(),w("div",Zo,[e.showNav?(g(),w("ul",Ho,[s("li",null,[ee(a,{class:"btn",to:{name:"index"}},{default:re(()=>[jo]),_:1})]),s("li",null,[ee(a,{class:"btn",to:{name:"new-game"}},{default:re(()=>[Ko]),_:1})]),qo])):G("",!0),ee(u)])}var Qo=se(Fo,[["render",Xo]]);class ct{constructor(t){this.rand_high=t||3735929054,this.rand_low=t^1231121986}random(t,o){this.rand_high=(this.rand_high<<16)+(this.rand_high>>16)+this.rand_low&4294967295,this.rand_low=this.rand_low+this.rand_high&4294967295;const n=(this.rand_high>>>0)/4294967295;return t+n*(o-t+1)|0}choice(t){return t[this.random(0,t.length-1)]}shuffle(t){const o=t.slice();for(let n=0;n<=o.length-2;n++){const i=this.random(n,o.length-1),r=o[n];o[n]=o[i],o[i]=r}return o}static serialize(t){return{rand_high:t.rand_high,rand_low:t.rand_low}}static unserialize(t){const o=new ct(0);return o.rand_high=t.rand_high,o.rand_low=t.rand_low,o}}const Jo=e=>{let t=e.toLowerCase();return t=t.replace(/[^a-z0-9]+/g,"-"),t=t.replace(/^-|-$/,""),t},it=(e,t)=>{const o=`${e}`;return o.length>=t.length?o:t.substr(0,t.length-o.length)+o},Dt=(...e)=>{const t=o=>(...n)=>{const i=new Date,r=it(i.getHours(),"00"),a=it(i.getMinutes(),"00"),u=it(i.getSeconds(),"00");console[o](`${r}:${a}:${u}`,...e,...n)};return{log:t("log"),error:t("error"),info:t("info")}},en=()=>Date.now().toString(36)+Math.random().toString(36).substring(2);function tn(e){return e.top+1<<0|e.right+1<<2|e.bottom+1<<4|e.left+1<<6}function sn(e){return{top:(e>>0&3)-1,right:(e>>2&3)-1,bottom:(e>>4&3)-1,left:(e>>6&3)-1}}function on(e){return[e.idx,e.pos.x,e.pos.y,e.z,e.owner,e.group]}function nn(e){return{idx:e[0],pos:{x:e[1],y:e[2]},z:e[3],owner:e[4],group:e[5]}}function ln(e){return[e.id,e.x,e.y,e.d,e.name,e.color,e.bgcolor,e.points,e.ts]}function rn(e){return{id:e[0],x:e[1],y:e[2],d:e[3],name:e[4],color:e[5],bgcolor:e[6],points:e[7],ts:e[8]}}function an(e){return[e.id,e.rng.type||"",ct.serialize(e.rng.obj),e.puzzle,e.players,e.scoreMode,e.shapeMode,e.snapMode,e.creatorUserId,e.hasReplay,e.gameVersion,e.private]}function un(e){return{id:e[0],rng:{type:e[1],obj:ct.unserialize(e[2])},puzzle:e[3],players:e[4],scoreMode:e[5],shapeMode:e[6],snapMode:e[7],creatorUserId:e[8],hasReplay:e[9],gameVersion:e[10],private:e[11]}}function cn(e,t){const o=e.width/e.tileSize;return{x:t%o,y:Math.floor(t/o)}}function dn(e,t){const o=e.width/e.pieceSize;return{x:t%o,y:Math.floor(t/o)}}const hn=e=>{let t=0;for(let o=0;o<e.length;o++){const n=e.charCodeAt(o);t=(t<<5)-t+n,t|=0}return t};function pn(e){const t=[];for(const o in e){const n=[o,e[o]].map(encodeURIComponent);t.push(n.join("="))}return t.length===0?"":`?${t.join("&")}`}var I={hash:hn,slug:Jo,pad:it,uniqId:en,encodeShape:tn,decodeShape:sn,encodePiece:on,decodePiece:nn,encodePlayer:ln,decodePlayer:rn,encodeGame:an,decodeGame:un,coordByPieceIdxDeprecated:cn,coordByPieceIdx:dn,asQueryArgs:pn};const X={SOUND_VOLUME:"sound_volume",SOUND_ENABLED:"sound_enabled",OTHER_PLAYER_CLICK_SOUND_ENABLED:"other_player_click_sound_enabled",COLOR_BACKGROUND:"bg_color",SHOW_TABLE:"show_table",TABLE_TEXTURE:"table_texture",PLAYER_COLOR:"player_color",PLAYER_NAME:"player_name",SHOW_PLAYER_NAMES:"show_player_names"},pe={SOUND_VOLUME:100,SOUND_ENABLED:!0,OTHER_PLAYER_CLICK_SOUND_ENABLED:!0,COLOR_BACKGROUND:"#222222",SHOW_TABLE:!0,TABLE_TEXTURE:"dark",PLAYER_COLOR:"#ffffff",PLAYER_NAME:"anon",SHOW_PLAYER_NAMES:!0},xs=()=>({background:"",showTable:!0,tableTexture:"dark",color:"",name:"",soundsEnabled:!0,otherPlayerClickSoundEnabled:!0,soundsVolume:100,showPlayerNames:!0}),Bt=(e,t)=>{localStorage.setItem(e,t)},Gt=e=>localStorage.getItem(e),gn=(e,t)=>{Bt(e,`${t}`)},mn=(e,t)=>{const o=Gt(e);if(o===null)return t;const n=parseInt(o,10);return isNaN(n)?t:n},fn=(e,t)=>{Bt(e,t?"1":"0")},_n=(e,t)=>{const o=Gt(e);return o===null?t:o==="1"},yn=(e,t)=>{Bt(e,t)},wn=(e,t)=>{const o=Gt(e);return o===null?t:o};var H={setInt:gn,getInt:mn,setBool:fn,getBool:_n,setStr:yn,getStr:wn};let bt="",Ys="";const wt=async(e,t,o)=>new Promise((n,i)=>{const r=new window.XMLHttpRequest;r.open(e,t,!0),r.withCredentials=!0;for(const a in o.headers||{})r.setRequestHeader(a,o.headers[a]);r.setRequestHeader("Client-Id",bt),r.setRequestHeader("Client-Secret",Ys),r.addEventListener("load",function(a){n({status:this.status,text:this.responseText,json:async()=>JSON.parse(this.responseText)})}),r.addEventListener("error",function(a){i(new Error("xhr error"))}),r.upload&&o.onUploadProgress&&r.upload.addEventListener("progress",function(a){o.onUploadProgress&&o.onUploadProgress(a)}),r.send(o.body||null)}),Cs=e=>{let t=H.getStr(e,"");return t||(t=I.uniqId(),H.setStr(e,t)),t};var _e={init:()=>{bt=Cs("ID"),Ys=Cs("SECRET")},request:wt,get:(e,t)=>wt("get",e,t),post:(e,t)=>wt("post",e,t),clientId:()=>bt};const Ws=1,It=Ws*1e3,rt=It*60,at=rt*60,Tt=at*24,vn=()=>{const e=new Date;return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},Fs=e=>{const t=Math.floor(e/Tt);e=e%Tt;const o=Math.floor(e/at);e=e%at;const n=Math.floor(e/rt);e=e%rt;const i=Math.floor(e/It);return`${t}d ${o}h ${n}m ${i}s`},En=(e,t)=>Fs(t-e);var Te={MS:Ws,SEC:It,MIN:rt,HOUR:at,DAY:Tt,timestamp:vn,timeDiffStr:En,durationStr:Fs};const Pn=ie({props:{game:{type:Object,required:!0}},computed:{style(){return{"background-image":`url("${this.game.imageUrl.replace("uploads/","uploads/r/")+"-375x210.webp"}")`}}},methods:{time(e,t){const o=e,n=t||Te.timestamp();return`${Te.timeDiffStr(o,n)}`}}}),bn={class:"game-info-text"},Tn=s("i",{class:"icon icon-puzzle-piece"},null,-1),$n=s("br",null,null,-1),Sn=s("i",{class:"icon icon-sillouette"},null,-1),Cn=s("br",null,null,-1),kn={key:0,class:"icon icon-clock"},An={key:1,class:"icon icon-flag"},On=s("br",null,null,-1),Nn=s("i",{class:"icon icon-replay"},null,-1),Un=m(" Watch replay ");function Rn(e,t,o,n,i,r){const a=L("router-link");return g(),w("div",{class:"game-teaser",style:Ie(e.style)},[ee(a,{class:"game-info",to:{name:"game",params:{id:e.game.id}}},{default:re(()=>[s("span",bn,[Tn,m(" "+F(e.game.piecesFinished)+"/"+F(e.game.piecesTotal),1),$n,Sn,m(" "+F(e.game.players),1),Cn,e.game.finished?(g(),w("i",An)):(g(),w("i",kn)),m(" "+F(e.time(e.game.started,e.game.finished)),1),On])]),_:1},8,["to"]),e.game.hasReplay?(g(),te(a,{key:0,class:"game-replay",to:{name:"replay",params:{id:e.game.id}}},{default:re(()=>[Nn,Un]),_:1},8,["to"])):G("",!0)],4)}var Zs=se(Pn,[["render",Rn]]);const Ln=ie({components:{GameTeaser:Zs},data(){return{gamesRunning:[],gamesFinished:[]}},async created(){const t=await(await _e.get("/api/index-data",{})).json();this.gamesRunning=t.gamesRunning,this.gamesFinished=t.gamesFinished}}),Vn=s("h1",null,"Running games",-1),Mn=s("h1",null,"Finished games",-1);function zn(e,t,o,n,i,r){const a=L("game-teaser");return g(),w("div",null,[Vn,(g(!0),w(ae,null,ye(e.gamesRunning,(u,f)=>(g(),w("div",{class:"game-teaser-wrap",key:f},[ee(a,{game:u},null,8,["game"])]))),128)),Mn,(g(!0),w(ae,null,ye(e.gamesFinished,(u,f)=>(g(),w("div",{class:"game-teaser-wrap",key:f},[ee(a,{game:u},null,8,["game"])]))),128))])}var Dn=se(Ln,[["render",zn]]);const Bn=ie({props:{images:{type:Array,required:!0}},emits:{imageClicked:null,imageEditClicked:null},methods:{imageClicked(e){this.$emit("imageClicked",e)},imageEditClicked(e){this.$emit("imageEditClicked",e)}}});function Gn(e,t,o,n,i,r){const a=L("image-teaser");return g(),w("div",null,[(g(!0),w(ae,null,ye(e.images,(u,f)=>(g(),te(a,{image:u,onClick:h=>e.imageClicked(u),onEditClick:h=>e.imageEditClicked(u),key:f},null,8,["image","onClick","onEditClick"]))),128))])}var Hs=se(Bn,[["render",Gn]]);const In=async e=>{const t=await Yn(e),o=await xn(t);return js(o.toDataURL())},xn=async e=>{const t=document.createElement("canvas"),o=t.getContext("2d");return t.width=e.width,t.height=e.height,o.drawImage(e,0,0),t},Yn=async e=>new Promise((t,o)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{t(n)},n.onerror=i=>{o(i)},n.src=e});function js(e){for(var t=e.split(","),o=t[0].match(/:(.*?);/)[1],n=atob(t[1]),i=n.length,r=new Uint8Array(i);i--;)r[i]=n.charCodeAt(i);return new Blob([r],{type:o})}const Wn=ie({props:{autocompleteTags:{type:Function},uploadProgress:{type:Number},uploading:{type:String}},emits:["setupGameClick","postToGalleryClick","close"],data(){return{previewUrl:"",file:null,title:"",tags:[],isPrivate:!1,droppable:!1,inputFocused:!1}},computed:{uploadProgressPercent(){return this.uploadProgress?Math.round(this.uploadProgress*100):0},canPostToGallery(){return this.uploading?!1:!!(this.previewUrl&&this.file)},canSetupGameClick(){return this.uploading?!1:!!(this.previewUrl&&this.file)}},mounted(){window.addEventListener("paste",this.onPaste)},unmounted(){window.removeEventListener("paste",this.onPaste)},methods:{reset(){this.previewUrl="",this.file=null,this.title="",this.tags=[],this.isPrivate=!1,this.droppable=!1},imageFromDragEvt(e){var n;const t=(n=e.dataTransfer)==null?void 0:n.items;if(!t||t.length===0)return null;const o=t[0];return o.type.startsWith("image/")?o:null},async onPaste(e){const t=e.clipboardData.getData("text");if(t){if(this.inputFocused)return;if(t.match(/^https?:\/\//)){const n="/api/proxy?"+new URLSearchParams({url:t});try{const i=await In(n);this.preview(i)}catch(i){console.error("unable to transform image http url into blob",i)}}else if(t.match(/^data:image\/([a-z]+);base64,/))try{const n=js(t);this.preview(n)}catch(n){console.error("unable to transform image data url into blob",n)}else console.log(t)}const o=e.clipboardData.files[0];!o||this.preview(o)},onFileSelect(e){const t=e.target;if(!t.files)return;const o=t.files[0];!o||this.preview(o)},preview(e){if(!e.type.startsWith("image/")){console.error("file type is not supported",e.type);return}const t=new FileReader;t.readAsDataURL(e),t.onload=o=>{this.previewUrl=o.target.result,this.file=e}},postToGallery(){this.$emit("postToGalleryClick",{file:this.file,title:this.title,tags:this.tags,isPrivate:this.isPrivate}),this.reset()},setupGameClick(){this.$emit("setupGameClick",{file:this.file,title:this.title,tags:this.tags,isPrivate:this.isPrivate}),this.reset()},onDrop(e){this.droppable=!1;const t=this.imageFromDragEvt(e);if(!t)return!1;const o=t.getAsFile();return o&&(this.file=o,this.preview(o),e.preventDefault()),!1},onDragover(e){return this.imageFromDragEvt(e)&&(this.droppable=!0,e.preventDefault()),!1},onDragleave(){this.droppable=!1}}}),Fn=s("div",{class:"drop-target"},null,-1),Zn={key:0,class:"has-image"},Hn={key:1},jn={class:"upload"},Kn=s("div",{class:"upload-content"},[m(" How to upload an image? Choose any of the following methods: "),s("ul",null,[s("li",null,"Click this area to select an image for upload "),s("li",null,"Drag and drop an image into the area"),s("li",null,"Paste an image URL"),s("li",null,"Paste an image")]),s("div",{class:"hint"},` Don't worry, the image will not show up in the gallery unless "Post to gallery" was clicked. `)],-1),qn={class:"area-settings"},Xn=s("td",null,[s("label",null,"Title")],-1),Qn=s("tr",null,[s("td",{colspan:"2"},[s("div",{class:"hint"},"Feel free to leave a credit to the artist/photographer in the title :)")])],-1),Jn=s("td",null,[s("label",null,"Private Image")],-1),ei=s("tr",null,[s("td",{colspan:"2"},[s("div",{class:"hint"},"Private images won't show up in the gallery.")])],-1),ti=s("td",null,[s("label",null,"Tags")],-1),si={class:"area-buttons"},oi=["disabled"],ni=s("i",{class:"icon icon-preview"},null,-1),ii=m(" Post to gallery"),li=["disabled"],ri=s("i",{class:"icon icon-puzzle-piece"},null,-1),ai=m(" Set up game"),ui=s("i",{class:"icon icon-puzzle-piece"},null,-1),ci=m(" Post to gallery "),di=s("br",null,null,-1),hi=m(" + set up game");function pi(e,t,o,n,i,r){const a=L("responsive-image"),u=L("tags-input"),f=L("overlay");return g(),te(f,{class:"new-image-dialog"},{default:re(()=>[s("div",{class:Xe(["area-image",{"has-image":!!e.previewUrl,"no-image":!e.previewUrl,droppable:e.droppable}]),onDrop:t[2]||(t[2]=(...h)=>e.onDrop&&e.onDrop(...h)),onDragover:t[3]||(t[3]=(...h)=>e.onDragover&&e.onDragover(...h)),onDragleave:t[4]||(t[4]=(...h)=>e.onDragleave&&e.onDragleave(...h))},[Fn,e.previewUrl?(g(),w("div",Zn,[s("span",{class:"remove btn",onClick:t[0]||(t[0]=h=>e.previewUrl="")},"X"),ee(a,{src:e.previewUrl},null,8,["src"])])):(g(),w("div",Hn,[s("label",jn,[s("input",{type:"file",style:{display:"none"},onChange:t[1]||(t[1]=(...h)=>e.onFileSelect&&e.onFileSelect(...h)),accept:"image/*"},null,32),Kn])]))],34),s("div",qn,[s("table",null,[s("tr",null,[Xn,s("td",null,[j(s("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=h=>e.title=h),placeholder:"Flower by @artist",onFocus:t[6]||(t[6]=h=>e.inputFocused=!0),onBlur:t[7]||(t[7]=h=>e.inputFocused=!1)},null,544),[[Re,e.title]])])]),Qn,s("tr",null,[Jn,s("td",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=h=>e.isPrivate=h)},null,512),[[Ue,e.isPrivate]])])]),ei,s("tr",null,[ti,s("td",null,[ee(u,{modelValue:e.tags,"onUpdate:modelValue":t[9]||(t[9]=h=>e.tags=h),autocompleteTags:e.autocompleteTags},null,8,["modelValue","autocompleteTags"])])])])]),s("div",si,[e.isPrivate?G("",!0):(g(),w("button",{key:0,class:"btn",disabled:!e.canPostToGallery,onClick:t[10]||(t[10]=(...h)=>e.postToGallery&&e.postToGallery(...h))},[e.uploading==="postToGallery"?(g(),w(ae,{key:0},[m("Uploading ("+F(e.uploadProgressPercent)+"%)",1)],64)):(g(),w(ae,{key:1},[ni,ii],64))],8,oi)),s("button",{class:"btn",disabled:!e.canSetupGameClick,onClick:t[11]||(t[11]=(...h)=>e.setupGameClick&&e.setupGameClick(...h))},[e.uploading==="setupGame"?(g(),w(ae,{key:0},[m("Uploading ("+F(e.uploadProgressPercent)+"%)",1)],64)):e.isPrivate?(g(),w(ae,{key:1},[ri,ai],64)):(g(),w(ae,{key:2},[ui,ci,di,hi],64))],8,li),s("button",{class:"btn",onClick:t[12]||(t[12]=h=>e.$emit("close"))},"Cancel")])]),_:1})}var Ks=se(Wn,[["render",pi]]);const gi=ie({props:{image:{type:Object,required:!0},autocompleteTags:{type:Function}},emits:["saveClick","close"],data(){return{title:"",tags:[]}},watch:{image(e,t){this.init(e)}},created(){this.init(this.image)},methods:{init(e){this.title=e.title,this.tags=e.tags.map(t=>t.title)},saveImage(){this.$emit("saveClick",{id:this.image.id,title:this.title,tags:this.tags})}}}),mi={class:"area-image"},fi={class:"has-image"},_i={class:"area-settings"},yi=s("td",null,[s("label",null,"Title")],-1),wi=s("tr",null,[s("td",{colspan:"2"},[s("div",{class:"hint"},"Feel free to leave a credit to the artist/photographer in the title :)")])],-1),vi=s("td",null,[s("label",null,"Tags")],-1),Ei={class:"area-buttons"},Pi=s("i",{class:"icon icon-preview"},null,-1),bi=m(" Save image"),Ti=[Pi,bi];function $i(e,t,o,n,i,r){const a=L("responsive-image"),u=L("tags-input"),f=L("overlay");return g(),te(f,{class:"edit-image-dialog"},{default:re(()=>[s("div",mi,[s("div",fi,[ee(a,{src:e.image.url,title:e.image.title},null,8,["src","title"])])]),s("div",_i,[s("table",null,[s("tr",null,[yi,s("td",null,[j(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=h=>e.title=h),placeholder:"Flower by @artist"},null,512),[[Re,e.title]])])]),wi,s("tr",null,[vi,s("td",null,[ee(u,{modelValue:e.tags,"onUpdate:modelValue":t[1]||(t[1]=h=>e.tags=h),autocompleteTags:e.autocompleteTags},null,8,["modelValue","autocompleteTags"])])])])]),s("div",Ei,[s("button",{class:"btn",onClick:t[2]||(t[2]=(...h)=>e.saveImage&&e.saveImage(...h))},Ti),s("button",{class:"btn",onClick:t[3]||(t[3]=h=>e.$emit("close"))},"Cancel")])]),_:1})}var qs=se(gi,[["render",$i]]),Le=(e=>(e[e.FINAL=0]="FINAL",e[e.ANY=1]="ANY",e))(Le||{}),Ke=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ANY=1]="ANY",e[e.FLAT=2]="FLAT",e))(Ke||{}),xe=(e=>(e[e.NORMAL=0]="NORMAL",e[e.REAL=1]="REAL",e))(xe||{});const Si=ie({props:{image:{type:Object,required:!0},forcePrivate:{type:Boolean,default:!1}},emits:["newGame","close"],data(){return{tiles:1e3,isPrivate:!1,scoreMode:Le.ANY,shapeMode:Ke.NORMAL,snapMode:xe.NORMAL}},mounted(){this.isPrivate=this.forcePrivate},methods:{onNewGameClick(){this.$emit("newGame",{tiles:this.tilesInt,private:this.isPrivate,image:this.image,scoreMode:this.scoreModeInt,shapeMode:this.shapeModeInt,snapMode:this.snapModeInt})}},computed:{canStartNewGame(){return!(!this.tilesInt||!this.image||!this.image.url||![0,1].includes(this.scoreModeInt))},scoreModeInt(){return parseInt(`${this.scoreMode}`,10)},shapeModeInt(){return parseInt(`${this.shapeMode}`,10)},snapModeInt(){return parseInt(`${this.snapMode}`,10)},tilesInt(){return parseInt(`${this.tiles}`,10)}}}),Ci={class:"area-image"},ki={class:"has-image"},Ai={key:0,class:"image-title"},Oi={key:0,class:"image-title-title"},Ni={key:1,class:"image-title-dim"},Ui={class:"area-settings"},Ri=s("td",null,[s("label",null,"Pieces")],-1),Li=s("td",null,[s("label",null,"Scoring: ")],-1),Vi=m(" Any (Score when pieces are connected to each other or on final location)"),Mi=s("br",null,null,-1),zi=m(" Final (Score when pieces are put to their final location)"),Di=s("td",null,[s("label",null,"Shapes: ")],-1),Bi=m(" Normal"),Gi=s("br",null,null,-1),Ii=m(" Any (Flat pieces can occur anywhere)"),xi=s("br",null,null,-1),Yi=m(" Flat (All pieces flat on all sides)"),Wi=s("td",null,[s("label",null,"Snapping: ")],-1),Fi=m(" Normal (Pieces snap to final destination and to each other)"),Zi=s("br",null,null,-1),Hi=m(" Real (Pieces snap only to corners, already snapped pieces and to each other)"),ji=s("td",null,[s("label",null,"Private Game")],-1),Ki=["disabled"],qi=s("tr",null,[s("td",{colspan:"2"},[s("div",{class:"hint"},"Private games won't show up in the game overview.")])],-1),Xi={key:0},Qi=s("td",null,[s("label",null,"Tags: ")],-1),Ji={class:"area-buttons"},el=["disabled"],tl=s("i",{class:"icon icon-puzzle-piece"},null,-1),sl=m(" Generate Puzzle "),ol=[tl,sl];function nl(e,t,o,n,i,r){const a=L("responsive-image"),u=L("overlay");return g(),te(u,{class:"new-game-dialog"},{default:re(()=>[s("div",Ci,[s("div",ki,[ee(a,{src:e.image.url,title:e.image.title},null,8,["src","title"])]),e.image.title||e.image.width||e.image.height?(g(),w("div",Ai,[e.image.title?(g(),w("span",Oi,'"'+F(e.image.title)+'"',1)):G("",!0),e.image.width||e.image.height?(g(),w("span",Ni,"("+F(e.image.width)+" \u2715 "+F(e.image.height)+")",1)):G("",!0)])):G("",!0)]),s("div",Ui,[s("table",null,[s("tr",null,[Ri,s("td",null,[j(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=f=>e.tiles=f)},null,512),[[Re,e.tiles]])])]),s("tr",null,[Li,s("td",null,[s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=f=>e.scoreMode=f),value:"1"},null,512),[[be,e.scoreMode]]),Vi]),Mi,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=f=>e.scoreMode=f),value:"0"},null,512),[[be,e.scoreMode]]),zi])])]),s("tr",null,[Di,s("td",null,[s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=f=>e.shapeMode=f),value:"0"},null,512),[[be,e.shapeMode]]),Bi]),Gi,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=f=>e.shapeMode=f),value:"1"},null,512),[[be,e.shapeMode]]),Ii]),xi,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=f=>e.shapeMode=f),value:"2"},null,512),[[be,e.shapeMode]]),Yi])])]),s("tr",null,[Wi,s("td",null,[s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[6]||(t[6]=f=>e.snapMode=f),value:"0"},null,512),[[be,e.snapMode]]),Fi]),Zi,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[7]||(t[7]=f=>e.snapMode=f),value:"1"},null,512),[[be,e.snapMode]]),Hi])])]),s("tr",null,[ji,s("td",null,[j(s("input",{disabled:e.forcePrivate,type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=f=>e.isPrivate=f)},null,8,Ki),[[Ue,e.isPrivate]])])]),qi,e.image.tags.length?(g(),w("tr",Xi,[Qi,s("td",null,[(g(!0),w(ae,null,ye(e.image.tags,(f,h)=>(g(),w("span",{key:h,class:"bit"},F(f.title),1))),128))])])):G("",!0)])]),s("div",Ji,[s("button",{class:"btn",disabled:!e.canStartNewGame,onClick:t[9]||(t[9]=(...f)=>e.onNewGameClick&&e.onNewGameClick(...f))},ol,8,el),s("button",{class:"btn",onClick:t[10]||(t[10]=f=>e.$emit("close"))},"Cancel")])]),_:1})}var Xs=se(Si,[["render",nl]]);const il=ie({components:{ImageLibrary:Hs,NewImageDialog:Ks,EditImageDialog:qs,NewGameDialog:Xs},data(){return{filters:{sort:"date_desc",tags:[]},images:[],tags:[],image:{id:0,filename:"",file:"",url:"",title:"",tags:[],created:0},dialog:"",newGameForcePrivate:!1,uploading:"",uploadProgress:0}},async created(){await this.loadImages()},computed:{relevantTags(){return this.tags.filter(e=>e.total>0)}},methods:{autocompleteTags(e,t){return this.tags.filter(o=>!t.includes(o.title)&&o.title.toLowerCase().startsWith(e.toLowerCase())).slice(0,10).map(o=>o.title)},toggleTag(e){this.filters.tags.includes(e.slug)?this.filters.tags=this.filters.tags.filter(t=>t!==e.slug):this.filters.tags.push(e.slug),this.filtersChanged()},async loadImages(){const t=await(await _e.get(`/api/newgame-data${I.asQueryArgs(this.filters)}`,{})).json();this.images=t.images,this.tags=t.tags},async filtersChanged(){await this.loadImages()},onImageClicked(e){this.image=e,this.newGameForcePrivate=!1,this.dialog="new-game"},onImageEditClicked(e){this.image=e,this.dialog="edit-image"},async uploadImage(e){this.uploadProgress=0;const t=new FormData;t.append("file",e.file,e.file.name),t.append("title",e.title),t.append("tags",e.tags),t.append("private",e.isPrivate);const o=await _e.post("/api/upload",{body:t,onUploadProgress:n=>{this.uploadProgress=n.loaded/n.total}});return this.uploadProgress=1,await o.json()},async saveImage(e){return await(await _e.post("/api/save-image",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:e.id,title:e.title,tags:e.tags})})).json()},async onSaveImageClick(e){const t=await this.saveImage(e);t.ok?(this.dialog="",await this.loadImages()):alert(t.error)},async postToGalleryClick(e){this.uploading="postToGallery",await this.uploadImage(e),this.uploading="",this.dialog="",await this.loadImages()},async setupGameClick(e){this.uploading="setupGame";const t=await this.uploadImage(e);this.uploading="",this.loadImages(),this.image=t,this.newGameForcePrivate=e.isPrivate,this.dialog="new-game"},async onNewGame(e){const t=await _e.post("/api/newgame",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status===200){const o=await t.json();this.$router.push({name:"game",params:{id:o.id}})}}}}),ll={class:"upload-image-teaser"},rl=s("div",{class:"hint"},"(The image you upload will be added to the public gallery.)",-1),al={key:0},ul=m(" Tags: "),cl=["onClick"],dl=m(" Sort by: "),hl=s("option",{value:"date_desc"},"Newest first",-1),pl=s("option",{value:"date_asc"},"Oldest first",-1),gl=s("option",{value:"alpha_asc"},"A-Z",-1),ml=s("option",{value:"alpha_desc"},"Z-A",-1),fl=[hl,pl,gl,ml];function _l(e,t,o,n,i,r){const a=L("image-library"),u=L("new-image-dialog"),f=L("edit-image-dialog"),h=L("new-game-dialog");return g(),w("div",null,[s("div",ll,[s("div",{class:"btn btn-big",onClick:t[0]||(t[0]=O=>e.dialog="new-image")},"Upload your image"),rl]),s("div",null,[e.tags.length>0?(g(),w("label",al,[ul,(g(!0),w(ae,null,ye(e.relevantTags,(O,z)=>(g(),w("span",{class:Xe(["bit is-clickable",{on:e.filters.tags.includes(O.slug)}]),key:z,onClick:P=>e.toggleTag(O)},F(O.title)+" ("+F(O.total)+")",11,cl))),128))])):G("",!0),s("label",null,[dl,j(s("select",{"onUpdate:modelValue":t[1]||(t[1]=O=>e.filters.sort=O),onChange:t[2]||(t[2]=(...O)=>e.filtersChanged&&e.filtersChanged(...O))},fl,544),[[zo,e.filters.sort]])])]),ee(a,{images:e.images,onImageClicked:e.onImageClicked,onImageEditClicked:e.onImageEditClicked},null,8,["images","onImageClicked","onImageEditClicked"]),e.dialog==="new-image"?(g(),te(u,{key:0,autocompleteTags:e.autocompleteTags,onClose:t[3]||(t[3]=O=>e.dialog=""),onBgclick:t[4]||(t[4]=O=>e.dialog=""),uploadProgress:e.uploadProgress,uploading:e.uploading,onPostToGalleryClick:e.postToGalleryClick,onSetupGameClick:e.setupGameClick},null,8,["autocompleteTags","uploadProgress","uploading","onPostToGalleryClick","onSetupGameClick"])):G("",!0),e.dialog==="edit-image"?(g(),te(f,{key:1,autocompleteTags:e.autocompleteTags,onClose:t[5]||(t[5]=O=>e.dialog=""),onBgclick:t[6]||(t[6]=O=>e.dialog=""),onSaveClick:e.onSaveImageClick,image:e.image},null,8,["autocompleteTags","onSaveClick","image"])):G("",!0),e.image&&e.dialog==="new-game"?(g(),te(h,{key:2,onClose:t[7]||(t[7]=O=>e.dialog=""),onBgclick:t[8]||(t[8]=O=>e.dialog=""),onNewGame:e.onNewGame,image:e.image,forcePrivate:e.newGameForcePrivate},null,8,["onNewGame","image","forcePrivate"])):G("",!0)])}var yl=se(il,[["render",_l]]);const wl=ie({props:{players:{type:Object,required:!0}},methods:{playerStyle(e){return e.color==="ukraine"?{backgroundImage:"linear-gradient(180deg, rgba(0,87,183,1) 0%, rgba(0,87,183,1) 50%, rgba(255,221,0,1) 50%)","-webkit-background-clip":"text","-webkit-text-fill-color":"transparent"}:{color:e.color}}},computed:{actives(){return this.players.active.sort((e,t)=>t.points-e.points),this.players.active},idles(){return this.players.idle.sort((e,t)=>t.points-e.points),this.players.idle}}}),vl={class:"scores"},El=s("div",null,"Scores",-1),Pl=s("td",null,[s("i",{class:"icon icon-lightning"})],-1),bl=s("td",null,[s("i",{class:"icon icon-zzz"})],-1);function Tl(e,t,o,n,i,r){return g(),w("div",vl,[El,s("table",null,[(g(!0),w(ae,null,ye(e.actives,(a,u)=>(g(),w("tr",{key:u,style:Ie(e.playerStyle(a))},[Pl,s("td",null,F(a.name),1),s("td",null,F(a.points),1)],4))),128)),(g(!0),w(ae,null,ye(e.idles,(a,u)=>(g(),w("tr",{key:u,style:Ie(e.playerStyle(a))},[bl,s("td",null,F(a.name),1),s("td",null,F(a.points),1)],4))),128))])])}var xt=se(wl,[["render",Tl]]);const $l=ie({props:{status:{type:Object,required:!0}},computed:{durationStr(){return Te.durationStr(this.status.duration)}}}),Sl={class:"puzzle-status"},Cl=s("i",{class:"icon icon-puzzle-piece"},null,-1),kl={key:0,class:"icon icon-clock"},Al={key:1,class:"icon icon-flag"};function Ol(e,t,o,n,i,r){return g(),w("div",Sl,[s("div",null,[Cl,m(" "+F(e.status.piecesDone)+"/"+F(e.status.piecesTotal),1)]),s("div",null,[this.status.finished?(g(),w("i",Al)):(g(),w("i",kl)),m(" "+F(e.durationStr),1)])])}var Yt=se($l,[["render",Ol]]);const Nl=ie({emits:{"update:modelValue":null},props:{modelValue:{type:Object,required:!0}},data:()=>({showTable:!1,tableTexture:"dark",background:"",color:"",isUkraineColor:!1,name:"",soundsEnabled:!0,otherPlayerClickSoundEnabled:!0,soundsVolume:100,showPlayerNames:!0,watches:[]}),methods:{updateVolume(e){const t=parseInt(e.target.value);this.soundsVolume=t},decreaseVolume(){this.soundsVolume=Math.max(0,this.soundsVolume-5)},increaseVolume(){this.soundsVolume=Math.min(100,this.soundsVolume+5)},apply(e){this.disableWatches(),this.showTable=!!e.showTable,this.tableTexture=e.tableTexture,this.background=`${e.background}`,this.color=`${e.color}`,this.isUkraineColor=this.color==="ukraine",this.name=`${e.name}`,this.soundsEnabled=!!e.soundsEnabled,this.otherPlayerClickSoundEnabled=!!e.otherPlayerClickSoundEnabled,this.soundsVolume=parseInt(`${e.soundsVolume}`,10),this.showPlayerNames=!!e.showPlayerNames,this.enableWatches()},emitChanges(){this.$emit("update:modelValue",{showTable:this.showTable,tableTexture:this.tableTexture,background:this.background,color:this.isUkraineColor?"ukraine":this.color,name:this.name,soundsEnabled:this.soundsEnabled,otherPlayerClickSoundEnabled:this.otherPlayerClickSoundEnabled,soundsVolume:this.soundsVolume,showPlayerNames:this.showPlayerNames})},enableWatches(){this.watches.push(this.$watch(()=>this.isUkraineColor,this.emitChanges)),this.watches.push(this.$watch(()=>this.background,this.emitChanges)),this.watches.push(this.$watch(()=>this.showTable,this.emitChanges)),this.watches.push(this.$watch(()=>this.tableTexture,this.emitChanges)),this.watches.push(this.$watch(()=>this.color,this.emitChanges)),this.watches.push(this.$watch(()=>this.name,this.emitChanges)),this.watches.push(this.$watch(()=>this.soundsEnabled,this.emitChanges)),this.watches.push(this.$watch(()=>this.otherPlayerClickSoundEnabled,this.emitChanges)),this.watches.push(this.$watch(()=>this.soundsVolume,this.emitChanges)),this.watches.push(this.$watch(()=>this.showPlayerNames,this.emitChanges))},disableWatches(){const e=this.watches;this.watches=[],e.forEach(t=>t())}},created(){this.apply(this.modelValue)}}),we=e=>(Do("data-v-2535bf00"),e=e(),Bo(),e),Ul={class:"settings"},Rl=we(()=>s("td",null,[s("label",null,"Background: ")],-1)),Ll=we(()=>s("td",null,[s("label",null,"Table: ")],-1)),Vl=m("Show"),Ml={key:0},zl=m(" Dark"),Dl={key:1},Bl=m(" Light"),Gl=we(()=>s("td",null,[s("label",null,"Color: ")],-1)),Il=we(()=>s("i",{class:"icon icon-ukraine-heart"},null,-1)),xl=we(()=>s("td",null,[s("label",null,"Name: ")],-1)),Yl=we(()=>s("td",null,[s("label",null,"Sounds: ")],-1)),Wl=we(()=>s("td",null,[s("label",null,"Piece connect sounds of others: ")],-1)),Fl=["disabled"],Zl=we(()=>s("td",null,[s("label",null,"Sounds Volume: ")],-1)),Hl={class:"sound-volume"},jl=we(()=>s("i",{class:"icon icon-volume-down"},null,-1)),Kl=[jl],ql=["disabled","value"],Xl=we(()=>s("i",{class:"icon icon-volume-up"},null,-1)),Ql=[Xl],Jl=we(()=>s("td",null,[s("label",null,"Show player names: ")],-1));function er(e,t,o,n,i,r){const a=L("overlay");return g(),te(a,{class:"transparent"},{default:re(()=>[s("table",Ul,[s("tr",null,[Rl,s("td",null,[j(s("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=u=>e.background=u)},null,512),[[Re,e.background]])])]),s("tr",null,[Ll,s("td",null,[s("label",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=u=>e.showTable=u)},null,512),[[Ue,e.showTable]]),Vl]),e.showTable?(g(),w("label",Ml,[j(s("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=u=>e.tableTexture=u),value:"dark"},null,512),[[be,e.tableTexture]]),zl])):G("",!0),e.showTable?(g(),w("label",Dl,[j(s("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=u=>e.tableTexture=u),value:"light"},null,512),[[be,e.tableTexture]]),Bl])):G("",!0)])]),s("tr",null,[Gl,s("td",null,[e.isUkraineColor?G("",!0):j((g(),w("input",{key:0,type:"color","onUpdate:modelValue":t[4]||(t[4]=u=>e.color=u)},null,512)),[[Re,e.color]]),s("label",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=u=>e.isUkraineColor=u)},null,512),[[Ue,e.isUkraineColor]]),Il])])]),s("tr",null,[xl,s("td",null,[j(s("input",{type:"text",maxLength:"16","onUpdate:modelValue":t[6]||(t[6]=u=>e.name=u)},null,512),[[Re,e.name]])])]),s("tr",null,[Yl,s("td",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=u=>e.soundsEnabled=u)},null,512),[[Ue,e.soundsEnabled]])])]),s("tr",null,[Wl,s("td",null,[j(s("input",{type:"checkbox",disabled:!e.soundsEnabled,"onUpdate:modelValue":t[8]||(t[8]=u=>e.otherPlayerClickSoundEnabled=u)},null,8,Fl),[[Ue,e.otherPlayerClickSoundEnabled]])])]),s("tr",null,[Zl,s("td",Hl,[s("span",{onClick:t[9]||(t[9]=(...u)=>e.decreaseVolume&&e.decreaseVolume(...u))},Kl),s("input",{disabled:!e.soundsEnabled,type:"range",min:"0",max:"100",value:e.soundsVolume,onChange:t[10]||(t[10]=(...u)=>e.updateVolume&&e.updateVolume(...u))},null,40,ql),s("span",{onClick:t[11]||(t[11]=(...u)=>e.increaseVolume&&e.increaseVolume(...u))},Ql)])]),s("tr",null,[Jl,s("td",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=u=>e.showPlayerNames=u)},null,512),[[Ue,e.showPlayerNames]])])])])]),_:1})}var Wt=se(Nl,[["render",er],["__scopeId","data-v-2535bf00"]]);const tr=ie({props:{img:String},computed:{previewStyle(){return{backgroundImage:`url('${this.img}')`}}}}),sr={class:"preview"};function or(e,t,o,n,i,r){const a=L("overlay");return g(),te(a,{class:"preview-overlay",animate:!1},{default:re(()=>[s("div",sr,[s("div",{class:"img",style:Ie(e.previewStyle)},null,4)])]),_:1})}var Ft=se(tr,[["render",or]]);const nr=ie({props:{game:{type:Object,required:!0}},computed:{scoreMode(){switch(this.game.scoreMode){case Le.ANY:return["Any","Score when pieces are connected to each other or on final location"];case Le.FINAL:default:return["Final","Score when pieces are put to their final location"]}},shapeMode(){switch(this.game.shapeMode){case Ke.FLAT:return["Flat","All pieces flat on all sides"];case Ke.ANY:return["Any","Flat pieces can occur anywhere"];case Ke.NORMAL:default:return["Normal",""]}},snapMode(){switch(this.game.snapMode){case xe.REAL:return["Real","Pieces snap only to corners, already snapped pieces and to each other"];case xe.NORMAL:default:return["Normal","Pieces snap to final destination and to each other"]}}}}),ir={class:"help"},lr=s("tr",null,[s("td",{colspan:"2"},"Info about this puzzle")],-1),rr=s("td",null,"Image Title: ",-1),ar=s("td",null,"Scoring: ",-1),ur=["title"],cr=s("td",null,"Shapes: ",-1),dr=["title"],hr=s("td",null,"Snapping: ",-1),pr=["title"];function gr(e,t,o,n,i,r){const a=L("overlay");return g(),te(a,{class:"transparent"},{default:re(()=>[s("table",ir,[lr,s("tr",null,[rr,s("td",null,F(e.game.puzzle.info.image.title),1)]),s("tr",null,[ar,s("td",null,[s("span",{title:e.snapMode[1]},F(e.scoreMode[0]),9,ur)])]),s("tr",null,[cr,s("td",null,[s("span",{title:e.snapMode[1]},F(e.shapeMode[0]),9,dr)])]),s("tr",null,[hr,s("td",null,[s("span",{title:e.snapMode[1]},F(e.snapMode[0]),9,pr)])])])]),_:1})}var Zt=se(nr,[["render",gr]]);const mr=4,fr=1,_r=4,yr=2,wr=3,vr=1,Er=2,Pr=4,br=3,Tr=1,$r=2,Sr=3,Cr=4,kr=5,Ar=6,Or=7,Nr=8,Ur=9,Rr=10,Lr=11,Vr=12,Mr=13,zr=14,Dr=15,Br=16,Gr=17,Ir=18,xr=19,Yr=20,Wr=21,Fr=22,Zr=1,Hr=2,jr=3,Kr=4;var p={EV_SERVER_EVENT:fr,EV_SERVER_INIT:_r,EV_CLIENT_EVENT:yr,EV_CLIENT_INIT:wr,GAME_VERSION:mr,LOG_HEADER:vr,LOG_ADD_PLAYER:Er,LOG_UPDATE_PLAYER:Pr,LOG_HANDLE_INPUT:br,INPUT_EV_MOVE:Ur,INPUT_EV_MOUSE_DOWN:Tr,INPUT_EV_MOUSE_UP:$r,INPUT_EV_MOUSE_MOVE:Sr,INPUT_EV_ZOOM_IN:Cr,INPUT_EV_ZOOM_OUT:kr,INPUT_EV_BG_COLOR:Ar,INPUT_EV_PLAYER_COLOR:Or,INPUT_EV_PLAYER_NAME:Nr,INPUT_EV_TOGGLE_PREVIEW:Rr,INPUT_EV_TOGGLE_SOUNDS:Lr,INPUT_EV_REPLAY_TOGGLE_PAUSE:Vr,INPUT_EV_REPLAY_SPEED_UP:Mr,INPUT_EV_REPLAY_SPEED_DOWN:zr,INPUT_EV_TOGGLE_PLAYER_NAMES:Dr,INPUT_EV_CENTER_FIT_PUZZLE:Br,INPUT_EV_TOGGLE_FIXED_PIECES:Gr,INPUT_EV_TOGGLE_LOOSE_PIECES:Ir,INPUT_EV_TOGGLE_TABLE:Fr,INPUT_EV_STORE_POS:xr,INPUT_EV_RESTORE_POS:Yr,INPUT_EV_CONNECTION_CLOSE:Wr,CHANGE_DATA:Zr,CHANGE_PIECE:Hr,CHANGE_PLAYER:jr,PLAYER_SNAP:Kr};const qr=Dt("Communication.js"),Xr=1001,Ht=4e3,Qs=0,$t=1,jt=2,Js=3,eo=4;let fe,St=[],Ct=e=>{St.push(e)},kt=[],At=e=>{kt.push(e)};function Qr(e){Ct=e;for(const t of St)Ct(t);St=[]}function Jr(e){At=e;for(const t of kt)At(t);kt=[]}let Ot=Qs;const Ze=e=>{Ot!==e&&(Ot=e,At(e))};function to(e){if(Ot===jt)try{fe.send(JSON.stringify(e))}catch{qr.info("unable to send message.. maybe because ws is invalid?")}}let Be,Ge,Nt=0;function so(e=2e4){fe.readyState==fe.OPEN&&fe.send(""),Nt=setTimeout(so,e)}function ks(){Nt&&clearTimeout(Nt)}function ea(e,t,o){return Be=0,Ge={},Ze(Js),new Promise(n=>{fe=new WebSocket(e,o+"|"+t),fe.onopen=()=>{Ze(jt),to([p.EV_CLIENT_INIT]),so()},fe.onmessage=i=>{const r=JSON.parse(i.data),a=r[0];if(a===p.EV_SERVER_INIT){const u=r[1];n(u)}else if(a===p.EV_SERVER_EVENT){const u=r[1],f=r[2];if(u===o&&Ge[f]){delete Ge[f];return}Ct(r)}else throw`[ 2021-05-09 invalid connect msgType ${a} ]`},fe.onerror=()=>{throw ks(),Ze($t),"[ 2021-05-15 onerror ]"},fe.onclose=i=>{ks(),i.code===Ht||i.code===Xr?Ze(eo):Ze($t)}})}async function ta(e,t){const o={gameId:e,offset:t};return await(await _e.get(`/api/replay-data${I.asQueryArgs(o)}`,{})).json()}function sa(){fe&&fe.close(Ht),Be=0,Ge={}}function oa(e){Be++,Ge[Be]=e,to([p.EV_CLIENT_EVENT,Be,Ge[Be]])}var Ce={connect:ea,requestReplayData:ta,disconnect:sa,sendClientEvent:oa,onServerChange:Qr,onConnectionStateChange:Jr,CODE_CUSTOM_DISCONNECT:Ht,CONN_STATE_NOT_CONNECTED:Qs,CONN_STATE_DISCONNECTED:$t,CONN_STATE_CLOSED:eo,CONN_STATE_CONNECTED:jt,CONN_STATE_CONNECTING:Js};const na=ie({emits:{reconnect:null},props:{connectionState:Number},computed:{lostConnection(){return this.connectionState===Ce.CONN_STATE_DISCONNECTED},connecting(){return this.connectionState===Ce.CONN_STATE_CONNECTING},show(){return!!(this.lostConnection||this.connecting)}}}),ia={key:0},la=s("i",{class:"icon icon-disconnect"},null,-1),ra=m(" LOST CONNECTION "),aa=s("i",{class:"icon icon-disconnect"},null,-1),ua=[la,ra,aa],ca={key:2};function da(e,t,o,n,i,r){const a=L("overlay");return j((g(),te(a,{class:"connection-lost"},{default:re(()=>[e.lostConnection?(g(),w("div",ia,ua)):G("",!0),e.lostConnection?(g(),w("span",{key:1,class:"btn",onClick:t[0]||(t[0]=u=>e.$emit("reconnect"))},"Reconnect")):G("",!0),e.connecting?(g(),w("div",ca,"Connecting...")):G("",!0)]),_:1},512)),[[Gs,e.show]])}var oo=se(na,[["render",da]]);const ha=ie({}),pa=s("table",{class:"help"},[s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-up"}),m(" Move up:")]),s("td",null,[s("div",null,[s("kbd",null,"W"),m("/"),s("kbd",null,"\u2191"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-down"}),m(" Move down:")]),s("td",null,[s("div",null,[s("kbd",null,"S"),m("/"),s("kbd",null,"\u2193"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-left"}),m(" Move left:")]),s("td",null,[s("div",null,[s("kbd",null,"A"),m("/"),s("kbd",null,"\u2190"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-right"}),m(" Move right:")]),s("td",null,[s("div",null,[s("kbd",null,"D"),m("/"),s("kbd",null,"\u2192"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td"),s("td",null,[s("div",null,[m("Move faster by holding "),s("kbd",null,"Shift")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-zoom-in"}),m(" Zoom in:")]),s("td",null,[s("div",null,[s("kbd",null,"E"),m("/"),s("i",{class:"icon icon-mouse-wheel"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-zoom-out"}),m(" Zoom out:")]),s("td",null,[s("div",null,[s("kbd",null,"Q"),m("/"),s("i",{class:"icon icon-mouse-wheel"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-preview"}),m(" Toggle preview:")]),s("td",null,[s("div",null,[s("kbd",null,"Space")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-center"}),m(" Center puzzle in screen:")]),s("td",null,[s("div",null,[s("kbd",null,"C")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-puzzle-piece-locked"}),m(" Toggle fixed pieces:")]),s("td",null,[s("div",null,[s("kbd",null,"F")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-puzzle-piece-free"}),m(" Toggle loose pieces:")]),s("td",null,[s("div",null,[s("kbd",null,"G")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-table"}),m(" Toggle table:")]),s("td",null,[s("div",null,[s("kbd",null,"T")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-player-name"}),m(" Toggle player names:")]),s("td",null,[s("div",null,[s("kbd",null,"N")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-volume-up"}),m(" Toggle sounds:")]),s("td",null,[s("div",null,[s("kbd",null,"M")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-save-pos"}),m(" Store position [0-9]:")]),s("td",null,[s("div",null,[s("kbd",null,"Shift"),m(" + "),s("kbd",null,"0"),m("-"),s("kbd",null,"9")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-load-pos"}),m(" Restore position [0-9]:")]),s("td",null,[s("div",null,[s("kbd",null,"0"),m("-"),s("kbd",null,"9")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-speed-up"}),m(" Speed up (replay):")]),s("td",null,[s("div",null,[s("kbd",null,"I")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-speed-down"}),m(" Speed down (replay):")]),s("td",null,[s("div",null,[s("kbd",null,"O")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-pause"}),m(" Pause (replay):")]),s("td",null,[s("div",null,[s("kbd",null,"P")])])])],-1);function ga(e,t,o,n,i,r){const a=L("overlay");return g(),te(a,{class:"transparent"},{default:re(()=>[pa]),_:1})}var Kt=se(ha,[["render",ga]]),ma="/assets/click.bb97cb07.mp3",fa=Object.freeze(Object.defineProperty({__proto__:null,default:ma},Symbol.toStringTag,{value:"Module"})),_a="/assets/click2.98536db5.mp3",ya=Object.freeze(Object.defineProperty({__proto__:null,default:_a},Symbol.toStringTag,{value:"Module"})),wa="/assets/wood-dark.1e21ffc1.jpg",va=Object.freeze(Object.defineProperty({__proto__:null,default:wa},Symbol.toStringTag,{value:"Module"})),Ea="/assets/wood-light.ae1bd383.jpg",Pa=Object.freeze(Object.defineProperty({__proto__:null,default:Ea},Symbol.toStringTag,{value:"Module"})),ba="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAW0lEQVQ4je1RywrAIAxLxP//5exixRWlVgZelpOKeTQFfnDypgy3eLIkSLLL8mxGPoHsU2hPAgDHBLvRX6hZZw/fwT0BtlLSONqCbWAmEIqMZOCDDlaDR3N03gOyDCn+y4DWmAAAAABJRU5ErkJggg==",Ta=Object.freeze(Object.defineProperty({__proto__:null,default:ba},Symbol.toStringTag,{value:"Module"})),$a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAARElEQVQ4jWNgGAU0Af+hmBCbgYGBgYERhwHEAEYGBgYGJtIdiApYyLAZBVDsAqoagC1ACQJyY4ERg0GCISh6KA4DigEAou8LC+LnIJoAAAAASUVORK5CYII=",Sa=Object.freeze(Object.defineProperty({__proto__:null,default:$a},Symbol.toStringTag,{value:"Module"})),Ca="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAcUlEQVQ4ja1TQQ7AIAgD///n7jCozA2Hbk00jbG1KIrcARszTugoBs49qioZj7r2kKACptkyAOCJsJuA+GzglwHjvMSSWFVaENWVASxh5eRLiq5fN/ASjI89VcP2K3hHpq1cEXNaMfnrL3TDZP2tDuoOA6MzCCXWr38AAAAASUVORK5CYII=",ka=Object.freeze(Object.defineProperty({__proto__:null,default:Ca},Symbol.toStringTag,{value:"Module"})),Aa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAU0lEQVQ4jWNgoAH4D8X42HDARKlt5BoAd82AuQAOGLGIYQQUPv0wF5CiCQUge4EsQ5C9QI4BjMguwBYeBAElscCIy1ZivMKIwSDBEBQ9FCckigEAU3QOD7TGvY4AAAAASUVORK5CYII=",Oa=Object.freeze(Object.defineProperty({__proto__:null,default:Aa},Symbol.toStringTag,{value:"Module"}));const Na=e=>{let t=!1;const o=()=>{t=!0},n=e.fps||60,i=e.slow||1,r=e.update,a=e.render,u=window.requestAnimationFrame,f=1/n,h=i*f;let O,z=0,P=window.performance.now();const _=()=>{for(O=window.performance.now(),z=z+Math.min(1,(O-P)/1e3);z>h;)z=z-h,r(f);a(z/i),P=O,t||u(_)};return u(_),{stop:o}};let As=.1;const Ua=6,Ra=.05;class Ut{constructor(t=null){this.x=0,this.y=0,this.curZoom=1,t&&this.fromSnapshot(t)}calculateZoomCapping(t,o,n,i){As=Math.max(.1,t/n,o/i)}snapshot(){return{x:this.x,y:this.y,curZoom:this.curZoom}}getCurrentZoom(){return this.curZoom}fromSnapshot(t){this.x=t.x,this.y=t.y,this.curZoom=t.curZoom}reset(){this.x=0,this.y=0,this.curZoom=1}move(t,o){this.x+=t/this.curZoom,this.y+=o/this.curZoom}calculateNewZoom(t){const o=t==="in"?1:-1,n=this.curZoom+Ra*this.curZoom*o;return Math.min(Math.max(n,As),Ua)}canZoom(t){return this.curZoom!=this.calculateNewZoom(t)}setZoom(t,o){if(this.curZoom==t)return!1;const n=1-this.curZoom/t;return this.move(-o.x*n,-o.y*n),this.curZoom=t,!0}zoom(t,o){return this.setZoom(this.calculateNewZoom(t),o)}viewportToWorld(t){const{x:o,y:n}=this.viewportToWorldRaw(t);return{x:Math.round(o),y:Math.round(n)}}viewportToWorldRaw(t){return{x:t.x/this.curZoom-this.x,y:t.y/this.curZoom-this.y}}worldToViewport(t){const{x:o,y:n}=this.worldToViewportRaw(t);return{x:Math.round(o),y:Math.round(n)}}worldToViewportRaw(t){return{x:(t.x+this.x)*this.curZoom,y:(t.y+this.y)*this.curZoom}}worldDimToViewport(t){const{w:o,h:n}=this.worldDimToViewportRaw(t);return{w:Math.round(o),h:Math.round(n)}}worldDimToViewportRaw(t){return{w:t.w*this.curZoom,h:t.h*this.curZoom}}viewportDimToWorld(t){const{w:o,h:n}=this.viewportDimToWorldRaw(t);return{w:Math.round(o),h:Math.round(n)}}viewportDimToWorldRaw(t){return{w:t.w/this.curZoom,h:t.h/this.curZoom}}}function qe(e=0,t=0){const o=document.createElement("canvas");return o.width=e,o.height=t,o}async function La(e){return new Promise(t=>{const o=new Image;o.onload=()=>{createImageBitmap(o).then(t)},o.src=e})}async function Va(e,t,o){const n=qe(t,o);return n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,o),await createImageBitmap(n)}function Ma(e,t,o){if(o==="ukraine"){const r=qe(e.width,e.height),a=r.getContext("2d"),u=t.height/1.75;a.save(),a.drawImage(t,0,0),a.fillStyle="#0057B7",a.globalCompositeOperation="source-in",a.fillRect(0,0,t.width,u),a.restore(),a.save(),a.globalCompositeOperation="destination-over",a.drawImage(e,0,0),a.restore();const f=qe(e.width,e.height/2),h=f.getContext("2d");return h.save(),h.drawImage(t,0,-u),h.fillStyle="#FFDD00",h.globalCompositeOperation="source-in",h.fillRect(0,0,t.width,t.height),h.restore(),h.save(),h.globalCompositeOperation="destination-over",h.drawImage(e,0,-u),h.restore(),a.drawImage(f,0,u),r}const n=qe(e.width,e.height),i=n.getContext("2d");return i.save(),i.drawImage(t,0,0),i.fillStyle=o,i.globalCompositeOperation="source-in",i.fillRect(0,0,t.width,t.height),i.restore(),i.save(),i.globalCompositeOperation="destination-over",i.drawImage(e,0,0),i.restore(),n}var he={createCanvas:qe,loadImageToBitmap:La,resizeBitmap:Va,colorizedCanvas:Ma};const za=Dt("Debug.js");let Rt=0,no=0;const Da=e=>{Rt=performance.now(),no=e},Ba=e=>{const t=performance.now(),o=t-Rt;o>no&&za.log(e+": "+o),Rt=t};var Ae={checkpoint_start:Da,checkpoint:Ba};function Ga(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ia(e,t){return{x:e.x+t.x,y:e.y+t.y}}function io(e,t){const o=e.x-t.x,n=e.y-t.y;return Math.sqrt(o*o+n*n)}function xa(e,t){return e.x>=t.x&&e.x<=t.x+t.w&&e.y>=t.y&&e.y<=t.y+t.h}function Lt(e){return{x:e.x+e.w/2,y:e.y+e.h/2}}function Ya(e,t,o){return{x:e.x+t,y:e.y+o,w:e.w,h:e.h}}function Wa(e,t){return!(t.x>e.x+e.w||e.x>t.x+t.w||t.y>e.y+e.h||e.y>t.y+t.h)}function Fa(e,t){return io(Lt(e),Lt(t))}var Q={pointSub:Ga,pointAdd:Ia,pointDistance:io,pointInBounds:xa,rectCenter:Lt,rectMoved:Ya,rectCenterDistance:Fa,rectsOverlap:Wa};const Os=Dt("PuzzleGraphics.js");async function Za(e,t,o){Os.log("start createPuzzleTileBitmaps");const n=o.tileSize,i=o.tileMarginWidth,r=o.tileDrawSize,a=n/100,u=[0,0,40,15,37,5,37,5,40,0,38,-5,38,-5,20,-20,50,-20,50,-20,80,-20,62,-5,62,-5,60,0,63,5,63,5,65,15,100,0],f=new Array(t.length),h={};function O(v){const Y=`${v.top}${v.right}${v.left}${v.bottom}`;if(h[Y])return h[Y];const R=new Path2D,S={x:i,y:i},C=Q.pointAdd(S,{x:n,y:0}),b=Q.pointAdd(C,{x:0,y:n}),N=Q.pointSub(b,{x:n,y:0});if(R.moveTo(S.x,S.y),v.top!==0)for(let d=0;d<u.length/6;d++){const oe=Q.pointAdd(S,{x:u[d*6+0]*a,y:v.top*u[d*6+1]*a}),Z=Q.pointAdd(S,{x:u[d*6+2]*a,y:v.top*u[d*6+3]*a}),ne=Q.pointAdd(S,{x:u[d*6+4]*a,y:v.top*u[d*6+5]*a});R.bezierCurveTo(oe.x,oe.y,Z.x,Z.y,ne.x,ne.y)}else R.lineTo(C.x,C.y);if(v.right!==0)for(let d=0;d<u.length/6;d++){const oe=Q.pointAdd(C,{x:-v.right*u[d*6+1]*a,y:u[d*6+0]*a}),Z=Q.pointAdd(C,{x:-v.right*u[d*6+3]*a,y:u[d*6+2]*a}),ne=Q.pointAdd(C,{x:-v.right*u[d*6+5]*a,y:u[d*6+4]*a});R.bezierCurveTo(oe.x,oe.y,Z.x,Z.y,ne.x,ne.y)}else R.lineTo(b.x,b.y);if(v.bottom!==0)for(let d=0;d<u.length/6;d++){const oe=Q.pointSub(b,{x:u[d*6+0]*a,y:v.bottom*u[d*6+1]*a}),Z=Q.pointSub(b,{x:u[d*6+2]*a,y:v.bottom*u[d*6+3]*a}),ne=Q.pointSub(b,{x:u[d*6+4]*a,y:v.bottom*u[d*6+5]*a});R.bezierCurveTo(oe.x,oe.y,Z.x,Z.y,ne.x,ne.y)}else R.lineTo(N.x,N.y);if(v.left!==0)for(let d=0;d<u.length/6;d++){const oe=Q.pointSub(N,{x:-v.left*u[d*6+1]*a,y:u[d*6+0]*a}),Z=Q.pointSub(N,{x:-v.left*u[d*6+3]*a,y:u[d*6+2]*a}),ne=Q.pointSub(N,{x:-v.left*u[d*6+5]*a,y:u[d*6+4]*a});R.bezierCurveTo(oe.x,oe.y,Z.x,Z.y,ne.x,ne.y)}else R.lineTo(S.x,S.y);return h[Y]=R,R}const z=he.createCanvas(r,r),P=z.getContext("2d"),_=he.createCanvas(r,r),k=_.getContext("2d");for(const v of t){const Y=I.decodePiece(v),R=Ha(o,Y.idx),S=O(I.decodeShape(o.shapes[Y.idx]));P.clearRect(0,0,r,r),P.save(),P.lineWidth=2,P.stroke(S),P.globalCompositeOperation="source-in",P.drawImage(e,R.x-i,R.y-i,r,r,0,0,r,r),P.restore(),P.save(),P.globalCompositeOperation="source-in",P.globalAlpha=.2,P.fillStyle="black",P.fillRect(0,0,z.width,z.height),P.restore(),P.save(),P.clip(S),P.drawImage(e,R.x-i,R.y-i,r,r,0,0,r,r),P.restore(),P.save(),P.clip(S),P.strokeStyle="rgba(0,0,0,.4)",P.lineWidth=0,P.shadowColor="black",P.shadowBlur=2,P.shadowOffsetX=-1,P.shadowOffsetY=-1,P.stroke(S),P.restore(),P.save(),P.clip(S),P.strokeStyle="rgba(255,255,255,.4)",P.lineWidth=0,P.shadowColor="white",P.shadowBlur=2,P.shadowOffsetX=1,P.shadowOffsetY=1,P.stroke(S),P.restore(),k.clearRect(0,0,r,r),k.save(),k.lineWidth=1,k.stroke(S),k.globalCompositeOperation="source-in",k.drawImage(e,R.x-i,R.y-i,r,r,0,0,r,r),k.restore(),P.drawImage(_,0,0),f[Y.idx]=await createImageBitmap(z)}return Os.log("end createPuzzleTileBitmaps"),f}function Ha(e,t){const o=I.coordByPieceIdxDeprecated(e,t);return{x:o.x*e.tileSize,y:o.y*e.tileSize,w:e.tileSize,h:e.tileSize}}async function ja(e){const t=await he.loadImageToBitmap(e.info.imageUrl),o=await he.resizeBitmap(t,e.info.width,e.info.height);return await Za(o,e.tiles,e.info)}var Ka={loadPuzzleBitmaps:ja};const lo=30,T={};function qa(e){return!!T[e]||!1}function Xa(e,t){return{id:e,x:0,y:0,d:0,name:null,color:null,bgcolor:null,points:0,ts:t}}function Qa(e,t){T[e]=t}function Ja(e){delete T[e]}function dt(e,t){let o=0;for(const n of T[e].players){if(I.decodePlayer(n).id===t)return o;o++}return-1}function eu(e,t){return T[e].players.length>t?I.decodePlayer(T[e].players[t]).id:null}function Me(e,t){const o=dt(e,t);return o===-1?null:I.decodePlayer(T[e].players[o])}function qt(e,t,o){const n=dt(e,t);n===-1?T[e].players.push(I.encodePlayer(o)):T[e].players[n]=I.encodePlayer(o)}function tu(e,t,o){T[e].puzzle.tiles[t]=I.encodePiece(o)}function su(e,t){T[e].puzzle.data=t}function ro(e,t){return dt(e,t)!==-1}function ou(e,t){return _o(T[e],t)}function nu(e,t){return Vu(T[e],t)}function iu(e,t,o){ro(e,t)?le(e,t,{ts:o}):qt(e,t,Xa(t,o))}function lu(e){return T[e]||null}function Vt(e){return ss(T[e])}function ru(e){return yo(T[e])}function vt(e){return T[e].scoreMode}function ao(e){return T[e].snapMode}function uo(e){return T[e].gameVersion}function Mt(e){return ts(T[e])}function au(e){return T[e].puzzle.tiles.map(I.decodePiece).sort((o,n)=>o.z-n.z)}function le(e,t,o){const n=Me(e,t);if(n!==null){for(const i of Object.keys(o))n[i]=o[i];qt(e,t,n)}}function st(e,t){for(const o of Object.keys(t))T[e].puzzle.data[o]=t[o]}function Ve(e,t,o){for(const n of Object.keys(o)){const i=I.decodePiece(T[e].puzzle.tiles[t]);i[n]=o[n],T[e].puzzle.tiles[t]=I.encodePiece(i)}}const ze=(e,t)=>I.decodePiece(T[e].puzzle.tiles[t]),ut=(e,t)=>ze(e,t).group,uu=(e,t)=>{const o=T[e].puzzle.info;return t===0||t===o.tilesX-1||t===o.tiles-o.tilesX||t===o.tiles-1},co=(e,t)=>{const o=T[e].puzzle.info,n={x:(o.table.width-o.width)/2,y:(o.table.height-o.height)/2},i=_u(e,t);return Q.pointAdd(n,i)},lt=(e,t)=>ze(e,t).pos,Xt=e=>uo(e)<=3?du(e):cu(e),cu=e=>({x:0,y:0,w:Jt(e),h:es(e)}),du=e=>{const t=Jt(e),o=es(e),n=Math.round(t/4),i=Math.round(o/4);return{x:0-n,y:0-i,w:t+2*n,h:o+2*i}},hu=(e,t)=>ze(e,t).z,He=(e,t)=>{for(const o of T[e].puzzle.tiles){const n=I.decodePiece(o);if(n.owner===t)return n.idx}return-1},pu=(e,t)=>{const o=He(e,t);return o<0?null:T[e].puzzle.tiles[o]},ho=e=>T[e].puzzle.info.tileDrawOffset,Qt=e=>T[e].puzzle.info.tileDrawSize,gu=e=>go(T[e]),mu=e=>mo(T[e]),Ns=e=>T[e].puzzle.data.maxGroup,Us=e=>T[e].puzzle.data.maxZ,fu=(e,t)=>{let o=0;for(const n of t){const i=hu(e,n);i>o&&(o=i)}return o};function _u(e,t){const o=T[e].puzzle.info,n=I.coordByPieceIdxDeprecated(o,t),i=n.x*o.tileSize,r=n.y*o.tileSize;return{x:i,y:r}}function yu(e,t){const o=T[e].puzzle.info,n=I.coordByPieceIdxDeprecated(o,t);return[n.y>0?t-o.tilesX:-1,n.x<o.tilesX-1?t+1:-1,n.y<o.tilesY-1?t+o.tilesX:-1,n.x>0?t-1:-1]}const Rs=(e,t,o)=>{for(const n of t)Ve(e,n,{z:o})},po=(e,t,o)=>{const n=lt(e,t),i=Q.pointAdd(n,o);Ve(e,t,{pos:i})},ot=(e,t,o)=>uo(e)>=3?vu(e,t,o):wu(e,t,o),wu=(e,t,o)=>{const n=Qt(e),i=Xt(e),r=o;for(const a of t){const u=ze(e,a);u.pos.x+o.x<i.x?r.x=Math.max(i.x-u.pos.x,r.x):u.pos.x+n+o.x>i.x+i.w&&(r.x=Math.min(i.x+i.w-u.pos.x+n,r.x)),u.pos.y+o.y<i.y?r.y=Math.max(i.y-u.pos.y,r.y):u.pos.y+n+o.y>i.y+i.h&&(r.y=Math.min(i.y+i.h-u.pos.y+n,r.y))}if(!r.x&&!r.y)return!1;for(const a of t)po(e,a,r);return!0},vu=(e,t,o)=>{const n=Xt(e),i=Qt(e)+2*ho(e),r=n.x,a=n.y,u=r+n.w-i,f=a+n.h-i,h=o;for(const O of t){const z=ze(e,O);o.x<0?h.x=Math.max(r-z.pos.x,h.x):h.x=Math.min(u-z.pos.x,h.x),o.y<0?h.y=Math.max(a-z.pos.y,h.y):h.y=Math.min(f-z.pos.y,h.y)}if(!h.x&&!h.y)return!1;for(const O of t)po(e,O,h);return!0},Eu=(e,t)=>Pu(e,t)===-1,Pu=(e,t)=>ze(e,t).owner,Ls=(e,t)=>{for(const o of t)Ve(e,o,{owner:-1,z:1})},Et=(e,t,o)=>{for(const n of t)Ve(e,n,{owner:o})};function bu(e,t){return Pe(e,t).length}function Pe(e,t){const o=T[e].puzzle.tiles,n=I.decodePiece(o[t]),i=[];if(n.group)for(const r of o){const a=I.decodePiece(r);a.group===n.group&&i.push(a.idx)}else i.push(n.idx);return i}const Tu=(e,t)=>{const o=T[e].puzzle.info,n=T[e].puzzle.tiles;let i=-1,r=-1;for(let a=0;a<n.length;a++){const u=I.decodePiece(n[a]);if(u.owner!==0)continue;const f={x:u.pos.x,y:u.pos.y,w:o.tileSize,h:o.tileSize};Q.pointInBounds(t,f)&&(i===-1||u.z>i)&&(i=u.z,r=a)}return r},$u=(e,t)=>{const o=Me(e,t);return o?o.bgcolor:null},Su=(e,t)=>{const o=Me(e,t);return o?o.color:null},Cu=(e,t)=>{const o=Me(e,t);return o?o.name:null},Vs=(e,t)=>{const o=Me(e,t);return o?o.points:0},ku=(e,t,o)=>{const n=ut(e,t),i=ut(e,o);return!!(n&&n===i)},Jt=e=>T[e].puzzle.info.table.width,es=e=>T[e].puzzle.info.table.height,Au=e=>T[e].puzzle,Ou=e=>T[e].rng.obj,Nu=e=>T[e].puzzle.info.width,Uu=e=>T[e].puzzle.info.height,Ru=(e,t)=>{if(ao(e)===xe.REAL){for(const o of t)if(uu(e,o))return!0;return!1}return!0};function Lu(e,t,o,n){const i=T[e].puzzle,r=[],a=()=>{r.push([p.CHANGE_DATA,i.data])},u=_=>{r.push([p.CHANGE_PIECE,I.encodePiece(ze(e,_))])},f=_=>{for(const k of _)u(k)},h=()=>{const _=Me(e,t);!_||r.push([p.CHANGE_PLAYER,I.encodePlayer(_)])};let O=!1;const z=(_,k,v)=>{const Y=T[_].puzzle.tiles,R=ut(_,k),S=ut(_,v);let C;const b=[];if(R&&b.push(R),S&&b.push(S),R)C=R;else if(S)C=S;else{const N=Ns(_)+1;st(_,{maxGroup:N}),a(),C=Ns(_)}if(Ve(_,k,{group:C}),u(k),Ve(_,v,{group:C}),u(v),b.length>0)for(const N of Y){const d=I.decodePiece(N);b.includes(d.group)&&(Ve(_,d.idx,{group:C}),u(d.idx))}},P=o[0];if(P===p.INPUT_EV_CONNECTION_CLOSE){const _=He(e,t);if(_>=0){const k=Pe(e,_);Et(e,k,0),f(k)}}else if(P===p.INPUT_EV_BG_COLOR){const _=o[1];le(e,t,{bgcolor:_,ts:n}),h()}else if(P===p.INPUT_EV_PLAYER_COLOR){const _=o[1];le(e,t,{color:_,ts:n}),h()}else if(P===p.INPUT_EV_PLAYER_NAME){const _=`${o[1]}`.substr(0,16);le(e,t,{name:_,ts:n}),h()}else if(P===p.INPUT_EV_MOVE){const _=o[1],k=o[2],v=Me(e,t);if(v){const Y=v.x-_,R=v.y-k;le(e,t,{ts:n,x:Y,y:R}),h();const S=He(e,t);if(S>=0){const C=Pe(e,S),b={x:-_,y:-k};ot(e,C,b)&&f(C)}}}else if(P===p.INPUT_EV_MOUSE_DOWN){const _=o[1],k=o[2],v={x:_,y:k};le(e,t,{d:1,ts:n}),h();const Y=Tu(e,v);if(Y>=0){const R=Us(e)+1;st(e,{maxZ:R}),a();const S=Pe(e,Y);Rs(e,S,Us(e)),Et(e,S,t),f(S)}}else if(P===p.INPUT_EV_MOUSE_MOVE){const _=o[1],k=o[2];if(!o[5])le(e,t,{x:_,y:k,ts:n}),h();else{const Y=He(e,t);if(Y<0)le(e,t,{ts:n}),h();else{const R=o[1],S=o[2],C=o[3],b=o[4];le(e,t,{x:R,y:S,ts:n}),h();const N=Pe(e,Y);ot(e,N,{x:C,y:b})&&f(N)}}}else if(P===p.INPUT_EV_MOUSE_UP){const k=He(e,t);if(k>=0){const v=Pe(e,k);Et(e,v,0),f(v);const Y=lt(e,k),R=co(e,k);if(Ru(e,v)&&Q.pointDistance(R,Y)<i.info.snapDistance){const S=Q.pointSub(R,Y);ot(e,v,S),Ls(e,v),f(v);let C=Vs(e,t);vt(e)===Le.FINAL?C+=v.length:vt(e)===Le.ANY&&(C+=1),le(e,t,{d:0,ts:n,points:C}),h(),Mt(e)===Vt(e)&&(st(e,{finished:n}),a()),O=!0}else{const S=(b,N,d,oe)=>{const Z=T[b].puzzle.info;if(d<0||ku(b,N,d))return!1;const ne=lt(b,N),$e=Q.pointAdd(lt(b,d),{x:oe[0]*Z.tileSize,y:oe[1]*Z.tileSize});if(Q.pointDistance(ne,$e)<Z.snapDistance){const ke=Q.pointSub($e,ne);let ge=Pe(b,N);if(ot(b,ge,ke),z(b,N,d),ge=Pe(b,N),Eu(b,d))Ls(b,ge);else{const De=fu(b,ge);Rs(b,ge,De)}return f(ge),!0}return!1};let C=!1;for(const b of Pe(e,k)){const N=yu(e,b);if(S(e,b,N[0],[0,1])||S(e,b,N[1],[-1,0])||S(e,b,N[2],[0,-1])||S(e,b,N[3],[1,0])){C=!0;break}}if(C&&vt(e)===Le.ANY){const b=Vs(e,t)+1;le(e,t,{d:0,ts:n,points:b}),h()}else le(e,t,{d:0,ts:n}),h();C&&ao(e)===xe.REAL&&Mt(e)===Vt(e)&&(st(e,{finished:n}),a()),C&&(O=!0)}}else le(e,t,{d:0,ts:n}),h()}else if(P===p.INPUT_EV_ZOOM_IN){const _=o[1],k=o[2];le(e,t,{x:_,y:k,ts:n}),h()}else if(P===p.INPUT_EV_ZOOM_OUT){const _=o[1],k=o[2];le(e,t,{x:_,y:k,ts:n}),h()}else le(e,t,{ts:n}),h();return O&&r.push([p.PLAYER_SNAP,t]),r}function go(e){return e.puzzle.data.started}function mo(e){return e.puzzle.data.finished}function ts(e){let t=0;for(const o of e.puzzle.tiles)I.decodePiece(o).owner===-1&&t++;return t}function ss(e){return e.puzzle.tiles.length}function fo(e){return e.players.map(I.decodePlayer)}function _o(e,t){const o=t-lo*Te.SEC;return fo(e).filter(n=>n.ts>=o)}function Vu(e,t){const o=t-lo*Te.SEC;return fo(e).filter(n=>n.ts<o&&n.points>0)}function yo(e){var o;const t=((o=e.puzzle.info.image)==null?void 0:o.url)||e.puzzle.info.imageUrl;if(!t)throw new Error("[2021-07-11] no image url set");return t}function Mu(e){return ts(e)===ss(e)}var V={setGame:Qa,unsetGame:Ja,loaded:qa,playerExists:ro,getActivePlayers:ou,getIdlePlayers:nu,addPlayer:iu,getFinishedPiecesCount:Mt,getPieceCount:Vt,getImageUrl:ru,get:lu,getGroupedPieceCount:bu,getPlayerBgColor:$u,getPlayerColor:Su,getPlayerName:Cu,getPlayerIndexById:dt,getPlayerIdByIndex:eu,changePlayer:le,setPlayer:qt,setPiece:tu,setPuzzleData:su,getBounds:Xt,getTableWidth:Jt,getTableHeight:es,getPuzzle:Au,getRng:Ou,getPuzzleWidth:Nu,getPuzzleHeight:Uu,getPiecesSortedByZIndex:au,getFirstOwnedPiece:pu,getPieceDrawOffset:ho,getPieceDrawSize:Qt,getFinalPiecePos:co,getStartTs:gu,getFinishTs:mu,handleInput:Lu,Game_getStartTs:go,Game_getFinishTs:mo,Game_getFinishedPiecesCount:ts,Game_getPieceCount:ss,Game_getActivePlayers:_o,Game_getImageUrl:yo,Game_isFinished:Mu};let wo=-10,vo=20,zt=2,Eo=15;const zu=5,Du=5,os=1,Bu=200,Ms=10,Gu=100,Iu=10,xu=1,Yu=5;function Wu(e){const t=e.random(0,255),o=e.random(0,255),n=e.random(0,255);return"rgba("+t+","+o+","+n+", 0.8)"}class zs{constructor(t){this.radius=Ms,this.previousRadius=Ms,this.explodingDuration=Gu,this.hasExploded=!1,this.alive=!0,this.color=Wu(t),this.px=window.innerWidth/4+Math.random()*window.innerWidth/2,this.py=window.innerHeight,this.vx=wo+Math.random()*vo,this.vy=(zt+Math.random()*Eo)*-1,this.duration=0}update(t){if(this.hasExploded){const o=Bu-this.radius;this.previousRadius=this.radius,this.radius+=o/Iu,this.explodingDuration--,this.explodingDuration==0&&(this.alive=!1)}else this.vx+=0,this.vy+=os,this.vy>=0&&t&&this.explode(t),this.px+=this.vx,this.py+=this.vy}draw(t){t.beginPath(),t.arc(this.px,this.py,this.previousRadius,0,Math.PI*2,!1),this.hasExploded||(t.fillStyle=this.color,t.lineWidth=1,t.fill())}explode(t){this.hasExploded=!0;const o=3+Math.floor(Math.random()*3);for(let n=0;n<o;n++){const i=10+Math.floor(Math.random()*21),r=zu+Math.random()*Du,a=2*Math.PI/i,u=Math.random()*a;for(let f=0;f<i;f++)t.push(new Fu(this,f*a+u,r))}}}class Fu{constructor(t,o,n){this.px=t.px,this.py=t.py,this.vx=Math.cos(o)*n,this.vy=Math.sin(o)*n,this.color=t.color,this.duration=40+Math.floor(Math.random()*20),this.alive=!0,this.radius=0}update(){this.vx+=0,this.vy+=os/10,this.px+=this.vx,this.py+=this.vy,this.radius=3,this.duration--,this.duration<=0&&(this.alive=!1)}draw(t){t.beginPath(),t.arc(this.px,this.py,this.radius,0,Math.PI*2,!1),t.fillStyle=this.color,t.lineWidth=1,t.fill()}}class Zu{constructor(t,o){this.canvas=t,this.rng=o,this.ctx=this.canvas.getContext("2d"),this.resize(),this.readyBombs=[],this.explodedBombs=[],this.particles=[],window.addEventListener("resize",()=>{this.resize()})}setSpeedParams(){let t=0,o=0;for(;t<this.canvas.height&&o>=0;)o+=os,t+=o;zt=o/2,Eo=o-zt;const n=1/4*this.canvas.width/(o/2);wo=-n,vo=2*n}resize(){this.setSpeedParams()}init(){this.readyBombs=[],this.explodedBombs=[],this.particles=[];for(let t=0;t<xu;t++)this.readyBombs.push(new zs(this.rng))}update(){Math.random()*100<Yu&&this.readyBombs.push(new zs(this.rng));const t=[];for(;this.explodedBombs.length>0;){const i=this.explodedBombs.shift();if(!i)break;i.update(),i.alive&&t.push(i)}this.explodedBombs=t;const o=[];for(;this.readyBombs.length>0;){const i=this.readyBombs.shift();if(!i)break;i.update(this.particles),i.hasExploded?this.explodedBombs.push(i):o.push(i)}this.readyBombs=o;const n=[];for(;this.particles.length>0;){const i=this.particles.shift();if(!i)break;i.update(),i.alive&&n.push(i)}this.particles=n}render(){this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.readyBombs.length;t++)this.readyBombs[t].draw(this.ctx);for(let t=0;t<this.explodedBombs.length;t++)this.explodedBombs[t].draw(this.ctx);for(let t=0;t<this.particles.length;t++)this.particles[t].draw(this.ctx)}}function Hu(e,t,o,n){let i=[],r=!0,a=!1,u=!1,f=!1,h=!1,O=!1,z=!1,P=!1;const _=(E,D)=>{const A=o.viewportToWorld({x:E,y:D});return[A.x,A.y]},k=(E,D)=>{const A=o.viewportDimToWorld({w:E,h:D});return[A.w,A.h]},v=E=>_(E.offsetX,E.offsetY),Y=()=>_(e.width/2,e.height/2),R=(E,D)=>{!r||(D.code==="ShiftLeft"||D.code==="ShiftRight"?P=E:D.code==="ArrowUp"||D.code==="KeyW"?f=E:D.code==="ArrowDown"||D.code==="KeyS"?h=E:D.code==="ArrowLeft"||D.code==="KeyA"?a=E:D.code==="ArrowRight"||D.code==="KeyD"?u=E:D.code==="KeyQ"?z=E:D.code==="KeyE"&&(O=E))};let S=!1,C=null,b=null;const N=E=>{b=v(E),C=[E.offsetX,E.offsetY],E.button===0&&(S=!0,q([p.INPUT_EV_MOUSE_DOWN,...b]))},d=E=>{b=v(E),C=[E.offsetX,E.offsetY],E.button===0&&(S=!1,q([p.INPUT_EV_MOUSE_UP,...b]))},oe=E=>{if(!C)return;b=v(E);const D=k(-(C[0]-E.offsetX),-(C[1]-E.offsetY));q([p.INPUT_EV_MOUSE_MOVE,...b,...D,S?1:0]),C=[E.offsetX,E.offsetY]},Z=E=>{if(b=v(E),o.canZoom(E.deltaY<0?"in":"out")){const D=E.deltaY<0?p.INPUT_EV_ZOOM_IN:p.INPUT_EV_ZOOM_OUT;q([D,...b])}},ne=E=>R(!0,E),$e=E=>R(!1,E),ke=E=>{if(!!r){if(n===Ee&&(E.code==="KeyI"?q([p.INPUT_EV_REPLAY_SPEED_UP]):E.code==="KeyO"?q([p.INPUT_EV_REPLAY_SPEED_DOWN]):E.code==="KeyP"&&q([p.INPUT_EV_REPLAY_TOGGLE_PAUSE])),E.code==="Space")q([p.INPUT_EV_TOGGLE_PREVIEW]);else if(E.code==="KeyF")q([p.INPUT_EV_TOGGLE_FIXED_PIECES]);else if(E.code==="KeyG")q([p.INPUT_EV_TOGGLE_LOOSE_PIECES]);else if(E.code==="KeyM")q([p.INPUT_EV_TOGGLE_SOUNDS]);else if(E.code==="KeyN")q([p.INPUT_EV_TOGGLE_PLAYER_NAMES]);else if(E.code==="KeyT")q([p.INPUT_EV_TOGGLE_TABLE]);else if(E.code==="KeyC")q([p.INPUT_EV_CENTER_FIT_PUZZLE]);else for(let D=0;D<=9;D++)if(E.code===`Digit${D}`){const A=E.shiftKey?p.INPUT_EV_STORE_POS:p.INPUT_EV_RESTORE_POS;q([A,D]);break}}},ge=()=>{e.addEventListener("mousedown",N),e.addEventListener("mouseup",d),e.addEventListener("mousemove",oe),e.addEventListener("wheel",Z),t.addEventListener("keydown",ne),t.addEventListener("keyup",$e),t.addEventListener("keypress",ke)},De=()=>{e.removeEventListener("mousedown",N),e.removeEventListener("mouseup",d),e.removeEventListener("mousemove",oe),e.removeEventListener("wheel",Z),t.removeEventListener("keydown",ne),t.removeEventListener("keyup",$e),t.removeEventListener("keypress",ke)},Ye=(E,D)=>{if(!C||!b)return;const A=new Ut(E).viewportToWorld({x:C[0],y:C[1]}),ve=new Ut(D).viewportToWorld({x:C[0],y:C[1]}),ue=[-(A.x-ve.x),-(A.y-ve.y)];q([p.INPUT_EV_MOUSE_MOVE,...b,...ue,S?1:0])},q=E=>{i.push(E)};return{registerEvents:ge,unregisterEvents:De,addEvent:q,consumeAll:()=>{if(i.length===0)return[];const E=i.slice();return i=[],E},createKeyEvents:()=>{const E=(a?1:0)-(u?1:0),D=(f?1:0)-(h?1:0);if(E!==0||D!==0){const A=(P?24:12)*Math.sqrt(o.getCurrentZoom()),ve=o.viewportDimToWorld({w:E*A,h:D*A});q([p.INPUT_EV_MOVE,ve.w,ve.h]),b&&(b[0]-=ve.w,b[1]-=ve.h)}if(!(O&&z)){if(O){if(o.canZoom("in")){const A=b||Y();q([p.INPUT_EV_ZOOM_IN,...A])}}else if(z&&o.canZoom("out")){const A=b||Y();q([p.INPUT_EV_ZOOM_OUT,...A])}}},createSnapshotEvents:Ye,setHotkeys:E=>{r=E}}}const nt={"./grab.png":Ta,"./grab_mask.png":Sa,"./hand.png":ka,"./hand_mask.png":Oa},Ds={"./assets/textures/wood-dark.jpg":va,"./assets/textures/wood-light.jpg":Pa},Bs={"./click.mp3":fa,"./click2.mp3":ya},je="play",Ee="replay";let Oe=!0,Ne=!0;const ju=e=>e.owner===-1?Oe:Ne;let J=!0;async function Po(e,t,o,n,i,r){typeof window.DEBUG=="undefined"&&(window.DEBUG=!1);const a=l=>n===Ee||l.id!==t,u=Bs["./click.mp3"].default,f=Bs["./click2.mp3"].default,h=new Audio(u),O=new Audio(f),z=await he.loadImageToBitmap(nt["./grab.png"].default),P=await he.loadImageToBitmap(nt["./hand.png"].default),_=await he.loadImageToBitmap(nt["./grab_mask.png"].default),k=await he.loadImageToBitmap(nt["./hand_mask.png"].default),v=z.width,Y=Math.round(v/2),R=z.height,S=Math.round(R/2),C={},b=async l=>{const c=l.color+" "+l.d;if(!C[c]){const y=l.d?z:P;if(l.color){const B=l.d?_:k;C[c]=await createImageBitmap(he.colorizedCanvas(y,B,l.color))}else C[c]=y}return C[c]},N=i,d={final:!1,log:[],logPointer:0,speeds:[.5,1,2,5,10,20,50,100,250,500],speedIdx:1,paused:!1,lastRealTs:0,lastGameTs:0,gameStartTs:0,skipNonActionPhases:!0,dataOffset:0};Ce.onConnectionStateChange(l=>{r.emit("connectionState",l)});const oe=async l=>{const c=d.dataOffset;d.dataOffset+=1e4;const y=await Ce.requestReplayData(l,c);return d.log=d.log.slice(d.logPointer),d.logPointer=0,d.log.push(...y.log),y.log.length===0&&(d.final=!0),y};let Z=()=>0;const ne=async()=>{if(n===je){const l=await Ce.connect(o,e,t),c=I.decodeGame(l);V.setGame(c.id,c),Z=()=>Te.timestamp()}else if(n===Ee){const l=await oe(e);if(!l.game)throw"[ 2021-05-29 no game received ]";const c=I.decodeGame(l.game);V.setGame(c.id,c),d.lastRealTs=Te.timestamp(),d.gameStartTs=parseInt(l.log[0][4],10),d.lastGameTs=d.gameStartTs,Z=()=>d.lastGameTs}else throw"[ 2020-12-22 MODE invalid, must be play|replay ]";J=!0};await ne();const $e=V.getPieceDrawOffset(e),ke=V.getPieceDrawSize(e),ge=V.getPuzzleWidth(e),De=V.getPuzzleHeight(e),Ye=V.getTableWidth(e),q=V.getTableHeight(e),ns={x:(Ye-ge)/2,y:(q-De)/2},ht={w:ge,h:De},is={w:ke,h:ke},E=await Ka.loadPuzzleBitmaps(V.getPuzzle(e)),D=new Zu(N,V.getRng(e));D.init();const A=N.getContext("2d");N.classList.add("loaded"),r.emit("puzzleCut");let ve="";const ue={},U=new Ut;U.calculateZoomCapping(window.innerWidth,window.innerHeight,Ye,q);const $o=()=>{U.reset(),U.move(-(Ye-N.width)/2,-(q-N.height)/2);const l=U.worldDimToViewportRaw(ht),c=20,y=N.width-c*2,B=N.height-c*2;if(l.w>y||l.h>B||l.w<y&&l.h<B){const x=Math.min(y/l.w,B/l.h),W={x:N.width/2,y:N.height/2};U.setZoom(x,W)}},ce=Hu(N,window,U,n);ce.registerEvents();const Qe=l=>{if(ue.last&&ve===l){const c=U.snapshot(),y=ue.last;return U.fromSnapshot(y),ce.createSnapshotEvents(c,y),delete ue.last,"last"}else if(ue[l]){const c=ue[l],y=U.snapshot();return ue.last=y,ve=l,U.fromSnapshot(c),ce.createSnapshotEvents(y,c),l}else return null};$o(),ue.center=U.snapshot();const So=V.getImageUrl(e),Je=l=>{const c=V.getStartTs(e),y=V.getFinishTs(e);r.emit("status",{finished:!!y,duration:(y||l)-c,piecesDone:V.getFinishedPiecesCount(e),piecesTotal:V.getPieceCount(e)}),r.emit("players",{active:V.getActivePlayers(e,l),idle:V.getIdlePlayers(e,l)})};Je(Z());const ls=!!V.getFinishTs(e);let pt=ls;const rs=()=>pt&&!ls,gt=()=>H.getInt(X.SOUND_VOLUME,pe.SOUND_VOLUME),as=()=>H.getBool(X.OTHER_PLAYER_CLICK_SOUND_ENABLED,pe.OTHER_PLAYER_CLICK_SOUND_ENABLED),mt=()=>H.getBool(X.SOUND_ENABLED,pe.SOUND_ENABLED),us=()=>H.getBool(X.SHOW_PLAYER_NAMES,pe.SHOW_PLAYER_NAMES),Co=()=>H.getBool(X.SHOW_TABLE,pe.SHOW_TABLE),ko=()=>H.getStr(X.TABLE_TEXTURE,pe.TABLE_TEXTURE),cs=()=>n===Ee?H.getStr(X.COLOR_BACKGROUND,pe.COLOR_BACKGROUND):V.getPlayerBgColor(e,t)||H.getStr(X.COLOR_BACKGROUND,pe.COLOR_BACKGROUND),ds=()=>n===Ee?H.getStr(X.PLAYER_COLOR,pe.PLAYER_COLOR):V.getPlayerColor(e,t)||H.getStr(X.PLAYER_COLOR,pe.PLAYER_COLOR),Ao=()=>n===Ee?H.getStr(X.PLAYER_NAME,pe.PLAYER_NAME):V.getPlayerName(e,t)||H.getStr(X.PLAYER_NAME,pe.PLAYER_NAME),hs=()=>{const l=gt();h.volume=l/100,h.play()},Oo=()=>{const l=gt();O.volume=l/100,O.play()},M={background:cs(),showTable:Co(),tableTexture:ko(),color:ds(),name:Ao(),soundsEnabled:mt(),otherPlayerClickSoundEnabled:as(),soundsVolume:gt(),showPlayerNames:us()};ce.addEvent([p.INPUT_EV_BG_COLOR,M.background]),ce.addEvent([p.INPUT_EV_PLAYER_COLOR,M.color]),ce.addEvent([p.INPUT_EV_PLAYER_NAME,M.name]);let ps="",gs="",ms=!1;const We=l=>{ms=l;const[c,y]=l?[ps,"grab"]:[gs,"default"];N.style.cursor=`url('${c}') ${Y} ${S}, ${y}`},ft=l=>{ps=he.colorizedCanvas(z,_,l).toDataURL(),gs=he.colorizedCanvas(P,k,l).toDataURL(),We(ms)};ft(ds());const et=()=>{r.emit("replaySpeed",d.speeds[d.speedIdx]),r.emit("replayPaused",d.paused)},K=(l,c=void 0)=>{r.emit("statusMessage",{what:l,value:c})},fs=()=>{d.speedIdx+1<d.speeds.length&&(d.speedIdx++,et(),K("Speed Up"))},_s=()=>{d.speedIdx>=1&&(d.speedIdx--,et(),K("Speed Down"))},ys=()=>{d.paused=!d.paused,et(),K(d.paused?"Paused":"Playing")};let Fe=!1;const ws=()=>{Fe=!Fe,r.emit("togglePreview",Fe)},vs=()=>{M.soundsEnabled=!M.soundsEnabled;const l=M.soundsEnabled;r.emit("toggleSoundsEnabled",l),H.setBool(X.SOUND_ENABLED,l),K("Sounds",l)},Es=()=>{M.showPlayerNames=!M.showPlayerNames;const l=M.showPlayerNames;r.emit("togglePlayerNames",l),H.setBool(X.SHOW_PLAYER_NAMES,l),K("Player names",l)},Ps=()=>{M.showTable=!M.showTable;const l=M.showTable;r.emit("toggleShowTable",l),H.setBool(X.SHOW_TABLE,l),K("Table",l)};r.on("replayOnSpeedUp",()=>{fs()}),r.on("replayOnSpeedDown",()=>{_s()}),r.on("replayOnPauseToggle",()=>{ys()}),r.on("onPreviewChange",l=>{Fe!==l&&(Fe=l)}),r.on("onBgChange",l=>{M.background!==l&&(M.background=l,H.setStr(X.COLOR_BACKGROUND,l),ce.addEvent([p.INPUT_EV_BG_COLOR,l]),K("Background",l))}),r.on("onTableTextureChange",l=>{M.tableTexture!==l&&(M.tableTexture=l,H.setStr(X.TABLE_TEXTURE,l),K("Table texture",l),J=!0)}),r.on("onShowTableChange",l=>{M.showTable!==l&&(M.showTable=l,H.setStr(X.SHOW_TABLE,l),K("Table",l),J=!0)}),r.on("onColorChange",l=>{M.color!==l&&(M.color=l,H.setStr(X.PLAYER_COLOR,l),ce.addEvent([p.INPUT_EV_PLAYER_COLOR,l]),K("Color",l))}),r.on("onNameChange",l=>{M.name!==l&&(M.name=l,H.setStr(X.PLAYER_NAME,l),ce.addEvent([p.INPUT_EV_PLAYER_NAME,l]),K("Name",l))}),r.on("onOtherPlayerClickSoundEnabledChange",l=>{M.otherPlayerClickSoundEnabled!==l&&(M.otherPlayerClickSoundEnabled=l,H.setBool(X.OTHER_PLAYER_CLICK_SOUND_ENABLED,l),K("Other player sounds",l))}),r.on("onSoundsEnabledChange",l=>{M.soundsEnabled!==l&&(M.soundsEnabled=l,H.setBool(X.SOUND_ENABLED,l),K("Sounds",l))}),r.on("onSoundsVolumeChange",l=>{M.soundsVolume!==l&&(M.soundsVolume=l,H.setInt(X.SOUND_VOLUME,l),hs(),K("Volume",l))}),r.on("onShowPlayerNamesChange",l=>{M.showPlayerNames!==l&&(M.showPlayerNames=l,H.setBool(X.SHOW_PLAYER_NAMES,l),K("Player names",l))}),r.on("setHotkeys",l=>{ce.setHotkeys(l)}),r.on("requireRerender",()=>{J=!0});const bs=[];let tt;const No=()=>{bs.forEach(l=>{clearInterval(l)}),tt&&clearTimeout(tt)};if(n===je?bs.push(setInterval(()=>{Je(Z())},1e3)):n===Ee&&et(),n===je)Ce.onServerChange(l=>{l[0],l[1],l[2];const c=l[3];let y=!1,B=!1;for(const[x,W]of c)switch(x){case p.CHANGE_PLAYER:{const $=I.decodePlayer(W);$.id!==t&&(V.setPlayer(e,$.id,$),y=!0)}break;case p.CHANGE_PIECE:{const $=I.decodePiece(W);V.setPiece(e,$.idx,$),y=!0}break;case p.CHANGE_DATA:V.setPuzzleData(e,W),y=!0;break;case p.PLAYER_SNAP:W!==t&&(B=!0);break}B&&mt()&&as()&&Oo(),y&&(J=!0),pt=!!V.getFinishTs(e)});else if(n===Ee){const l=(B,x)=>{const W=B;if(W[0]===p.LOG_ADD_PLAYER){const $=W[1];return V.addPlayer(e,$,x),!0}if(W[0]===p.LOG_UPDATE_PLAYER){const $=V.getPlayerIdByIndex(e,W[1]);if(!$)throw"[ 2021-05-17 player not found (update player) ]";return V.addPlayer(e,$,x),!0}if(W[0]===p.LOG_HANDLE_INPUT){const $=V.getPlayerIdByIndex(e,W[1]);if(!$)throw"[ 2021-05-17 player not found (handle input) ]";const me=W[2];return V.handleInput(e,$,me,x),!0}return!1};let c=d.lastGameTs;const y=async()=>{d.logPointer+1>=d.log.length&&await oe(e);const B=Te.timestamp();if(d.paused){d.lastRealTs=B,tt=setTimeout(y,50);return}const W=(B-d.lastRealTs)*d.speeds[d.speedIdx];let $=d.lastGameTs+W,me=!0;do if(d.paused)me=!1;else{const Se=d.logPointer+1;if(Se>=d.log.length)me=!1;else{const de=d.log[d.logPointer],Ts=c+de[de.length-1],_t=d.log[Se],$s=_t[_t.length-1],yt=Ts+$s;yt>$?($+500*Te.MS<yt&&($+=$s),me=!1):(c=Ts,l(_t,yt)&&(J=!0),d.logPointer=Se)}}while(me);d.lastRealTs=B,d.lastGameTs=$,Je(Z()),d.final||(tt=setTimeout(y,50))};y()}const Uo=()=>{ce.createKeyEvents();for(const l of ce.consumeAll())if(n===je){const c=l[0];if(c===p.INPUT_EV_MOVE){const x=U.worldDimToViewportRaw({w:l[1],h:l[2]});J=!0,U.move(x.w,x.h),delete ue.last}else if(c===p.INPUT_EV_MOUSE_MOVE){if(l[5]&&!V.getFirstOwnedPiece(e,t)){const W=U.worldDimToViewportRaw({w:l[3],h:l[4]});J=!0,U.move(W.w,W.h),delete ue.last}}else if(c===p.INPUT_EV_PLAYER_COLOR)ft(l[1]);else if(c===p.INPUT_EV_MOUSE_DOWN)We(!0);else if(c===p.INPUT_EV_MOUSE_UP)We(!1);else if(c===p.INPUT_EV_ZOOM_IN){const x={x:l[1],y:l[2]};J=!0,U.zoom("in",U.worldToViewportRaw(x)),delete ue.last}else if(c===p.INPUT_EV_ZOOM_OUT){const x={x:l[1],y:l[2]};J=!0,U.zoom("out",U.worldToViewportRaw(x)),delete ue.last}else if(c===p.INPUT_EV_TOGGLE_PREVIEW)ws();else if(c===p.INPUT_EV_TOGGLE_SOUNDS)vs();else if(c===p.INPUT_EV_TOGGLE_PLAYER_NAMES)Es();else if(c===p.INPUT_EV_CENTER_FIT_PUZZLE){const x="center",W=Qe(x);K(W?`Restored position "${W}"`:`Position "${x}" not set`)}else if(c===p.INPUT_EV_TOGGLE_FIXED_PIECES)Oe=!Oe,K(`${Oe?"Showing":"Hiding"} finished pieces`),J=!0;else if(c===p.INPUT_EV_TOGGLE_LOOSE_PIECES)Ne=!Ne,K(`${Ne?"Showing":"Hiding"} unfinished pieces`),J=!0;else if(c===p.INPUT_EV_TOGGLE_TABLE)Ps();else if(c===p.INPUT_EV_STORE_POS){const x=`${l[1]}`;ue[x]=U.snapshot(),K(`Stored position ${x}`)}else if(c===p.INPUT_EV_RESTORE_POS){const x=`${l[1]}`,W=Qe(x);K(W?`Restored position "${W}"`:`Position "${x}" not set`)}const y=Z(),B=V.handleInput(e,t,l,y);mt()&&B.find(x=>x[0]===p.PLAYER_SNAP)&&hs(),B.length>0&&(J=!0),Ce.sendClientEvent(l)}else if(n===Ee){const c=l[0];if(c===p.INPUT_EV_REPLAY_TOGGLE_PAUSE)ys();else if(c===p.INPUT_EV_REPLAY_SPEED_DOWN)_s();else if(c===p.INPUT_EV_REPLAY_SPEED_UP)fs();else if(c===p.INPUT_EV_MOVE){const y=U.worldDimToViewportRaw({w:l[1],h:l[2]});J=!0,U.move(y.w,y.h)}else if(c===p.INPUT_EV_MOUSE_MOVE){if(l[5]){const B=U.worldDimToViewportRaw({w:l[3],h:l[4]});J=!0,U.move(B.w,B.h)}}else if(c===p.INPUT_EV_PLAYER_COLOR)ft(l[1]);else if(c===p.INPUT_EV_MOUSE_DOWN)We(!0);else if(c===p.INPUT_EV_MOUSE_UP)We(!1);else if(c===p.INPUT_EV_ZOOM_IN){const y={x:l[1],y:l[2]};J=!0,U.zoom("in",U.worldToViewportRaw(y))}else if(c===p.INPUT_EV_ZOOM_OUT){const y={x:l[1],y:l[2]};J=!0,U.zoom("out",U.worldToViewportRaw(y))}else if(c===p.INPUT_EV_TOGGLE_PREVIEW)ws();else if(c===p.INPUT_EV_TOGGLE_SOUNDS)vs();else if(c===p.INPUT_EV_TOGGLE_PLAYER_NAMES)Es();else if(c===p.INPUT_EV_CENTER_FIT_PUZZLE){const y="center",B=Qe(y);K(B?`Restored position "${B}"`:`Position "${y}" not set`)}else if(c===p.INPUT_EV_TOGGLE_FIXED_PIECES)Oe=!Oe,K(`${Oe?"Showing":"Hiding"} finished pieces`),J=!0;else if(c===p.INPUT_EV_TOGGLE_LOOSE_PIECES)Ne=!Ne,K(`${Ne?"Showing":"Hiding"} unfinished pieces`),J=!0;else if(c===p.INPUT_EV_TOGGLE_TABLE)Ps();else if(c===p.INPUT_EV_STORE_POS){const y=`${l[1]}`;ue[y]=U.snapshot(),K(`Stored position ${y}`)}else if(c===p.INPUT_EV_RESTORE_POS){const y=`${l[1]}`,B=Qe(y);K(B?`Restored position "${B}"`:`Position "${y}" not set`)}}pt=!!V.getFinishTs(e),rs()&&(D.update(),J=!0)},Ro=new DOMMatrix([1,0,0,1,0,0]),Lo={dark:await he.loadImageToBitmap(Ds["./assets/textures/wood-dark.jpg"].default),light:await he.loadImageToBitmap(Ds["./assets/textures/wood-light.jpg"].default)},Vo=Na({update:Uo,render:async()=>{if(!J)return;const l=Z();let c,y,B;if(window.DEBUG&&Ae.checkpoint_start(0),A.fillStyle=cs(),A.fillRect(0,0,N.width,N.height),M.showTable){const $=Lo[M.tableTexture];if($){const me=V.getBounds(e);c=U.worldToViewportRaw(me),y=U.worldDimToViewportRaw(me);const Se=A.createPattern($,"repeat");Se.setTransform(Ro.translate(c.x,c.y).scale(U.getCurrentZoom()*3)),A.fillStyle=Se,A.fillRect(c.x,c.y,y.w,y.h);const de=U.worldDimToViewportRaw({w:16,h:16});A.fillStyle="rgba(0, 0, 0, .5)",A.fillRect(c.x,c.y,y.w,de.h),A.fillRect(c.x,c.y+de.h,de.w,y.h-2*de.h),A.fillRect(c.x+y.w-de.w,c.y+de.h,de.w,y.h-2*de.h),A.fillRect(c.x,c.y+y.h-de.h,y.w,de.w)}}if(window.DEBUG&&Ae.checkpoint("clear done"),c=U.worldToViewportRaw(ns),y=U.worldDimToViewportRaw(ht),M.showTable){const $=U.worldDimToViewportRaw({w:8,h:8});A.fillStyle="rgba(0, 0, 0, .5)",A.fillRect(c.x-$.w,c.y-$.h,y.w+2*$.w,$.h),A.fillRect(c.x-$.w,c.y,$.h,y.h),A.fillRect(c.x+y.w,c.y,$.w,y.h),A.fillRect(c.x-$.w,c.y+y.h,y.w+2*$.w,$.h)}M.showTable&&M.tableTexture==="dark"?A.fillStyle="rgba(0, 0, 0, .3)":A.fillStyle="rgba(255, 255, 255, .3)",A.fillRect(c.x,c.y,y.w,y.h),window.DEBUG&&Ae.checkpoint("board done");const x=V.getPiecesSortedByZIndex(e);window.DEBUG&&Ae.checkpoint("get pieces done"),y=U.worldDimToViewportRaw(is);for(const $ of x)!ju($)||(B=E[$.idx],c=U.worldToViewportRaw({x:$e+$.pos.x,y:$e+$.pos.y}),A.drawImage(B,0,0,B.width,B.height,c.x,c.y,y.w,y.h));window.DEBUG&&Ae.checkpoint("pieces done");const W=[];for(const $ of V.getActivePlayers(e,l))a($)&&(B=await b($),c=U.worldToViewport($),A.drawImage(B,c.x-Y,c.y-S),us()&&W.push([`${$.name} (${$.points})`,c.x,c.y+R]));A.fillStyle="white",A.textAlign="center";for(const[$,me,Se]of W)A.fillText($,me,Se);window.DEBUG&&Ae.checkpoint("players done"),Je(l),window.DEBUG&&Ae.checkpoint("HUD done"),rs()&&D.render(),J=!1}}),Mo=()=>{No(),Vo.stop(),ce&&ce.unregisterEvents()};return{previewImageUrl:So,player:M,game:V.get(e),disconnect:Ce.disconnect,connect:ne,unload:Mo}}const Ku=ie({name:"game",components:{PuzzleStatusComponent:Yt,Scores:xt,SettingsOverlay:Wt,PreviewOverlay:Ft,InfoOverlay:Zt,ConnectionOverlay:oo,HelpOverlay:Kt},data(){return{statusMessages:[],players:{active:[],idle:[]},status:{finished:!1,duration:0,piecesDone:0,piecesTotal:0},overlay:"",connectionState:0,cuttingPuzzle:!0,eventBus:Is(),g:{player:xs(),game:null,previewImageUrl:"",connect:()=>{},disconnect:()=>{},unload:()=>{}}}},async mounted(){if(!this.$route.params.id)return;this.eventBus.on("puzzleCut",()=>{this.cuttingPuzzle=!1}),this.eventBus.on("players",t=>{this.players=t}),this.eventBus.on("status",t=>{this.status=t}),this.eventBus.on("connectionState",t=>{this.connectionState=t}),this.eventBus.on("togglePreview",t=>{this.toggleTo("preview",t,!1)}),this.eventBus.on("toggleSoundsEnabled",t=>{this.g.player.soundsEnabled=!!t}),this.eventBus.on("togglePlayerNames",t=>{this.g.player.showPlayerNames=!!t}),this.eventBus.on("toggleShowTable",t=>{this.g.player.showTable=!!t}),this.$watch(()=>this.g.player.background,t=>{this.eventBus.emit("onBgChange",t)}),this.$watch(()=>this.g.player.showTable,t=>{this.eventBus.emit("onShowTableChange",t)}),this.$watch(()=>this.g.player.tableTexture,t=>{this.eventBus.emit("onTableTextureChange",t)}),this.$watch(()=>this.g.player.color,t=>{this.eventBus.emit("onColorChange",t)}),this.$watch(()=>this.g.player.name,t=>{this.eventBus.emit("onNameChange",t)}),this.$watch(()=>this.g.player.soundsEnabled,t=>{this.eventBus.emit("onSoundsEnabledChange",t)}),this.$watch(()=>this.g.player.otherPlayerClickSoundEnabled,t=>{this.eventBus.emit("onOtherPlayerClickSoundEnabledChange",t)}),this.$watch(()=>this.g.player.soundsVolume,t=>{this.eventBus.emit("onSoundsVolumeChange",t)}),this.$watch(()=>this.g.player.showPlayerNames,t=>{this.eventBus.emit("onShowPlayerNamesChange",t)});const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",this.onResize),this.g=await Po(`${this.$route.params.id}`,_e.clientId(),this.$config.WS_ADDRESS,je,e,this.eventBus),this.eventBus.on("statusMessage",t=>{this.addStatusMessage(t.what,t.value)})},unmounted(){this.g.unload(),this.g.disconnect(),window.removeEventListener("resize",this.onResize)},methods:{addStatusMessage(e,t){typeof t=="undefined"?this.statusMessages.push(`${e}`):t===!0||t===!1?this.statusMessages.push(`${e} ${t?"enabled":"disabled"}`):this.statusMessages.push(`${e} changed to ${t}`),setTimeout(()=>{this.statusMessages.shift()},3e3)},onResize(){const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,this.eventBus.emit("requireRerender")},reconnect(){this.g.connect()},toggleTo(e,t,o){t===!1?(this.overlay="",o&&this.eventBus.emit("setHotkeys",!0)):(this.overlay=e,o&&this.eventBus.emit("setHotkeys",!1))},toggle(e,t){this.overlay===""?(this.overlay=e,t&&this.eventBus.emit("setHotkeys",!1)):(this.overlay="",t&&this.eventBus.emit("setHotkeys",!0)),e==="preview"&&this.eventBus.emit("onPreviewChange",this.overlay==="preview")}}}),qu={id:"game"},Xu=s("div",null,[s("i",{class:"icon icon-hourglass"}),m(" Cutting puzzle, please wait... "),s("i",{class:"icon icon-hourglass"})],-1),Qu={class:"menu-left"},Ju={key:0,class:"switch-game-replay"},ec=s("i",{class:"icon icon-replay"},null,-1),tc=m(" Watch replay"),sc={class:"menu"},oc={class:"tabs"},nc=s("i",{class:"icon icon-puzzle-piece"},null,-1),ic=m(" Puzzles"),lc=s("i",{class:"icon icon-preview"},null,-1),rc=m(" Preview"),ac=[lc,rc],uc=s("i",{class:"icon icon-settings"},null,-1),cc=m(" Settings"),dc=[uc,cc],hc=s("i",{class:"icon icon-info"},null,-1),pc=m(" Info"),gc=[hc,pc],mc=s("i",{class:"icon icon-hotkey"},null,-1),fc=m(" Hotkeys"),_c=[mc,fc],yc=s("a",{class:"opener",href:"https://ec.europa.eu/info/strategy/priorities-2019-2024/stronger-europe-world/eu-solidarity-ukraine/eu-assistance-ukraine/eu-stands-ukraine_en",target:"_blank"},[s("i",{class:"icon icon-ukraine-heart"}),m(" Stand with Ukraine ")],-1),wc={class:"menu-right"},vc={key:4,class:"status-messages"},Ec={ref:"canvas"};function Pc(e,t,o,n,i,r){const a=L("settings-overlay"),u=L("preview-overlay"),f=L("info-overlay"),h=L("help-overlay"),O=L("overlay"),z=L("connection-overlay"),P=L("puzzle-status"),_=L("router-link"),k=L("scores");return g(),w("div",qu,[e.overlay==="settings"?(g(),te(a,{key:0,onClose:t[0]||(t[0]=v=>e.toggle("settings",!0)),onBgclick:t[1]||(t[1]=v=>e.toggle("settings",!0)),modelValue:e.g.player,"onUpdate:modelValue":t[2]||(t[2]=v=>e.g.player=v)},null,8,["modelValue"])):G("",!0),e.overlay==="preview"?(g(),te(u,{key:1,onClose:t[3]||(t[3]=v=>e.toggle("preview",!1)),onClick:t[4]||(t[4]=v=>e.toggle("preview",!1)),img:e.g.previewImageUrl},null,8,["img"])):G("",!0),e.g.game&&e.overlay==="info"?(g(),te(f,{key:2,onClose:t[5]||(t[5]=v=>e.toggle("info",!0)),onBgclick:t[6]||(t[6]=v=>e.toggle("info",!0)),game:e.g.game},null,8,["game"])):G("",!0),e.overlay==="help"?(g(),te(h,{key:3,onClose:t[7]||(t[7]=v=>e.toggle("help",!0)),onBgclick:t[8]||(t[8]=v=>e.toggle("help",!0))})):G("",!0),j(ee(O,null,{default:re(()=>[Xu]),_:1},512),[[Gs,e.cuttingPuzzle]]),ee(z,{connectionState:e.connectionState,onReconnect:e.reconnect},null,8,["connectionState","onReconnect"]),s("div",Qu,[ee(P,{status:e.status},null,8,["status"]),e.g.game&&e.g.game.hasReplay?(g(),w("div",Ju,[ee(_,{to:{name:"replay",params:{id:e.g.game.id}}},{default:re(()=>[ec,tc]),_:1},8,["to"])])):G("",!0)]),s("div",sc,[s("div",oc,[ee(_,{class:"opener",to:{name:"index"},target:"_blank"},{default:re(()=>[nc,ic]),_:1}),s("div",{class:"opener",onClick:t[9]||(t[9]=v=>e.toggle("preview",!1))},ac),s("div",{class:"opener",onClick:t[10]||(t[10]=v=>e.toggle("settings",!0))},dc),s("div",{class:"opener",onClick:t[11]||(t[11]=v=>e.toggle("info",!0))},gc),s("div",{class:"opener",onClick:t[12]||(t[12]=v=>e.toggle("help",!0))},_c),yc])]),s("div",wc,[ee(k,{players:e.players},null,8,["players"])]),e.statusMessages.length?(g(),w("div",vc,[(g(!0),w(ae,null,ye(e.statusMessages,(v,Y)=>(g(),w("div",{key:Y},F(v),1))),128))])):G("",!0),s("canvas",Ec,null,512)])}var bc=se(Ku,[["render",Pc]]);const Tc=ie({name:"replay",components:{PuzzleStatusComponent:Yt,Scores:xt,SettingsOverlay:Wt,PreviewOverlay:Ft,InfoOverlay:Zt,HelpOverlay:Kt},data(){return{statusMessages:[],players:{active:[],idle:[]},status:{finished:!1,duration:0,piecesDone:0,piecesTotal:0},overlay:"",connectionState:0,cuttingPuzzle:!0,eventBus:Is(),g:{player:xs(),game:null,previewImageUrl:"",connect:()=>{},disconnect:()=>{},unload:()=>{}},replay:{speed:1,paused:!1}}},async mounted(){if(!this.$route.params.id)return;this.eventBus.on("puzzleCut",()=>{this.cuttingPuzzle=!1}),this.eventBus.on("players",t=>{this.players=t}),this.eventBus.on("status",t=>{this.status=t}),this.eventBus.on("connectionState",t=>{this.connectionState=t}),this.eventBus.on("togglePreview",t=>{this.toggleTo("preview",t,!1)}),this.eventBus.on("toggleSoundsEnabled",t=>{this.g.player.soundsEnabled=!!t}),this.eventBus.on("togglePlayerNames",t=>{this.g.player.showPlayerNames=!!t}),this.eventBus.on("toggleShowTable",t=>{this.g.player.showTable=!!t}),this.eventBus.on("replaySpeed",t=>{this.replay.speed=t}),this.eventBus.on("replayPaused",t=>{this.replay.paused=t}),this.$watch(()=>this.g.player.background,t=>{this.eventBus.emit("onBgChange",t)}),this.$watch(()=>this.g.player.showTable,t=>{this.eventBus.emit("onShowTableChange",t)}),this.$watch(()=>this.g.player.tableTexture,t=>{this.eventBus.emit("onTableTextureChange",t)}),this.$watch(()=>this.g.player.color,t=>{this.eventBus.emit("onColorChange",t)}),this.$watch(()=>this.g.player.name,t=>{this.eventBus.emit("onNameChange",t)}),this.$watch(()=>this.g.player.soundsEnabled,t=>{this.eventBus.emit("onSoundsEnabledChange",t)}),this.$watch(()=>this.g.player.otherPlayerClickSoundEnabled,t=>{this.eventBus.emit("onOtherPlayerClickSoundEnabledChange",t)}),this.$watch(()=>this.g.player.soundsVolume,t=>{this.eventBus.emit("onSoundsVolumeChange",t)}),this.$watch(()=>this.g.player.showPlayerNames,t=>{this.eventBus.emit("onShowPlayerNamesChange",t)});const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",this.onResize),this.g=await Po(`${this.$route.params.id}`,_e.clientId(),this.$config.WS_ADDRESS,Ee,e,this.eventBus),this.eventBus.on("statusMessage",t=>{this.addStatusMessage(t.what,t.value)})},unmounted(){this.g.unload(),this.g.disconnect(),window.removeEventListener("resize",this.onResize)},methods:{addStatusMessage(e,t){typeof t=="undefined"?this.statusMessages.push(`${e}`):t===!0||t===!1?this.statusMessages.push(`${e} ${t?"enabled":"disabled"}`):this.statusMessages.push(`${e} changed to ${t}`),setTimeout(()=>{this.statusMessages.shift()},3e3)},onResize(){const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,this.eventBus.emit("requireRerender")},toggleTo(e,t,o){t===!1?(this.overlay="",o&&this.eventBus.emit("setHotkeys",!0)):(this.overlay=e,o&&this.eventBus.emit("setHotkeys",!1))},toggle(e,t){this.overlay===""?(this.overlay=e,t&&this.eventBus.emit("setHotkeys",!1)):(this.overlay="",t&&this.eventBus.emit("setHotkeys",!0)),e==="preview"&&this.eventBus.emit("onPreviewChange",this.overlay==="preview")}},computed:{replayText(){return"Replay-Speed: "+(this.replay.speed+"x")+(this.replay.paused?" Paused":"")}}}),$c={id:"replay"},Sc={key:4,class:"overlay"},Cc=s("div",{class:"overlay-content"},[s("div",null,[s("i",{class:"icon icon-hourglass"}),m(" Cutting puzzle, please wait... "),s("i",{class:"icon icon-hourglass"})])],-1),kc=[Cc],Ac={class:"menu-left"},Oc={class:"playback-control"},Nc=s("i",{class:"icon icon-speed-up"},null,-1),Uc=[Nc],Rc=s("i",{class:"icon icon-speed-down"},null,-1),Lc=[Rc],Vc=s("i",{class:"icon icon-pause"},null,-1),Mc=[Vc],zc={key:0,class:"switch-game-replay"},Dc=s("i",{class:"icon icon-puzzle-piece"},null,-1),Bc=m(" To the game"),Gc={class:"menu"},Ic={class:"tabs"},xc=s("i",{class:"icon icon-puzzle-piece"},null,-1),Yc=m(" Puzzles"),Wc=s("i",{class:"icon icon-preview"},null,-1),Fc=m(" Preview"),Zc=[Wc,Fc],Hc=s("i",{class:"icon icon-settings"},null,-1),jc=m(" Settings"),Kc=[Hc,jc],qc=s("i",{class:"icon icon-info"},null,-1),Xc=m(" Info"),Qc=[qc,Xc],Jc=s("i",{class:"icon icon-hotkey"},null,-1),ed=m(" Hotkeys"),td=[Jc,ed],sd=s("a",{class:"opener",href:"https://ec.europa.eu/info/strategy/priorities-2019-2024/stronger-europe-world/eu-solidarity-ukraine/eu-assistance-ukraine/eu-stands-ukraine_en",target:"_blank"},[s("i",{class:"icon icon-ukraine-heart"}),m(" Stand with Ukraine ")],-1),od={class:"menu-right"},nd={key:5,class:"status-messages"},id={ref:"canvas"};function ld(e,t,o,n,i,r){const a=L("settings-overlay"),u=L("preview-overlay"),f=L("info-overlay"),h=L("help-overlay"),O=L("puzzle-status"),z=L("router-link"),P=L("scores");return g(),w("div",$c,[e.overlay==="settings"?(g(),te(a,{key:0,onClose:t[0]||(t[0]=_=>e.toggle("settings",!0)),onBgclick:t[1]||(t[1]=_=>e.toggle("settings",!0)),modelValue:e.g.player,"onUpdate:modelValue":t[2]||(t[2]=_=>e.g.player=_)},null,8,["modelValue"])):G("",!0),e.overlay==="preview"?(g(),te(u,{key:1,onClose:t[3]||(t[3]=_=>e.toggle("preview",!1)),onClick:t[4]||(t[4]=_=>e.toggle("preview",!1)),img:e.g.previewImageUrl},null,8,["img"])):G("",!0),e.g.game&&e.overlay==="info"?(g(),te(f,{key:2,onClose:t[5]||(t[5]=_=>e.toggle("info",!0)),onBgclick:t[6]||(t[6]=_=>e.toggle("info",!0)),game:e.g.game},null,8,["game"])):G("",!0),e.overlay==="help"?(g(),te(h,{key:3,onClose:t[7]||(t[7]=_=>e.toggle("help",!0)),onBgclick:t[8]||(t[8]=_=>e.toggle("help",!0))})):G("",!0),e.cuttingPuzzle?(g(),w("div",Sc,kc)):G("",!0),s("div",Ac,[ee(O,{status:e.status},null,8,["status"]),s("div",Oc,[s("div",null,F(e.replayText),1),s("button",{class:"btn",onClick:t[9]||(t[9]=_=>e.eventBus.emit("replayOnSpeedUp"))},Uc),s("button",{class:"btn",onClick:t[10]||(t[10]=_=>e.eventBus.emit("replayOnSpeedDown"))},Lc),s("button",{class:"btn",onClick:t[11]||(t[11]=_=>e.eventBus.emit("replayOnPauseToggle"))},Mc)]),e.g.game?(g(),w("div",zc,[ee(z,{to:{name:"game",params:{id:e.g.game.id}}},{default:re(()=>[Dc,Bc]),_:1},8,["to"])])):G("",!0)]),s("div",Gc,[s("div",Ic,[ee(z,{class:"opener",to:{name:"index"},target:"_blank"},{default:re(()=>[xc,Yc]),_:1}),s("div",{class:"opener",onClick:t[12]||(t[12]=_=>e.toggle("preview",!1))},Zc),s("div",{class:"opener",onClick:t[13]||(t[13]=_=>e.toggle("settings",!0))},Kc),s("div",{class:"opener",onClick:t[14]||(t[14]=_=>e.toggle("info",!0))},Qc),s("div",{class:"opener",onClick:t[15]||(t[15]=_=>e.toggle("help",!0))},td),sd])]),s("div",od,[ee(P,{players:e.players},null,8,["players"])]),e.statusMessages.length?(g(),w("div",nd,[(g(!0),w(ae,null,ye(e.statusMessages,(_,k)=>(g(),w("div",{key:k},F(_),1))),128))])):G("",!0),s("canvas",id,null,512)])}var rd=se(Tc,[["render",ld]]);let bo=null;async function ad(){bo=await(await _e.get("/api/me",{})).json()}var To={getMe:()=>bo,init:ad};const ud=ie({props:{image:{type:Object,required:!0}},data:()=>({me:To.getMe()}),computed:{style(){return{backgroundImage:`url("${this.image.url.replace("uploads/","uploads/r/")+"-150x100.webp"}")`}},canEdit(){return this.me.id?this.me.id===this.image.uploaderUserId:!1}},emits:{click:null,editClick:null},methods:{onClick(){this.$emit("click")},onEditClick(){this.$emit("editClick")}}}),cd=s("i",{class:"icon icon-edit"},null,-1),dd=[cd];function hd(e,t,o,n,i,r){return g(),w("div",{class:"imageteaser",style:Ie(e.style),onClick:t[1]||(t[1]=(...a)=>e.onClick&&e.onClick(...a))},[e.canEdit?(g(),w("div",{key:0,class:"btn edit",onClick:t[0]||(t[0]=Pt((...a)=>e.onEditClick&&e.onEditClick(...a),["stop"]))},dd)):G("",!0)],4)}var pd=se(ud,[["render",hd]]);const gd=ie({props:{animate:{type:Boolean,default:!0}},emits:{bgclick:null,close:null},data:()=>({classes:[]}),methods:{onKeyUp(e){e.code==="Escape"&&window.getComputedStyle(this.$el).display!=="none"&&this.$emit("close")}},mounted(){window.addEventListener("keyup",this.onKeyUp)},unmounted(){window.removeEventListener("keyup",this.onKeyUp)}}),md={class:"overlay"};function fd(e,t,o,n,i,r){return g(),w("div",md,[s("div",{class:Xe(["overlay-background",e.classes.map(a=>"overlay-background-"+a)]),onClick:t[0]||(t[0]=a=>e.$emit("bgclick"))},null,2),s("div",{class:Xe(["overlay-content",e.classes.map(a=>"overlay-content-"+a)])},[Go(e.$slots,"default")],2)])}var _d=se(gd,[["render",fd]]);const yd={props:{src:String,title:{type:String,default:""},height:{type:String,default:"100%"},width:{type:String,default:"100%"}},computed:{style(){return{display:"inline-block",verticalAlign:"text-bottom",backgroundImage:`url('${this.src}')`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",width:this.width,height:this.height}}}},wd=["title"];function vd(e,t,o,n,i,r){return g(),w("div",{style:Ie(r.style),title:o.title},null,12,wd)}var Ed=se(yd,[["render",vd]]);const Pd=ie({props:{modelValue:{type:Array,required:!0},autocompleteTags:{type:Function}},emits:{"update:modelValue":null},data(){return{input:"",values:[],autocomplete:{idx:-1,values:[]}}},watch:{modelValue(e,t){this.values=e}},created(){this.values=this.modelValue},methods:{onKeyUp(e){if(e.code==="ArrowDown"&&this.autocomplete.values.length>0)return this.autocomplete.idx<this.autocomplete.values.length-1&&this.autocomplete.idx++,e.stopPropagation(),!1;if(e.code==="ArrowUp"&&this.autocomplete.values.length>0)return this.autocomplete.idx>0&&this.autocomplete.idx--,e.stopPropagation(),!1;if(e.key===",")return this.add(),e.stopPropagation(),!1;if(e.code==="Escape")return this.autocomplete.values=[],this.autocomplete.idx=-1,e.stopPropagation(),!1;this.input&&this.autocompleteTags?(this.autocomplete.values=this.autocompleteTags(this.input,this.values),this.autocomplete.idx=-1):(this.autocomplete.values=[],this.autocomplete.idx=-1)},addVal(e){const t=e.replace(/,/g,"").trim();!t||(this.values.includes(t)||this.values.push(t),this.input="",this.autocomplete.values=[],this.autocomplete.idx=-1,this.$emit("update:modelValue",this.values),this.$refs.input.focus())},add(){const e=this.autocomplete.idx>=0?this.autocomplete.values[this.autocomplete.idx]:this.input;this.addVal(e)},rm(e){this.values=this.values.filter(t=>t!==e),this.$emit("update:modelValue",this.values)}}}),bd={class:"input-holder"},Td={key:0,class:"enter-hint color-highlight"},$d={key:0,class:"autocomplete"},Sd=["onClick"],Cd=["onClick"];function kd(e,t,o,n,i,r){return g(),w("div",null,[s("div",bd,[j(s("input",{ref:"input",class:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>e.input=a),placeholder:"Plants, People",onKeydown:[t[1]||(t[1]=Ss(Pt((...a)=>e.add&&e.add(...a),["prevent"]),["enter"])),t[2]||(t[2]=Ss(Pt((...a)=>e.add&&e.add(...a),["prevent"]),["tab"]))],onKeyup:t[3]||(t[3]=(...a)=>e.onKeyUp&&e.onKeyUp(...a))},null,544),[[Re,e.input]]),e.input?(g(),w("div",Td,"[Press ENTER/TAB to add]")):G("",!0)]),e.autocomplete.values?(g(),w("div",$d,[s("ul",null,[(g(!0),w(ae,null,ye(e.autocomplete.values,(a,u)=>(g(),w("li",{key:u,class:Xe({active:u===e.autocomplete.idx}),onClick:f=>e.addVal(a)},F(a),11,Sd))),128))])])):G("",!0),(g(!0),w(ae,null,ye(e.values,(a,u)=>(g(),w("span",{key:u,class:"bit is-clickable",onClick:f=>e.rm(a)},F(a)+" \u2716",9,Cd))),128))])}var Ad=se(Pd,[["render",kd],["__scopeId","data-v-8e01df40"]]);(async()=>{_e.init(),await To.init();const t=await(await _e.get("/api/conf",{})).json(),o=Io({history:xo(),routes:[{name:"index",path:"/",component:Dn},{name:"new-game",path:"/new-game",component:yl},{name:"game",path:"/g/:id",component:bc},{name:"replay",path:"/replay/:id",component:rd}]});o.beforeEach((i,r)=>{r.name&&document.documentElement.classList.remove(`view-${String(r.name)}`),document.documentElement.classList.add(`view-${String(i.name)}`)});const n=Yo(Qo);n.config.globalProperties.$config=t,n.use(o),n.component("connection-overlay",oo),n.component("edit-image-dialog",qs),n.component("game-teaser",Zs),n.component("help-overlay",Kt),n.component("image-library",Hs),n.component("image-teaser",pd),n.component("info-overlay",Zt),n.component("new-game-dialog",Xs),n.component("new-image-dialog",Ks),n.component("overlay",_d),n.component("preview-overlay",Ft),n.component("puzzle-status",Yt),n.component("responsive-image",Ed),n.component("scores",xt),n.component("settings-overlay",Wt),n.component("tags-input",Ad),n.mount("#app")})();
//# sourceMappingURL=index.58049dde.js.map
