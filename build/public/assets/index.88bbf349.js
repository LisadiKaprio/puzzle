import{d as ne,r as O,o as p,c as v,a as s,b as Q,w as re,e as M,f as m,g as J,n as De,t as F,F as ae,h as me,i as Ke,j,v as Oe,k as Ve,l as Se,m as Co,p as So,q as To,s as Rs,u as Ls,x as Et,y as ko,z as Es,A as Ao,B as Oo,C as No}from"./vendor.4bfcbb49.js";const Uo=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}};Uo();var ee=(e,t)=>{const o=e.__vccOpts||e;for(const[n,i]of t)o[n]=i;return o};const Ro=ne({name:"app",computed:{showNav(){return!["game","replay"].includes(String(this.$route.name))}}}),Lo={id:"app"},Vo={key:0,class:"nav"},zo=m("Games overview"),Mo=m("New game"),Do=s("li",null,[s("a",{href:"https://ec.europa.eu/info/strategy/priorities-2019-2024/stronger-europe-world/eu-solidarity-ukraine/eu-assistance-ukraine/eu-stands-ukraine_en",class:"btn btn-ukraine",target:"_blank"},[s("i",{class:"icon icon-ukraine-heart"}),m(" Stand with Ukraine "),s("i",{class:"icon icon-ukraine-heart"})])],-1);function Io(e,t,o,n,i,r){const l=O("router-link"),c=O("router-view");return p(),v("div",Lo,[e.showNav?(p(),v("ul",Vo,[s("li",null,[Q(l,{class:"btn",to:{name:"index"}},{default:re(()=>[zo]),_:1})]),s("li",null,[Q(l,{class:"btn",to:{name:"new-game"}},{default:re(()=>[Mo]),_:1})]),Do])):M("",!0),Q(c)])}var Go=ee(Ro,[["render",Io]]);class ct{constructor(t){this.rand_high=t||3735929054,this.rand_low=t^1231121986}random(t,o){this.rand_high=(this.rand_high<<16)+(this.rand_high>>16)+this.rand_low&4294967295,this.rand_low=this.rand_low+this.rand_high&4294967295;const n=(this.rand_high>>>0)/4294967295;return t+n*(o-t+1)|0}choice(t){return t[this.random(0,t.length-1)]}shuffle(t){const o=t.slice();for(let n=0;n<=o.length-2;n++){const i=this.random(n,o.length-1),r=o[n];o[n]=o[i],o[i]=r}return o}static serialize(t){return{rand_high:t.rand_high,rand_low:t.rand_low}}static unserialize(t){const o=new ct(0);return o.rand_high=t.rand_high,o.rand_low=t.rand_low,o}}const Bo=e=>{let t=e.toLowerCase();return t=t.replace(/[^a-z0-9]+/g,"-"),t=t.replace(/^-|-$/,""),t},nt=(e,t)=>{const o=`${e}`;return o.length>=t.length?o:t.substr(0,t.length-o.length)+o},Mt=(...e)=>{const t=o=>(...n)=>{const i=new Date,r=nt(i.getHours(),"00"),l=nt(i.getMinutes(),"00"),c=nt(i.getSeconds(),"00");console[o](`${r}:${l}:${c}`,...e,...n)};return{log:t("log"),error:t("error"),info:t("info")}},Yo=()=>Date.now().toString(36)+Math.random().toString(36).substring(2);function Fo(e){return e.top+1<<0|e.right+1<<2|e.bottom+1<<4|e.left+1<<6}function Wo(e){return{top:(e>>0&3)-1,right:(e>>2&3)-1,bottom:(e>>4&3)-1,left:(e>>6&3)-1}}function xo(e){return[e.idx,e.pos.x,e.pos.y,e.z,e.owner,e.group]}function Zo(e){return{idx:e[0],pos:{x:e[1],y:e[2]},z:e[3],owner:e[4],group:e[5]}}function Ho(e){return[e.id,e.x,e.y,e.d,e.name,e.color,e.bgcolor,e.points,e.ts]}function jo(e){return{id:e[0],x:e[1],y:e[2],d:e[3],name:e[4],color:e[5],bgcolor:e[6],points:e[7],ts:e[8]}}function Ko(e){return[e.id,e.rng.type||"",ct.serialize(e.rng.obj),e.puzzle,e.players,e.scoreMode,e.shapeMode,e.snapMode,e.creatorUserId,e.hasReplay,e.gameVersion,e.private]}function qo(e){return{id:e[0],rng:{type:e[1],obj:ct.unserialize(e[2])},puzzle:e[3],players:e[4],scoreMode:e[5],shapeMode:e[6],snapMode:e[7],creatorUserId:e[8],hasReplay:e[9],gameVersion:e[10],private:e[11]}}function Qo(e,t){const o=e.width/e.tileSize;return{x:t%o,y:Math.floor(t/o)}}function Xo(e,t){const o=e.width/e.pieceSize;return{x:t%o,y:Math.floor(t/o)}}const Jo=e=>{let t=0;for(let o=0;o<e.length;o++){const n=e.charCodeAt(o);t=(t<<5)-t+n,t|=0}return t};function en(e){const t=[];for(const o in e){const n=[o,e[o]].map(encodeURIComponent);t.push(n.join("="))}return t.length===0?"":`?${t.join("&")}`}var D={hash:Jo,slug:Bo,pad:nt,uniqId:Yo,encodeShape:Fo,decodeShape:Wo,encodePiece:xo,decodePiece:Zo,encodePlayer:Ho,decodePlayer:jo,encodeGame:Ko,decodeGame:qo,coordByPieceIdxDeprecated:Qo,coordByPieceIdx:Xo,asQueryArgs:en};const ie={SOUND_VOLUME:"sound_volume",SOUND_ENABLED:"sound_enabled",OTHER_PLAYER_CLICK_SOUND_ENABLED:"other_player_click_sound_enabled",COLOR_BACKGROUND:"bg_color",PLAYER_COLOR:"player_color",PLAYER_NAME:"player_name",SHOW_PLAYER_NAMES:"show_player_names"},_e={SOUND_VOLUME:100,SOUND_ENABLED:!0,OTHER_PLAYER_CLICK_SOUND_ENABLED:!0,COLOR_BACKGROUND:"#222222",PLAYER_COLOR:"#ffffff",PLAYER_NAME:"anon",SHOW_PLAYER_NAMES:!0},Vs=()=>({background:"",color:"",name:"",soundsEnabled:!0,otherPlayerClickSoundEnabled:!0,soundsVolume:100,showPlayerNames:!0}),Dt=(e,t)=>{localStorage.setItem(e,t)},It=e=>localStorage.getItem(e),tn=(e,t)=>{Dt(e,`${t}`)},sn=(e,t)=>{const o=It(e);if(o===null)return t;const n=parseInt(o,10);return isNaN(n)?t:n},on=(e,t)=>{Dt(e,t?"1":"0")},nn=(e,t)=>{const o=It(e);return o===null?t:o==="1"},ln=(e,t)=>{Dt(e,t)},rn=(e,t)=>{const o=It(e);return o===null?t:o};var X={setInt:tn,getInt:sn,setBool:on,getBool:nn,setStr:ln,getStr:rn};let Pt="",zs="";const yt=async(e,t,o)=>new Promise((n,i)=>{const r=new window.XMLHttpRequest;r.open(e,t,!0),r.withCredentials=!0;for(const l in o.headers||{})r.setRequestHeader(l,o.headers[l]);r.setRequestHeader("Client-Id",Pt),r.setRequestHeader("Client-Secret",zs),r.addEventListener("load",function(l){n({status:this.status,text:this.responseText,json:async()=>JSON.parse(this.responseText)})}),r.addEventListener("error",function(l){i(new Error("xhr error"))}),r.upload&&o.onUploadProgress&&r.upload.addEventListener("progress",function(l){o.onUploadProgress&&o.onUploadProgress(l)}),r.send(o.body||null)}),Ps=e=>{let t=X.getStr(e,"");return t||(t=D.uniqId(),X.setStr(e,t)),t};var ge={init:()=>{Pt=Ps("ID"),zs=Ps("SECRET")},request:yt,get:(e,t)=>yt("get",e,t),post:(e,t)=>yt("post",e,t),clientId:()=>Pt};const Ms=1,Gt=Ms*1e3,lt=Gt*60,rt=lt*60,$t=rt*24,an=()=>{const e=new Date;return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},Ds=e=>{const t=Math.floor(e/$t);e=e%$t;const o=Math.floor(e/rt);e=e%rt;const n=Math.floor(e/lt);e=e%lt;const i=Math.floor(e/Gt);return`${t}d ${o}h ${n}m ${i}s`},cn=(e,t)=>Ds(t-e);var Ee={MS:Ms,SEC:Gt,MIN:lt,HOUR:rt,DAY:$t,timestamp:an,timeDiffStr:cn,durationStr:Ds};const un=ne({props:{game:{type:Object,required:!0}},computed:{style(){return{"background-image":`url("${this.game.imageUrl.replace("uploads/","uploads/r/")+"-375x210.webp"}")`}}},methods:{time(e,t){const o=e,n=t||Ee.timestamp();return`${Ee.timeDiffStr(o,n)}`}}}),dn={class:"game-info-text"},pn=s("i",{class:"icon icon-puzzle-piece"},null,-1),hn=s("br",null,null,-1),gn=s("i",{class:"icon icon-sillouette"},null,-1),mn=s("br",null,null,-1),fn={key:0,class:"icon icon-clock"},_n={key:1,class:"icon icon-flag"},yn=s("br",null,null,-1),vn=s("i",{class:"icon icon-replay"},null,-1),wn=m(" Watch replay ");function En(e,t,o,n,i,r){const l=O("router-link");return p(),v("div",{class:"game-teaser",style:De(e.style)},[Q(l,{class:"game-info",to:{name:"game",params:{id:e.game.id}}},{default:re(()=>[s("span",dn,[pn,m(" "+F(e.game.piecesFinished)+"/"+F(e.game.piecesTotal),1),hn,gn,m(" "+F(e.game.players),1),mn,e.game.finished?(p(),v("i",_n)):(p(),v("i",fn)),m(" "+F(e.time(e.game.started,e.game.finished)),1),yn])]),_:1},8,["to"]),e.game.hasReplay?(p(),J(l,{key:0,class:"game-replay",to:{name:"replay",params:{id:e.game.id}}},{default:re(()=>[vn,wn]),_:1},8,["to"])):M("",!0)],4)}var Is=ee(un,[["render",En]]);const Pn=ne({components:{GameTeaser:Is},data(){return{gamesRunning:[],gamesFinished:[]}},async created(){const t=await(await ge.get("/api/index-data",{})).json();this.gamesRunning=t.gamesRunning,this.gamesFinished=t.gamesFinished}}),$n=s("h1",null,"Running games",-1),bn=s("h1",null,"Finished games",-1);function Cn(e,t,o,n,i,r){const l=O("game-teaser");return p(),v("div",null,[$n,(p(!0),v(ae,null,me(e.gamesRunning,(c,f)=>(p(),v("div",{class:"game-teaser-wrap",key:f},[Q(l,{game:c},null,8,["game"])]))),128)),bn,(p(!0),v(ae,null,me(e.gamesFinished,(c,f)=>(p(),v("div",{class:"game-teaser-wrap",key:f},[Q(l,{game:c},null,8,["game"])]))),128))])}var Sn=ee(Pn,[["render",Cn]]);const Tn=ne({props:{images:{type:Array,required:!0}},emits:{imageClicked:null,imageEditClicked:null},methods:{imageClicked(e){this.$emit("imageClicked",e)},imageEditClicked(e){this.$emit("imageEditClicked",e)}}});function kn(e,t,o,n,i,r){const l=O("image-teaser");return p(),v("div",null,[(p(!0),v(ae,null,me(e.images,(c,f)=>(p(),J(l,{image:c,onClick:h=>e.imageClicked(c),onEditClick:h=>e.imageEditClicked(c),key:f},null,8,["image","onClick","onEditClick"]))),128))])}var Gs=ee(Tn,[["render",kn]]);const An=async e=>{const t=await Nn(e),o=await On(t);return Bs(o.toDataURL())},On=async e=>{const t=document.createElement("canvas"),o=t.getContext("2d");return t.width=e.width,t.height=e.height,o.drawImage(e,0,0),t},Nn=async e=>new Promise((t,o)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{t(n)},n.onerror=i=>{o(i)},n.src=e});function Bs(e){for(var t=e.split(","),o=t[0].match(/:(.*?);/)[1],n=atob(t[1]),i=n.length,r=new Uint8Array(i);i--;)r[i]=n.charCodeAt(i);return new Blob([r],{type:o})}const Un=ne({props:{autocompleteTags:{type:Function},uploadProgress:{type:Number},uploading:{type:String}},emits:["setupGameClick","postToGalleryClick","close"],data(){return{previewUrl:"",file:null,title:"",tags:[],isPrivate:!1,droppable:!1,inputFocused:!1}},computed:{uploadProgressPercent(){return this.uploadProgress?Math.round(this.uploadProgress*100):0},canPostToGallery(){return this.uploading?!1:!!(this.previewUrl&&this.file)},canSetupGameClick(){return this.uploading?!1:!!(this.previewUrl&&this.file)}},mounted(){window.addEventListener("paste",this.onPaste)},unmounted(){window.removeEventListener("paste",this.onPaste)},methods:{reset(){this.previewUrl="",this.file=null,this.title="",this.tags=[],this.isPrivate=!1,this.droppable=!1},imageFromDragEvt(e){var n;const t=(n=e.dataTransfer)==null?void 0:n.items;if(!t||t.length===0)return null;const o=t[0];return o.type.startsWith("image/")?o:null},async onPaste(e){const t=e.clipboardData.getData("text");if(t){if(this.inputFocused)return;if(t.match(/^https?:\/\//)){const n="/api/proxy?"+new URLSearchParams({url:t});try{const i=await An(n);this.preview(i)}catch(i){console.error("unable to transform image http url into blob",i)}}else if(t.match(/^data:image\/([a-z]+);base64,/))try{const n=Bs(t);this.preview(n)}catch(n){console.error("unable to transform image data url into blob",n)}else console.log(t)}const o=e.clipboardData.files[0];!o||this.preview(o)},onFileSelect(e){const t=e.target;if(!t.files)return;const o=t.files[0];!o||this.preview(o)},preview(e){if(!e.type.startsWith("image/")){console.error("file type is not supported",e.type);return}const t=new FileReader;t.readAsDataURL(e),t.onload=o=>{this.previewUrl=o.target.result,this.file=e}},postToGallery(){this.$emit("postToGalleryClick",{file:this.file,title:this.title,tags:this.tags,isPrivate:this.isPrivate}),this.reset()},setupGameClick(){this.$emit("setupGameClick",{file:this.file,title:this.title,tags:this.tags,isPrivate:this.isPrivate}),this.reset()},onDrop(e){this.droppable=!1;const t=this.imageFromDragEvt(e);if(!t)return!1;const o=t.getAsFile();return o&&(this.file=o,this.preview(o),e.preventDefault()),!1},onDragover(e){return this.imageFromDragEvt(e)&&(this.droppable=!0,e.preventDefault()),!1},onDragleave(){this.droppable=!1}}}),Rn=s("div",{class:"drop-target"},null,-1),Ln={key:0,class:"has-image"},Vn={key:1},zn={class:"upload"},Mn=s("div",{class:"upload-content"},[m(" How to upload an image? Choose any of the following methods: "),s("ul",null,[s("li",null,"Click this area to select an image for upload "),s("li",null,"Drag and drop an image into the area"),s("li",null,"Paste an image URL"),s("li",null,"Paste an image")]),s("div",{class:"hint"},` Don't worry, the image will not show up in the gallery unless "Post to gallery" was clicked. `)],-1),Dn={class:"area-settings"},In=s("td",null,[s("label",null,"Title")],-1),Gn=s("tr",null,[s("td",{colspan:"2"},[s("div",{class:"hint"},"Feel free to leave a credit to the artist/photographer in the title :)")])],-1),Bn=s("td",null,[s("label",null,"Private Image")],-1),Yn=s("td",null,[s("label",null,"Tags")],-1),Fn={class:"area-buttons"},Wn=["disabled"],xn=s("i",{class:"icon icon-preview"},null,-1),Zn=m(" Post to gallery"),Hn=["disabled"],jn=s("i",{class:"icon icon-puzzle-piece"},null,-1),Kn=m(" Set up game"),qn=s("i",{class:"icon icon-puzzle-piece"},null,-1),Qn=m(" Post to gallery "),Xn=s("br",null,null,-1),Jn=m(" + set up game");function ei(e,t,o,n,i,r){const l=O("responsive-image"),c=O("tags-input"),f=O("overlay");return p(),J(f,{class:"new-image-dialog"},{default:re(()=>[s("div",{class:Ke(["area-image",{"has-image":!!e.previewUrl,"no-image":!e.previewUrl,droppable:e.droppable}]),onDrop:t[2]||(t[2]=(...h)=>e.onDrop&&e.onDrop(...h)),onDragover:t[3]||(t[3]=(...h)=>e.onDragover&&e.onDragover(...h)),onDragleave:t[4]||(t[4]=(...h)=>e.onDragleave&&e.onDragleave(...h))},[Rn,e.previewUrl?(p(),v("div",Ln,[s("span",{class:"remove btn",onClick:t[0]||(t[0]=h=>e.previewUrl="")},"X"),Q(l,{src:e.previewUrl},null,8,["src"])])):(p(),v("div",Vn,[s("label",zn,[s("input",{type:"file",style:{display:"none"},onChange:t[1]||(t[1]=(...h)=>e.onFileSelect&&e.onFileSelect(...h)),accept:"image/*"},null,32),Mn])]))],34),s("div",Dn,[s("table",null,[s("tr",null,[In,s("td",null,[j(s("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=h=>e.title=h),placeholder:"Flower by @artist",onFocus:t[6]||(t[6]=h=>e.inputFocused=!0),onBlur:t[7]||(t[7]=h=>e.inputFocused=!1)},null,544),[[Oe,e.title]])])]),Gn,s("tr",null,[Bn,s("td",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=h=>e.isPrivate=h)},null,512),[[Ve,e.isPrivate]])])]),s("tr",null,[Yn,s("td",null,[Q(c,{modelValue:e.tags,"onUpdate:modelValue":t[9]||(t[9]=h=>e.tags=h),autocompleteTags:e.autocompleteTags},null,8,["modelValue","autocompleteTags"])])])])]),s("div",Fn,[e.isPrivate?M("",!0):(p(),v("button",{key:0,class:"btn",disabled:!e.canPostToGallery,onClick:t[10]||(t[10]=(...h)=>e.postToGallery&&e.postToGallery(...h))},[e.uploading==="postToGallery"?(p(),v(ae,{key:0},[m("Uploading ("+F(e.uploadProgressPercent)+"%)",1)],64)):(p(),v(ae,{key:1},[xn,Zn],64))],8,Wn)),s("button",{class:"btn",disabled:!e.canSetupGameClick,onClick:t[11]||(t[11]=(...h)=>e.setupGameClick&&e.setupGameClick(...h))},[e.uploading==="setupGame"?(p(),v(ae,{key:0},[m("Uploading ("+F(e.uploadProgressPercent)+"%)",1)],64)):e.isPrivate?(p(),v(ae,{key:1},[jn,Kn],64)):(p(),v(ae,{key:2},[qn,Qn,Xn,Jn],64))],8,Hn),s("button",{class:"btn",onClick:t[12]||(t[12]=h=>e.$emit("close"))},"Cancel")])]),_:1})}var Ys=ee(Un,[["render",ei]]);const ti=ne({props:{image:{type:Object,required:!0},autocompleteTags:{type:Function}},emits:["saveClick","close"],data(){return{title:"",tags:[]}},watch:{image(e,t){this.init(e)}},created(){this.init(this.image)},methods:{init(e){this.title=e.title,this.tags=e.tags.map(t=>t.title)},saveImage(){this.$emit("saveClick",{id:this.image.id,title:this.title,tags:this.tags})}}}),si={class:"area-image"},oi={class:"has-image"},ni={class:"area-settings"},ii=s("td",null,[s("label",null,"Title")],-1),li=s("tr",null,[s("td",{colspan:"2"},[s("div",{class:"hint"},"Feel free to leave a credit to the artist/photographer in the title :)")])],-1),ri=s("td",null,[s("label",null,"Tags")],-1),ai={class:"area-buttons"},ci=s("i",{class:"icon icon-preview"},null,-1),ui=m(" Save image"),di=[ci,ui];function pi(e,t,o,n,i,r){const l=O("responsive-image"),c=O("tags-input"),f=O("overlay");return p(),J(f,{class:"edit-image-dialog"},{default:re(()=>[s("div",si,[s("div",oi,[Q(l,{src:e.image.url,title:e.image.title},null,8,["src","title"])])]),s("div",ni,[s("table",null,[s("tr",null,[ii,s("td",null,[j(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=h=>e.title=h),placeholder:"Flower by @artist"},null,512),[[Oe,e.title]])])]),li,s("tr",null,[ri,s("td",null,[Q(c,{modelValue:e.tags,"onUpdate:modelValue":t[1]||(t[1]=h=>e.tags=h),autocompleteTags:e.autocompleteTags},null,8,["modelValue","autocompleteTags"])])])])]),s("div",ai,[s("button",{class:"btn",onClick:t[2]||(t[2]=(...h)=>e.saveImage&&e.saveImage(...h))},di),s("button",{class:"btn",onClick:t[3]||(t[3]=h=>e.$emit("close"))},"Cancel")])]),_:1})}var Fs=ee(ti,[["render",pi]]),Ne=(e=>(e[e.FINAL=0]="FINAL",e[e.ANY=1]="ANY",e))(Ne||{}),He=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ANY=1]="ANY",e[e.FLAT=2]="FLAT",e))(He||{}),Ie=(e=>(e[e.NORMAL=0]="NORMAL",e[e.REAL=1]="REAL",e))(Ie||{});const hi=ne({props:{image:{type:Object,required:!0},forcePrivate:{type:Boolean,default:!1}},emits:["newGame","close"],data(){return{tiles:1e3,isPrivate:!1,scoreMode:Ne.ANY,shapeMode:He.NORMAL,snapMode:Ie.NORMAL}},mounted(){this.isPrivate=this.forcePrivate},methods:{onNewGameClick(){this.$emit("newGame",{tiles:this.tilesInt,private:this.isPrivate,image:this.image,scoreMode:this.scoreModeInt,shapeMode:this.shapeModeInt,snapMode:this.snapModeInt})}},computed:{canStartNewGame(){return!(!this.tilesInt||!this.image||!this.image.url||![0,1].includes(this.scoreModeInt))},scoreModeInt(){return parseInt(`${this.scoreMode}`,10)},shapeModeInt(){return parseInt(`${this.shapeMode}`,10)},snapModeInt(){return parseInt(`${this.snapMode}`,10)},tilesInt(){return parseInt(`${this.tiles}`,10)}}}),gi={class:"area-image"},mi={class:"has-image"},fi={key:0,class:"image-title"},_i={key:0,class:"image-title-title"},yi={key:1,class:"image-title-dim"},vi={class:"area-settings"},wi=s("td",null,[s("label",null,"Pieces")],-1),Ei=s("td",null,[s("label",null,"Scoring: ")],-1),Pi=m(" Any (Score when pieces are connected to each other or on final location)"),$i=s("br",null,null,-1),bi=m(" Final (Score when pieces are put to their final location)"),Ci=s("td",null,[s("label",null,"Shapes: ")],-1),Si=m(" Normal"),Ti=s("br",null,null,-1),ki=m(" Any (Flat pieces can occur anywhere)"),Ai=s("br",null,null,-1),Oi=m(" Flat (All pieces flat on all sides)"),Ni=s("td",null,[s("label",null,"Snapping: ")],-1),Ui=m(" Normal (Pieces snap to final destination and to each other)"),Ri=s("br",null,null,-1),Li=m(" Real (Pieces snap only to corners, already snapped pieces and to each other)"),Vi=s("td",null,[s("label",null,"Private Game")],-1),zi=["disabled"],Mi={key:0},Di=s("td",null,[s("label",null,"Tags: ")],-1),Ii={class:"area-buttons"},Gi=["disabled"],Bi=s("i",{class:"icon icon-puzzle-piece"},null,-1),Yi=m(" Generate Puzzle "),Fi=[Bi,Yi];function Wi(e,t,o,n,i,r){const l=O("responsive-image"),c=O("overlay");return p(),J(c,{class:"new-game-dialog"},{default:re(()=>[s("div",gi,[s("div",mi,[Q(l,{src:e.image.url,title:e.image.title},null,8,["src","title"])]),e.image.title||e.image.width||e.image.height?(p(),v("div",fi,[e.image.title?(p(),v("span",_i,'"'+F(e.image.title)+'"',1)):M("",!0),e.image.width||e.image.height?(p(),v("span",yi,"("+F(e.image.width)+" \u2715 "+F(e.image.height)+")",1)):M("",!0)])):M("",!0)]),s("div",vi,[s("table",null,[s("tr",null,[wi,s("td",null,[j(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=f=>e.tiles=f)},null,512),[[Oe,e.tiles]])])]),s("tr",null,[Ei,s("td",null,[s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=f=>e.scoreMode=f),value:"1"},null,512),[[Se,e.scoreMode]]),Pi]),$i,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=f=>e.scoreMode=f),value:"0"},null,512),[[Se,e.scoreMode]]),bi])])]),s("tr",null,[Ci,s("td",null,[s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=f=>e.shapeMode=f),value:"0"},null,512),[[Se,e.shapeMode]]),Si]),Ti,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=f=>e.shapeMode=f),value:"1"},null,512),[[Se,e.shapeMode]]),ki]),Ai,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=f=>e.shapeMode=f),value:"2"},null,512),[[Se,e.shapeMode]]),Oi])])]),s("tr",null,[Ni,s("td",null,[s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[6]||(t[6]=f=>e.snapMode=f),value:"0"},null,512),[[Se,e.snapMode]]),Ui]),Ri,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[7]||(t[7]=f=>e.snapMode=f),value:"1"},null,512),[[Se,e.snapMode]]),Li])])]),s("tr",null,[Vi,s("td",null,[j(s("input",{disabled:e.forcePrivate,type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=f=>e.isPrivate=f)},null,8,zi),[[Ve,e.isPrivate]])])]),e.image.tags.length?(p(),v("tr",Mi,[Di,s("td",null,[(p(!0),v(ae,null,me(e.image.tags,(f,h)=>(p(),v("span",{key:h,class:"bit"},F(f.title),1))),128))])])):M("",!0)])]),s("div",Ii,[s("button",{class:"btn",disabled:!e.canStartNewGame,onClick:t[9]||(t[9]=(...f)=>e.onNewGameClick&&e.onNewGameClick(...f))},Fi,8,Gi),s("button",{class:"btn",onClick:t[10]||(t[10]=f=>e.$emit("close"))},"Cancel")])]),_:1})}var Ws=ee(hi,[["render",Wi]]);const xi=ne({components:{ImageLibrary:Gs,NewImageDialog:Ys,EditImageDialog:Fs,NewGameDialog:Ws},data(){return{filters:{sort:"date_desc",tags:[]},images:[],tags:[],image:{id:0,filename:"",file:"",url:"",title:"",tags:[],created:0},dialog:"",newGameForcePrivate:!1,uploading:"",uploadProgress:0}},async created(){await this.loadImages()},computed:{relevantTags(){return this.tags.filter(e=>e.total>0)}},methods:{autocompleteTags(e,t){return this.tags.filter(o=>!t.includes(o.title)&&o.title.toLowerCase().startsWith(e.toLowerCase())).slice(0,10).map(o=>o.title)},toggleTag(e){this.filters.tags.includes(e.slug)?this.filters.tags=this.filters.tags.filter(t=>t!==e.slug):this.filters.tags.push(e.slug),this.filtersChanged()},async loadImages(){const t=await(await ge.get(`/api/newgame-data${D.asQueryArgs(this.filters)}`,{})).json();this.images=t.images,this.tags=t.tags},async filtersChanged(){await this.loadImages()},onImageClicked(e){this.image=e,this.newGameForcePrivate=!1,this.dialog="new-game"},onImageEditClicked(e){this.image=e,this.dialog="edit-image"},async uploadImage(e){this.uploadProgress=0;const t=new FormData;t.append("file",e.file,e.file.name),t.append("title",e.title),t.append("tags",e.tags),t.append("private",e.isPrivate);const o=await ge.post("/api/upload",{body:t,onUploadProgress:n=>{this.uploadProgress=n.loaded/n.total}});return this.uploadProgress=1,await o.json()},async saveImage(e){return await(await ge.post("/api/save-image",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:e.id,title:e.title,tags:e.tags})})).json()},async onSaveImageClick(e){const t=await this.saveImage(e);t.ok?(this.dialog="",await this.loadImages()):alert(t.error)},async postToGalleryClick(e){this.uploading="postToGallery",await this.uploadImage(e),this.uploading="",this.dialog="",await this.loadImages()},async setupGameClick(e){this.uploading="setupGame";const t=await this.uploadImage(e);this.uploading="",this.loadImages(),this.image=t,this.newGameForcePrivate=e.isPrivate,this.dialog="new-game"},async onNewGame(e){const t=await ge.post("/api/newgame",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status===200){const o=await t.json();this.$router.push({name:"game",params:{id:o.id}})}}}}),Zi={class:"upload-image-teaser"},Hi=s("div",{class:"hint"},"(The image you upload will be added to the public gallery.)",-1),ji={key:0},Ki=m(" Tags: "),qi=["onClick"],Qi=m(" Sort by: "),Xi=s("option",{value:"date_desc"},"Newest first",-1),Ji=s("option",{value:"date_asc"},"Oldest first",-1),el=s("option",{value:"alpha_asc"},"A-Z",-1),tl=s("option",{value:"alpha_desc"},"Z-A",-1),sl=[Xi,Ji,el,tl];function ol(e,t,o,n,i,r){const l=O("image-library"),c=O("new-image-dialog"),f=O("edit-image-dialog"),h=O("new-game-dialog");return p(),v("div",null,[s("div",Zi,[s("div",{class:"btn btn-big",onClick:t[0]||(t[0]=N=>e.dialog="new-image")},"Upload your image"),Hi]),s("div",null,[e.tags.length>0?(p(),v("label",ji,[Ki,(p(!0),v(ae,null,me(e.relevantTags,(N,I)=>(p(),v("span",{class:Ke(["bit is-clickable",{on:e.filters.tags.includes(N.slug)}]),key:I,onClick:w=>e.toggleTag(N)},F(N.title)+" ("+F(N.total)+")",11,qi))),128))])):M("",!0),s("label",null,[Qi,j(s("select",{"onUpdate:modelValue":t[1]||(t[1]=N=>e.filters.sort=N),onChange:t[2]||(t[2]=(...N)=>e.filtersChanged&&e.filtersChanged(...N))},sl,544),[[Co,e.filters.sort]])])]),Q(l,{images:e.images,onImageClicked:e.onImageClicked,onImageEditClicked:e.onImageEditClicked},null,8,["images","onImageClicked","onImageEditClicked"]),e.dialog==="new-image"?(p(),J(c,{key:0,autocompleteTags:e.autocompleteTags,onClose:t[3]||(t[3]=N=>e.dialog=""),onBgclick:t[4]||(t[4]=N=>e.dialog=""),uploadProgress:e.uploadProgress,uploading:e.uploading,onPostToGalleryClick:e.postToGalleryClick,onSetupGameClick:e.setupGameClick},null,8,["autocompleteTags","uploadProgress","uploading","onPostToGalleryClick","onSetupGameClick"])):M("",!0),e.dialog==="edit-image"?(p(),J(f,{key:1,autocompleteTags:e.autocompleteTags,onClose:t[5]||(t[5]=N=>e.dialog=""),onBgclick:t[6]||(t[6]=N=>e.dialog=""),onSaveClick:e.onSaveImageClick,image:e.image},null,8,["autocompleteTags","onSaveClick","image"])):M("",!0),e.image&&e.dialog==="new-game"?(p(),J(h,{key:2,onClose:t[7]||(t[7]=N=>e.dialog=""),onBgclick:t[8]||(t[8]=N=>e.dialog=""),onNewGame:e.onNewGame,image:e.image,forcePrivate:e.newGameForcePrivate},null,8,["onNewGame","image","forcePrivate"])):M("",!0)])}var nl=ee(xi,[["render",ol]]);const il=ne({props:{players:{type:Object,required:!0}},methods:{playerStyle(e){return e.color==="ukraine"?{backgroundImage:"linear-gradient(180deg, rgba(0,87,183,1) 0%, rgba(0,87,183,1) 50%, rgba(255,221,0,1) 50%)","-webkit-background-clip":"text","-webkit-text-fill-color":"transparent"}:{color:e.color}}},computed:{actives(){return this.players.active.sort((e,t)=>t.points-e.points),this.players.active},idles(){return this.players.idle.sort((e,t)=>t.points-e.points),this.players.idle}}}),ll={class:"scores"},rl=s("div",null,"Scores",-1),al=s("td",null,[s("i",{class:"icon icon-lightning"})],-1),cl=s("td",null,[s("i",{class:"icon icon-zzz"})],-1);function ul(e,t,o,n,i,r){return p(),v("div",ll,[rl,s("table",null,[(p(!0),v(ae,null,me(e.actives,(l,c)=>(p(),v("tr",{key:c,style:De(e.playerStyle(l))},[al,s("td",null,F(l.name),1),s("td",null,F(l.points),1)],4))),128)),(p(!0),v(ae,null,me(e.idles,(l,c)=>(p(),v("tr",{key:c,style:De(e.playerStyle(l))},[cl,s("td",null,F(l.name),1),s("td",null,F(l.points),1)],4))),128))])])}var Bt=ee(il,[["render",ul]]);const dl=ne({props:{status:{type:Object,required:!0}},computed:{durationStr(){return Ee.durationStr(this.status.duration)}}}),pl={class:"puzzle-status"},hl=s("i",{class:"icon icon-puzzle-piece"},null,-1),gl={key:0,class:"icon icon-clock"},ml={key:1,class:"icon icon-flag"};function fl(e,t,o,n,i,r){return p(),v("div",pl,[s("div",null,[hl,m(" "+F(e.status.piecesDone)+"/"+F(e.status.piecesTotal),1)]),s("div",null,[this.status.finished?(p(),v("i",ml)):(p(),v("i",gl)),m(" "+F(e.durationStr),1)])])}var Yt=ee(dl,[["render",fl]]);const _l=ne({emits:{"update:modelValue":null},props:{modelValue:{type:Object,required:!0}},data:()=>({background:"",color:"",isUkraineColor:!1,name:"",soundsEnabled:!0,otherPlayerClickSoundEnabled:!0,soundsVolume:100,showPlayerNames:!0,watches:[]}),methods:{updateVolume(e){const t=parseInt(e.target.value);this.soundsVolume=t},decreaseVolume(){this.soundsVolume=Math.max(0,this.soundsVolume-5)},increaseVolume(){this.soundsVolume=Math.min(100,this.soundsVolume+5)},apply(e){this.disableWatches(),this.background=`${e.background}`,this.color=`${e.color}`,this.isUkraineColor=this.color==="ukraine",this.name=`${e.name}`,this.soundsEnabled=!!e.soundsEnabled,this.otherPlayerClickSoundEnabled=!!e.otherPlayerClickSoundEnabled,this.soundsVolume=parseInt(`${e.soundsVolume}`,10),this.showPlayerNames=!!e.showPlayerNames,this.enableWatches()},emitChanges(){this.$emit("update:modelValue",{background:this.background,color:this.isUkraineColor?"ukraine":this.color,name:this.name,soundsEnabled:this.soundsEnabled,otherPlayerClickSoundEnabled:this.otherPlayerClickSoundEnabled,soundsVolume:this.soundsVolume,showPlayerNames:this.showPlayerNames})},enableWatches(){this.watches.push(this.$watch(()=>this.isUkraineColor,this.emitChanges)),this.watches.push(this.$watch(()=>this.background,this.emitChanges)),this.watches.push(this.$watch(()=>this.color,this.emitChanges)),this.watches.push(this.$watch(()=>this.name,this.emitChanges)),this.watches.push(this.$watch(()=>this.soundsEnabled,this.emitChanges)),this.watches.push(this.$watch(()=>this.otherPlayerClickSoundEnabled,this.emitChanges)),this.watches.push(this.$watch(()=>this.soundsVolume,this.emitChanges)),this.watches.push(this.$watch(()=>this.showPlayerNames,this.emitChanges))},disableWatches(){const e=this.watches;this.watches=[],e.forEach(t=>t())}},created(){this.apply(this.modelValue)}}),ve=e=>(So("data-v-15f805ff"),e=e(),To(),e),yl={class:"settings"},vl=ve(()=>s("td",null,[s("label",null,"Background: ")],-1)),wl=ve(()=>s("td",null,[s("label",null,"Color: ")],-1)),El=ve(()=>s("i",{class:"icon icon-ukraine-heart"},null,-1)),Pl=ve(()=>s("td",null,[s("label",null,"Name: ")],-1)),$l=ve(()=>s("td",null,[s("label",null,"Sounds: ")],-1)),bl=ve(()=>s("td",null,[s("label",null,"Piece connect sounds of others: ")],-1)),Cl=["disabled"],Sl=ve(()=>s("td",null,[s("label",null,"Sounds Volume: ")],-1)),Tl={class:"sound-volume"},kl=ve(()=>s("i",{class:"icon icon-volume-down"},null,-1)),Al=[kl],Ol=["disabled","value"],Nl=ve(()=>s("i",{class:"icon icon-volume-up"},null,-1)),Ul=[Nl],Rl=ve(()=>s("td",null,[s("label",null,"Show player names: ")],-1));function Ll(e,t,o,n,i,r){const l=O("overlay");return p(),J(l,{class:"transparent"},{default:re(()=>[s("table",yl,[s("tr",null,[vl,s("td",null,[j(s("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=c=>e.background=c)},null,512),[[Oe,e.background]])])]),s("tr",null,[wl,s("td",null,[e.isUkraineColor?M("",!0):j((p(),v("input",{key:0,type:"color","onUpdate:modelValue":t[1]||(t[1]=c=>e.color=c)},null,512)),[[Oe,e.color]]),s("label",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=c=>e.isUkraineColor=c)},null,512),[[Ve,e.isUkraineColor]]),El])])]),s("tr",null,[Pl,s("td",null,[j(s("input",{type:"text",maxLength:"16","onUpdate:modelValue":t[3]||(t[3]=c=>e.name=c)},null,512),[[Oe,e.name]])])]),s("tr",null,[$l,s("td",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=c=>e.soundsEnabled=c)},null,512),[[Ve,e.soundsEnabled]])])]),s("tr",null,[bl,s("td",null,[j(s("input",{type:"checkbox",disabled:!e.soundsEnabled,"onUpdate:modelValue":t[5]||(t[5]=c=>e.otherPlayerClickSoundEnabled=c)},null,8,Cl),[[Ve,e.otherPlayerClickSoundEnabled]])])]),s("tr",null,[Sl,s("td",Tl,[s("span",{onClick:t[6]||(t[6]=(...c)=>e.decreaseVolume&&e.decreaseVolume(...c))},Al),s("input",{disabled:!e.soundsEnabled,type:"range",min:"0",max:"100",value:e.soundsVolume,onChange:t[7]||(t[7]=(...c)=>e.updateVolume&&e.updateVolume(...c))},null,40,Ol),s("span",{onClick:t[8]||(t[8]=(...c)=>e.increaseVolume&&e.increaseVolume(...c))},Ul)])]),s("tr",null,[Rl,s("td",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=c=>e.showPlayerNames=c)},null,512),[[Ve,e.showPlayerNames]])])])])]),_:1})}var Ft=ee(_l,[["render",Ll],["__scopeId","data-v-15f805ff"]]);const Vl=ne({props:{img:String},computed:{previewStyle(){return{backgroundImage:`url('${this.img}')`}}}}),zl={class:"preview"};function Ml(e,t,o,n,i,r){const l=O("overlay");return p(),J(l,{class:"preview-overlay",animate:!1},{default:re(()=>[s("div",zl,[s("div",{class:"img",style:De(e.previewStyle)},null,4)])]),_:1})}var Wt=ee(Vl,[["render",Ml]]);const Dl=ne({props:{game:{type:Object,required:!0}},computed:{scoreMode(){switch(this.game.scoreMode){case Ne.ANY:return["Any","Score when pieces are connected to each other or on final location"];case Ne.FINAL:default:return["Final","Score when pieces are put to their final location"]}},shapeMode(){switch(this.game.shapeMode){case He.FLAT:return["Flat","All pieces flat on all sides"];case He.ANY:return["Any","Flat pieces can occur anywhere"];case He.NORMAL:default:return["Normal",""]}},snapMode(){switch(this.game.snapMode){case Ie.REAL:return["Real","Pieces snap only to corners, already snapped pieces and to each other"];case Ie.NORMAL:default:return["Normal","Pieces snap to final destination and to each other"]}}}}),Il={class:"help"},Gl=s("tr",null,[s("td",{colspan:"2"},"Info about this puzzle")],-1),Bl=s("td",null,"Image Title: ",-1),Yl=s("td",null,"Scoring: ",-1),Fl=["title"],Wl=s("td",null,"Shapes: ",-1),xl=["title"],Zl=s("td",null,"Snapping: ",-1),Hl=["title"];function jl(e,t,o,n,i,r){const l=O("overlay");return p(),J(l,{class:"transparent"},{default:re(()=>[s("table",Il,[Gl,s("tr",null,[Bl,s("td",null,F(e.game.puzzle.info.image.title),1)]),s("tr",null,[Yl,s("td",null,[s("span",{title:e.snapMode[1]},F(e.scoreMode[0]),9,Fl)])]),s("tr",null,[Wl,s("td",null,[s("span",{title:e.snapMode[1]},F(e.shapeMode[0]),9,xl)])]),s("tr",null,[Zl,s("td",null,[s("span",{title:e.snapMode[1]},F(e.snapMode[0]),9,Hl)])])])]),_:1})}var xt=ee(Dl,[["render",jl]]);const Kl=2,ql=1,Ql=4,Xl=2,Jl=3,er=1,tr=2,sr=4,or=3,nr=1,ir=2,lr=3,rr=4,ar=5,cr=6,ur=7,dr=8,pr=9,hr=10,gr=11,mr=12,fr=13,_r=14,yr=15,vr=16,wr=17,Er=18,Pr=19,$r=20,br=21,Cr=1,Sr=2,Tr=3,kr=4;var d={EV_SERVER_EVENT:ql,EV_SERVER_INIT:Ql,EV_CLIENT_EVENT:Xl,EV_CLIENT_INIT:Jl,GAME_VERSION:Kl,LOG_HEADER:er,LOG_ADD_PLAYER:tr,LOG_UPDATE_PLAYER:sr,LOG_HANDLE_INPUT:or,INPUT_EV_MOVE:pr,INPUT_EV_MOUSE_DOWN:nr,INPUT_EV_MOUSE_UP:ir,INPUT_EV_MOUSE_MOVE:lr,INPUT_EV_ZOOM_IN:rr,INPUT_EV_ZOOM_OUT:ar,INPUT_EV_BG_COLOR:cr,INPUT_EV_PLAYER_COLOR:ur,INPUT_EV_PLAYER_NAME:dr,INPUT_EV_TOGGLE_PREVIEW:hr,INPUT_EV_TOGGLE_SOUNDS:gr,INPUT_EV_REPLAY_TOGGLE_PAUSE:mr,INPUT_EV_REPLAY_SPEED_UP:fr,INPUT_EV_REPLAY_SPEED_DOWN:_r,INPUT_EV_TOGGLE_PLAYER_NAMES:yr,INPUT_EV_CENTER_FIT_PUZZLE:vr,INPUT_EV_TOGGLE_FIXED_PIECES:wr,INPUT_EV_TOGGLE_LOOSE_PIECES:Er,INPUT_EV_STORE_POS:Pr,INPUT_EV_RESTORE_POS:$r,INPUT_EV_CONNECTION_CLOSE:br,CHANGE_DATA:Cr,CHANGE_PIECE:Sr,CHANGE_PLAYER:Tr,PLAYER_SNAP:kr};const Ar=Mt("Communication.js"),Or=1001,Zt=4e3,xs=0,bt=1,Ht=2,Zs=3,Hs=4;let he,Ct=[],St=e=>{Ct.push(e)},Tt=[],kt=e=>{Tt.push(e)};function Nr(e){St=e;for(const t of Ct)St(t);Ct=[]}function Ur(e){kt=e;for(const t of Tt)kt(t);Tt=[]}let At=xs;const We=e=>{At!==e&&(At=e,kt(e))};function js(e){if(At===Ht)try{he.send(JSON.stringify(e))}catch{Ar.info("unable to send message.. maybe because ws is invalid?")}}let ze,Me,Ot=0;function Ks(e=2e4){he.readyState==he.OPEN&&he.send(""),Ot=setTimeout(Ks,e)}function $s(){Ot&&clearTimeout(Ot)}function Rr(e,t,o){return ze=0,Me={},We(Zs),new Promise(n=>{he=new WebSocket(e,o+"|"+t),he.onopen=()=>{We(Ht),js([d.EV_CLIENT_INIT]),Ks()},he.onmessage=i=>{const r=JSON.parse(i.data),l=r[0];if(l===d.EV_SERVER_INIT){const c=r[1];n(c)}else if(l===d.EV_SERVER_EVENT){const c=r[1],f=r[2];if(c===o&&Me[f]){delete Me[f];return}St(r)}else throw`[ 2021-05-09 invalid connect msgType ${l} ]`},he.onerror=()=>{throw $s(),We(bt),"[ 2021-05-15 onerror ]"},he.onclose=i=>{$s(),i.code===Zt||i.code===Or?We(Hs):We(bt)}})}async function Lr(e,t){const o={gameId:e,offset:t};return await(await ge.get(`/api/replay-data${D.asQueryArgs(o)}`,{})).json()}function Vr(){he&&he.close(Zt),ze=0,Me={}}function zr(e){ze++,Me[ze]=e,js([d.EV_CLIENT_EVENT,ze,Me[ze]])}var be={connect:Rr,requestReplayData:Lr,disconnect:Vr,sendClientEvent:zr,onServerChange:Nr,onConnectionStateChange:Ur,CODE_CUSTOM_DISCONNECT:Zt,CONN_STATE_NOT_CONNECTED:xs,CONN_STATE_DISCONNECTED:bt,CONN_STATE_CLOSED:Hs,CONN_STATE_CONNECTED:Ht,CONN_STATE_CONNECTING:Zs};const Mr=ne({emits:{reconnect:null},props:{connectionState:Number},computed:{lostConnection(){return this.connectionState===be.CONN_STATE_DISCONNECTED},connecting(){return this.connectionState===be.CONN_STATE_CONNECTING},show(){return!!(this.lostConnection||this.connecting)}}}),Dr={key:0},Ir=s("i",{class:"icon icon-disconnect"},null,-1),Gr=m(" LOST CONNECTION "),Br=s("i",{class:"icon icon-disconnect"},null,-1),Yr=[Ir,Gr,Br],Fr={key:2};function Wr(e,t,o,n,i,r){const l=O("overlay");return j((p(),J(l,{class:"connection-lost"},{default:re(()=>[e.lostConnection?(p(),v("div",Dr,Yr)):M("",!0),e.lostConnection?(p(),v("span",{key:1,class:"btn",onClick:t[0]||(t[0]=c=>e.$emit("reconnect"))},"Reconnect")):M("",!0),e.connecting?(p(),v("div",Fr,"Connecting...")):M("",!0)]),_:1},512)),[[Rs,e.show]])}var qs=ee(Mr,[["render",Wr]]);const xr=ne({}),Zr=s("table",{class:"help"},[s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-up"}),m(" Move up:")]),s("td",null,[s("div",null,[s("kbd",null,"W"),m("/"),s("kbd",null,"\u2191"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-down"}),m(" Move down:")]),s("td",null,[s("div",null,[s("kbd",null,"S"),m("/"),s("kbd",null,"\u2193"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-left"}),m(" Move left:")]),s("td",null,[s("div",null,[s("kbd",null,"A"),m("/"),s("kbd",null,"\u2190"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-right"}),m(" Move right:")]),s("td",null,[s("div",null,[s("kbd",null,"D"),m("/"),s("kbd",null,"\u2192"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td"),s("td",null,[s("div",null,[m("Move faster by holding "),s("kbd",null,"Shift")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-zoom-in"}),m(" Zoom in:")]),s("td",null,[s("div",null,[s("kbd",null,"E"),m("/"),s("i",{class:"icon icon-mouse-wheel"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-zoom-out"}),m(" Zoom out:")]),s("td",null,[s("div",null,[s("kbd",null,"Q"),m("/"),s("i",{class:"icon icon-mouse-wheel"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-preview"}),m(" Toggle preview:")]),s("td",null,[s("div",null,[s("kbd",null,"Space")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-center"}),m(" Center puzzle in screen:")]),s("td",null,[s("div",null,[s("kbd",null,"C")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-puzzle-piece-locked"}),m(" Toggle fixed pieces:")]),s("td",null,[s("div",null,[s("kbd",null,"F")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-puzzle-piece-free"}),m(" Toggle loose pieces:")]),s("td",null,[s("div",null,[s("kbd",null,"G")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-player-name"}),m(" Toggle player names:")]),s("td",null,[s("div",null,[s("kbd",null,"N")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-volume-up"}),m(" Toggle sounds:")]),s("td",null,[s("div",null,[s("kbd",null,"M")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-save-pos"}),m(" Store position [0-9]:")]),s("td",null,[s("div",null,[s("kbd",null,"Shift"),m(" + "),s("kbd",null,"0"),m("-"),s("kbd",null,"9")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-load-pos"}),m(" Restore position [0-9]:")]),s("td",null,[s("div",null,[s("kbd",null,"0"),m("-"),s("kbd",null,"9")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-speed-up"}),m(" Speed up (replay):")]),s("td",null,[s("div",null,[s("kbd",null,"I")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-speed-down"}),m(" Speed down (replay):")]),s("td",null,[s("div",null,[s("kbd",null,"O")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-pause"}),m(" Pause (replay):")]),s("td",null,[s("div",null,[s("kbd",null,"P")])])])],-1);function Hr(e,t,o,n,i,r){const l=O("overlay");return p(),J(l,{class:"transparent"},{default:re(()=>[Zr]),_:1})}var jt=ee(xr,[["render",Hr]]),jr="/assets/click.bb97cb07.mp3",Kr=Object.freeze(Object.defineProperty({__proto__:null,default:jr},Symbol.toStringTag,{value:"Module"})),qr="/assets/click2.98536db5.mp3",Qr=Object.freeze(Object.defineProperty({__proto__:null,default:qr},Symbol.toStringTag,{value:"Module"})),Xr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAW0lEQVQ4je1RywrAIAxLxP//5exixRWlVgZelpOKeTQFfnDypgy3eLIkSLLL8mxGPoHsU2hPAgDHBLvRX6hZZw/fwT0BtlLSONqCbWAmEIqMZOCDDlaDR3N03gOyDCn+y4DWmAAAAABJRU5ErkJggg==",Jr=Object.freeze(Object.defineProperty({__proto__:null,default:Xr},Symbol.toStringTag,{value:"Module"})),ea="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAARElEQVQ4jWNgGAU0Af+hmBCbgYGBgYERhwHEAEYGBgYGJtIdiApYyLAZBVDsAqoagC1ACQJyY4ERg0GCISh6KA4DigEAou8LC+LnIJoAAAAASUVORK5CYII=",ta=Object.freeze(Object.defineProperty({__proto__:null,default:ea},Symbol.toStringTag,{value:"Module"})),sa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAcUlEQVQ4ja1TQQ7AIAgD///n7jCozA2Hbk00jbG1KIrcARszTugoBs49qioZj7r2kKACptkyAOCJsJuA+GzglwHjvMSSWFVaENWVASxh5eRLiq5fN/ASjI89VcP2K3hHpq1cEXNaMfnrL3TDZP2tDuoOA6MzCCXWr38AAAAASUVORK5CYII=",oa=Object.freeze(Object.defineProperty({__proto__:null,default:sa},Symbol.toStringTag,{value:"Module"})),na="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAU0lEQVQ4jWNgoAH4D8X42HDARKlt5BoAd82AuQAOGLGIYQQUPv0wF5CiCQUge4EsQ5C9QI4BjMguwBYeBAElscCIy1ZivMKIwSDBEBQ9FCckigEAU3QOD7TGvY4AAAAASUVORK5CYII=",ia=Object.freeze(Object.defineProperty({__proto__:null,default:na},Symbol.toStringTag,{value:"Module"}));const la=e=>{let t=!1;const o=()=>{t=!0},n=e.fps||60,i=e.slow||1,r=e.update,l=e.render,c=window.requestAnimationFrame,f=1/n,h=i*f;let N,I=0,w=window.performance.now();const _=()=>{for(N=window.performance.now(),I=I+Math.min(1,(N-w)/1e3);I>h;)I=I-h,r(f);l(I/i),w=N,t||c(_)};return c(_),{stop:o}},ra=.1,aa=6,ca=.05;class Nt{constructor(t=null){this.x=0,this.y=0,this.curZoom=1,t&&this.fromSnapshot(t)}snapshot(){return{x:this.x,y:this.y,curZoom:this.curZoom}}getCurrentZoom(){return this.curZoom}fromSnapshot(t){this.x=t.x,this.y=t.y,this.curZoom=t.curZoom}reset(){this.x=0,this.y=0,this.curZoom=1}move(t,o){this.x+=t/this.curZoom,this.y+=o/this.curZoom}calculateNewZoom(t){const o=t==="in"?1:-1,n=this.curZoom+ca*this.curZoom*o;return Math.min(Math.max(n,ra),aa)}canZoom(t){return this.curZoom!=this.calculateNewZoom(t)}setZoom(t,o){if(this.curZoom==t)return!1;const n=1-this.curZoom/t;return this.move(-o.x*n,-o.y*n),this.curZoom=t,!0}zoom(t,o){return this.setZoom(this.calculateNewZoom(t),o)}viewportToWorld(t){const{x:o,y:n}=this.viewportToWorldRaw(t);return{x:Math.round(o),y:Math.round(n)}}viewportToWorldRaw(t){return{x:t.x/this.curZoom-this.x,y:t.y/this.curZoom-this.y}}worldToViewport(t){const{x:o,y:n}=this.worldToViewportRaw(t);return{x:Math.round(o),y:Math.round(n)}}worldToViewportRaw(t){return{x:(t.x+this.x)*this.curZoom,y:(t.y+this.y)*this.curZoom}}worldDimToViewport(t){const{w:o,h:n}=this.worldDimToViewportRaw(t);return{w:Math.round(o),h:Math.round(n)}}worldDimToViewportRaw(t){return{w:t.w*this.curZoom,h:t.h*this.curZoom}}viewportDimToWorld(t){const{w:o,h:n}=this.viewportDimToWorldRaw(t);return{w:Math.round(o),h:Math.round(n)}}viewportDimToWorldRaw(t){return{w:t.w/this.curZoom,h:t.h/this.curZoom}}}function je(e=0,t=0){const o=document.createElement("canvas");return o.width=e,o.height=t,o}async function ua(e){return new Promise(t=>{const o=new Image;o.onload=()=>{createImageBitmap(o).then(t)},o.src=e})}async function da(e,t,o){const n=je(t,o);return n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,o),await createImageBitmap(n)}function pa(e,t,o){if(o==="ukraine"){const r=je(e.width,e.height),l=r.getContext("2d"),c=t.height/1.75;l.save(),l.drawImage(t,0,0),l.fillStyle="#0057B7",l.globalCompositeOperation="source-in",l.fillRect(0,0,t.width,c),l.restore(),l.save(),l.globalCompositeOperation="destination-over",l.drawImage(e,0,0),l.restore();const f=je(e.width,e.height/2),h=f.getContext("2d");return h.save(),h.drawImage(t,0,-c),h.fillStyle="#FFDD00",h.globalCompositeOperation="source-in",h.fillRect(0,0,t.width,t.height),h.restore(),h.save(),h.globalCompositeOperation="destination-over",h.drawImage(e,0,-c),h.restore(),l.drawImage(f,0,c),r}const n=je(e.width,e.height),i=n.getContext("2d");return i.save(),i.drawImage(t,0,0),i.fillStyle=o,i.globalCompositeOperation="source-in",i.fillRect(0,0,t.width,t.height),i.restore(),i.save(),i.globalCompositeOperation="destination-over",i.drawImage(e,0,0),i.restore(),n}var pe={createCanvas:je,loadImageToBitmap:ua,resizeBitmap:da,colorizedCanvas:pa};const ha=Mt("Debug.js");let Ut=0,Qs=0;const ga=e=>{Ut=performance.now(),Qs=e},ma=e=>{const t=performance.now(),o=t-Ut;o>Qs&&ha.log(e+": "+o),Ut=t};var Te={checkpoint_start:ga,checkpoint:ma};function fa(e,t){return{x:e.x-t.x,y:e.y-t.y}}function _a(e,t){return{x:e.x+t.x,y:e.y+t.y}}function Xs(e,t){const o=e.x-t.x,n=e.y-t.y;return Math.sqrt(o*o+n*n)}function ya(e,t){return e.x>=t.x&&e.x<=t.x+t.w&&e.y>=t.y&&e.y<=t.y+t.h}function Rt(e){return{x:e.x+e.w/2,y:e.y+e.h/2}}function va(e,t,o){return{x:e.x+t,y:e.y+o,w:e.w,h:e.h}}function wa(e,t){return!(t.x>e.x+e.w||e.x>t.x+t.w||t.y>e.y+e.h||e.y>t.y+t.h)}function Ea(e,t){return Xs(Rt(e),Rt(t))}var H={pointSub:fa,pointAdd:_a,pointDistance:Xs,pointInBounds:ya,rectCenter:Rt,rectMoved:va,rectCenterDistance:Ea,rectsOverlap:wa};const bs=Mt("PuzzleGraphics.js");async function Pa(e,t,o){bs.log("start createPuzzleTileBitmaps");const n=o.tileSize,i=o.tileMarginWidth,r=o.tileDrawSize,l=n/100,c=[0,0,40,15,37,5,37,5,40,0,38,-5,38,-5,20,-20,50,-20,50,-20,80,-20,62,-5,62,-5,60,0,63,5,63,5,65,15,100,0],f=new Array(t.length),h={};function N(y){const B=`${y.top}${y.right}${y.left}${y.bottom}`;if(h[B])return h[B];const A=new Path2D,C={x:i,y:i},S=H.pointAdd(C,{x:n,y:0}),$=H.pointAdd(S,{x:0,y:n}),k=H.pointSub($,{x:n,y:0});if(A.moveTo(C.x,C.y),y.top!==0)for(let u=0;u<c.length/6;u++){const te=H.pointAdd(C,{x:c[u*6+0]*l,y:y.top*c[u*6+1]*l}),x=H.pointAdd(C,{x:c[u*6+2]*l,y:y.top*c[u*6+3]*l}),se=H.pointAdd(C,{x:c[u*6+4]*l,y:y.top*c[u*6+5]*l});A.bezierCurveTo(te.x,te.y,x.x,x.y,se.x,se.y)}else A.lineTo(S.x,S.y);if(y.right!==0)for(let u=0;u<c.length/6;u++){const te=H.pointAdd(S,{x:-y.right*c[u*6+1]*l,y:c[u*6+0]*l}),x=H.pointAdd(S,{x:-y.right*c[u*6+3]*l,y:c[u*6+2]*l}),se=H.pointAdd(S,{x:-y.right*c[u*6+5]*l,y:c[u*6+4]*l});A.bezierCurveTo(te.x,te.y,x.x,x.y,se.x,se.y)}else A.lineTo($.x,$.y);if(y.bottom!==0)for(let u=0;u<c.length/6;u++){const te=H.pointSub($,{x:c[u*6+0]*l,y:y.bottom*c[u*6+1]*l}),x=H.pointSub($,{x:c[u*6+2]*l,y:y.bottom*c[u*6+3]*l}),se=H.pointSub($,{x:c[u*6+4]*l,y:y.bottom*c[u*6+5]*l});A.bezierCurveTo(te.x,te.y,x.x,x.y,se.x,se.y)}else A.lineTo(k.x,k.y);if(y.left!==0)for(let u=0;u<c.length/6;u++){const te=H.pointSub(k,{x:-y.left*c[u*6+1]*l,y:c[u*6+0]*l}),x=H.pointSub(k,{x:-y.left*c[u*6+3]*l,y:c[u*6+2]*l}),se=H.pointSub(k,{x:-y.left*c[u*6+5]*l,y:c[u*6+4]*l});A.bezierCurveTo(te.x,te.y,x.x,x.y,se.x,se.y)}else A.lineTo(C.x,C.y);return h[B]=A,A}const I=pe.createCanvas(r,r),w=I.getContext("2d"),_=pe.createCanvas(r,r),T=_.getContext("2d");for(const y of t){const B=D.decodePiece(y),A=$a(o,B.idx),C=N(D.decodeShape(o.shapes[B.idx]));w.clearRect(0,0,r,r),w.save(),w.lineWidth=2,w.stroke(C),w.globalCompositeOperation="source-in",w.drawImage(e,A.x-i,A.y-i,r,r,0,0,r,r),w.restore(),w.save(),w.globalCompositeOperation="source-in",w.globalAlpha=.2,w.fillStyle="black",w.fillRect(0,0,I.width,I.height),w.restore(),w.save(),w.clip(C),w.drawImage(e,A.x-i,A.y-i,r,r,0,0,r,r),w.restore(),w.save(),w.clip(C),w.strokeStyle="rgba(0,0,0,.4)",w.lineWidth=0,w.shadowColor="black",w.shadowBlur=2,w.shadowOffsetX=-1,w.shadowOffsetY=-1,w.stroke(C),w.restore(),w.save(),w.clip(C),w.strokeStyle="rgba(255,255,255,.4)",w.lineWidth=0,w.shadowColor="white",w.shadowBlur=2,w.shadowOffsetX=1,w.shadowOffsetY=1,w.stroke(C),w.restore(),T.clearRect(0,0,r,r),T.save(),T.lineWidth=1,T.stroke(C),T.globalCompositeOperation="source-in",T.drawImage(e,A.x-i,A.y-i,r,r,0,0,r,r),T.restore(),w.drawImage(_,0,0),f[B.idx]=await createImageBitmap(I)}return bs.log("end createPuzzleTileBitmaps"),f}function $a(e,t){const o=D.coordByPieceIdxDeprecated(e,t);return{x:o.x*e.tileSize,y:o.y*e.tileSize,w:e.tileSize,h:e.tileSize}}async function ba(e){const t=await pe.loadImageToBitmap(e.info.imageUrl),o=await pe.resizeBitmap(t,e.info.width,e.info.height);return await Pa(o,e.tiles,e.info)}var Ca={loadPuzzleBitmaps:ba};const Js=30,b={};function Sa(e){return!!b[e]||!1}function Ta(e,t){return{id:e,x:0,y:0,d:0,name:null,color:null,bgcolor:null,points:0,ts:t}}function ka(e,t){b[e]=t}function Aa(e){delete b[e]}function ut(e,t){let o=0;for(const n of b[e].players){if(D.decodePlayer(n).id===t)return o;o++}return-1}function Oa(e,t){return b[e].players.length>t?D.decodePlayer(b[e].players[t]).id:null}function Re(e,t){const o=ut(e,t);return o===-1?null:D.decodePlayer(b[e].players[o])}function Kt(e,t,o){const n=ut(e,t);n===-1?b[e].players.push(D.encodePlayer(o)):b[e].players[n]=D.encodePlayer(o)}function Na(e,t,o){b[e].puzzle.tiles[t]=D.encodePiece(o)}function Ua(e,t){b[e].puzzle.data=t}function eo(e,t){return ut(e,t)!==-1}function Ra(e,t){return co(b[e],t)}function La(e,t){return uc(b[e],t)}function Va(e,t,o){eo(e,t)?le(e,t,{ts:o}):Kt(e,t,Ta(t,o))}function za(e){return b[e]||null}function Lt(e){return Qt(b[e])}function Ma(e){return uo(b[e])}function vt(e){return b[e].scoreMode}function to(e){return b[e].snapMode}function Vt(e){return qt(b[e])}function Da(e){return b[e].puzzle.tiles.map(D.decodePiece).sort((o,n)=>o.z-n.z)}function le(e,t,o){const n=Re(e,t);if(n!==null){for(const i of Object.keys(o))n[i]=o[i];Kt(e,t,n)}}function tt(e,t){for(const o of Object.keys(t))b[e].puzzle.data[o]=t[o]}function Ue(e,t,o){for(const n of Object.keys(o)){const i=D.decodePiece(b[e].puzzle.tiles[t]);i[n]=o[n],b[e].puzzle.tiles[t]=D.encodePiece(i)}}const Ge=(e,t)=>D.decodePiece(b[e].puzzle.tiles[t]),at=(e,t)=>Ge(e,t).group,Ia=(e,t)=>{const o=b[e].puzzle.info;return t===0||t===o.tilesX-1||t===o.tiles-o.tilesX||t===o.tiles-1},so=(e,t)=>{const o=b[e].puzzle.info,n={x:(o.table.width-o.width)/2,y:(o.table.height-o.height)/2},i=Ha(e,t);return H.pointAdd(n,i)},it=(e,t)=>Ge(e,t).pos,Ga=e=>{const t=no(e),o=io(e),n=Math.round(t/4),i=Math.round(o/4);return{x:0-n,y:0-i,w:t+2*n,h:o+2*i}},Ba=(e,t)=>Ge(e,t).z,xe=(e,t)=>{for(const o of b[e].puzzle.tiles){const n=D.decodePiece(o);if(n.owner===t)return n.idx}return-1},Ya=(e,t)=>{const o=xe(e,t);return o<0?null:b[e].puzzle.tiles[o]},Fa=e=>b[e].puzzle.info.tileDrawOffset,oo=e=>b[e].puzzle.info.tileDrawSize,Wa=e=>lo(b[e]),xa=e=>ro(b[e]),Cs=e=>b[e].puzzle.data.maxGroup,Ss=e=>b[e].puzzle.data.maxZ,Za=(e,t)=>{let o=0;for(const n of t){const i=Ba(e,n);i>o&&(o=i)}return o};function Ha(e,t){const o=b[e].puzzle.info,n=D.coordByPieceIdxDeprecated(o,t),i=n.x*o.tileSize,r=n.y*o.tileSize;return{x:i,y:r}}function ja(e,t){const o=b[e].puzzle.info,n=D.coordByPieceIdxDeprecated(o,t);return[n.y>0?t-o.tilesX:-1,n.x<o.tilesX-1?t+1:-1,n.y<o.tilesY-1?t+o.tilesX:-1,n.x>0?t-1:-1]}const Ts=(e,t,o)=>{for(const n of t)Ue(e,n,{z:o})},Ka=(e,t,o)=>{const n=it(e,t),i=H.pointAdd(n,o);Ue(e,t,{pos:i})},st=(e,t,o)=>{const n=oo(e),i=Ga(e),r=o;for(const l of t){const c=Ge(e,l);c.pos.x+o.x<i.x?r.x=Math.max(i.x-c.pos.x,r.x):c.pos.x+n+o.x>i.x+i.w&&(r.x=Math.min(i.x+i.w-c.pos.x+n,r.x)),c.pos.y+o.y<i.y?r.y=Math.max(i.y-c.pos.y,r.y):c.pos.y+n+o.y>i.y+i.h&&(r.y=Math.min(i.y+i.h-c.pos.y+n,r.y))}if(!r.x&&!r.y)return!1;for(const l of t)Ka(e,l,r);return!0},qa=(e,t)=>Qa(e,t)===-1,Qa=(e,t)=>Ge(e,t).owner,ks=(e,t)=>{for(const o of t)Ue(e,o,{owner:-1,z:1})},wt=(e,t,o)=>{for(const n of t)Ue(e,n,{owner:o})};function Xa(e,t){return we(e,t).length}function we(e,t){const o=b[e].puzzle.tiles,n=D.decodePiece(o[t]),i=[];if(n.group)for(const r of o){const l=D.decodePiece(r);l.group===n.group&&i.push(l.idx)}else i.push(n.idx);return i}const Ja=(e,t)=>{const o=b[e].puzzle.info,n=b[e].puzzle.tiles;let i=-1,r=-1;for(let l=0;l<n.length;l++){const c=D.decodePiece(n[l]);if(c.owner!==0)continue;const f={x:c.pos.x,y:c.pos.y,w:o.tileSize,h:o.tileSize};H.pointInBounds(t,f)&&(i===-1||c.z>i)&&(i=c.z,r=l)}return r},ec=(e,t)=>{const o=Re(e,t);return o?o.bgcolor:null},tc=(e,t)=>{const o=Re(e,t);return o?o.color:null},sc=(e,t)=>{const o=Re(e,t);return o?o.name:null},As=(e,t)=>{const o=Re(e,t);return o?o.points:0},oc=(e,t,o)=>{const n=at(e,t),i=at(e,o);return!!(n&&n===i)},no=e=>b[e].puzzle.info.table.width,io=e=>b[e].puzzle.info.table.height,nc=e=>b[e].puzzle,ic=e=>b[e].rng.obj,lc=e=>b[e].puzzle.info.width,rc=e=>b[e].puzzle.info.height,ac=(e,t)=>{if(to(e)===Ie.REAL){for(const o of t)if(Ia(e,o))return!0;return!1}return!0};function cc(e,t,o,n){const i=b[e].puzzle,r=[],l=()=>{r.push([d.CHANGE_DATA,i.data])},c=_=>{r.push([d.CHANGE_PIECE,D.encodePiece(Ge(e,_))])},f=_=>{for(const T of _)c(T)},h=()=>{const _=Re(e,t);!_||r.push([d.CHANGE_PLAYER,D.encodePlayer(_)])};let N=!1;const I=(_,T,y)=>{const B=b[_].puzzle.tiles,A=at(_,T),C=at(_,y);let S;const $=[];if(A&&$.push(A),C&&$.push(C),A)S=A;else if(C)S=C;else{const k=Cs(_)+1;tt(_,{maxGroup:k}),l(),S=Cs(_)}if(Ue(_,T,{group:S}),c(T),Ue(_,y,{group:S}),c(y),$.length>0)for(const k of B){const u=D.decodePiece(k);$.includes(u.group)&&(Ue(_,u.idx,{group:S}),c(u.idx))}},w=o[0];if(w===d.INPUT_EV_CONNECTION_CLOSE){const _=xe(e,t);if(_>=0){const T=we(e,_);wt(e,T,0),f(T)}}else if(w===d.INPUT_EV_BG_COLOR){const _=o[1];le(e,t,{bgcolor:_,ts:n}),h()}else if(w===d.INPUT_EV_PLAYER_COLOR){const _=o[1];le(e,t,{color:_,ts:n}),h()}else if(w===d.INPUT_EV_PLAYER_NAME){const _=`${o[1]}`.substr(0,16);le(e,t,{name:_,ts:n}),h()}else if(w===d.INPUT_EV_MOVE){const _=o[1],T=o[2],y=Re(e,t);if(y){const B=y.x-_,A=y.y-T;le(e,t,{ts:n,x:B,y:A}),h();const C=xe(e,t);if(C>=0){const S=we(e,C),$={x:-_,y:-T};st(e,S,$)&&f(S)}}}else if(w===d.INPUT_EV_MOUSE_DOWN){const _=o[1],T=o[2],y={x:_,y:T};le(e,t,{d:1,ts:n}),h();const B=Ja(e,y);if(B>=0){const A=Ss(e)+1;tt(e,{maxZ:A}),l();const C=we(e,B);Ts(e,C,Ss(e)),wt(e,C,t),f(C)}}else if(w===d.INPUT_EV_MOUSE_MOVE){const _=o[1],T=o[2];if(!o[5])le(e,t,{x:_,y:T,ts:n}),h();else{const B=xe(e,t);if(B<0)le(e,t,{ts:n}),h();else{const A=o[1],C=o[2],S=o[3],$=o[4];le(e,t,{x:A,y:C,ts:n}),h();const k=we(e,B);st(e,k,{x:S,y:$})&&f(k)}}}else if(w===d.INPUT_EV_MOUSE_UP){const T=xe(e,t);if(T>=0){const y=we(e,T);wt(e,y,0),f(y);const B=it(e,T),A=so(e,T);if(ac(e,y)&&H.pointDistance(A,B)<i.info.snapDistance){const C=H.pointSub(A,B);st(e,y,C),ks(e,y),f(y);let S=As(e,t);vt(e)===Ne.FINAL?S+=y.length:vt(e)===Ne.ANY&&(S+=1),le(e,t,{d:0,ts:n,points:S}),h(),Vt(e)===Lt(e)&&(tt(e,{finished:n}),l()),N=!0}else{const C=($,k,u,te)=>{const x=b[$].puzzle.info;if(u<0||oc($,k,u))return!1;const se=it($,k),Pe=H.pointAdd(it($,u),{x:te[0]*x.tileSize,y:te[1]*x.tileSize});if(H.pointDistance(se,Pe)<x.snapDistance){const Ce=H.pointSub(Pe,se);let de=we($,k);if(st($,de,Ce),I($,k,u),de=we($,k),qa($,u))ks($,de);else{const Le=Za($,de);Ts($,de,Le)}return f(de),!0}return!1};let S=!1;for(const $ of we(e,T)){const k=ja(e,$);if(C(e,$,k[0],[0,1])||C(e,$,k[1],[-1,0])||C(e,$,k[2],[0,-1])||C(e,$,k[3],[1,0])){S=!0;break}}if(S&&vt(e)===Ne.ANY){const $=As(e,t)+1;le(e,t,{d:0,ts:n,points:$}),h()}else le(e,t,{d:0,ts:n}),h();S&&to(e)===Ie.REAL&&Vt(e)===Lt(e)&&(tt(e,{finished:n}),l()),S&&(N=!0)}}else le(e,t,{d:0,ts:n}),h()}else if(w===d.INPUT_EV_ZOOM_IN){const _=o[1],T=o[2];le(e,t,{x:_,y:T,ts:n}),h()}else if(w===d.INPUT_EV_ZOOM_OUT){const _=o[1],T=o[2];le(e,t,{x:_,y:T,ts:n}),h()}else le(e,t,{ts:n}),h();return N&&r.push([d.PLAYER_SNAP,t]),r}function lo(e){return e.puzzle.data.started}function ro(e){return e.puzzle.data.finished}function qt(e){let t=0;for(const o of e.puzzle.tiles)D.decodePiece(o).owner===-1&&t++;return t}function Qt(e){return e.puzzle.tiles.length}function ao(e){return e.players.map(D.decodePlayer)}function co(e,t){const o=t-Js*Ee.SEC;return ao(e).filter(n=>n.ts>=o)}function uc(e,t){const o=t-Js*Ee.SEC;return ao(e).filter(n=>n.ts<o&&n.points>0)}function uo(e){var o;const t=((o=e.puzzle.info.image)==null?void 0:o.url)||e.puzzle.info.imageUrl;if(!t)throw new Error("[2021-07-11] no image url set");return t}function dc(e){return qt(e)===Qt(e)}var U={setGame:ka,unsetGame:Aa,loaded:Sa,playerExists:eo,getActivePlayers:Ra,getIdlePlayers:La,addPlayer:Va,getFinishedPiecesCount:Vt,getPieceCount:Lt,getImageUrl:Ma,get:za,getGroupedPieceCount:Xa,getPlayerBgColor:ec,getPlayerColor:tc,getPlayerName:sc,getPlayerIndexById:ut,getPlayerIdByIndex:Oa,changePlayer:le,setPlayer:Kt,setPiece:Na,setPuzzleData:Ua,getTableWidth:no,getTableHeight:io,getPuzzle:nc,getRng:ic,getPuzzleWidth:lc,getPuzzleHeight:rc,getPiecesSortedByZIndex:Da,getFirstOwnedPiece:Ya,getPieceDrawOffset:Fa,getPieceDrawSize:oo,getFinalPiecePos:so,getStartTs:Wa,getFinishTs:xa,handleInput:cc,Game_getStartTs:lo,Game_getFinishTs:ro,Game_getFinishedPiecesCount:qt,Game_getPieceCount:Qt,Game_getActivePlayers:co,Game_getImageUrl:uo,Game_isFinished:dc};let po=-10,ho=20,zt=2,go=15;const pc=5,hc=5,Xt=1,gc=200,Os=10,mc=100,fc=10,_c=1,yc=5;function vc(e){const t=e.random(0,255),o=e.random(0,255),n=e.random(0,255);return"rgba("+t+","+o+","+n+", 0.8)"}class Ns{constructor(t){this.radius=Os,this.previousRadius=Os,this.explodingDuration=mc,this.hasExploded=!1,this.alive=!0,this.color=vc(t),this.px=window.innerWidth/4+Math.random()*window.innerWidth/2,this.py=window.innerHeight,this.vx=po+Math.random()*ho,this.vy=(zt+Math.random()*go)*-1,this.duration=0}update(t){if(this.hasExploded){const o=gc-this.radius;this.previousRadius=this.radius,this.radius+=o/fc,this.explodingDuration--,this.explodingDuration==0&&(this.alive=!1)}else this.vx+=0,this.vy+=Xt,this.vy>=0&&t&&this.explode(t),this.px+=this.vx,this.py+=this.vy}draw(t){t.beginPath(),t.arc(this.px,this.py,this.previousRadius,0,Math.PI*2,!1),this.hasExploded||(t.fillStyle=this.color,t.lineWidth=1,t.fill())}explode(t){this.hasExploded=!0;const o=3+Math.floor(Math.random()*3);for(let n=0;n<o;n++){const i=10+Math.floor(Math.random()*21),r=pc+Math.random()*hc,l=2*Math.PI/i,c=Math.random()*l;for(let f=0;f<i;f++)t.push(new wc(this,f*l+c,r))}}}class wc{constructor(t,o,n){this.px=t.px,this.py=t.py,this.vx=Math.cos(o)*n,this.vy=Math.sin(o)*n,this.color=t.color,this.duration=40+Math.floor(Math.random()*20),this.alive=!0,this.radius=0}update(){this.vx+=0,this.vy+=Xt/10,this.px+=this.vx,this.py+=this.vy,this.radius=3,this.duration--,this.duration<=0&&(this.alive=!1)}draw(t){t.beginPath(),t.arc(this.px,this.py,this.radius,0,Math.PI*2,!1),t.fillStyle=this.color,t.lineWidth=1,t.fill()}}class Ec{constructor(t,o){this.canvas=t,this.rng=o,this.ctx=this.canvas.getContext("2d"),this.resize(),this.readyBombs=[],this.explodedBombs=[],this.particles=[],window.addEventListener("resize",()=>{this.resize()})}setSpeedParams(){let t=0,o=0;for(;t<this.canvas.height&&o>=0;)o+=Xt,t+=o;zt=o/2,go=o-zt;const n=1/4*this.canvas.width/(o/2);po=-n,ho=2*n}resize(){this.setSpeedParams()}init(){this.readyBombs=[],this.explodedBombs=[],this.particles=[];for(let t=0;t<_c;t++)this.readyBombs.push(new Ns(this.rng))}update(){Math.random()*100<yc&&this.readyBombs.push(new Ns(this.rng));const t=[];for(;this.explodedBombs.length>0;){const i=this.explodedBombs.shift();if(!i)break;i.update(),i.alive&&t.push(i)}this.explodedBombs=t;const o=[];for(;this.readyBombs.length>0;){const i=this.readyBombs.shift();if(!i)break;i.update(this.particles),i.hasExploded?this.explodedBombs.push(i):o.push(i)}this.readyBombs=o;const n=[];for(;this.particles.length>0;){const i=this.particles.shift();if(!i)break;i.update(),i.alive&&n.push(i)}this.particles=n}render(){this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.readyBombs.length;t++)this.readyBombs[t].draw(this.ctx);for(let t=0;t<this.explodedBombs.length;t++)this.explodedBombs[t].draw(this.ctx);for(let t=0;t<this.particles.length;t++)this.particles[t].draw(this.ctx)}}function Pc(e,t,o,n){let i=[],r=!0,l=!1,c=!1,f=!1,h=!1,N=!1,I=!1,w=!1;const _=(E,R)=>{const W=o.viewportToWorld({x:E,y:R});return[W.x,W.y]},T=(E,R)=>{const W=o.viewportDimToWorld({w:E,h:R});return[W.w,W.h]},y=E=>_(E.offsetX,E.offsetY),B=()=>_(e.width/2,e.height/2),A=(E,R)=>{!r||(R.code==="ShiftLeft"||R.code==="ShiftRight"?w=E:R.code==="ArrowUp"||R.code==="KeyW"?f=E:R.code==="ArrowDown"||R.code==="KeyS"?h=E:R.code==="ArrowLeft"||R.code==="KeyA"?l=E:R.code==="ArrowRight"||R.code==="KeyD"?c=E:R.code==="KeyQ"?I=E:R.code==="KeyE"&&(N=E))};let C=!1,S=null,$=null;const k=E=>{$=y(E),S=[E.offsetX,E.offsetY],E.button===0&&(C=!0,K([d.INPUT_EV_MOUSE_DOWN,...$]))},u=E=>{$=y(E),S=[E.offsetX,E.offsetY],E.button===0&&(C=!1,K([d.INPUT_EV_MOUSE_UP,...$]))},te=E=>{if(!S)return;$=y(E);const R=T(-(S[0]-E.offsetX),-(S[1]-E.offsetY));K([d.INPUT_EV_MOUSE_MOVE,...$,...R,C?1:0]),S=[E.offsetX,E.offsetY]},x=E=>{if($=y(E),o.canZoom(E.deltaY<0?"in":"out")){const R=E.deltaY<0?d.INPUT_EV_ZOOM_IN:d.INPUT_EV_ZOOM_OUT;K([R,...$])}},se=E=>A(!0,E),Pe=E=>A(!1,E),Ce=E=>{if(!!r){if(n===ye&&(E.code==="KeyI"?K([d.INPUT_EV_REPLAY_SPEED_UP]):E.code==="KeyO"?K([d.INPUT_EV_REPLAY_SPEED_DOWN]):E.code==="KeyP"&&K([d.INPUT_EV_REPLAY_TOGGLE_PAUSE])),E.code==="Space")K([d.INPUT_EV_TOGGLE_PREVIEW]);else if(E.code==="KeyF")K([d.INPUT_EV_TOGGLE_FIXED_PIECES]);else if(E.code==="KeyG")K([d.INPUT_EV_TOGGLE_LOOSE_PIECES]);else if(E.code==="KeyM")K([d.INPUT_EV_TOGGLE_SOUNDS]);else if(E.code==="KeyN")K([d.INPUT_EV_TOGGLE_PLAYER_NAMES]);else if(E.code==="KeyC")K([d.INPUT_EV_CENTER_FIT_PUZZLE]);else for(let R=0;R<=9;R++)if(E.code===`Digit${R}`){const W=E.shiftKey?d.INPUT_EV_STORE_POS:d.INPUT_EV_RESTORE_POS;K([W,R]);break}}},de=()=>{e.addEventListener("mousedown",k),e.addEventListener("mouseup",u),e.addEventListener("mousemove",te),e.addEventListener("wheel",x),t.addEventListener("keydown",se),t.addEventListener("keyup",Pe),t.addEventListener("keypress",Ce)},Le=()=>{e.removeEventListener("mousedown",k),e.removeEventListener("mouseup",u),e.removeEventListener("mousemove",te),e.removeEventListener("wheel",x),t.removeEventListener("keydown",se),t.removeEventListener("keyup",Pe),t.removeEventListener("keypress",Ce)},qe=(E,R)=>{if(!S||!$)return;const W=new Nt(E).viewportToWorld({x:S[0],y:S[1]}),fe=new Nt(R).viewportToWorld({x:S[0],y:S[1]}),ce=[-(W.x-fe.x),-(W.y-fe.y)];K([d.INPUT_EV_MOUSE_MOVE,...$,...ce,C?1:0])},K=E=>{i.push(E)};return{registerEvents:de,unregisterEvents:Le,addEvent:K,consumeAll:()=>{if(i.length===0)return[];const E=i.slice();return i=[],E},createKeyEvents:()=>{const E=(l?1:0)-(c?1:0),R=(f?1:0)-(h?1:0);if(E!==0||R!==0){const W=(w?24:12)*Math.sqrt(o.getCurrentZoom()),fe=o.viewportDimToWorld({w:E*W,h:R*W});K([d.INPUT_EV_MOVE,fe.w,fe.h]),$&&($[0]-=fe.w,$[1]-=fe.h)}if(!(N&&I)){if(N){if(o.canZoom("in")){const W=$||B();K([d.INPUT_EV_ZOOM_IN,...W])}}else if(I&&o.canZoom("out")){const W=$||B();K([d.INPUT_EV_ZOOM_OUT,...W])}}},createSnapshotEvents:qe,setHotkeys:E=>{r=E}}}const ot={"./grab.png":Jr,"./grab_mask.png":ta,"./hand.png":oa,"./hand_mask.png":ia},Us={"./click.mp3":Kr,"./click2.mp3":Qr},Ze="play",ye="replay";let ke=!0,Ae=!0;const $c=e=>e.owner===-1?ke:Ae;let oe=!0;async function mo(e,t,o,n,i,r){typeof window.DEBUG=="undefined"&&(window.DEBUG=!1);const l=a=>n===ye||a.id!==t,c=Us["./click.mp3"].default,f=Us["./click2.mp3"].default,h=new Audio(c),N=new Audio(f),I=await pe.loadImageToBitmap(ot["./grab.png"].default),w=await pe.loadImageToBitmap(ot["./hand.png"].default),_=await pe.loadImageToBitmap(ot["./grab_mask.png"].default),T=await pe.loadImageToBitmap(ot["./hand_mask.png"].default),y=I.width,B=Math.round(y/2),A=I.height,C=Math.round(A/2),S={},$=async a=>{const g=a.color+" "+a.d;if(!S[g]){const P=a.d?I:w;if(a.color){const V=a.d?_:T;S[g]=await createImageBitmap(pe.colorizedCanvas(P,V,a.color))}else S[g]=P}return S[g]},k=i,u={final:!1,log:[],logPointer:0,speeds:[.5,1,2,5,10,20,50,100,250,500],speedIdx:1,paused:!1,lastRealTs:0,lastGameTs:0,gameStartTs:0,skipNonActionPhases:!0,dataOffset:0};be.onConnectionStateChange(a=>{r.emit("connectionState",a)});const te=async a=>{const g=u.dataOffset;u.dataOffset+=1e4;const P=await be.requestReplayData(a,g);return u.log=u.log.slice(u.logPointer),u.logPointer=0,u.log.push(...P.log),P.log.length===0&&(u.final=!0),P};let x=()=>0;const se=async()=>{if(n===Ze){const a=await be.connect(o,e,t),g=D.decodeGame(a);U.setGame(g.id,g),x=()=>Ee.timestamp()}else if(n===ye){const a=await te(e);if(!a.game)throw"[ 2021-05-29 no game received ]";const g=D.decodeGame(a.game);U.setGame(g.id,g),u.lastRealTs=Ee.timestamp(),u.gameStartTs=parseInt(a.log[0][4],10),u.lastGameTs=u.gameStartTs,x=()=>u.lastGameTs}else throw"[ 2020-12-22 MODE invalid, must be play|replay ]";oe=!0};await se();const Pe=U.getPieceDrawOffset(e),Ce=U.getPieceDrawSize(e),de=U.getPuzzleWidth(e),Le=U.getPuzzleHeight(e),qe=U.getTableWidth(e),K=U.getTableHeight(e),Jt={x:(qe-de)/2,y:(K-Le)/2},dt={w:de,h:Le},es={w:Ce,h:Ce},E=await Ca.loadPuzzleBitmaps(U.getPuzzle(e)),R=new Ec(k,U.getRng(e));R.init();const W=k.getContext("2d");k.classList.add("loaded"),r.emit("puzzleCut");let fe="";const ce={},L=new Nt,yo=()=>{L.reset(),L.move(-(qe-k.width)/2,-(K-k.height)/2);const a=L.worldDimToViewportRaw(dt),g=20,P=k.width-g*2,V=k.height-g*2;if(a.w>P||a.h>V||a.w<P&&a.h<V){const G=Math.min(P/a.w,V/a.h),Y={x:k.width/2,y:k.height/2};L.setZoom(G,Y)}},ue=Pc(k,window,L,n);ue.registerEvents();const Qe=a=>{if(ce.last&&fe===a){const g=L.snapshot(),P=ce.last;return L.fromSnapshot(P),ue.createSnapshotEvents(g,P),delete ce.last,"last"}else if(ce[a]){const g=ce[a],P=L.snapshot();return ce.last=P,fe=a,L.fromSnapshot(g),ue.createSnapshotEvents(P,g),a}else return null};yo(),ce.center=L.snapshot();const vo=U.getImageUrl(e),Xe=a=>{const g=U.getStartTs(e),P=U.getFinishTs(e);r.emit("status",{finished:!!P,duration:(P||a)-g,piecesDone:U.getFinishedPiecesCount(e),piecesTotal:U.getPieceCount(e)}),r.emit("players",{active:U.getActivePlayers(e,a),idle:U.getIdlePlayers(e,a)})};Xe(x());const ts=!!U.getFinishTs(e);let pt=ts;const ss=()=>pt&&!ts,ht=()=>X.getInt(ie.SOUND_VOLUME,_e.SOUND_VOLUME),os=()=>X.getBool(ie.OTHER_PLAYER_CLICK_SOUND_ENABLED,_e.OTHER_PLAYER_CLICK_SOUND_ENABLED),gt=()=>X.getBool(ie.SOUND_ENABLED,_e.SOUND_ENABLED),ns=()=>X.getBool(ie.SHOW_PLAYER_NAMES,_e.SHOW_PLAYER_NAMES),is=()=>n===ye?X.getStr(ie.COLOR_BACKGROUND,_e.COLOR_BACKGROUND):U.getPlayerBgColor(e,t)||X.getStr(ie.COLOR_BACKGROUND,_e.COLOR_BACKGROUND),ls=()=>n===ye?X.getStr(ie.PLAYER_COLOR,_e.PLAYER_COLOR):U.getPlayerColor(e,t)||X.getStr(ie.PLAYER_COLOR,_e.PLAYER_COLOR),wo=()=>n===ye?X.getStr(ie.PLAYER_NAME,_e.PLAYER_NAME):U.getPlayerName(e,t)||X.getStr(ie.PLAYER_NAME,_e.PLAYER_NAME),rs=()=>{const a=ht();h.volume=a/100,h.play()},Eo=()=>{const a=ht();N.volume=a/100,N.play()},Z={background:is(),color:ls(),name:wo(),soundsEnabled:gt(),otherPlayerClickSoundEnabled:os(),soundsVolume:ht(),showPlayerNames:ns()};ue.addEvent([d.INPUT_EV_BG_COLOR,Z.background]),ue.addEvent([d.INPUT_EV_PLAYER_COLOR,Z.color]),ue.addEvent([d.INPUT_EV_PLAYER_NAME,Z.name]);let as="",cs="",us=!1;const Be=a=>{us=a;const[g,P]=a?[as,"grab"]:[cs,"default"];k.style.cursor=`url('${g}') ${B} ${C}, ${P}`},mt=a=>{as=pe.colorizedCanvas(I,_,a).toDataURL(),cs=pe.colorizedCanvas(w,T,a).toDataURL(),Be(us)};mt(ls());const Je=()=>{r.emit("replaySpeed",u.speeds[u.speedIdx]),r.emit("replayPaused",u.paused)},q=(a,g=void 0)=>{r.emit("statusMessage",{what:a,value:g})},ds=()=>{u.speedIdx+1<u.speeds.length&&(u.speedIdx++,Je(),q("Speed Up"))},ps=()=>{u.speedIdx>=1&&(u.speedIdx--,Je(),q("Speed Down"))},hs=()=>{u.paused=!u.paused,Je(),q(u.paused?"Paused":"Playing")};let Ye=!1;const gs=()=>{Ye=!Ye,r.emit("togglePreview",Ye)},ms=()=>{Z.soundsEnabled=!Z.soundsEnabled;const a=Z.soundsEnabled;r.emit("toggleSoundsEnabled",a),X.setBool(ie.SOUND_ENABLED,a),q("Sounds",a)},fs=()=>{Z.showPlayerNames=!Z.showPlayerNames;const a=Z.showPlayerNames;r.emit("togglePlayerNames",a),X.setBool(ie.SHOW_PLAYER_NAMES,a),q("Player names",a)};r.on("replayOnSpeedUp",()=>{ds()}),r.on("replayOnSpeedDown",()=>{ps()}),r.on("replayOnPauseToggle",()=>{hs()}),r.on("onPreviewChange",a=>{Ye!==a&&(Ye=a)}),r.on("onBgChange",a=>{Z.background!==a&&(Z.background=a,X.setStr(ie.COLOR_BACKGROUND,a),ue.addEvent([d.INPUT_EV_BG_COLOR,a]),q("Background",a))}),r.on("onColorChange",a=>{Z.color!==a&&(Z.color=a,X.setStr(ie.PLAYER_COLOR,a),ue.addEvent([d.INPUT_EV_PLAYER_COLOR,a]),q("Color",a))}),r.on("onNameChange",a=>{Z.name!==a&&(Z.name=a,X.setStr(ie.PLAYER_NAME,a),ue.addEvent([d.INPUT_EV_PLAYER_NAME,a]),q("Name",a))}),r.on("onOtherPlayerClickSoundEnabledChange",a=>{Z.otherPlayerClickSoundEnabled!==a&&(Z.otherPlayerClickSoundEnabled=a,X.setBool(ie.OTHER_PLAYER_CLICK_SOUND_ENABLED,a),q("Other player sounds",a))}),r.on("onSoundsEnabledChange",a=>{Z.soundsEnabled!==a&&(Z.soundsEnabled=a,X.setBool(ie.SOUND_ENABLED,a),q("Sounds",a))}),r.on("onSoundsVolumeChange",a=>{Z.soundsVolume!==a&&(Z.soundsVolume=a,X.setInt(ie.SOUND_VOLUME,a),rs(),q("Volume",a))}),r.on("onShowPlayerNamesChange",a=>{Z.showPlayerNames!==a&&(Z.showPlayerNames=a,X.setBool(ie.SHOW_PLAYER_NAMES,a),q("Player names",a))}),r.on("setHotkeys",a=>{ue.setHotkeys(a)}),r.on("requireRerender",()=>{oe=!0});const _s=[];let et;const Po=()=>{_s.forEach(a=>{clearInterval(a)}),et&&clearTimeout(et)};if(n===Ze?_s.push(setInterval(()=>{Xe(x())},1e3)):n===ye&&Je(),n===Ze)be.onServerChange(a=>{a[0],a[1],a[2];const g=a[3];let P=!1,V=!1;for(const[G,Y]of g)switch(G){case d.CHANGE_PLAYER:{const z=D.decodePlayer(Y);z.id!==t&&(U.setPlayer(e,z.id,z),P=!0)}break;case d.CHANGE_PIECE:{const z=D.decodePiece(Y);U.setPiece(e,z.idx,z),P=!0}break;case d.CHANGE_DATA:U.setPuzzleData(e,Y),P=!0;break;case d.PLAYER_SNAP:Y!==t&&(V=!0);break}V&&gt()&&os()&&Eo(),P&&(oe=!0),pt=!!U.getFinishTs(e)});else if(n===ye){const a=(V,G)=>{const Y=V;if(Y[0]===d.LOG_ADD_PLAYER){const z=Y[1];return U.addPlayer(e,z,G),!0}if(Y[0]===d.LOG_UPDATE_PLAYER){const z=U.getPlayerIdByIndex(e,Y[1]);if(!z)throw"[ 2021-05-17 player not found (update player) ]";return U.addPlayer(e,z,G),!0}if(Y[0]===d.LOG_HANDLE_INPUT){const z=U.getPlayerIdByIndex(e,Y[1]);if(!z)throw"[ 2021-05-17 player not found (handle input) ]";const $e=Y[2];return U.handleInput(e,z,$e,G),!0}return!1};let g=u.lastGameTs;const P=async()=>{u.logPointer+1>=u.log.length&&await te(e);const V=Ee.timestamp();if(u.paused){u.lastRealTs=V,et=setTimeout(P,50);return}const Y=(V-u.lastRealTs)*u.speeds[u.speedIdx];let z=u.lastGameTs+Y,$e=!0;do if(u.paused)$e=!1;else{const Fe=u.logPointer+1;if(Fe>=u.log.length)$e=!1;else{const ys=u.log[u.logPointer],vs=g+ys[ys.length-1],ft=u.log[Fe],ws=ft[ft.length-1],_t=vs+ws;_t>z?(z+500*Ee.MS<_t&&(z+=ws),$e=!1):(g=vs,a(ft,_t)&&(oe=!0),u.logPointer=Fe)}}while($e);u.lastRealTs=V,u.lastGameTs=z,Xe(x()),u.final||(et=setTimeout(P,50))};P()}const $o=la({update:()=>{ue.createKeyEvents();for(const a of ue.consumeAll())if(n===Ze){const g=a[0];if(g===d.INPUT_EV_MOVE){const G=L.worldDimToViewportRaw({w:a[1],h:a[2]});oe=!0,L.move(G.w,G.h),delete ce.last}else if(g===d.INPUT_EV_MOUSE_MOVE){if(a[5]&&!U.getFirstOwnedPiece(e,t)){const Y=L.worldDimToViewportRaw({w:a[3],h:a[4]});oe=!0,L.move(Y.w,Y.h),delete ce.last}}else if(g===d.INPUT_EV_PLAYER_COLOR)mt(a[1]);else if(g===d.INPUT_EV_MOUSE_DOWN)Be(!0);else if(g===d.INPUT_EV_MOUSE_UP)Be(!1);else if(g===d.INPUT_EV_ZOOM_IN){const G={x:a[1],y:a[2]};oe=!0,L.zoom("in",L.worldToViewportRaw(G)),delete ce.last}else if(g===d.INPUT_EV_ZOOM_OUT){const G={x:a[1],y:a[2]};oe=!0,L.zoom("out",L.worldToViewportRaw(G)),delete ce.last}else if(g===d.INPUT_EV_TOGGLE_PREVIEW)gs();else if(g===d.INPUT_EV_TOGGLE_SOUNDS)ms();else if(g===d.INPUT_EV_TOGGLE_PLAYER_NAMES)fs();else if(g===d.INPUT_EV_CENTER_FIT_PUZZLE){const G="center",Y=Qe(G);q(Y?`Restored position "${Y}"`:`Position "${G}" not set`)}else if(g===d.INPUT_EV_TOGGLE_FIXED_PIECES)ke=!ke,q(`${ke?"Showing":"Hiding"} finished pieces`),oe=!0;else if(g===d.INPUT_EV_TOGGLE_LOOSE_PIECES)Ae=!Ae,q(`${Ae?"Showing":"Hiding"} unfinished pieces`),oe=!0;else if(g===d.INPUT_EV_STORE_POS){const G=`${a[1]}`;ce[G]=L.snapshot(),q(`Stored position ${G}`)}else if(g===d.INPUT_EV_RESTORE_POS){const G=`${a[1]}`,Y=Qe(G);q(Y?`Restored position "${Y}"`:`Position "${G}" not set`)}const P=x(),V=U.handleInput(e,t,a,P);gt()&&V.find(G=>G[0]===d.PLAYER_SNAP)&&rs(),V.length>0&&(oe=!0),be.sendClientEvent(a)}else if(n===ye){const g=a[0];if(g===d.INPUT_EV_REPLAY_TOGGLE_PAUSE)hs();else if(g===d.INPUT_EV_REPLAY_SPEED_DOWN)ps();else if(g===d.INPUT_EV_REPLAY_SPEED_UP)ds();else if(g===d.INPUT_EV_MOVE){const P=L.worldDimToViewportRaw({w:a[1],h:a[2]});oe=!0,L.move(P.w,P.h)}else if(g===d.INPUT_EV_MOUSE_MOVE){if(a[5]){const V=L.worldDimToViewportRaw({w:a[3],h:a[4]});oe=!0,L.move(V.w,V.h)}}else if(g===d.INPUT_EV_PLAYER_COLOR)mt(a[1]);else if(g===d.INPUT_EV_MOUSE_DOWN)Be(!0);else if(g===d.INPUT_EV_MOUSE_UP)Be(!1);else if(g===d.INPUT_EV_ZOOM_IN){const P={x:a[1],y:a[2]};oe=!0,L.zoom("in",L.worldToViewportRaw(P))}else if(g===d.INPUT_EV_ZOOM_OUT){const P={x:a[1],y:a[2]};oe=!0,L.zoom("out",L.worldToViewportRaw(P))}else if(g===d.INPUT_EV_TOGGLE_PREVIEW)gs();else if(g===d.INPUT_EV_TOGGLE_SOUNDS)ms();else if(g===d.INPUT_EV_TOGGLE_PLAYER_NAMES)fs();else if(g===d.INPUT_EV_CENTER_FIT_PUZZLE){const P="center",V=Qe(P);q(V?`Restored position "${V}"`:`Position "${P}" not set`)}else if(g===d.INPUT_EV_TOGGLE_FIXED_PIECES)ke=!ke,q(`${ke?"Showing":"Hiding"} finished pieces`),oe=!0;else if(g===d.INPUT_EV_TOGGLE_LOOSE_PIECES)Ae=!Ae,q(`${Ae?"Showing":"Hiding"} unfinished pieces`),oe=!0;else if(g===d.INPUT_EV_STORE_POS){const P=`${a[1]}`;ce[P]=L.snapshot(),q(`Stored position ${P}`)}else if(g===d.INPUT_EV_RESTORE_POS){const P=`${a[1]}`,V=Qe(P);q(V?`Restored position "${V}"`:`Position "${P}" not set`)}}pt=!!U.getFinishTs(e),ss()&&(R.update(),oe=!0)},render:async()=>{if(!oe)return;const a=x();let g,P,V;window.DEBUG&&Te.checkpoint_start(0),W.fillStyle=is(),W.fillRect(0,0,k.width,k.height),window.DEBUG&&Te.checkpoint("clear done"),g=L.worldToViewportRaw(Jt),P=L.worldDimToViewportRaw(dt),W.fillStyle="rgba(255, 255, 255, .3)",W.fillRect(g.x,g.y,P.w,P.h),window.DEBUG&&Te.checkpoint("board done");const G=U.getPiecesSortedByZIndex(e);window.DEBUG&&Te.checkpoint("get pieces done"),P=L.worldDimToViewportRaw(es);for(const z of G)!$c(z)||(V=E[z.idx],g=L.worldToViewportRaw({x:Pe+z.pos.x,y:Pe+z.pos.y}),W.drawImage(V,0,0,V.width,V.height,g.x,g.y,P.w,P.h));window.DEBUG&&Te.checkpoint("pieces done");const Y=[];for(const z of U.getActivePlayers(e,a))l(z)&&(V=await $(z),g=L.worldToViewport(z),W.drawImage(V,g.x-B,g.y-C),ns()&&Y.push([`${z.name} (${z.points})`,g.x,g.y+A]));W.fillStyle="white",W.textAlign="center";for(const[z,$e,Fe]of Y)W.fillText(z,$e,Fe);window.DEBUG&&Te.checkpoint("players done"),Xe(a),window.DEBUG&&Te.checkpoint("HUD done"),ss()&&R.render(),oe=!1}}),bo=()=>{Po(),$o.stop(),ue&&ue.unregisterEvents()};return{previewImageUrl:vo,player:Z,game:U.get(e),disconnect:be.disconnect,connect:se,unload:bo}}const bc=ne({name:"game",components:{PuzzleStatusComponent:Yt,Scores:Bt,SettingsOverlay:Ft,PreviewOverlay:Wt,InfoOverlay:xt,ConnectionOverlay:qs,HelpOverlay:jt},data(){return{statusMessages:[],players:{active:[],idle:[]},status:{finished:!1,duration:0,piecesDone:0,piecesTotal:0},overlay:"",connectionState:0,cuttingPuzzle:!0,eventBus:Ls(),g:{player:Vs(),game:null,previewImageUrl:"",connect:()=>{},disconnect:()=>{},unload:()=>{}}}},async mounted(){if(!this.$route.params.id)return;this.eventBus.on("puzzleCut",()=>{this.cuttingPuzzle=!1}),this.eventBus.on("players",t=>{this.players=t}),this.eventBus.on("status",t=>{this.status=t}),this.eventBus.on("connectionState",t=>{this.connectionState=t}),this.eventBus.on("togglePreview",t=>{this.toggleTo("preview",t,!1)}),this.eventBus.on("toggleSoundsEnabled",t=>{this.g.player.soundsEnabled=!!t}),this.eventBus.on("togglePlayerNames",t=>{this.g.player.showPlayerNames=!!t}),this.$watch(()=>this.g.player.background,t=>{this.eventBus.emit("onBgChange",t)}),this.$watch(()=>this.g.player.color,t=>{this.eventBus.emit("onColorChange",t)}),this.$watch(()=>this.g.player.name,t=>{this.eventBus.emit("onNameChange",t)}),this.$watch(()=>this.g.player.soundsEnabled,t=>{this.eventBus.emit("onSoundsEnabledChange",t)}),this.$watch(()=>this.g.player.otherPlayerClickSoundEnabled,t=>{this.eventBus.emit("onOtherPlayerClickSoundEnabledChange",t)}),this.$watch(()=>this.g.player.soundsVolume,t=>{this.eventBus.emit("onSoundsVolumeChange",t)}),this.$watch(()=>this.g.player.showPlayerNames,t=>{this.eventBus.emit("onShowPlayerNamesChange",t)});const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",this.onResize),this.g=await mo(`${this.$route.params.id}`,ge.clientId(),this.$config.WS_ADDRESS,Ze,e,this.eventBus),this.eventBus.on("statusMessage",t=>{this.addStatusMessage(t.what,t.value)})},unmounted(){this.g.unload(),this.g.disconnect(),window.removeEventListener("resize",this.onResize)},methods:{addStatusMessage(e,t){typeof t=="undefined"?this.statusMessages.push(`${e}`):t===!0||t===!1?this.statusMessages.push(`${e} ${t?"enabled":"disabled"}`):this.statusMessages.push(`${e} changed to ${t}`),setTimeout(()=>{this.statusMessages.shift()},3e3)},onResize(){const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,this.eventBus.emit("requireRerender")},reconnect(){this.g.connect()},toggleTo(e,t,o){t===!1?(this.overlay="",o&&this.eventBus.emit("setHotkeys",!0)):(this.overlay=e,o&&this.eventBus.emit("setHotkeys",!1))},toggle(e,t){this.overlay===""?(this.overlay=e,t&&this.eventBus.emit("setHotkeys",!1)):(this.overlay="",t&&this.eventBus.emit("setHotkeys",!0)),e==="preview"&&this.eventBus.emit("onPreviewChange",this.overlay==="preview")}}}),Cc={id:"game"},Sc=s("div",null,[s("i",{class:"icon icon-hourglass"}),m(" Cutting puzzle, please wait... "),s("i",{class:"icon icon-hourglass"})],-1),Tc={class:"menu-left"},kc={key:0,class:"switch-game-replay"},Ac=s("i",{class:"icon icon-replay"},null,-1),Oc=m(" Watch replay"),Nc={class:"menu"},Uc={class:"tabs"},Rc=s("i",{class:"icon icon-puzzle-piece"},null,-1),Lc=m(" Puzzles"),Vc=s("i",{class:"icon icon-preview"},null,-1),zc=m(" Preview"),Mc=[Vc,zc],Dc=s("i",{class:"icon icon-settings"},null,-1),Ic=m(" Settings"),Gc=[Dc,Ic],Bc=s("i",{class:"icon icon-info"},null,-1),Yc=m(" Info"),Fc=[Bc,Yc],Wc=s("i",{class:"icon icon-hotkey"},null,-1),xc=m(" Hotkeys"),Zc=[Wc,xc],Hc=s("a",{class:"opener",href:"https://ec.europa.eu/info/strategy/priorities-2019-2024/stronger-europe-world/eu-solidarity-ukraine/eu-assistance-ukraine/eu-stands-ukraine_en",target:"_blank"},[s("i",{class:"icon icon-ukraine-heart"}),m(" Stand with Ukraine ")],-1),jc={class:"menu-right"},Kc={key:4,class:"status-messages"},qc={ref:"canvas"};function Qc(e,t,o,n,i,r){const l=O("settings-overlay"),c=O("preview-overlay"),f=O("info-overlay"),h=O("help-overlay"),N=O("overlay"),I=O("connection-overlay"),w=O("puzzle-status"),_=O("router-link"),T=O("scores");return p(),v("div",Cc,[e.overlay==="settings"?(p(),J(l,{key:0,onClose:t[0]||(t[0]=y=>e.toggle("settings",!0)),onBgclick:t[1]||(t[1]=y=>e.toggle("settings",!0)),modelValue:e.g.player,"onUpdate:modelValue":t[2]||(t[2]=y=>e.g.player=y)},null,8,["modelValue"])):M("",!0),e.overlay==="preview"?(p(),J(c,{key:1,onClose:t[3]||(t[3]=y=>e.toggle("preview",!1)),onClick:t[4]||(t[4]=y=>e.toggle("preview",!1)),img:e.g.previewImageUrl},null,8,["img"])):M("",!0),e.g.game&&e.overlay==="info"?(p(),J(f,{key:2,onClose:t[5]||(t[5]=y=>e.toggle("info",!0)),onBgclick:t[6]||(t[6]=y=>e.toggle("info",!0)),game:e.g.game},null,8,["game"])):M("",!0),e.overlay==="help"?(p(),J(h,{key:3,onClose:t[7]||(t[7]=y=>e.toggle("help",!0)),onBgclick:t[8]||(t[8]=y=>e.toggle("help",!0))})):M("",!0),j(Q(N,null,{default:re(()=>[Sc]),_:1},512),[[Rs,e.cuttingPuzzle]]),Q(I,{connectionState:e.connectionState,onReconnect:e.reconnect},null,8,["connectionState","onReconnect"]),s("div",Tc,[Q(w,{status:e.status},null,8,["status"]),e.g.game&&e.g.game.hasReplay?(p(),v("div",kc,[Q(_,{to:{name:"replay",params:{id:e.g.game.id}}},{default:re(()=>[Ac,Oc]),_:1},8,["to"])])):M("",!0)]),s("div",Nc,[s("div",Uc,[Q(_,{class:"opener",to:{name:"index"},target:"_blank"},{default:re(()=>[Rc,Lc]),_:1}),s("div",{class:"opener",onClick:t[9]||(t[9]=y=>e.toggle("preview",!1))},Mc),s("div",{class:"opener",onClick:t[10]||(t[10]=y=>e.toggle("settings",!0))},Gc),s("div",{class:"opener",onClick:t[11]||(t[11]=y=>e.toggle("info",!0))},Fc),s("div",{class:"opener",onClick:t[12]||(t[12]=y=>e.toggle("help",!0))},Zc),Hc])]),s("div",jc,[Q(T,{players:e.players},null,8,["players"])]),e.statusMessages.length?(p(),v("div",Kc,[(p(!0),v(ae,null,me(e.statusMessages,(y,B)=>(p(),v("div",{key:B},F(y),1))),128))])):M("",!0),s("canvas",qc,null,512)])}var Xc=ee(bc,[["render",Qc]]);const Jc=ne({name:"replay",components:{PuzzleStatusComponent:Yt,Scores:Bt,SettingsOverlay:Ft,PreviewOverlay:Wt,InfoOverlay:xt,HelpOverlay:jt},data(){return{statusMessages:[],players:{active:[],idle:[]},status:{finished:!1,duration:0,piecesDone:0,piecesTotal:0},overlay:"",connectionState:0,cuttingPuzzle:!0,eventBus:Ls(),g:{player:Vs(),game:null,previewImageUrl:"",connect:()=>{},disconnect:()=>{},unload:()=>{}},replay:{speed:1,paused:!1}}},async mounted(){if(!this.$route.params.id)return;this.eventBus.on("puzzleCut",()=>{this.cuttingPuzzle=!1}),this.eventBus.on("players",t=>{this.players=t}),this.eventBus.on("status",t=>{this.status=t}),this.eventBus.on("connectionState",t=>{this.connectionState=t}),this.eventBus.on("togglePreview",t=>{this.toggleTo("preview",t,!1)}),this.eventBus.on("toggleSoundsEnabled",t=>{this.g.player.soundsEnabled=!!t}),this.eventBus.on("togglePlayerNames",t=>{this.g.player.showPlayerNames=!!t}),this.eventBus.on("replaySpeed",t=>{this.replay.speed=t}),this.eventBus.on("replayPaused",t=>{this.replay.paused=t}),this.$watch(()=>this.g.player.background,t=>{this.eventBus.emit("onBgChange",t)}),this.$watch(()=>this.g.player.color,t=>{this.eventBus.emit("onColorChange",t)}),this.$watch(()=>this.g.player.name,t=>{this.eventBus.emit("onNameChange",t)}),this.$watch(()=>this.g.player.soundsEnabled,t=>{this.eventBus.emit("onSoundsEnabledChange",t)}),this.$watch(()=>this.g.player.otherPlayerClickSoundEnabled,t=>{this.eventBus.emit("onOtherPlayerClickSoundEnabledChange",t)}),this.$watch(()=>this.g.player.soundsVolume,t=>{this.eventBus.emit("onSoundsVolumeChange",t)}),this.$watch(()=>this.g.player.showPlayerNames,t=>{this.eventBus.emit("onShowPlayerNamesChange",t)});const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",this.onResize),this.g=await mo(`${this.$route.params.id}`,ge.clientId(),this.$config.WS_ADDRESS,ye,e,this.eventBus),this.eventBus.on("statusMessage",t=>{this.addStatusMessage(t.what,t.value)})},unmounted(){this.g.unload(),this.g.disconnect(),window.removeEventListener("resize",this.onResize)},methods:{addStatusMessage(e,t){typeof t=="undefined"?this.statusMessages.push(`${e}`):t===!0||t===!1?this.statusMessages.push(`${e} ${t?"enabled":"disabled"}`):this.statusMessages.push(`${e} changed to ${t}`),setTimeout(()=>{this.statusMessages.shift()},3e3)},onResize(){const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,this.eventBus.emit("requireRerender")},toggleTo(e,t,o){t===!1?(this.overlay="",o&&this.eventBus.emit("setHotkeys",!0)):(this.overlay=e,o&&this.eventBus.emit("setHotkeys",!1))},toggle(e,t){this.overlay===""?(this.overlay=e,t&&this.eventBus.emit("setHotkeys",!1)):(this.overlay="",t&&this.eventBus.emit("setHotkeys",!0)),e==="preview"&&this.eventBus.emit("onPreviewChange",this.overlay==="preview")}},computed:{replayText(){return"Replay-Speed: "+(this.replay.speed+"x")+(this.replay.paused?" Paused":"")}}}),eu={id:"replay"},tu={key:4,class:"overlay"},su=s("div",{class:"overlay-content"},[s("div",null,[s("i",{class:"icon icon-hourglass"}),m(" Cutting puzzle, please wait... "),s("i",{class:"icon icon-hourglass"})])],-1),ou=[su],nu={class:"menu-left"},iu={class:"playback-control"},lu=s("i",{class:"icon icon-speed-up"},null,-1),ru=[lu],au=s("i",{class:"icon icon-speed-down"},null,-1),cu=[au],uu=s("i",{class:"icon icon-pause"},null,-1),du=[uu],pu={key:0,class:"switch-game-replay"},hu=s("i",{class:"icon icon-puzzle-piece"},null,-1),gu=m(" To the game"),mu={class:"menu"},fu={class:"tabs"},_u=s("i",{class:"icon icon-puzzle-piece"},null,-1),yu=m(" Puzzles"),vu=s("i",{class:"icon icon-preview"},null,-1),wu=m(" Preview"),Eu=[vu,wu],Pu=s("i",{class:"icon icon-settings"},null,-1),$u=m(" Settings"),bu=[Pu,$u],Cu=s("i",{class:"icon icon-info"},null,-1),Su=m(" Info"),Tu=[Cu,Su],ku=s("i",{class:"icon icon-hotkey"},null,-1),Au=m(" Hotkeys"),Ou=[ku,Au],Nu=s("a",{class:"opener",href:"https://ec.europa.eu/info/strategy/priorities-2019-2024/stronger-europe-world/eu-solidarity-ukraine/eu-assistance-ukraine/eu-stands-ukraine_en",target:"_blank"},[s("i",{class:"icon icon-ukraine-heart"}),m(" Stand with Ukraine ")],-1),Uu={class:"menu-right"},Ru={key:5,class:"status-messages"},Lu={ref:"canvas"};function Vu(e,t,o,n,i,r){const l=O("settings-overlay"),c=O("preview-overlay"),f=O("info-overlay"),h=O("help-overlay"),N=O("puzzle-status"),I=O("router-link"),w=O("scores");return p(),v("div",eu,[e.overlay==="settings"?(p(),J(l,{key:0,onClose:t[0]||(t[0]=_=>e.toggle("settings",!0)),onBgclick:t[1]||(t[1]=_=>e.toggle("settings",!0)),modelValue:e.g.player,"onUpdate:modelValue":t[2]||(t[2]=_=>e.g.player=_)},null,8,["modelValue"])):M("",!0),e.overlay==="preview"?(p(),J(c,{key:1,onClose:t[3]||(t[3]=_=>e.toggle("preview",!1)),onClick:t[4]||(t[4]=_=>e.toggle("preview",!1)),img:e.g.previewImageUrl},null,8,["img"])):M("",!0),e.g.game&&e.overlay==="info"?(p(),J(f,{key:2,onClose:t[5]||(t[5]=_=>e.toggle("info",!0)),onBgclick:t[6]||(t[6]=_=>e.toggle("info",!0)),game:e.g.game},null,8,["game"])):M("",!0),e.overlay==="help"?(p(),J(h,{key:3,onClose:t[7]||(t[7]=_=>e.toggle("help",!0)),onBgclick:t[8]||(t[8]=_=>e.toggle("help",!0))})):M("",!0),e.cuttingPuzzle?(p(),v("div",tu,ou)):M("",!0),s("div",nu,[Q(N,{status:e.status},null,8,["status"]),s("div",iu,[s("div",null,F(e.replayText),1),s("button",{class:"btn",onClick:t[9]||(t[9]=_=>e.eventBus.emit("replayOnSpeedUp"))},ru),s("button",{class:"btn",onClick:t[10]||(t[10]=_=>e.eventBus.emit("replayOnSpeedDown"))},cu),s("button",{class:"btn",onClick:t[11]||(t[11]=_=>e.eventBus.emit("replayOnPauseToggle"))},du)]),e.g.game?(p(),v("div",pu,[Q(I,{to:{name:"game",params:{id:e.g.game.id}}},{default:re(()=>[hu,gu]),_:1},8,["to"])])):M("",!0)]),s("div",mu,[s("div",fu,[Q(I,{class:"opener",to:{name:"index"},target:"_blank"},{default:re(()=>[_u,yu]),_:1}),s("div",{class:"opener",onClick:t[12]||(t[12]=_=>e.toggle("preview",!1))},Eu),s("div",{class:"opener",onClick:t[13]||(t[13]=_=>e.toggle("settings",!0))},bu),s("div",{class:"opener",onClick:t[14]||(t[14]=_=>e.toggle("info",!0))},Tu),s("div",{class:"opener",onClick:t[15]||(t[15]=_=>e.toggle("help",!0))},Ou),Nu])]),s("div",Uu,[Q(w,{players:e.players},null,8,["players"])]),e.statusMessages.length?(p(),v("div",Ru,[(p(!0),v(ae,null,me(e.statusMessages,(_,T)=>(p(),v("div",{key:T},F(_),1))),128))])):M("",!0),s("canvas",Lu,null,512)])}var zu=ee(Jc,[["render",Vu]]);let fo=null;async function Mu(){fo=await(await ge.get("/api/me",{})).json()}var _o={getMe:()=>fo,init:Mu};const Du=ne({props:{image:{type:Object,required:!0}},data:()=>({me:_o.getMe()}),computed:{style(){return{backgroundImage:`url("${this.image.url.replace("uploads/","uploads/r/")+"-150x100.webp"}")`}},canEdit(){return this.me.id?this.me.id===this.image.uploaderUserId:!1}},emits:{click:null,editClick:null},methods:{onClick(){this.$emit("click")},onEditClick(){this.$emit("editClick")}}}),Iu=s("i",{class:"icon icon-edit"},null,-1),Gu=[Iu];function Bu(e,t,o,n,i,r){return p(),v("div",{class:"imageteaser",style:De(e.style),onClick:t[1]||(t[1]=(...l)=>e.onClick&&e.onClick(...l))},[e.canEdit?(p(),v("div",{key:0,class:"btn edit",onClick:t[0]||(t[0]=Et((...l)=>e.onEditClick&&e.onEditClick(...l),["stop"]))},Gu)):M("",!0)],4)}var Yu=ee(Du,[["render",Bu]]);const Fu=ne({props:{animate:{type:Boolean,default:!0}},emits:{bgclick:null,close:null},data:()=>({classes:[]}),methods:{onKeyUp(e){e.code==="Escape"&&window.getComputedStyle(this.$el).display!=="none"&&this.$emit("close")}},mounted(){window.addEventListener("keyup",this.onKeyUp)},unmounted(){window.removeEventListener("keyup",this.onKeyUp)}}),Wu={class:"overlay"};function xu(e,t,o,n,i,r){return p(),v("div",Wu,[s("div",{class:Ke(["overlay-background",e.classes.map(l=>"overlay-background-"+l)]),onClick:t[0]||(t[0]=l=>e.$emit("bgclick"))},null,2),s("div",{class:Ke(["overlay-content",e.classes.map(l=>"overlay-content-"+l)])},[ko(e.$slots,"default")],2)])}var Zu=ee(Fu,[["render",xu]]);const Hu={props:{src:String,title:{type:String,default:""},height:{type:String,default:"100%"},width:{type:String,default:"100%"}},computed:{style(){return{display:"inline-block",verticalAlign:"text-bottom",backgroundImage:`url('${this.src}')`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",width:this.width,height:this.height}}}},ju=["title"];function Ku(e,t,o,n,i,r){return p(),v("div",{style:De(r.style),title:o.title},null,12,ju)}var qu=ee(Hu,[["render",Ku]]);const Qu=ne({props:{modelValue:{type:Array,required:!0},autocompleteTags:{type:Function}},emits:{"update:modelValue":null},data(){return{input:"",values:[],autocomplete:{idx:-1,values:[]}}},watch:{modelValue(e,t){this.values=e}},created(){this.values=this.modelValue},methods:{onKeyUp(e){if(e.code==="ArrowDown"&&this.autocomplete.values.length>0)return this.autocomplete.idx<this.autocomplete.values.length-1&&this.autocomplete.idx++,e.stopPropagation(),!1;if(e.code==="ArrowUp"&&this.autocomplete.values.length>0)return this.autocomplete.idx>0&&this.autocomplete.idx--,e.stopPropagation(),!1;if(e.key===",")return this.add(),e.stopPropagation(),!1;if(e.code==="Escape")return this.autocomplete.values=[],this.autocomplete.idx=-1,e.stopPropagation(),!1;this.input&&this.autocompleteTags?(this.autocomplete.values=this.autocompleteTags(this.input,this.values),this.autocomplete.idx=-1):(this.autocomplete.values=[],this.autocomplete.idx=-1)},addVal(e){const t=e.replace(/,/g,"").trim();!t||(this.values.includes(t)||this.values.push(t),this.input="",this.autocomplete.values=[],this.autocomplete.idx=-1,this.$emit("update:modelValue",this.values),this.$refs.input.focus())},add(){const e=this.autocomplete.idx>=0?this.autocomplete.values[this.autocomplete.idx]:this.input;this.addVal(e)},rm(e){this.values=this.values.filter(t=>t!==e),this.$emit("update:modelValue",this.values)}}}),Xu={class:"input-holder"},Ju={key:0,class:"enter-hint color-highlight"},ed={key:0,class:"autocomplete"},td=["onClick"],sd=["onClick"];function od(e,t,o,n,i,r){return p(),v("div",null,[s("div",Xu,[j(s("input",{ref:"input",class:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>e.input=l),placeholder:"Plants, People",onKeydown:[t[1]||(t[1]=Es(Et((...l)=>e.add&&e.add(...l),["prevent"]),["enter"])),t[2]||(t[2]=Es(Et((...l)=>e.add&&e.add(...l),["prevent"]),["tab"]))],onKeyup:t[3]||(t[3]=(...l)=>e.onKeyUp&&e.onKeyUp(...l))},null,544),[[Oe,e.input]]),e.input?(p(),v("div",Ju,"[Press ENTER/TAB to add]")):M("",!0)]),e.autocomplete.values?(p(),v("div",ed,[s("ul",null,[(p(!0),v(ae,null,me(e.autocomplete.values,(l,c)=>(p(),v("li",{key:c,class:Ke({active:c===e.autocomplete.idx}),onClick:f=>e.addVal(l)},F(l),11,td))),128))])])):M("",!0),(p(!0),v(ae,null,me(e.values,(l,c)=>(p(),v("span",{key:c,class:"bit is-clickable",onClick:f=>e.rm(l)},F(l)+" \u2716",9,sd))),128))])}var nd=ee(Qu,[["render",od],["__scopeId","data-v-8e01df40"]]);(async()=>{ge.init(),await _o.init();const t=await(await ge.get("/api/conf",{})).json(),o=Ao({history:Oo(),routes:[{name:"index",path:"/",component:Sn},{name:"new-game",path:"/new-game",component:nl},{name:"game",path:"/g/:id",component:Xc},{name:"replay",path:"/replay/:id",component:zu}]});o.beforeEach((i,r)=>{r.name&&document.documentElement.classList.remove(`view-${String(r.name)}`),document.documentElement.classList.add(`view-${String(i.name)}`)});const n=No(Go);n.config.globalProperties.$config=t,n.use(o),n.component("connection-overlay",qs),n.component("edit-image-dialog",Fs),n.component("game-teaser",Is),n.component("help-overlay",jt),n.component("image-library",Gs),n.component("image-teaser",Yu),n.component("info-overlay",xt),n.component("new-game-dialog",Ws),n.component("new-image-dialog",Ys),n.component("overlay",Zu),n.component("preview-overlay",Wt),n.component("puzzle-status",Yt),n.component("responsive-image",qu),n.component("scores",Bt),n.component("settings-overlay",Ft),n.component("tags-input",nd),n.mount("#app")})();
//# sourceMappingURL=index.88bbf349.js.map
