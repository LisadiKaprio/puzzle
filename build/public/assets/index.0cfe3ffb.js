import{d as ie,r as N,o as p,c as y,a as s,b as ee,w as ae,e as B,f as m,g as te,n as Ie,t as F,F as re,h as _e,i as Xe,j,v as Re,k as Ue,l as Pe,m as Vo,p as Mo,q as zo,s as zs,u as Ds,x as bt,y as Do,z as Ts,A as Bo,B as Go,C as Io}from"./vendor.4bfcbb49.js";const xo=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=o(i);fetch(i.href,a)}};xo();var se=(e,t)=>{const o=e.__vccOpts||e;for(const[n,i]of t)o[n]=i;return o};const Yo=ie({name:"app",computed:{showNav(){return!["game","replay"].includes(String(this.$route.name))}}}),Wo={id:"app"},Fo={key:0,class:"nav"},Zo=m("Games overview"),Ho=m("New game"),jo=s("li",null,[s("a",{href:"https://ec.europa.eu/info/strategy/priorities-2019-2024/stronger-europe-world/eu-solidarity-ukraine/eu-assistance-ukraine/eu-stands-ukraine_en",class:"btn btn-ukraine",target:"_blank"},[s("i",{class:"icon icon-ukraine-heart"}),m(" Stand with Ukraine "),s("i",{class:"icon icon-ukraine-heart"})])],-1);function Ko(e,t,o,n,i,a){const r=N("router-link"),u=N("router-view");return p(),y("div",Wo,[e.showNav?(p(),y("ul",Fo,[s("li",null,[ee(r,{class:"btn",to:{name:"index"}},{default:ae(()=>[Zo]),_:1})]),s("li",null,[ee(r,{class:"btn",to:{name:"new-game"}},{default:ae(()=>[Ho]),_:1})]),jo])):B("",!0),ee(u)])}var qo=se(Yo,[["render",Ko]]);class dt{constructor(t){this.rand_high=t||3735929054,this.rand_low=t^1231121986}random(t,o){this.rand_high=(this.rand_high<<16)+(this.rand_high>>16)+this.rand_low&4294967295,this.rand_low=this.rand_low+this.rand_high&4294967295;const n=(this.rand_high>>>0)/4294967295;return t+n*(o-t+1)|0}choice(t){return t[this.random(0,t.length-1)]}shuffle(t){const o=t.slice();for(let n=0;n<=o.length-2;n++){const i=this.random(n,o.length-1),a=o[n];o[n]=o[i],o[i]=a}return o}static serialize(t){return{rand_high:t.rand_high,rand_low:t.rand_low}}static unserialize(t){const o=new dt(0);return o.rand_high=t.rand_high,o.rand_low=t.rand_low,o}}const Xo=e=>{let t=e.toLowerCase();return t=t.replace(/[^a-z0-9]+/g,"-"),t=t.replace(/^-|-$/,""),t},lt=(e,t)=>{const o=`${e}`;return o.length>=t.length?o:t.substr(0,t.length-o.length)+o},Bt=(...e)=>{const t=o=>(...n)=>{const i=new Date,a=lt(i.getHours(),"00"),r=lt(i.getMinutes(),"00"),u=lt(i.getSeconds(),"00");console[o](`${a}:${r}:${u}`,...e,...n)};return{log:t("log"),error:t("error"),info:t("info")}},Qo=()=>Date.now().toString(36)+Math.random().toString(36).substring(2);function Jo(e){return e.top+1<<0|e.right+1<<2|e.bottom+1<<4|e.left+1<<6}function en(e){return{top:(e>>0&3)-1,right:(e>>2&3)-1,bottom:(e>>4&3)-1,left:(e>>6&3)-1}}function tn(e){return[e.idx,e.pos.x,e.pos.y,e.z,e.owner,e.group]}function sn(e){return{idx:e[0],pos:{x:e[1],y:e[2]},z:e[3],owner:e[4],group:e[5]}}function on(e){return[e.id,e.x,e.y,e.d,e.name,e.color,e.bgcolor,e.points,e.ts]}function nn(e){return{id:e[0],x:e[1],y:e[2],d:e[3],name:e[4],color:e[5],bgcolor:e[6],points:e[7],ts:e[8]}}function ln(e){return[e.id,e.rng.type||"",dt.serialize(e.rng.obj),e.puzzle,e.players,e.scoreMode,e.shapeMode,e.snapMode,e.creatorUserId,e.hasReplay,e.gameVersion,e.private]}function an(e){return{id:e[0],rng:{type:e[1],obj:dt.unserialize(e[2])},puzzle:e[3],players:e[4],scoreMode:e[5],shapeMode:e[6],snapMode:e[7],creatorUserId:e[8],hasReplay:e[9],gameVersion:e[10],private:e[11]}}function rn(e,t){const o=e.width/e.tileSize;return{x:t%o,y:Math.floor(t/o)}}function un(e,t){const o=e.width/e.pieceSize;return{x:t%o,y:Math.floor(t/o)}}const cn=e=>{let t=0;for(let o=0;o<e.length;o++){const n=e.charCodeAt(o);t=(t<<5)-t+n,t|=0}return t};function dn(e){const t=[];for(const o in e){const n=[o,e[o]].map(encodeURIComponent);t.push(n.join("="))}return t.length===0?"":`?${t.join("&")}`}var I={hash:cn,slug:Xo,pad:lt,uniqId:Qo,encodeShape:Jo,decodeShape:en,encodePiece:tn,decodePiece:sn,encodePlayer:on,decodePlayer:nn,encodeGame:ln,decodeGame:an,coordByPieceIdxDeprecated:rn,coordByPieceIdx:un,asQueryArgs:dn};const q={SOUND_VOLUME:"sound_volume",SOUND_ENABLED:"sound_enabled",OTHER_PLAYER_CLICK_SOUND_ENABLED:"other_player_click_sound_enabled",COLOR_BACKGROUND:"bg_color",SHOW_TABLE:"show_table",TABLE_TEXTURE:"table_texture",PLAYER_COLOR:"player_color",PLAYER_NAME:"player_name",SHOW_PLAYER_NAMES:"show_player_names"},he={SOUND_VOLUME:100,SOUND_ENABLED:!0,OTHER_PLAYER_CLICK_SOUND_ENABLED:!0,COLOR_BACKGROUND:"#222222",SHOW_TABLE:!0,TABLE_TEXTURE:"dark",PLAYER_COLOR:"#ffffff",PLAYER_NAME:"anon",SHOW_PLAYER_NAMES:!0},Bs=()=>({background:"",showTable:!0,tableTexture:"dark",color:"",name:"",soundsEnabled:!0,otherPlayerClickSoundEnabled:!0,soundsVolume:100,showPlayerNames:!0}),Gt=(e,t)=>{localStorage.setItem(e,t)},It=e=>localStorage.getItem(e),hn=(e,t)=>{Gt(e,`${t}`)},pn=(e,t)=>{const o=It(e);if(o===null)return t;const n=parseInt(o,10);return isNaN(n)?t:n},gn=(e,t)=>{Gt(e,t?"1":"0")},mn=(e,t)=>{const o=It(e);return o===null?t:o==="1"},fn=(e,t)=>{Gt(e,t)},_n=(e,t)=>{const o=It(e);return o===null?t:o};var H={setInt:hn,getInt:pn,setBool:gn,getBool:mn,setStr:fn,getStr:_n};let Tt="",Gs="";const vt=async(e,t,o)=>new Promise((n,i)=>{const a=new window.XMLHttpRequest;a.open(e,t,!0),a.withCredentials=!0;for(const r in o.headers||{})a.setRequestHeader(r,o.headers[r]);a.setRequestHeader("Client-Id",Tt),a.setRequestHeader("Client-Secret",Gs),a.addEventListener("load",function(r){n({status:this.status,text:this.responseText,json:async()=>JSON.parse(this.responseText)})}),a.addEventListener("error",function(r){i(new Error("xhr error"))}),a.upload&&o.onUploadProgress&&a.upload.addEventListener("progress",function(r){o.onUploadProgress&&o.onUploadProgress(r)}),a.send(o.body||null)}),$s=e=>{let t=H.getStr(e,"");return t||(t=I.uniqId(),H.setStr(e,t)),t};var fe={init:()=>{Tt=$s("ID"),Gs=$s("SECRET")},request:vt,get:(e,t)=>vt("get",e,t),post:(e,t)=>vt("post",e,t),clientId:()=>Tt};const Is=1,xt=Is*1e3,rt=xt*60,ut=rt*60,$t=ut*24,yn=()=>{const e=new Date;return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},xs=e=>{const t=Math.floor(e/$t);e=e%$t;const o=Math.floor(e/ut);e=e%ut;const n=Math.floor(e/rt);e=e%rt;const i=Math.floor(e/xt);return`${t}d ${o}h ${n}m ${i}s`},wn=(e,t)=>xs(t-e);var be={MS:Is,SEC:xt,MIN:rt,HOUR:ut,DAY:$t,timestamp:yn,timeDiffStr:wn,durationStr:xs};const vn=ie({props:{game:{type:Object,required:!0}},computed:{style(){return{"background-image":`url("${this.game.imageUrl.replace("uploads/","uploads/r/")+"-375x210.webp"}")`}}},methods:{time(e,t){const o=e,n=t||be.timestamp();return`${be.timeDiffStr(o,n)}`}}}),En={class:"game-info-text"},Pn=s("i",{class:"icon icon-puzzle-piece"},null,-1),bn=s("br",null,null,-1),Tn=s("i",{class:"icon icon-sillouette"},null,-1),$n=s("br",null,null,-1),Sn={key:0,class:"icon icon-clock"},Cn={key:1,class:"icon icon-flag"},kn=s("br",null,null,-1),An=s("i",{class:"icon icon-replay"},null,-1),On=m(" Watch replay ");function Nn(e,t,o,n,i,a){const r=N("router-link");return p(),y("div",{class:"game-teaser",style:Ie(e.style)},[ee(r,{class:"game-info",to:{name:"game",params:{id:e.game.id}}},{default:ae(()=>[s("span",En,[Pn,m(" "+F(e.game.piecesFinished)+"/"+F(e.game.piecesTotal),1),bn,Tn,m(" "+F(e.game.players),1),$n,e.game.finished?(p(),y("i",Cn)):(p(),y("i",Sn)),m(" "+F(e.time(e.game.started,e.game.finished)),1),kn])]),_:1},8,["to"]),e.game.hasReplay?(p(),te(r,{key:0,class:"game-replay",to:{name:"replay",params:{id:e.game.id}}},{default:ae(()=>[An,On]),_:1},8,["to"])):B("",!0)],4)}var Ys=se(vn,[["render",Nn]]);const Un=ie({components:{GameTeaser:Ys},data(){return{gamesRunning:[],gamesFinished:[]}},async created(){const t=await(await fe.get("/api/index-data",{})).json();this.gamesRunning=t.gamesRunning,this.gamesFinished=t.gamesFinished}}),Rn=s("h1",null,"Running games",-1),Ln=s("h1",null,"Finished games",-1);function Vn(e,t,o,n,i,a){const r=N("game-teaser");return p(),y("div",null,[Rn,(p(!0),y(re,null,_e(e.gamesRunning,(u,f)=>(p(),y("div",{class:"game-teaser-wrap",key:f},[ee(r,{game:u},null,8,["game"])]))),128)),Ln,(p(!0),y(re,null,_e(e.gamesFinished,(u,f)=>(p(),y("div",{class:"game-teaser-wrap",key:f},[ee(r,{game:u},null,8,["game"])]))),128))])}var Mn=se(Un,[["render",Vn]]);const zn=ie({props:{images:{type:Array,required:!0}},emits:{imageClicked:null,imageEditClicked:null},methods:{imageClicked(e){this.$emit("imageClicked",e)},imageEditClicked(e){this.$emit("imageEditClicked",e)}}});function Dn(e,t,o,n,i,a){const r=N("image-teaser");return p(),y("div",null,[(p(!0),y(re,null,_e(e.images,(u,f)=>(p(),te(r,{image:u,onClick:d=>e.imageClicked(u),onEditClick:d=>e.imageEditClicked(u),key:f},null,8,["image","onClick","onEditClick"]))),128))])}var Ws=se(zn,[["render",Dn]]);const Bn=async e=>{const t=await In(e),o=await Gn(t);return Fs(o.toDataURL())},Gn=async e=>{const t=document.createElement("canvas"),o=t.getContext("2d");return t.width=e.width,t.height=e.height,o.drawImage(e,0,0),t},In=async e=>new Promise((t,o)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{t(n)},n.onerror=i=>{o(i)},n.src=e});function Fs(e){for(var t=e.split(","),o=t[0].match(/:(.*?);/)[1],n=atob(t[1]),i=n.length,a=new Uint8Array(i);i--;)a[i]=n.charCodeAt(i);return new Blob([a],{type:o})}const xn=ie({props:{autocompleteTags:{type:Function},uploadProgress:{type:Number},uploading:{type:String}},emits:["setupGameClick","postToGalleryClick","close"],data(){return{previewUrl:"",file:null,title:"",tags:[],isPrivate:!1,droppable:!1,inputFocused:!1}},computed:{uploadProgressPercent(){return this.uploadProgress?Math.round(this.uploadProgress*100):0},canPostToGallery(){return this.uploading?!1:!!(this.previewUrl&&this.file)},canSetupGameClick(){return this.uploading?!1:!!(this.previewUrl&&this.file)}},mounted(){window.addEventListener("paste",this.onPaste)},unmounted(){window.removeEventListener("paste",this.onPaste)},methods:{reset(){this.previewUrl="",this.file=null,this.title="",this.tags=[],this.isPrivate=!1,this.droppable=!1},imageFromDragEvt(e){var n;const t=(n=e.dataTransfer)==null?void 0:n.items;if(!t||t.length===0)return null;const o=t[0];return o.type.startsWith("image/")?o:null},async onPaste(e){const t=e.clipboardData.getData("text");if(t){if(this.inputFocused)return;if(t.match(/^https?:\/\//)){const n="/api/proxy?"+new URLSearchParams({url:t});try{const i=await Bn(n);this.preview(i)}catch(i){console.error("unable to transform image http url into blob",i)}}else if(t.match(/^data:image\/([a-z]+);base64,/))try{const n=Fs(t);this.preview(n)}catch(n){console.error("unable to transform image data url into blob",n)}else console.log(t)}const o=e.clipboardData.files[0];!o||this.preview(o)},onFileSelect(e){const t=e.target;if(!t.files)return;const o=t.files[0];!o||this.preview(o)},preview(e){if(!e.type.startsWith("image/")){console.error("file type is not supported",e.type);return}const t=new FileReader;t.readAsDataURL(e),t.onload=o=>{this.previewUrl=o.target.result,this.file=e}},postToGallery(){this.$emit("postToGalleryClick",{file:this.file,title:this.title,tags:this.tags,isPrivate:this.isPrivate}),this.reset()},setupGameClick(){this.$emit("setupGameClick",{file:this.file,title:this.title,tags:this.tags,isPrivate:this.isPrivate}),this.reset()},onDrop(e){this.droppable=!1;const t=this.imageFromDragEvt(e);if(!t)return!1;const o=t.getAsFile();return o&&(this.file=o,this.preview(o),e.preventDefault()),!1},onDragover(e){return this.imageFromDragEvt(e)&&(this.droppable=!0,e.preventDefault()),!1},onDragleave(){this.droppable=!1}}}),Yn=s("div",{class:"drop-target"},null,-1),Wn={key:0,class:"has-image"},Fn={key:1},Zn={class:"upload"},Hn=s("div",{class:"upload-content"},[m(" How to upload an image? Choose any of the following methods: "),s("ul",null,[s("li",null,"Click this area to select an image for upload "),s("li",null,"Drag and drop an image into the area"),s("li",null,"Paste an image URL"),s("li",null,"Paste an image")]),s("div",{class:"hint"},` Don't worry, the image will not show up in the gallery unless "Post to gallery" was clicked. `)],-1),jn={class:"area-settings"},Kn=s("td",null,[s("label",null,"Title")],-1),qn=s("tr",null,[s("td",{colspan:"2"},[s("div",{class:"hint"},"Feel free to leave a credit to the artist/photographer in the title :)")])],-1),Xn=s("td",null,[s("label",null,"Private Image")],-1),Qn=s("tr",null,[s("td",{colspan:"2"},[s("div",{class:"hint"},"Private images won't show up in the gallery.")])],-1),Jn=s("td",null,[s("label",null,"Tags")],-1),ei={class:"area-buttons"},ti=["disabled"],si=s("i",{class:"icon icon-preview"},null,-1),oi=m(" Post to gallery"),ni=["disabled"],ii=s("i",{class:"icon icon-puzzle-piece"},null,-1),li=m(" Set up game"),ai=s("i",{class:"icon icon-puzzle-piece"},null,-1),ri=m(" Post to gallery "),ui=s("br",null,null,-1),ci=m(" + set up game");function di(e,t,o,n,i,a){const r=N("responsive-image"),u=N("tags-input"),f=N("overlay");return p(),te(f,{class:"new-image-dialog"},{default:ae(()=>[s("div",{class:Xe(["area-image",{"has-image":!!e.previewUrl,"no-image":!e.previewUrl,droppable:e.droppable}]),onDrop:t[2]||(t[2]=(...d)=>e.onDrop&&e.onDrop(...d)),onDragover:t[3]||(t[3]=(...d)=>e.onDragover&&e.onDragover(...d)),onDragleave:t[4]||(t[4]=(...d)=>e.onDragleave&&e.onDragleave(...d))},[Yn,e.previewUrl?(p(),y("div",Wn,[s("span",{class:"remove btn",onClick:t[0]||(t[0]=d=>e.previewUrl="")},"X"),ee(r,{src:e.previewUrl},null,8,["src"])])):(p(),y("div",Fn,[s("label",Zn,[s("input",{type:"file",style:{display:"none"},onChange:t[1]||(t[1]=(...d)=>e.onFileSelect&&e.onFileSelect(...d)),accept:"image/*"},null,32),Hn])]))],34),s("div",jn,[s("table",null,[s("tr",null,[Kn,s("td",null,[j(s("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=d=>e.title=d),placeholder:"Flower by @artist",onFocus:t[6]||(t[6]=d=>e.inputFocused=!0),onBlur:t[7]||(t[7]=d=>e.inputFocused=!1)},null,544),[[Re,e.title]])])]),qn,s("tr",null,[Xn,s("td",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=d=>e.isPrivate=d)},null,512),[[Ue,e.isPrivate]])])]),Qn,s("tr",null,[Jn,s("td",null,[ee(u,{modelValue:e.tags,"onUpdate:modelValue":t[9]||(t[9]=d=>e.tags=d),autocompleteTags:e.autocompleteTags},null,8,["modelValue","autocompleteTags"])])])])]),s("div",ei,[e.isPrivate?B("",!0):(p(),y("button",{key:0,class:"btn",disabled:!e.canPostToGallery,onClick:t[10]||(t[10]=(...d)=>e.postToGallery&&e.postToGallery(...d))},[e.uploading==="postToGallery"?(p(),y(re,{key:0},[m("Uploading ("+F(e.uploadProgressPercent)+"%)",1)],64)):(p(),y(re,{key:1},[si,oi],64))],8,ti)),s("button",{class:"btn",disabled:!e.canSetupGameClick,onClick:t[11]||(t[11]=(...d)=>e.setupGameClick&&e.setupGameClick(...d))},[e.uploading==="setupGame"?(p(),y(re,{key:0},[m("Uploading ("+F(e.uploadProgressPercent)+"%)",1)],64)):e.isPrivate?(p(),y(re,{key:1},[ii,li],64)):(p(),y(re,{key:2},[ai,ri,ui,ci],64))],8,ni),s("button",{class:"btn",onClick:t[12]||(t[12]=d=>e.$emit("close"))},"Cancel")])]),_:1})}var Zs=se(xn,[["render",di]]);const hi=ie({props:{image:{type:Object,required:!0},autocompleteTags:{type:Function}},emits:["saveClick","close"],data(){return{title:"",tags:[]}},watch:{image(e,t){this.init(e)}},created(){this.init(this.image)},methods:{init(e){this.title=e.title,this.tags=e.tags.map(t=>t.title)},saveImage(){this.$emit("saveClick",{id:this.image.id,title:this.title,tags:this.tags})}}}),pi={class:"area-image"},gi={class:"has-image"},mi={class:"area-settings"},fi=s("td",null,[s("label",null,"Title")],-1),_i=s("tr",null,[s("td",{colspan:"2"},[s("div",{class:"hint"},"Feel free to leave a credit to the artist/photographer in the title :)")])],-1),yi=s("td",null,[s("label",null,"Tags")],-1),wi={class:"area-buttons"},vi=s("i",{class:"icon icon-preview"},null,-1),Ei=m(" Save image"),Pi=[vi,Ei];function bi(e,t,o,n,i,a){const r=N("responsive-image"),u=N("tags-input"),f=N("overlay");return p(),te(f,{class:"edit-image-dialog"},{default:ae(()=>[s("div",pi,[s("div",gi,[ee(r,{src:e.image.url,title:e.image.title},null,8,["src","title"])])]),s("div",mi,[s("table",null,[s("tr",null,[fi,s("td",null,[j(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=d=>e.title=d),placeholder:"Flower by @artist"},null,512),[[Re,e.title]])])]),_i,s("tr",null,[yi,s("td",null,[ee(u,{modelValue:e.tags,"onUpdate:modelValue":t[1]||(t[1]=d=>e.tags=d),autocompleteTags:e.autocompleteTags},null,8,["modelValue","autocompleteTags"])])])])]),s("div",wi,[s("button",{class:"btn",onClick:t[2]||(t[2]=(...d)=>e.saveImage&&e.saveImage(...d))},Pi),s("button",{class:"btn",onClick:t[3]||(t[3]=d=>e.$emit("close"))},"Cancel")])]),_:1})}var Hs=se(hi,[["render",bi]]),Le=(e=>(e[e.FINAL=0]="FINAL",e[e.ANY=1]="ANY",e))(Le||{}),Ke=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ANY=1]="ANY",e[e.FLAT=2]="FLAT",e))(Ke||{}),xe=(e=>(e[e.NORMAL=0]="NORMAL",e[e.REAL=1]="REAL",e))(xe||{});const Ti=ie({props:{image:{type:Object,required:!0},forcePrivate:{type:Boolean,default:!1}},emits:["newGame","close"],data(){return{tiles:1e3,isPrivate:!1,scoreMode:Le.ANY,shapeMode:Ke.NORMAL,snapMode:xe.NORMAL}},mounted(){this.isPrivate=this.forcePrivate},methods:{onNewGameClick(){this.$emit("newGame",{tiles:this.tilesInt,private:this.isPrivate,image:this.image,scoreMode:this.scoreModeInt,shapeMode:this.shapeModeInt,snapMode:this.snapModeInt})}},computed:{canStartNewGame(){return!(!this.tilesInt||!this.image||!this.image.url||![0,1].includes(this.scoreModeInt))},scoreModeInt(){return parseInt(`${this.scoreMode}`,10)},shapeModeInt(){return parseInt(`${this.shapeMode}`,10)},snapModeInt(){return parseInt(`${this.snapMode}`,10)},tilesInt(){return parseInt(`${this.tiles}`,10)}}}),$i={class:"area-image"},Si={class:"has-image"},Ci={key:0,class:"image-title"},ki={key:0,class:"image-title-title"},Ai={key:1,class:"image-title-dim"},Oi={class:"area-settings"},Ni=s("td",null,[s("label",null,"Pieces")],-1),Ui=s("td",null,[s("label",null,"Scoring: ")],-1),Ri=m(" Any (Score when pieces are connected to each other or on final location)"),Li=s("br",null,null,-1),Vi=m(" Final (Score when pieces are put to their final location)"),Mi=s("td",null,[s("label",null,"Shapes: ")],-1),zi=m(" Normal"),Di=s("br",null,null,-1),Bi=m(" Any (Flat pieces can occur anywhere)"),Gi=s("br",null,null,-1),Ii=m(" Flat (All pieces flat on all sides)"),xi=s("td",null,[s("label",null,"Snapping: ")],-1),Yi=m(" Normal (Pieces snap to final destination and to each other)"),Wi=s("br",null,null,-1),Fi=m(" Real (Pieces snap only to corners, already snapped pieces and to each other)"),Zi=s("td",null,[s("label",null,"Private Game")],-1),Hi=["disabled"],ji=s("tr",null,[s("td",{colspan:"2"},[s("div",{class:"hint"},"Private games won't show up in the game overview.")])],-1),Ki={key:0},qi=s("td",null,[s("label",null,"Tags: ")],-1),Xi={class:"area-buttons"},Qi=["disabled"],Ji=s("i",{class:"icon icon-puzzle-piece"},null,-1),el=m(" Generate Puzzle "),tl=[Ji,el];function sl(e,t,o,n,i,a){const r=N("responsive-image"),u=N("overlay");return p(),te(u,{class:"new-game-dialog"},{default:ae(()=>[s("div",$i,[s("div",Si,[ee(r,{src:e.image.url,title:e.image.title},null,8,["src","title"])]),e.image.title||e.image.width||e.image.height?(p(),y("div",Ci,[e.image.title?(p(),y("span",ki,'"'+F(e.image.title)+'"',1)):B("",!0),e.image.width||e.image.height?(p(),y("span",Ai,"("+F(e.image.width)+" \u2715 "+F(e.image.height)+")",1)):B("",!0)])):B("",!0)]),s("div",Oi,[s("table",null,[s("tr",null,[Ni,s("td",null,[j(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=f=>e.tiles=f)},null,512),[[Re,e.tiles]])])]),s("tr",null,[Ui,s("td",null,[s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=f=>e.scoreMode=f),value:"1"},null,512),[[Pe,e.scoreMode]]),Ri]),Li,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=f=>e.scoreMode=f),value:"0"},null,512),[[Pe,e.scoreMode]]),Vi])])]),s("tr",null,[Mi,s("td",null,[s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=f=>e.shapeMode=f),value:"0"},null,512),[[Pe,e.shapeMode]]),zi]),Di,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=f=>e.shapeMode=f),value:"1"},null,512),[[Pe,e.shapeMode]]),Bi]),Gi,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=f=>e.shapeMode=f),value:"2"},null,512),[[Pe,e.shapeMode]]),Ii])])]),s("tr",null,[xi,s("td",null,[s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[6]||(t[6]=f=>e.snapMode=f),value:"0"},null,512),[[Pe,e.snapMode]]),Yi]),Wi,s("label",null,[j(s("input",{type:"radio","onUpdate:modelValue":t[7]||(t[7]=f=>e.snapMode=f),value:"1"},null,512),[[Pe,e.snapMode]]),Fi])])]),s("tr",null,[Zi,s("td",null,[j(s("input",{disabled:e.forcePrivate,type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=f=>e.isPrivate=f)},null,8,Hi),[[Ue,e.isPrivate]])])]),ji,e.image.tags.length?(p(),y("tr",Ki,[qi,s("td",null,[(p(!0),y(re,null,_e(e.image.tags,(f,d)=>(p(),y("span",{key:d,class:"bit"},F(f.title),1))),128))])])):B("",!0)])]),s("div",Xi,[s("button",{class:"btn",disabled:!e.canStartNewGame,onClick:t[9]||(t[9]=(...f)=>e.onNewGameClick&&e.onNewGameClick(...f))},tl,8,Qi),s("button",{class:"btn",onClick:t[10]||(t[10]=f=>e.$emit("close"))},"Cancel")])]),_:1})}var js=se(Ti,[["render",sl]]);const ol=ie({components:{ImageLibrary:Ws,NewImageDialog:Zs,EditImageDialog:Hs,NewGameDialog:js},data(){return{filters:{sort:"date_desc",tags:[]},images:[],tags:[],image:{id:0,filename:"",file:"",url:"",title:"",tags:[],created:0},dialog:"",newGameForcePrivate:!1,uploading:"",uploadProgress:0}},async created(){await this.loadImages()},computed:{relevantTags(){return this.tags.filter(e=>e.total>0)}},methods:{autocompleteTags(e,t){return this.tags.filter(o=>!t.includes(o.title)&&o.title.toLowerCase().startsWith(e.toLowerCase())).slice(0,10).map(o=>o.title)},toggleTag(e){this.filters.tags.includes(e.slug)?this.filters.tags=this.filters.tags.filter(t=>t!==e.slug):this.filters.tags.push(e.slug),this.filtersChanged()},async loadImages(){const t=await(await fe.get(`/api/newgame-data${I.asQueryArgs(this.filters)}`,{})).json();this.images=t.images,this.tags=t.tags},async filtersChanged(){await this.loadImages()},onImageClicked(e){this.image=e,this.newGameForcePrivate=!1,this.dialog="new-game"},onImageEditClicked(e){this.image=e,this.dialog="edit-image"},async uploadImage(e){this.uploadProgress=0;const t=new FormData;t.append("file",e.file,e.file.name),t.append("title",e.title),t.append("tags",e.tags),t.append("private",e.isPrivate);const o=await fe.post("/api/upload",{body:t,onUploadProgress:n=>{this.uploadProgress=n.loaded/n.total}});return this.uploadProgress=1,await o.json()},async saveImage(e){return await(await fe.post("/api/save-image",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:e.id,title:e.title,tags:e.tags})})).json()},async onSaveImageClick(e){const t=await this.saveImage(e);t.ok?(this.dialog="",await this.loadImages()):alert(t.error)},async postToGalleryClick(e){this.uploading="postToGallery",await this.uploadImage(e),this.uploading="",this.dialog="",await this.loadImages()},async setupGameClick(e){this.uploading="setupGame";const t=await this.uploadImage(e);this.uploading="",this.loadImages(),this.image=t,this.newGameForcePrivate=e.isPrivate,this.dialog="new-game"},async onNewGame(e){const t=await fe.post("/api/newgame",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status===200){const o=await t.json();this.$router.push({name:"game",params:{id:o.id}})}}}}),nl={class:"upload-image-teaser"},il=s("div",{class:"hint"},"(The image you upload will be added to the public gallery.)",-1),ll={key:0},al=m(" Tags: "),rl=["onClick"],ul=m(" Sort by: "),cl=s("option",{value:"date_desc"},"Newest first",-1),dl=s("option",{value:"date_asc"},"Oldest first",-1),hl=s("option",{value:"alpha_asc"},"A-Z",-1),pl=s("option",{value:"alpha_desc"},"Z-A",-1),gl=[cl,dl,hl,pl];function ml(e,t,o,n,i,a){const r=N("image-library"),u=N("new-image-dialog"),f=N("edit-image-dialog"),d=N("new-game-dialog");return p(),y("div",null,[s("div",nl,[s("div",{class:"btn btn-big",onClick:t[0]||(t[0]=k=>e.dialog="new-image")},"Upload your image"),il]),s("div",null,[e.tags.length>0?(p(),y("label",ll,[al,(p(!0),y(re,null,_e(e.relevantTags,(k,M)=>(p(),y("span",{class:Xe(["bit is-clickable",{on:e.filters.tags.includes(k.slug)}]),key:M,onClick:E=>e.toggleTag(k)},F(k.title)+" ("+F(k.total)+")",11,rl))),128))])):B("",!0),s("label",null,[ul,j(s("select",{"onUpdate:modelValue":t[1]||(t[1]=k=>e.filters.sort=k),onChange:t[2]||(t[2]=(...k)=>e.filtersChanged&&e.filtersChanged(...k))},gl,544),[[Vo,e.filters.sort]])])]),ee(r,{images:e.images,onImageClicked:e.onImageClicked,onImageEditClicked:e.onImageEditClicked},null,8,["images","onImageClicked","onImageEditClicked"]),e.dialog==="new-image"?(p(),te(u,{key:0,autocompleteTags:e.autocompleteTags,onClose:t[3]||(t[3]=k=>e.dialog=""),onBgclick:t[4]||(t[4]=k=>e.dialog=""),uploadProgress:e.uploadProgress,uploading:e.uploading,onPostToGalleryClick:e.postToGalleryClick,onSetupGameClick:e.setupGameClick},null,8,["autocompleteTags","uploadProgress","uploading","onPostToGalleryClick","onSetupGameClick"])):B("",!0),e.dialog==="edit-image"?(p(),te(f,{key:1,autocompleteTags:e.autocompleteTags,onClose:t[5]||(t[5]=k=>e.dialog=""),onBgclick:t[6]||(t[6]=k=>e.dialog=""),onSaveClick:e.onSaveImageClick,image:e.image},null,8,["autocompleteTags","onSaveClick","image"])):B("",!0),e.image&&e.dialog==="new-game"?(p(),te(d,{key:2,onClose:t[7]||(t[7]=k=>e.dialog=""),onBgclick:t[8]||(t[8]=k=>e.dialog=""),onNewGame:e.onNewGame,image:e.image,forcePrivate:e.newGameForcePrivate},null,8,["onNewGame","image","forcePrivate"])):B("",!0)])}var fl=se(ol,[["render",ml]]);const _l=ie({props:{players:{type:Object,required:!0}},methods:{playerStyle(e){return e.color==="ukraine"?{backgroundImage:"linear-gradient(180deg, rgba(0,87,183,1) 0%, rgba(0,87,183,1) 50%, rgba(255,221,0,1) 50%)","-webkit-background-clip":"text","-webkit-text-fill-color":"transparent"}:{color:e.color}}},computed:{actives(){return this.players.active.sort((e,t)=>t.points-e.points),this.players.active},idles(){return this.players.idle.sort((e,t)=>t.points-e.points),this.players.idle}}}),yl={class:"scores"},wl=s("div",null,"Scores",-1),vl=s("td",null,[s("i",{class:"icon icon-lightning"})],-1),El=s("td",null,[s("i",{class:"icon icon-zzz"})],-1);function Pl(e,t,o,n,i,a){return p(),y("div",yl,[wl,s("table",null,[(p(!0),y(re,null,_e(e.actives,(r,u)=>(p(),y("tr",{key:u,style:Ie(e.playerStyle(r))},[vl,s("td",null,F(r.name),1),s("td",null,F(r.points),1)],4))),128)),(p(!0),y(re,null,_e(e.idles,(r,u)=>(p(),y("tr",{key:u,style:Ie(e.playerStyle(r))},[El,s("td",null,F(r.name),1),s("td",null,F(r.points),1)],4))),128))])])}var Yt=se(_l,[["render",Pl]]);const bl=ie({props:{status:{type:Object,required:!0}},computed:{durationStr(){return be.durationStr(this.status.duration)}}}),Tl={class:"puzzle-status"},$l=s("i",{class:"icon icon-puzzle-piece"},null,-1),Sl={key:0,class:"icon icon-clock"},Cl={key:1,class:"icon icon-flag"};function kl(e,t,o,n,i,a){return p(),y("div",Tl,[s("div",null,[$l,m(" "+F(e.status.piecesDone)+"/"+F(e.status.piecesTotal),1)]),s("div",null,[this.status.finished?(p(),y("i",Cl)):(p(),y("i",Sl)),m(" "+F(e.durationStr),1)])])}var Wt=se(bl,[["render",kl]]);const Al=ie({emits:{"update:modelValue":null},props:{modelValue:{type:Object,required:!0}},data:()=>({showTable:!1,tableTexture:"dark",background:"",color:"",isUkraineColor:!1,name:"",soundsEnabled:!0,otherPlayerClickSoundEnabled:!0,soundsVolume:100,showPlayerNames:!0,watches:[]}),methods:{updateVolume(e){const t=parseInt(e.target.value);this.soundsVolume=t},decreaseVolume(){this.soundsVolume=Math.max(0,this.soundsVolume-5)},increaseVolume(){this.soundsVolume=Math.min(100,this.soundsVolume+5)},apply(e){this.disableWatches(),this.showTable=!!e.showTable,this.tableTexture=e.tableTexture,this.background=`${e.background}`,this.color=`${e.color}`,this.isUkraineColor=this.color==="ukraine",this.name=`${e.name}`,this.soundsEnabled=!!e.soundsEnabled,this.otherPlayerClickSoundEnabled=!!e.otherPlayerClickSoundEnabled,this.soundsVolume=parseInt(`${e.soundsVolume}`,10),this.showPlayerNames=!!e.showPlayerNames,this.enableWatches()},emitChanges(){this.$emit("update:modelValue",{showTable:this.showTable,tableTexture:this.tableTexture,background:this.background,color:this.isUkraineColor?"ukraine":this.color,name:this.name,soundsEnabled:this.soundsEnabled,otherPlayerClickSoundEnabled:this.otherPlayerClickSoundEnabled,soundsVolume:this.soundsVolume,showPlayerNames:this.showPlayerNames})},enableWatches(){this.watches.push(this.$watch(()=>this.isUkraineColor,this.emitChanges)),this.watches.push(this.$watch(()=>this.background,this.emitChanges)),this.watches.push(this.$watch(()=>this.showTable,this.emitChanges)),this.watches.push(this.$watch(()=>this.tableTexture,this.emitChanges)),this.watches.push(this.$watch(()=>this.color,this.emitChanges)),this.watches.push(this.$watch(()=>this.name,this.emitChanges)),this.watches.push(this.$watch(()=>this.soundsEnabled,this.emitChanges)),this.watches.push(this.$watch(()=>this.otherPlayerClickSoundEnabled,this.emitChanges)),this.watches.push(this.$watch(()=>this.soundsVolume,this.emitChanges)),this.watches.push(this.$watch(()=>this.showPlayerNames,this.emitChanges))},disableWatches(){const e=this.watches;this.watches=[],e.forEach(t=>t())}},created(){this.apply(this.modelValue)}}),ye=e=>(Mo("data-v-2535bf00"),e=e(),zo(),e),Ol={class:"settings"},Nl=ye(()=>s("td",null,[s("label",null,"Background: ")],-1)),Ul=ye(()=>s("td",null,[s("label",null,"Table: ")],-1)),Rl=m("Show"),Ll={key:0},Vl=m(" Dark"),Ml={key:1},zl=m(" Light"),Dl=ye(()=>s("td",null,[s("label",null,"Color: ")],-1)),Bl=ye(()=>s("i",{class:"icon icon-ukraine-heart"},null,-1)),Gl=ye(()=>s("td",null,[s("label",null,"Name: ")],-1)),Il=ye(()=>s("td",null,[s("label",null,"Sounds: ")],-1)),xl=ye(()=>s("td",null,[s("label",null,"Piece connect sounds of others: ")],-1)),Yl=["disabled"],Wl=ye(()=>s("td",null,[s("label",null,"Sounds Volume: ")],-1)),Fl={class:"sound-volume"},Zl=ye(()=>s("i",{class:"icon icon-volume-down"},null,-1)),Hl=[Zl],jl=["disabled","value"],Kl=ye(()=>s("i",{class:"icon icon-volume-up"},null,-1)),ql=[Kl],Xl=ye(()=>s("td",null,[s("label",null,"Show player names: ")],-1));function Ql(e,t,o,n,i,a){const r=N("overlay");return p(),te(r,{class:"transparent"},{default:ae(()=>[s("table",Ol,[s("tr",null,[Nl,s("td",null,[j(s("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=u=>e.background=u)},null,512),[[Re,e.background]])])]),s("tr",null,[Ul,s("td",null,[s("label",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=u=>e.showTable=u)},null,512),[[Ue,e.showTable]]),Rl]),e.showTable?(p(),y("label",Ll,[j(s("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=u=>e.tableTexture=u),value:"dark"},null,512),[[Pe,e.tableTexture]]),Vl])):B("",!0),e.showTable?(p(),y("label",Ml,[j(s("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=u=>e.tableTexture=u),value:"light"},null,512),[[Pe,e.tableTexture]]),zl])):B("",!0)])]),s("tr",null,[Dl,s("td",null,[e.isUkraineColor?B("",!0):j((p(),y("input",{key:0,type:"color","onUpdate:modelValue":t[4]||(t[4]=u=>e.color=u)},null,512)),[[Re,e.color]]),s("label",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=u=>e.isUkraineColor=u)},null,512),[[Ue,e.isUkraineColor]]),Bl])])]),s("tr",null,[Gl,s("td",null,[j(s("input",{type:"text",maxLength:"16","onUpdate:modelValue":t[6]||(t[6]=u=>e.name=u)},null,512),[[Re,e.name]])])]),s("tr",null,[Il,s("td",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=u=>e.soundsEnabled=u)},null,512),[[Ue,e.soundsEnabled]])])]),s("tr",null,[xl,s("td",null,[j(s("input",{type:"checkbox",disabled:!e.soundsEnabled,"onUpdate:modelValue":t[8]||(t[8]=u=>e.otherPlayerClickSoundEnabled=u)},null,8,Yl),[[Ue,e.otherPlayerClickSoundEnabled]])])]),s("tr",null,[Wl,s("td",Fl,[s("span",{onClick:t[9]||(t[9]=(...u)=>e.decreaseVolume&&e.decreaseVolume(...u))},Hl),s("input",{disabled:!e.soundsEnabled,type:"range",min:"0",max:"100",value:e.soundsVolume,onChange:t[10]||(t[10]=(...u)=>e.updateVolume&&e.updateVolume(...u))},null,40,jl),s("span",{onClick:t[11]||(t[11]=(...u)=>e.increaseVolume&&e.increaseVolume(...u))},ql)])]),s("tr",null,[Xl,s("td",null,[j(s("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=u=>e.showPlayerNames=u)},null,512),[[Ue,e.showPlayerNames]])])])])]),_:1})}var Ft=se(Al,[["render",Ql],["__scopeId","data-v-2535bf00"]]);const Jl=ie({props:{img:String},computed:{previewStyle(){return{backgroundImage:`url('${this.img}')`}}}}),ea={class:"preview"};function ta(e,t,o,n,i,a){const r=N("overlay");return p(),te(r,{class:"preview-overlay",animate:!1},{default:ae(()=>[s("div",ea,[s("div",{class:"img",style:Ie(e.previewStyle)},null,4)])]),_:1})}var Zt=se(Jl,[["render",ta]]);const sa=ie({props:{game:{type:Object,required:!0}},computed:{scoreMode(){switch(this.game.scoreMode){case Le.ANY:return["Any","Score when pieces are connected to each other or on final location"];case Le.FINAL:default:return["Final","Score when pieces are put to their final location"]}},shapeMode(){switch(this.game.shapeMode){case Ke.FLAT:return["Flat","All pieces flat on all sides"];case Ke.ANY:return["Any","Flat pieces can occur anywhere"];case Ke.NORMAL:default:return["Normal",""]}},snapMode(){switch(this.game.snapMode){case xe.REAL:return["Real","Pieces snap only to corners, already snapped pieces and to each other"];case xe.NORMAL:default:return["Normal","Pieces snap to final destination and to each other"]}}}}),oa={class:"help"},na=s("tr",null,[s("td",{colspan:"2"},"Info about this puzzle")],-1),ia=s("td",null,"Image Title: ",-1),la=s("td",null,"Scoring: ",-1),aa=["title"],ra=s("td",null,"Shapes: ",-1),ua=["title"],ca=s("td",null,"Snapping: ",-1),da=["title"];function ha(e,t,o,n,i,a){const r=N("overlay");return p(),te(r,{class:"transparent"},{default:ae(()=>[s("table",oa,[na,s("tr",null,[ia,s("td",null,F(e.game.puzzle.info.image.title),1)]),s("tr",null,[la,s("td",null,[s("span",{title:e.snapMode[1]},F(e.scoreMode[0]),9,aa)])]),s("tr",null,[ra,s("td",null,[s("span",{title:e.snapMode[1]},F(e.shapeMode[0]),9,ua)])]),s("tr",null,[ca,s("td",null,[s("span",{title:e.snapMode[1]},F(e.snapMode[0]),9,da)])])])]),_:1})}var Ht=se(sa,[["render",ha]]);const pa=3,ga=1,ma=4,fa=2,_a=3,ya=1,wa=2,va=4,Ea=3,Pa=1,ba=2,Ta=3,$a=4,Sa=5,Ca=6,ka=7,Aa=8,Oa=9,Na=10,Ua=11,Ra=12,La=13,Va=14,Ma=15,za=16,Da=17,Ba=18,Ga=19,Ia=20,xa=21,Ya=22,Wa=1,Fa=2,Za=3,Ha=4;var h={EV_SERVER_EVENT:ga,EV_SERVER_INIT:ma,EV_CLIENT_EVENT:fa,EV_CLIENT_INIT:_a,GAME_VERSION:pa,LOG_HEADER:ya,LOG_ADD_PLAYER:wa,LOG_UPDATE_PLAYER:va,LOG_HANDLE_INPUT:Ea,INPUT_EV_MOVE:Oa,INPUT_EV_MOUSE_DOWN:Pa,INPUT_EV_MOUSE_UP:ba,INPUT_EV_MOUSE_MOVE:Ta,INPUT_EV_ZOOM_IN:$a,INPUT_EV_ZOOM_OUT:Sa,INPUT_EV_BG_COLOR:Ca,INPUT_EV_PLAYER_COLOR:ka,INPUT_EV_PLAYER_NAME:Aa,INPUT_EV_TOGGLE_PREVIEW:Na,INPUT_EV_TOGGLE_SOUNDS:Ua,INPUT_EV_REPLAY_TOGGLE_PAUSE:Ra,INPUT_EV_REPLAY_SPEED_UP:La,INPUT_EV_REPLAY_SPEED_DOWN:Va,INPUT_EV_TOGGLE_PLAYER_NAMES:Ma,INPUT_EV_CENTER_FIT_PUZZLE:za,INPUT_EV_TOGGLE_FIXED_PIECES:Da,INPUT_EV_TOGGLE_LOOSE_PIECES:Ba,INPUT_EV_TOGGLE_TABLE:Ya,INPUT_EV_STORE_POS:Ga,INPUT_EV_RESTORE_POS:Ia,INPUT_EV_CONNECTION_CLOSE:xa,CHANGE_DATA:Wa,CHANGE_PIECE:Fa,CHANGE_PLAYER:Za,PLAYER_SNAP:Ha};const ja=Bt("Communication.js"),Ka=1001,jt=4e3,Ks=0,St=1,Kt=2,qs=3,Xs=4;let me,Ct=[],kt=e=>{Ct.push(e)},At=[],Ot=e=>{At.push(e)};function qa(e){kt=e;for(const t of Ct)kt(t);Ct=[]}function Xa(e){Ot=e;for(const t of At)Ot(t);At=[]}let Nt=Ks;const Ze=e=>{Nt!==e&&(Nt=e,Ot(e))};function Qs(e){if(Nt===Kt)try{me.send(JSON.stringify(e))}catch{ja.info("unable to send message.. maybe because ws is invalid?")}}let Be,Ge,Ut=0;function Js(e=2e4){me.readyState==me.OPEN&&me.send(""),Ut=setTimeout(Js,e)}function Ss(){Ut&&clearTimeout(Ut)}function Qa(e,t,o){return Be=0,Ge={},Ze(qs),new Promise(n=>{me=new WebSocket(e,o+"|"+t),me.onopen=()=>{Ze(Kt),Qs([h.EV_CLIENT_INIT]),Js()},me.onmessage=i=>{const a=JSON.parse(i.data),r=a[0];if(r===h.EV_SERVER_INIT){const u=a[1];n(u)}else if(r===h.EV_SERVER_EVENT){const u=a[1],f=a[2];if(u===o&&Ge[f]){delete Ge[f];return}kt(a)}else throw`[ 2021-05-09 invalid connect msgType ${r} ]`},me.onerror=()=>{throw Ss(),Ze(St),"[ 2021-05-15 onerror ]"},me.onclose=i=>{Ss(),i.code===jt||i.code===Ka?Ze(Xs):Ze(St)}})}async function Ja(e,t){const o={gameId:e,offset:t};return await(await fe.get(`/api/replay-data${I.asQueryArgs(o)}`,{})).json()}function er(){me&&me.close(jt),Be=0,Ge={}}function tr(e){Be++,Ge[Be]=e,Qs([h.EV_CLIENT_EVENT,Be,Ge[Be]])}var Se={connect:Qa,requestReplayData:Ja,disconnect:er,sendClientEvent:tr,onServerChange:qa,onConnectionStateChange:Xa,CODE_CUSTOM_DISCONNECT:jt,CONN_STATE_NOT_CONNECTED:Ks,CONN_STATE_DISCONNECTED:St,CONN_STATE_CLOSED:Xs,CONN_STATE_CONNECTED:Kt,CONN_STATE_CONNECTING:qs};const sr=ie({emits:{reconnect:null},props:{connectionState:Number},computed:{lostConnection(){return this.connectionState===Se.CONN_STATE_DISCONNECTED},connecting(){return this.connectionState===Se.CONN_STATE_CONNECTING},show(){return!!(this.lostConnection||this.connecting)}}}),or={key:0},nr=s("i",{class:"icon icon-disconnect"},null,-1),ir=m(" LOST CONNECTION "),lr=s("i",{class:"icon icon-disconnect"},null,-1),ar=[nr,ir,lr],rr={key:2};function ur(e,t,o,n,i,a){const r=N("overlay");return j((p(),te(r,{class:"connection-lost"},{default:ae(()=>[e.lostConnection?(p(),y("div",or,ar)):B("",!0),e.lostConnection?(p(),y("span",{key:1,class:"btn",onClick:t[0]||(t[0]=u=>e.$emit("reconnect"))},"Reconnect")):B("",!0),e.connecting?(p(),y("div",rr,"Connecting...")):B("",!0)]),_:1},512)),[[zs,e.show]])}var eo=se(sr,[["render",ur]]);const cr=ie({}),dr=s("table",{class:"help"},[s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-up"}),m(" Move up:")]),s("td",null,[s("div",null,[s("kbd",null,"W"),m("/"),s("kbd",null,"\u2191"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-down"}),m(" Move down:")]),s("td",null,[s("div",null,[s("kbd",null,"S"),m("/"),s("kbd",null,"\u2193"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-left"}),m(" Move left:")]),s("td",null,[s("div",null,[s("kbd",null,"A"),m("/"),s("kbd",null,"\u2190"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-arrow-right"}),m(" Move right:")]),s("td",null,[s("div",null,[s("kbd",null,"D"),m("/"),s("kbd",null,"\u2192"),m("/"),s("i",{class:"icon icon-mouse-left"})])])]),s("tr",null,[s("td"),s("td",null,[s("div",null,[m("Move faster by holding "),s("kbd",null,"Shift")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-zoom-in"}),m(" Zoom in:")]),s("td",null,[s("div",null,[s("kbd",null,"E"),m("/"),s("i",{class:"icon icon-mouse-wheel"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-zoom-out"}),m(" Zoom out:")]),s("td",null,[s("div",null,[s("kbd",null,"Q"),m("/"),s("i",{class:"icon icon-mouse-wheel"})])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-preview"}),m(" Toggle preview:")]),s("td",null,[s("div",null,[s("kbd",null,"Space")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-center"}),m(" Center puzzle in screen:")]),s("td",null,[s("div",null,[s("kbd",null,"C")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-puzzle-piece-locked"}),m(" Toggle fixed pieces:")]),s("td",null,[s("div",null,[s("kbd",null,"F")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-puzzle-piece-free"}),m(" Toggle loose pieces:")]),s("td",null,[s("div",null,[s("kbd",null,"G")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-table"}),m(" Toggle table:")]),s("td",null,[s("div",null,[s("kbd",null,"T")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-player-name"}),m(" Toggle player names:")]),s("td",null,[s("div",null,[s("kbd",null,"N")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-volume-up"}),m(" Toggle sounds:")]),s("td",null,[s("div",null,[s("kbd",null,"M")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-save-pos"}),m(" Store position [0-9]:")]),s("td",null,[s("div",null,[s("kbd",null,"Shift"),m(" + "),s("kbd",null,"0"),m("-"),s("kbd",null,"9")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-load-pos"}),m(" Restore position [0-9]:")]),s("td",null,[s("div",null,[s("kbd",null,"0"),m("-"),s("kbd",null,"9")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-speed-up"}),m(" Speed up (replay):")]),s("td",null,[s("div",null,[s("kbd",null,"I")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-speed-down"}),m(" Speed down (replay):")]),s("td",null,[s("div",null,[s("kbd",null,"O")])])]),s("tr",null,[s("td",null,[s("i",{class:"icon icon-pause"}),m(" Pause (replay):")]),s("td",null,[s("div",null,[s("kbd",null,"P")])])])],-1);function hr(e,t,o,n,i,a){const r=N("overlay");return p(),te(r,{class:"transparent"},{default:ae(()=>[dr]),_:1})}var qt=se(cr,[["render",hr]]),pr="/assets/click.bb97cb07.mp3",gr=Object.freeze(Object.defineProperty({__proto__:null,default:pr},Symbol.toStringTag,{value:"Module"})),mr="/assets/click2.98536db5.mp3",fr=Object.freeze(Object.defineProperty({__proto__:null,default:mr},Symbol.toStringTag,{value:"Module"})),_r="/assets/wood-dark.1e21ffc1.jpg",yr=Object.freeze(Object.defineProperty({__proto__:null,default:_r},Symbol.toStringTag,{value:"Module"})),wr="/assets/wood-light.ae1bd383.jpg",vr=Object.freeze(Object.defineProperty({__proto__:null,default:wr},Symbol.toStringTag,{value:"Module"})),Er="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAW0lEQVQ4je1RywrAIAxLxP//5exixRWlVgZelpOKeTQFfnDypgy3eLIkSLLL8mxGPoHsU2hPAgDHBLvRX6hZZw/fwT0BtlLSONqCbWAmEIqMZOCDDlaDR3N03gOyDCn+y4DWmAAAAABJRU5ErkJggg==",Pr=Object.freeze(Object.defineProperty({__proto__:null,default:Er},Symbol.toStringTag,{value:"Module"})),br="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAARElEQVQ4jWNgGAU0Af+hmBCbgYGBgYERhwHEAEYGBgYGJtIdiApYyLAZBVDsAqoagC1ACQJyY4ERg0GCISh6KA4DigEAou8LC+LnIJoAAAAASUVORK5CYII=",Tr=Object.freeze(Object.defineProperty({__proto__:null,default:br},Symbol.toStringTag,{value:"Module"})),$r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAcUlEQVQ4ja1TQQ7AIAgD///n7jCozA2Hbk00jbG1KIrcARszTugoBs49qioZj7r2kKACptkyAOCJsJuA+GzglwHjvMSSWFVaENWVASxh5eRLiq5fN/ASjI89VcP2K3hHpq1cEXNaMfnrL3TDZP2tDuoOA6MzCCXWr38AAAAASUVORK5CYII=",Sr=Object.freeze(Object.defineProperty({__proto__:null,default:$r},Symbol.toStringTag,{value:"Module"})),Cr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAU0lEQVQ4jWNgoAH4D8X42HDARKlt5BoAd82AuQAOGLGIYQQUPv0wF5CiCQUge4EsQ5C9QI4BjMguwBYeBAElscCIy1ZivMKIwSDBEBQ9FCckigEAU3QOD7TGvY4AAAAASUVORK5CYII=",kr=Object.freeze(Object.defineProperty({__proto__:null,default:Cr},Symbol.toStringTag,{value:"Module"}));const Ar=e=>{let t=!1;const o=()=>{t=!0},n=e.fps||60,i=e.slow||1,a=e.update,r=e.render,u=window.requestAnimationFrame,f=1/n,d=i*f;let k,M=0,E=window.performance.now();const _=()=>{for(k=window.performance.now(),M=M+Math.min(1,(k-E)/1e3);M>d;)M=M-d,a(f);r(M/i),E=k,t||u(_)};return u(_),{stop:o}},Or=.1,Nr=6,Ur=.05;class Rt{constructor(t=null){this.x=0,this.y=0,this.curZoom=1,t&&this.fromSnapshot(t)}snapshot(){return{x:this.x,y:this.y,curZoom:this.curZoom}}getCurrentZoom(){return this.curZoom}fromSnapshot(t){this.x=t.x,this.y=t.y,this.curZoom=t.curZoom}reset(){this.x=0,this.y=0,this.curZoom=1}move(t,o){this.x+=t/this.curZoom,this.y+=o/this.curZoom}calculateNewZoom(t){const o=t==="in"?1:-1,n=this.curZoom+Ur*this.curZoom*o;return Math.min(Math.max(n,Or),Nr)}canZoom(t){return this.curZoom!=this.calculateNewZoom(t)}setZoom(t,o){if(this.curZoom==t)return!1;const n=1-this.curZoom/t;return this.move(-o.x*n,-o.y*n),this.curZoom=t,!0}zoom(t,o){return this.setZoom(this.calculateNewZoom(t),o)}viewportToWorld(t){const{x:o,y:n}=this.viewportToWorldRaw(t);return{x:Math.round(o),y:Math.round(n)}}viewportToWorldRaw(t){return{x:t.x/this.curZoom-this.x,y:t.y/this.curZoom-this.y}}worldToViewport(t){const{x:o,y:n}=this.worldToViewportRaw(t);return{x:Math.round(o),y:Math.round(n)}}worldToViewportRaw(t){return{x:(t.x+this.x)*this.curZoom,y:(t.y+this.y)*this.curZoom}}worldDimToViewport(t){const{w:o,h:n}=this.worldDimToViewportRaw(t);return{w:Math.round(o),h:Math.round(n)}}worldDimToViewportRaw(t){return{w:t.w*this.curZoom,h:t.h*this.curZoom}}viewportDimToWorld(t){const{w:o,h:n}=this.viewportDimToWorldRaw(t);return{w:Math.round(o),h:Math.round(n)}}viewportDimToWorldRaw(t){return{w:t.w/this.curZoom,h:t.h/this.curZoom}}}function qe(e=0,t=0){const o=document.createElement("canvas");return o.width=e,o.height=t,o}async function Rr(e){return new Promise(t=>{const o=new Image;o.onload=()=>{createImageBitmap(o).then(t)},o.src=e})}async function Lr(e,t,o){const n=qe(t,o);return n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,o),await createImageBitmap(n)}function Vr(e,t,o){if(o==="ukraine"){const a=qe(e.width,e.height),r=a.getContext("2d"),u=t.height/1.75;r.save(),r.drawImage(t,0,0),r.fillStyle="#0057B7",r.globalCompositeOperation="source-in",r.fillRect(0,0,t.width,u),r.restore(),r.save(),r.globalCompositeOperation="destination-over",r.drawImage(e,0,0),r.restore();const f=qe(e.width,e.height/2),d=f.getContext("2d");return d.save(),d.drawImage(t,0,-u),d.fillStyle="#FFDD00",d.globalCompositeOperation="source-in",d.fillRect(0,0,t.width,t.height),d.restore(),d.save(),d.globalCompositeOperation="destination-over",d.drawImage(e,0,-u),d.restore(),r.drawImage(f,0,u),a}const n=qe(e.width,e.height),i=n.getContext("2d");return i.save(),i.drawImage(t,0,0),i.fillStyle=o,i.globalCompositeOperation="source-in",i.fillRect(0,0,t.width,t.height),i.restore(),i.save(),i.globalCompositeOperation="destination-over",i.drawImage(e,0,0),i.restore(),n}var de={createCanvas:qe,loadImageToBitmap:Rr,resizeBitmap:Lr,colorizedCanvas:Vr};const Mr=Bt("Debug.js");let Lt=0,to=0;const zr=e=>{Lt=performance.now(),to=e},Dr=e=>{const t=performance.now(),o=t-Lt;o>to&&Mr.log(e+": "+o),Lt=t};var Ae={checkpoint_start:zr,checkpoint:Dr};function Br(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Gr(e,t){return{x:e.x+t.x,y:e.y+t.y}}function so(e,t){const o=e.x-t.x,n=e.y-t.y;return Math.sqrt(o*o+n*n)}function Ir(e,t){return e.x>=t.x&&e.x<=t.x+t.w&&e.y>=t.y&&e.y<=t.y+t.h}function Vt(e){return{x:e.x+e.w/2,y:e.y+e.h/2}}function xr(e,t,o){return{x:e.x+t,y:e.y+o,w:e.w,h:e.h}}function Yr(e,t){return!(t.x>e.x+e.w||e.x>t.x+t.w||t.y>e.y+e.h||e.y>t.y+t.h)}function Wr(e,t){return so(Vt(e),Vt(t))}var Q={pointSub:Br,pointAdd:Gr,pointDistance:so,pointInBounds:Ir,rectCenter:Vt,rectMoved:xr,rectCenterDistance:Wr,rectsOverlap:Yr};const Cs=Bt("PuzzleGraphics.js");async function Fr(e,t,o){Cs.log("start createPuzzleTileBitmaps");const n=o.tileSize,i=o.tileMarginWidth,a=o.tileDrawSize,r=n/100,u=[0,0,40,15,37,5,37,5,40,0,38,-5,38,-5,20,-20,50,-20,50,-20,80,-20,62,-5,62,-5,60,0,63,5,63,5,65,15,100,0],f=new Array(t.length),d={};function k(w){const Y=`${w.top}${w.right}${w.left}${w.bottom}`;if(d[Y])return d[Y];const O=new Path2D,$={x:i,y:i},S=Q.pointAdd($,{x:n,y:0}),b=Q.pointAdd(S,{x:0,y:n}),A=Q.pointSub(b,{x:n,y:0});if(O.moveTo($.x,$.y),w.top!==0)for(let c=0;c<u.length/6;c++){const oe=Q.pointAdd($,{x:u[c*6+0]*r,y:w.top*u[c*6+1]*r}),Z=Q.pointAdd($,{x:u[c*6+2]*r,y:w.top*u[c*6+3]*r}),ne=Q.pointAdd($,{x:u[c*6+4]*r,y:w.top*u[c*6+5]*r});O.bezierCurveTo(oe.x,oe.y,Z.x,Z.y,ne.x,ne.y)}else O.lineTo(S.x,S.y);if(w.right!==0)for(let c=0;c<u.length/6;c++){const oe=Q.pointAdd(S,{x:-w.right*u[c*6+1]*r,y:u[c*6+0]*r}),Z=Q.pointAdd(S,{x:-w.right*u[c*6+3]*r,y:u[c*6+2]*r}),ne=Q.pointAdd(S,{x:-w.right*u[c*6+5]*r,y:u[c*6+4]*r});O.bezierCurveTo(oe.x,oe.y,Z.x,Z.y,ne.x,ne.y)}else O.lineTo(b.x,b.y);if(w.bottom!==0)for(let c=0;c<u.length/6;c++){const oe=Q.pointSub(b,{x:u[c*6+0]*r,y:w.bottom*u[c*6+1]*r}),Z=Q.pointSub(b,{x:u[c*6+2]*r,y:w.bottom*u[c*6+3]*r}),ne=Q.pointSub(b,{x:u[c*6+4]*r,y:w.bottom*u[c*6+5]*r});O.bezierCurveTo(oe.x,oe.y,Z.x,Z.y,ne.x,ne.y)}else O.lineTo(A.x,A.y);if(w.left!==0)for(let c=0;c<u.length/6;c++){const oe=Q.pointSub(A,{x:-w.left*u[c*6+1]*r,y:u[c*6+0]*r}),Z=Q.pointSub(A,{x:-w.left*u[c*6+3]*r,y:u[c*6+2]*r}),ne=Q.pointSub(A,{x:-w.left*u[c*6+5]*r,y:u[c*6+4]*r});O.bezierCurveTo(oe.x,oe.y,Z.x,Z.y,ne.x,ne.y)}else O.lineTo($.x,$.y);return d[Y]=O,O}const M=de.createCanvas(a,a),E=M.getContext("2d"),_=de.createCanvas(a,a),C=_.getContext("2d");for(const w of t){const Y=I.decodePiece(w),O=Zr(o,Y.idx),$=k(I.decodeShape(o.shapes[Y.idx]));E.clearRect(0,0,a,a),E.save(),E.lineWidth=2,E.stroke($),E.globalCompositeOperation="source-in",E.drawImage(e,O.x-i,O.y-i,a,a,0,0,a,a),E.restore(),E.save(),E.globalCompositeOperation="source-in",E.globalAlpha=.2,E.fillStyle="black",E.fillRect(0,0,M.width,M.height),E.restore(),E.save(),E.clip($),E.drawImage(e,O.x-i,O.y-i,a,a,0,0,a,a),E.restore(),E.save(),E.clip($),E.strokeStyle="rgba(0,0,0,.4)",E.lineWidth=0,E.shadowColor="black",E.shadowBlur=2,E.shadowOffsetX=-1,E.shadowOffsetY=-1,E.stroke($),E.restore(),E.save(),E.clip($),E.strokeStyle="rgba(255,255,255,.4)",E.lineWidth=0,E.shadowColor="white",E.shadowBlur=2,E.shadowOffsetX=1,E.shadowOffsetY=1,E.stroke($),E.restore(),C.clearRect(0,0,a,a),C.save(),C.lineWidth=1,C.stroke($),C.globalCompositeOperation="source-in",C.drawImage(e,O.x-i,O.y-i,a,a,0,0,a,a),C.restore(),E.drawImage(_,0,0),f[Y.idx]=await createImageBitmap(M)}return Cs.log("end createPuzzleTileBitmaps"),f}function Zr(e,t){const o=I.coordByPieceIdxDeprecated(e,t);return{x:o.x*e.tileSize,y:o.y*e.tileSize,w:e.tileSize,h:e.tileSize}}async function Hr(e){const t=await de.loadImageToBitmap(e.info.imageUrl),o=await de.resizeBitmap(t,e.info.width,e.info.height);return await Fr(o,e.tiles,e.info)}var jr={loadPuzzleBitmaps:Hr};const oo=30,T={};function Kr(e){return!!T[e]||!1}function qr(e,t){return{id:e,x:0,y:0,d:0,name:null,color:null,bgcolor:null,points:0,ts:t}}function Xr(e,t){T[e]=t}function Qr(e){delete T[e]}function ht(e,t){let o=0;for(const n of T[e].players){if(I.decodePlayer(n).id===t)return o;o++}return-1}function Jr(e,t){return T[e].players.length>t?I.decodePlayer(T[e].players[t]).id:null}function Me(e,t){const o=ht(e,t);return o===-1?null:I.decodePlayer(T[e].players[o])}function Xt(e,t,o){const n=ht(e,t);n===-1?T[e].players.push(I.encodePlayer(o)):T[e].players[n]=I.encodePlayer(o)}function eu(e,t,o){T[e].puzzle.tiles[t]=I.encodePiece(o)}function tu(e,t){T[e].puzzle.data=t}function no(e,t){return ht(e,t)!==-1}function su(e,t){return mo(T[e],t)}function ou(e,t){return Ru(T[e],t)}function nu(e,t,o){no(e,t)?le(e,t,{ts:o}):Xt(e,t,qr(t,o))}function iu(e){return T[e]||null}function Mt(e){return ts(T[e])}function lu(e){return fo(T[e])}function Et(e){return T[e].scoreMode}function io(e){return T[e].snapMode}function au(e){return T[e].gameVersion}function zt(e){return es(T[e])}function ru(e){return T[e].puzzle.tiles.map(I.decodePiece).sort((o,n)=>o.z-n.z)}function le(e,t,o){const n=Me(e,t);if(n!==null){for(const i of Object.keys(o))n[i]=o[i];Xt(e,t,n)}}function ot(e,t){for(const o of Object.keys(t))T[e].puzzle.data[o]=t[o]}function Ve(e,t,o){for(const n of Object.keys(o)){const i=I.decodePiece(T[e].puzzle.tiles[t]);i[n]=o[n],T[e].puzzle.tiles[t]=I.encodePiece(i)}}const ze=(e,t)=>I.decodePiece(T[e].puzzle.tiles[t]),ct=(e,t)=>ze(e,t).group,uu=(e,t)=>{const o=T[e].puzzle.info;return t===0||t===o.tilesX-1||t===o.tiles-o.tilesX||t===o.tiles-1},lo=(e,t)=>{const o=T[e].puzzle.info,n={x:(o.table.width-o.width)/2,y:(o.table.height-o.height)/2},i=mu(e,t);return Q.pointAdd(n,i)},at=(e,t)=>ze(e,t).pos,Qt=e=>{const t=uo(e),o=co(e),n=Math.round(t/4),i=Math.round(o/4);return{x:0-n,y:0-i,w:t+2*n,h:o+2*i}},cu=(e,t)=>ze(e,t).z,He=(e,t)=>{for(const o of T[e].puzzle.tiles){const n=I.decodePiece(o);if(n.owner===t)return n.idx}return-1},du=(e,t)=>{const o=He(e,t);return o<0?null:T[e].puzzle.tiles[o]},ao=e=>T[e].puzzle.info.tileDrawOffset,Jt=e=>T[e].puzzle.info.tileDrawSize,hu=e=>ho(T[e]),pu=e=>po(T[e]),ks=e=>T[e].puzzle.data.maxGroup,As=e=>T[e].puzzle.data.maxZ,gu=(e,t)=>{let o=0;for(const n of t){const i=cu(e,n);i>o&&(o=i)}return o};function mu(e,t){const o=T[e].puzzle.info,n=I.coordByPieceIdxDeprecated(o,t),i=n.x*o.tileSize,a=n.y*o.tileSize;return{x:i,y:a}}function fu(e,t){const o=T[e].puzzle.info,n=I.coordByPieceIdxDeprecated(o,t);return[n.y>0?t-o.tilesX:-1,n.x<o.tilesX-1?t+1:-1,n.y<o.tilesY-1?t+o.tilesX:-1,n.x>0?t-1:-1]}const Os=(e,t,o)=>{for(const n of t)Ve(e,n,{z:o})},ro=(e,t,o)=>{const n=at(e,t),i=Q.pointAdd(n,o);Ve(e,t,{pos:i})},nt=(e,t,o)=>au(e)>=3?yu(e,t,o):_u(e,t,o),_u=(e,t,o)=>{const n=Jt(e),i=Qt(e),a=o;for(const r of t){const u=ze(e,r);u.pos.x+o.x<i.x?a.x=Math.max(i.x-u.pos.x,a.x):u.pos.x+n+o.x>i.x+i.w&&(a.x=Math.min(i.x+i.w-u.pos.x+n,a.x)),u.pos.y+o.y<i.y?a.y=Math.max(i.y-u.pos.y,a.y):u.pos.y+n+o.y>i.y+i.h&&(a.y=Math.min(i.y+i.h-u.pos.y+n,a.y))}if(!a.x&&!a.y)return!1;for(const r of t)ro(e,r,a);return!0},yu=(e,t,o)=>{const n=Qt(e),i=Jt(e)+2*ao(e),a=n.x,r=n.y,u=a+n.w-i,f=r+n.h-i,d=o;for(const k of t){const M=ze(e,k);o.x<0?d.x=Math.max(a-M.pos.x,d.x):d.x=Math.min(u-M.pos.x,d.x),o.y<0?d.y=Math.max(r-M.pos.y,d.y):d.y=Math.min(f-M.pos.y,d.y)}if(!d.x&&!d.y)return!1;for(const k of t)ro(e,k,d);return!0},wu=(e,t)=>vu(e,t)===-1,vu=(e,t)=>ze(e,t).owner,Ns=(e,t)=>{for(const o of t)Ve(e,o,{owner:-1,z:1})},Pt=(e,t,o)=>{for(const n of t)Ve(e,n,{owner:o})};function Eu(e,t){return Ee(e,t).length}function Ee(e,t){const o=T[e].puzzle.tiles,n=I.decodePiece(o[t]),i=[];if(n.group)for(const a of o){const r=I.decodePiece(a);r.group===n.group&&i.push(r.idx)}else i.push(n.idx);return i}const Pu=(e,t)=>{const o=T[e].puzzle.info,n=T[e].puzzle.tiles;let i=-1,a=-1;for(let r=0;r<n.length;r++){const u=I.decodePiece(n[r]);if(u.owner!==0)continue;const f={x:u.pos.x,y:u.pos.y,w:o.tileSize,h:o.tileSize};Q.pointInBounds(t,f)&&(i===-1||u.z>i)&&(i=u.z,a=r)}return a},bu=(e,t)=>{const o=Me(e,t);return o?o.bgcolor:null},Tu=(e,t)=>{const o=Me(e,t);return o?o.color:null},$u=(e,t)=>{const o=Me(e,t);return o?o.name:null},Us=(e,t)=>{const o=Me(e,t);return o?o.points:0},Su=(e,t,o)=>{const n=ct(e,t),i=ct(e,o);return!!(n&&n===i)},uo=e=>T[e].puzzle.info.table.width,co=e=>T[e].puzzle.info.table.height,Cu=e=>T[e].puzzle,ku=e=>T[e].rng.obj,Au=e=>T[e].puzzle.info.width,Ou=e=>T[e].puzzle.info.height,Nu=(e,t)=>{if(io(e)===xe.REAL){for(const o of t)if(uu(e,o))return!0;return!1}return!0};function Uu(e,t,o,n){const i=T[e].puzzle,a=[],r=()=>{a.push([h.CHANGE_DATA,i.data])},u=_=>{a.push([h.CHANGE_PIECE,I.encodePiece(ze(e,_))])},f=_=>{for(const C of _)u(C)},d=()=>{const _=Me(e,t);!_||a.push([h.CHANGE_PLAYER,I.encodePlayer(_)])};let k=!1;const M=(_,C,w)=>{const Y=T[_].puzzle.tiles,O=ct(_,C),$=ct(_,w);let S;const b=[];if(O&&b.push(O),$&&b.push($),O)S=O;else if($)S=$;else{const A=ks(_)+1;ot(_,{maxGroup:A}),r(),S=ks(_)}if(Ve(_,C,{group:S}),u(C),Ve(_,w,{group:S}),u(w),b.length>0)for(const A of Y){const c=I.decodePiece(A);b.includes(c.group)&&(Ve(_,c.idx,{group:S}),u(c.idx))}},E=o[0];if(E===h.INPUT_EV_CONNECTION_CLOSE){const _=He(e,t);if(_>=0){const C=Ee(e,_);Pt(e,C,0),f(C)}}else if(E===h.INPUT_EV_BG_COLOR){const _=o[1];le(e,t,{bgcolor:_,ts:n}),d()}else if(E===h.INPUT_EV_PLAYER_COLOR){const _=o[1];le(e,t,{color:_,ts:n}),d()}else if(E===h.INPUT_EV_PLAYER_NAME){const _=`${o[1]}`.substr(0,16);le(e,t,{name:_,ts:n}),d()}else if(E===h.INPUT_EV_MOVE){const _=o[1],C=o[2],w=Me(e,t);if(w){const Y=w.x-_,O=w.y-C;le(e,t,{ts:n,x:Y,y:O}),d();const $=He(e,t);if($>=0){const S=Ee(e,$),b={x:-_,y:-C};nt(e,S,b)&&f(S)}}}else if(E===h.INPUT_EV_MOUSE_DOWN){const _=o[1],C=o[2],w={x:_,y:C};le(e,t,{d:1,ts:n}),d();const Y=Pu(e,w);if(Y>=0){const O=As(e)+1;ot(e,{maxZ:O}),r();const $=Ee(e,Y);Os(e,$,As(e)),Pt(e,$,t),f($)}}else if(E===h.INPUT_EV_MOUSE_MOVE){const _=o[1],C=o[2];if(!o[5])le(e,t,{x:_,y:C,ts:n}),d();else{const Y=He(e,t);if(Y<0)le(e,t,{ts:n}),d();else{const O=o[1],$=o[2],S=o[3],b=o[4];le(e,t,{x:O,y:$,ts:n}),d();const A=Ee(e,Y);nt(e,A,{x:S,y:b})&&f(A)}}}else if(E===h.INPUT_EV_MOUSE_UP){const C=He(e,t);if(C>=0){const w=Ee(e,C);Pt(e,w,0),f(w);const Y=at(e,C),O=lo(e,C);if(Nu(e,w)&&Q.pointDistance(O,Y)<i.info.snapDistance){const $=Q.pointSub(O,Y);nt(e,w,$),Ns(e,w),f(w);let S=Us(e,t);Et(e)===Le.FINAL?S+=w.length:Et(e)===Le.ANY&&(S+=1),le(e,t,{d:0,ts:n,points:S}),d(),zt(e)===Mt(e)&&(ot(e,{finished:n}),r()),k=!0}else{const $=(b,A,c,oe)=>{const Z=T[b].puzzle.info;if(c<0||Su(b,A,c))return!1;const ne=at(b,A),Te=Q.pointAdd(at(b,c),{x:oe[0]*Z.tileSize,y:oe[1]*Z.tileSize});if(Q.pointDistance(ne,Te)<Z.snapDistance){const Ce=Q.pointSub(Te,ne);let pe=Ee(b,A);if(nt(b,pe,Ce),M(b,A,c),pe=Ee(b,A),wu(b,c))Ns(b,pe);else{const De=gu(b,pe);Os(b,pe,De)}return f(pe),!0}return!1};let S=!1;for(const b of Ee(e,C)){const A=fu(e,b);if($(e,b,A[0],[0,1])||$(e,b,A[1],[-1,0])||$(e,b,A[2],[0,-1])||$(e,b,A[3],[1,0])){S=!0;break}}if(S&&Et(e)===Le.ANY){const b=Us(e,t)+1;le(e,t,{d:0,ts:n,points:b}),d()}else le(e,t,{d:0,ts:n}),d();S&&io(e)===xe.REAL&&zt(e)===Mt(e)&&(ot(e,{finished:n}),r()),S&&(k=!0)}}else le(e,t,{d:0,ts:n}),d()}else if(E===h.INPUT_EV_ZOOM_IN){const _=o[1],C=o[2];le(e,t,{x:_,y:C,ts:n}),d()}else if(E===h.INPUT_EV_ZOOM_OUT){const _=o[1],C=o[2];le(e,t,{x:_,y:C,ts:n}),d()}else le(e,t,{ts:n}),d();return k&&a.push([h.PLAYER_SNAP,t]),a}function ho(e){return e.puzzle.data.started}function po(e){return e.puzzle.data.finished}function es(e){let t=0;for(const o of e.puzzle.tiles)I.decodePiece(o).owner===-1&&t++;return t}function ts(e){return e.puzzle.tiles.length}function go(e){return e.players.map(I.decodePlayer)}function mo(e,t){const o=t-oo*be.SEC;return go(e).filter(n=>n.ts>=o)}function Ru(e,t){const o=t-oo*be.SEC;return go(e).filter(n=>n.ts<o&&n.points>0)}function fo(e){var o;const t=((o=e.puzzle.info.image)==null?void 0:o.url)||e.puzzle.info.imageUrl;if(!t)throw new Error("[2021-07-11] no image url set");return t}function Lu(e){return es(e)===ts(e)}var U={setGame:Xr,unsetGame:Qr,loaded:Kr,playerExists:no,getActivePlayers:su,getIdlePlayers:ou,addPlayer:nu,getFinishedPiecesCount:zt,getPieceCount:Mt,getImageUrl:lu,get:iu,getGroupedPieceCount:Eu,getPlayerBgColor:bu,getPlayerColor:Tu,getPlayerName:$u,getPlayerIndexById:ht,getPlayerIdByIndex:Jr,changePlayer:le,setPlayer:Xt,setPiece:eu,setPuzzleData:tu,getBounds:Qt,getTableWidth:uo,getTableHeight:co,getPuzzle:Cu,getRng:ku,getPuzzleWidth:Au,getPuzzleHeight:Ou,getPiecesSortedByZIndex:ru,getFirstOwnedPiece:du,getPieceDrawOffset:ao,getPieceDrawSize:Jt,getFinalPiecePos:lo,getStartTs:hu,getFinishTs:pu,handleInput:Uu,Game_getStartTs:ho,Game_getFinishTs:po,Game_getFinishedPiecesCount:es,Game_getPieceCount:ts,Game_getActivePlayers:mo,Game_getImageUrl:fo,Game_isFinished:Lu};let _o=-10,yo=20,Dt=2,wo=15;const Vu=5,Mu=5,ss=1,zu=200,Rs=10,Du=100,Bu=10,Gu=1,Iu=5;function xu(e){const t=e.random(0,255),o=e.random(0,255),n=e.random(0,255);return"rgba("+t+","+o+","+n+", 0.8)"}class Ls{constructor(t){this.radius=Rs,this.previousRadius=Rs,this.explodingDuration=Du,this.hasExploded=!1,this.alive=!0,this.color=xu(t),this.px=window.innerWidth/4+Math.random()*window.innerWidth/2,this.py=window.innerHeight,this.vx=_o+Math.random()*yo,this.vy=(Dt+Math.random()*wo)*-1,this.duration=0}update(t){if(this.hasExploded){const o=zu-this.radius;this.previousRadius=this.radius,this.radius+=o/Bu,this.explodingDuration--,this.explodingDuration==0&&(this.alive=!1)}else this.vx+=0,this.vy+=ss,this.vy>=0&&t&&this.explode(t),this.px+=this.vx,this.py+=this.vy}draw(t){t.beginPath(),t.arc(this.px,this.py,this.previousRadius,0,Math.PI*2,!1),this.hasExploded||(t.fillStyle=this.color,t.lineWidth=1,t.fill())}explode(t){this.hasExploded=!0;const o=3+Math.floor(Math.random()*3);for(let n=0;n<o;n++){const i=10+Math.floor(Math.random()*21),a=Vu+Math.random()*Mu,r=2*Math.PI/i,u=Math.random()*r;for(let f=0;f<i;f++)t.push(new Yu(this,f*r+u,a))}}}class Yu{constructor(t,o,n){this.px=t.px,this.py=t.py,this.vx=Math.cos(o)*n,this.vy=Math.sin(o)*n,this.color=t.color,this.duration=40+Math.floor(Math.random()*20),this.alive=!0,this.radius=0}update(){this.vx+=0,this.vy+=ss/10,this.px+=this.vx,this.py+=this.vy,this.radius=3,this.duration--,this.duration<=0&&(this.alive=!1)}draw(t){t.beginPath(),t.arc(this.px,this.py,this.radius,0,Math.PI*2,!1),t.fillStyle=this.color,t.lineWidth=1,t.fill()}}class Wu{constructor(t,o){this.canvas=t,this.rng=o,this.ctx=this.canvas.getContext("2d"),this.resize(),this.readyBombs=[],this.explodedBombs=[],this.particles=[],window.addEventListener("resize",()=>{this.resize()})}setSpeedParams(){let t=0,o=0;for(;t<this.canvas.height&&o>=0;)o+=ss,t+=o;Dt=o/2,wo=o-Dt;const n=1/4*this.canvas.width/(o/2);_o=-n,yo=2*n}resize(){this.setSpeedParams()}init(){this.readyBombs=[],this.explodedBombs=[],this.particles=[];for(let t=0;t<Gu;t++)this.readyBombs.push(new Ls(this.rng))}update(){Math.random()*100<Iu&&this.readyBombs.push(new Ls(this.rng));const t=[];for(;this.explodedBombs.length>0;){const i=this.explodedBombs.shift();if(!i)break;i.update(),i.alive&&t.push(i)}this.explodedBombs=t;const o=[];for(;this.readyBombs.length>0;){const i=this.readyBombs.shift();if(!i)break;i.update(this.particles),i.hasExploded?this.explodedBombs.push(i):o.push(i)}this.readyBombs=o;const n=[];for(;this.particles.length>0;){const i=this.particles.shift();if(!i)break;i.update(),i.alive&&n.push(i)}this.particles=n}render(){this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.readyBombs.length;t++)this.readyBombs[t].draw(this.ctx);for(let t=0;t<this.explodedBombs.length;t++)this.explodedBombs[t].draw(this.ctx);for(let t=0;t<this.particles.length;t++)this.particles[t].draw(this.ctx)}}function Fu(e,t,o,n){let i=[],a=!0,r=!1,u=!1,f=!1,d=!1,k=!1,M=!1,E=!1;const _=(v,z)=>{const G=o.viewportToWorld({x:v,y:z});return[G.x,G.y]},C=(v,z)=>{const G=o.viewportDimToWorld({w:v,h:z});return[G.w,G.h]},w=v=>_(v.offsetX,v.offsetY),Y=()=>_(e.width/2,e.height/2),O=(v,z)=>{!a||(z.code==="ShiftLeft"||z.code==="ShiftRight"?E=v:z.code==="ArrowUp"||z.code==="KeyW"?f=v:z.code==="ArrowDown"||z.code==="KeyS"?d=v:z.code==="ArrowLeft"||z.code==="KeyA"?r=v:z.code==="ArrowRight"||z.code==="KeyD"?u=v:z.code==="KeyQ"?M=v:z.code==="KeyE"&&(k=v))};let $=!1,S=null,b=null;const A=v=>{b=w(v),S=[v.offsetX,v.offsetY],v.button===0&&($=!0,X([h.INPUT_EV_MOUSE_DOWN,...b]))},c=v=>{b=w(v),S=[v.offsetX,v.offsetY],v.button===0&&($=!1,X([h.INPUT_EV_MOUSE_UP,...b]))},oe=v=>{if(!S)return;b=w(v);const z=C(-(S[0]-v.offsetX),-(S[1]-v.offsetY));X([h.INPUT_EV_MOUSE_MOVE,...b,...z,$?1:0]),S=[v.offsetX,v.offsetY]},Z=v=>{if(b=w(v),o.canZoom(v.deltaY<0?"in":"out")){const z=v.deltaY<0?h.INPUT_EV_ZOOM_IN:h.INPUT_EV_ZOOM_OUT;X([z,...b])}},ne=v=>O(!0,v),Te=v=>O(!1,v),Ce=v=>{if(!!a){if(n===ve&&(v.code==="KeyI"?X([h.INPUT_EV_REPLAY_SPEED_UP]):v.code==="KeyO"?X([h.INPUT_EV_REPLAY_SPEED_DOWN]):v.code==="KeyP"&&X([h.INPUT_EV_REPLAY_TOGGLE_PAUSE])),v.code==="Space")X([h.INPUT_EV_TOGGLE_PREVIEW]);else if(v.code==="KeyF")X([h.INPUT_EV_TOGGLE_FIXED_PIECES]);else if(v.code==="KeyG")X([h.INPUT_EV_TOGGLE_LOOSE_PIECES]);else if(v.code==="KeyM")X([h.INPUT_EV_TOGGLE_SOUNDS]);else if(v.code==="KeyN")X([h.INPUT_EV_TOGGLE_PLAYER_NAMES]);else if(v.code==="KeyT")X([h.INPUT_EV_TOGGLE_TABLE]);else if(v.code==="KeyC")X([h.INPUT_EV_CENTER_FIT_PUZZLE]);else for(let z=0;z<=9;z++)if(v.code===`Digit${z}`){const G=v.shiftKey?h.INPUT_EV_STORE_POS:h.INPUT_EV_RESTORE_POS;X([G,z]);break}}},pe=()=>{e.addEventListener("mousedown",A),e.addEventListener("mouseup",c),e.addEventListener("mousemove",oe),e.addEventListener("wheel",Z),t.addEventListener("keydown",ne),t.addEventListener("keyup",Te),t.addEventListener("keypress",Ce)},De=()=>{e.removeEventListener("mousedown",A),e.removeEventListener("mouseup",c),e.removeEventListener("mousemove",oe),e.removeEventListener("wheel",Z),t.removeEventListener("keydown",ne),t.removeEventListener("keyup",Te),t.removeEventListener("keypress",Ce)},Qe=(v,z)=>{if(!S||!b)return;const G=new Rt(v).viewportToWorld({x:S[0],y:S[1]}),we=new Rt(z).viewportToWorld({x:S[0],y:S[1]}),ue=[-(G.x-we.x),-(G.y-we.y)];X([h.INPUT_EV_MOUSE_MOVE,...b,...ue,$?1:0])},X=v=>{i.push(v)};return{registerEvents:pe,unregisterEvents:De,addEvent:X,consumeAll:()=>{if(i.length===0)return[];const v=i.slice();return i=[],v},createKeyEvents:()=>{const v=(r?1:0)-(u?1:0),z=(f?1:0)-(d?1:0);if(v!==0||z!==0){const G=(E?24:12)*Math.sqrt(o.getCurrentZoom()),we=o.viewportDimToWorld({w:v*G,h:z*G});X([h.INPUT_EV_MOVE,we.w,we.h]),b&&(b[0]-=we.w,b[1]-=we.h)}if(!(k&&M)){if(k){if(o.canZoom("in")){const G=b||Y();X([h.INPUT_EV_ZOOM_IN,...G])}}else if(M&&o.canZoom("out")){const G=b||Y();X([h.INPUT_EV_ZOOM_OUT,...G])}}},createSnapshotEvents:Qe,setHotkeys:v=>{a=v}}}const it={"./grab.png":Pr,"./grab_mask.png":Tr,"./hand.png":Sr,"./hand_mask.png":kr},Vs={"./assets/textures/wood-dark.jpg":yr,"./assets/textures/wood-light.jpg":vr},Ms={"./click.mp3":gr,"./click2.mp3":fr},je="play",ve="replay";let Oe=!0,Ne=!0;const Zu=e=>e.owner===-1?Oe:Ne;let J=!0;async function vo(e,t,o,n,i,a){typeof window.DEBUG=="undefined"&&(window.DEBUG=!1);const r=l=>n===ve||l.id!==t,u=Ms["./click.mp3"].default,f=Ms["./click2.mp3"].default,d=new Audio(u),k=new Audio(f),M=await de.loadImageToBitmap(it["./grab.png"].default),E=await de.loadImageToBitmap(it["./hand.png"].default),_=await de.loadImageToBitmap(it["./grab_mask.png"].default),C=await de.loadImageToBitmap(it["./hand_mask.png"].default),w=M.width,Y=Math.round(w/2),O=M.height,$=Math.round(O/2),S={},b=async l=>{const g=l.color+" "+l.d;if(!S[g]){const P=l.d?M:E;if(l.color){const D=l.d?_:C;S[g]=await createImageBitmap(de.colorizedCanvas(P,D,l.color))}else S[g]=P}return S[g]},A=i,c={final:!1,log:[],logPointer:0,speeds:[.5,1,2,5,10,20,50,100,250,500],speedIdx:1,paused:!1,lastRealTs:0,lastGameTs:0,gameStartTs:0,skipNonActionPhases:!0,dataOffset:0};Se.onConnectionStateChange(l=>{a.emit("connectionState",l)});const oe=async l=>{const g=c.dataOffset;c.dataOffset+=1e4;const P=await Se.requestReplayData(l,g);return c.log=c.log.slice(c.logPointer),c.logPointer=0,c.log.push(...P.log),P.log.length===0&&(c.final=!0),P};let Z=()=>0;const ne=async()=>{if(n===je){const l=await Se.connect(o,e,t),g=I.decodeGame(l);U.setGame(g.id,g),Z=()=>be.timestamp()}else if(n===ve){const l=await oe(e);if(!l.game)throw"[ 2021-05-29 no game received ]";const g=I.decodeGame(l.game);U.setGame(g.id,g),c.lastRealTs=be.timestamp(),c.gameStartTs=parseInt(l.log[0][4],10),c.lastGameTs=c.gameStartTs,Z=()=>c.lastGameTs}else throw"[ 2020-12-22 MODE invalid, must be play|replay ]";J=!0};await ne();const Te=U.getPieceDrawOffset(e),Ce=U.getPieceDrawSize(e),pe=U.getPuzzleWidth(e),De=U.getPuzzleHeight(e),Qe=U.getTableWidth(e),X=U.getTableHeight(e),os={x:(Qe-pe)/2,y:(X-De)/2},pt={w:pe,h:De},ns={w:Ce,h:Ce},v=await jr.loadPuzzleBitmaps(U.getPuzzle(e)),z=new Wu(A,U.getRng(e));z.init();const G=A.getContext("2d");A.classList.add("loaded"),a.emit("puzzleCut");let we="";const ue={},R=new Rt,bo=()=>{R.reset(),R.move(-(Qe-A.width)/2,-(X-A.height)/2);const l=R.worldDimToViewportRaw(pt),g=20,P=A.width-g*2,D=A.height-g*2;if(l.w>P||l.h>D||l.w<P&&l.h<D){const x=Math.min(P/l.w,D/l.h),W={x:A.width/2,y:A.height/2};R.setZoom(x,W)}},ce=Fu(A,window,R,n);ce.registerEvents();const Je=l=>{if(ue.last&&we===l){const g=R.snapshot(),P=ue.last;return R.fromSnapshot(P),ce.createSnapshotEvents(g,P),delete ue.last,"last"}else if(ue[l]){const g=ue[l],P=R.snapshot();return ue.last=P,we=l,R.fromSnapshot(g),ce.createSnapshotEvents(P,g),l}else return null};bo(),ue.center=R.snapshot();const To=U.getImageUrl(e),et=l=>{const g=U.getStartTs(e),P=U.getFinishTs(e);a.emit("status",{finished:!!P,duration:(P||l)-g,piecesDone:U.getFinishedPiecesCount(e),piecesTotal:U.getPieceCount(e)}),a.emit("players",{active:U.getActivePlayers(e,l),idle:U.getIdlePlayers(e,l)})};et(Z());const is=!!U.getFinishTs(e);let gt=is;const ls=()=>gt&&!is,mt=()=>H.getInt(q.SOUND_VOLUME,he.SOUND_VOLUME),as=()=>H.getBool(q.OTHER_PLAYER_CLICK_SOUND_ENABLED,he.OTHER_PLAYER_CLICK_SOUND_ENABLED),ft=()=>H.getBool(q.SOUND_ENABLED,he.SOUND_ENABLED),rs=()=>H.getBool(q.SHOW_PLAYER_NAMES,he.SHOW_PLAYER_NAMES),$o=()=>H.getBool(q.SHOW_TABLE,he.SHOW_TABLE),So=()=>H.getStr(q.TABLE_TEXTURE,he.TABLE_TEXTURE),us=()=>n===ve?H.getStr(q.COLOR_BACKGROUND,he.COLOR_BACKGROUND):U.getPlayerBgColor(e,t)||H.getStr(q.COLOR_BACKGROUND,he.COLOR_BACKGROUND),cs=()=>n===ve?H.getStr(q.PLAYER_COLOR,he.PLAYER_COLOR):U.getPlayerColor(e,t)||H.getStr(q.PLAYER_COLOR,he.PLAYER_COLOR),Co=()=>n===ve?H.getStr(q.PLAYER_NAME,he.PLAYER_NAME):U.getPlayerName(e,t)||H.getStr(q.PLAYER_NAME,he.PLAYER_NAME),ds=()=>{const l=mt();d.volume=l/100,d.play()},ko=()=>{const l=mt();k.volume=l/100,k.play()},V={background:us(),showTable:$o(),tableTexture:So(),color:cs(),name:Co(),soundsEnabled:ft(),otherPlayerClickSoundEnabled:as(),soundsVolume:mt(),showPlayerNames:rs()};ce.addEvent([h.INPUT_EV_BG_COLOR,V.background]),ce.addEvent([h.INPUT_EV_PLAYER_COLOR,V.color]),ce.addEvent([h.INPUT_EV_PLAYER_NAME,V.name]);let hs="",ps="",gs=!1;const Ye=l=>{gs=l;const[g,P]=l?[hs,"grab"]:[ps,"default"];A.style.cursor=`url('${g}') ${Y} ${$}, ${P}`},_t=l=>{hs=de.colorizedCanvas(M,_,l).toDataURL(),ps=de.colorizedCanvas(E,C,l).toDataURL(),Ye(gs)};_t(cs());const tt=()=>{a.emit("replaySpeed",c.speeds[c.speedIdx]),a.emit("replayPaused",c.paused)},K=(l,g=void 0)=>{a.emit("statusMessage",{what:l,value:g})},ms=()=>{c.speedIdx+1<c.speeds.length&&(c.speedIdx++,tt(),K("Speed Up"))},fs=()=>{c.speedIdx>=1&&(c.speedIdx--,tt(),K("Speed Down"))},_s=()=>{c.paused=!c.paused,tt(),K(c.paused?"Paused":"Playing")};let We=!1;const ys=()=>{We=!We,a.emit("togglePreview",We)},ws=()=>{V.soundsEnabled=!V.soundsEnabled;const l=V.soundsEnabled;a.emit("toggleSoundsEnabled",l),H.setBool(q.SOUND_ENABLED,l),K("Sounds",l)},vs=()=>{V.showPlayerNames=!V.showPlayerNames;const l=V.showPlayerNames;a.emit("togglePlayerNames",l),H.setBool(q.SHOW_PLAYER_NAMES,l),K("Player names",l)},Es=()=>{V.showTable=!V.showTable;const l=V.showTable;a.emit("toggleShowTable",l),H.setBool(q.SHOW_TABLE,l),K("Table",l)};a.on("replayOnSpeedUp",()=>{ms()}),a.on("replayOnSpeedDown",()=>{fs()}),a.on("replayOnPauseToggle",()=>{_s()}),a.on("onPreviewChange",l=>{We!==l&&(We=l)}),a.on("onBgChange",l=>{V.background!==l&&(V.background=l,H.setStr(q.COLOR_BACKGROUND,l),ce.addEvent([h.INPUT_EV_BG_COLOR,l]),K("Background",l))}),a.on("onTableTextureChange",l=>{V.tableTexture!==l&&(V.tableTexture=l,H.setStr(q.TABLE_TEXTURE,l),K("Table texture",l),J=!0)}),a.on("onShowTableChange",l=>{V.showTable!==l&&(V.showTable=l,H.setStr(q.SHOW_TABLE,l),K("Table",l),J=!0)}),a.on("onColorChange",l=>{V.color!==l&&(V.color=l,H.setStr(q.PLAYER_COLOR,l),ce.addEvent([h.INPUT_EV_PLAYER_COLOR,l]),K("Color",l))}),a.on("onNameChange",l=>{V.name!==l&&(V.name=l,H.setStr(q.PLAYER_NAME,l),ce.addEvent([h.INPUT_EV_PLAYER_NAME,l]),K("Name",l))}),a.on("onOtherPlayerClickSoundEnabledChange",l=>{V.otherPlayerClickSoundEnabled!==l&&(V.otherPlayerClickSoundEnabled=l,H.setBool(q.OTHER_PLAYER_CLICK_SOUND_ENABLED,l),K("Other player sounds",l))}),a.on("onSoundsEnabledChange",l=>{V.soundsEnabled!==l&&(V.soundsEnabled=l,H.setBool(q.SOUND_ENABLED,l),K("Sounds",l))}),a.on("onSoundsVolumeChange",l=>{V.soundsVolume!==l&&(V.soundsVolume=l,H.setInt(q.SOUND_VOLUME,l),ds(),K("Volume",l))}),a.on("onShowPlayerNamesChange",l=>{V.showPlayerNames!==l&&(V.showPlayerNames=l,H.setBool(q.SHOW_PLAYER_NAMES,l),K("Player names",l))}),a.on("setHotkeys",l=>{ce.setHotkeys(l)}),a.on("requireRerender",()=>{J=!0});const Ps=[];let st;const Ao=()=>{Ps.forEach(l=>{clearInterval(l)}),st&&clearTimeout(st)};if(n===je?Ps.push(setInterval(()=>{et(Z())},1e3)):n===ve&&tt(),n===je)Se.onServerChange(l=>{l[0],l[1],l[2];const g=l[3];let P=!1,D=!1;for(const[x,W]of g)switch(x){case h.CHANGE_PLAYER:{const L=I.decodePlayer(W);L.id!==t&&(U.setPlayer(e,L.id,L),P=!0)}break;case h.CHANGE_PIECE:{const L=I.decodePiece(W);U.setPiece(e,L.idx,L),P=!0}break;case h.CHANGE_DATA:U.setPuzzleData(e,W),P=!0;break;case h.PLAYER_SNAP:W!==t&&(D=!0);break}D&&ft()&&as()&&ko(),P&&(J=!0),gt=!!U.getFinishTs(e)});else if(n===ve){const l=(D,x)=>{const W=D;if(W[0]===h.LOG_ADD_PLAYER){const L=W[1];return U.addPlayer(e,L,x),!0}if(W[0]===h.LOG_UPDATE_PLAYER){const L=U.getPlayerIdByIndex(e,W[1]);if(!L)throw"[ 2021-05-17 player not found (update player) ]";return U.addPlayer(e,L,x),!0}if(W[0]===h.LOG_HANDLE_INPUT){const L=U.getPlayerIdByIndex(e,W[1]);if(!L)throw"[ 2021-05-17 player not found (handle input) ]";const ge=W[2];return U.handleInput(e,L,ge,x),!0}return!1};let g=c.lastGameTs;const P=async()=>{c.logPointer+1>=c.log.length&&await oe(e);const D=be.timestamp();if(c.paused){c.lastRealTs=D,st=setTimeout(P,50);return}const W=(D-c.lastRealTs)*c.speeds[c.speedIdx];let L=c.lastGameTs+W,ge=!0;do if(c.paused)ge=!1;else{const $e=c.logPointer+1;if($e>=c.log.length)ge=!1;else{const ke=c.log[c.logPointer],Fe=g+ke[ke.length-1],yt=c.log[$e],bs=yt[yt.length-1],wt=Fe+bs;wt>L?(L+500*be.MS<wt&&(L+=bs),ge=!1):(g=Fe,l(yt,wt)&&(J=!0),c.logPointer=$e)}}while(ge);c.lastRealTs=D,c.lastGameTs=L,et(Z()),c.final||(st=setTimeout(P,50))};P()}const Oo=()=>{ce.createKeyEvents();for(const l of ce.consumeAll())if(n===je){const g=l[0];if(g===h.INPUT_EV_MOVE){const x=R.worldDimToViewportRaw({w:l[1],h:l[2]});J=!0,R.move(x.w,x.h),delete ue.last}else if(g===h.INPUT_EV_MOUSE_MOVE){if(l[5]&&!U.getFirstOwnedPiece(e,t)){const W=R.worldDimToViewportRaw({w:l[3],h:l[4]});J=!0,R.move(W.w,W.h),delete ue.last}}else if(g===h.INPUT_EV_PLAYER_COLOR)_t(l[1]);else if(g===h.INPUT_EV_MOUSE_DOWN)Ye(!0);else if(g===h.INPUT_EV_MOUSE_UP)Ye(!1);else if(g===h.INPUT_EV_ZOOM_IN){const x={x:l[1],y:l[2]};J=!0,R.zoom("in",R.worldToViewportRaw(x)),delete ue.last}else if(g===h.INPUT_EV_ZOOM_OUT){const x={x:l[1],y:l[2]};J=!0,R.zoom("out",R.worldToViewportRaw(x)),delete ue.last}else if(g===h.INPUT_EV_TOGGLE_PREVIEW)ys();else if(g===h.INPUT_EV_TOGGLE_SOUNDS)ws();else if(g===h.INPUT_EV_TOGGLE_PLAYER_NAMES)vs();else if(g===h.INPUT_EV_CENTER_FIT_PUZZLE){const x="center",W=Je(x);K(W?`Restored position "${W}"`:`Position "${x}" not set`)}else if(g===h.INPUT_EV_TOGGLE_FIXED_PIECES)Oe=!Oe,K(`${Oe?"Showing":"Hiding"} finished pieces`),J=!0;else if(g===h.INPUT_EV_TOGGLE_LOOSE_PIECES)Ne=!Ne,K(`${Ne?"Showing":"Hiding"} unfinished pieces`),J=!0;else if(g===h.INPUT_EV_TOGGLE_TABLE)Es();else if(g===h.INPUT_EV_STORE_POS){const x=`${l[1]}`;ue[x]=R.snapshot(),K(`Stored position ${x}`)}else if(g===h.INPUT_EV_RESTORE_POS){const x=`${l[1]}`,W=Je(x);K(W?`Restored position "${W}"`:`Position "${x}" not set`)}const P=Z(),D=U.handleInput(e,t,l,P);ft()&&D.find(x=>x[0]===h.PLAYER_SNAP)&&ds(),D.length>0&&(J=!0),Se.sendClientEvent(l)}else if(n===ve){const g=l[0];if(g===h.INPUT_EV_REPLAY_TOGGLE_PAUSE)_s();else if(g===h.INPUT_EV_REPLAY_SPEED_DOWN)fs();else if(g===h.INPUT_EV_REPLAY_SPEED_UP)ms();else if(g===h.INPUT_EV_MOVE){const P=R.worldDimToViewportRaw({w:l[1],h:l[2]});J=!0,R.move(P.w,P.h)}else if(g===h.INPUT_EV_MOUSE_MOVE){if(l[5]){const D=R.worldDimToViewportRaw({w:l[3],h:l[4]});J=!0,R.move(D.w,D.h)}}else if(g===h.INPUT_EV_PLAYER_COLOR)_t(l[1]);else if(g===h.INPUT_EV_MOUSE_DOWN)Ye(!0);else if(g===h.INPUT_EV_MOUSE_UP)Ye(!1);else if(g===h.INPUT_EV_ZOOM_IN){const P={x:l[1],y:l[2]};J=!0,R.zoom("in",R.worldToViewportRaw(P))}else if(g===h.INPUT_EV_ZOOM_OUT){const P={x:l[1],y:l[2]};J=!0,R.zoom("out",R.worldToViewportRaw(P))}else if(g===h.INPUT_EV_TOGGLE_PREVIEW)ys();else if(g===h.INPUT_EV_TOGGLE_SOUNDS)ws();else if(g===h.INPUT_EV_TOGGLE_PLAYER_NAMES)vs();else if(g===h.INPUT_EV_CENTER_FIT_PUZZLE){const P="center",D=Je(P);K(D?`Restored position "${D}"`:`Position "${P}" not set`)}else if(g===h.INPUT_EV_TOGGLE_FIXED_PIECES)Oe=!Oe,K(`${Oe?"Showing":"Hiding"} finished pieces`),J=!0;else if(g===h.INPUT_EV_TOGGLE_LOOSE_PIECES)Ne=!Ne,K(`${Ne?"Showing":"Hiding"} unfinished pieces`),J=!0;else if(g===h.INPUT_EV_TOGGLE_TABLE)Es();else if(g===h.INPUT_EV_STORE_POS){const P=`${l[1]}`;ue[P]=R.snapshot(),K(`Stored position ${P}`)}else if(g===h.INPUT_EV_RESTORE_POS){const P=`${l[1]}`,D=Je(P);K(D?`Restored position "${D}"`:`Position "${P}" not set`)}}gt=!!U.getFinishTs(e),ls()&&(z.update(),J=!0)},No=new DOMMatrix([1,0,0,1,0,0]),Uo={dark:await de.loadImageToBitmap(Vs["./assets/textures/wood-dark.jpg"].default),light:await de.loadImageToBitmap(Vs["./assets/textures/wood-light.jpg"].default)},Ro=Ar({update:Oo,render:async()=>{if(!J)return;const l=Z();let g,P,D;if(window.DEBUG&&Ae.checkpoint_start(0),G.fillStyle=us(),G.fillRect(0,0,A.width,A.height),V.showTable){const L=Uo[V.tableTexture];if(L){const ge=G.createPattern(L,"repeat"),$e=U.getBounds(e),ke=R.worldToViewportRaw($e),Fe=R.worldDimToViewportRaw($e);ge.setTransform(No.translate(ke.x,ke.y).scale(R.getCurrentZoom()*3)),G.fillStyle=ge,G.fillRect(ke.x,ke.y,Fe.w,Fe.h)}}window.DEBUG&&Ae.checkpoint("clear done"),g=R.worldToViewportRaw(os),P=R.worldDimToViewportRaw(pt),V.showTable&&V.tableTexture==="dark"?G.fillStyle="rgba(0, 0, 0, .3)":G.fillStyle="rgba(255, 255, 255, .3)",G.fillRect(g.x,g.y,P.w,P.h),window.DEBUG&&Ae.checkpoint("board done");const x=U.getPiecesSortedByZIndex(e);window.DEBUG&&Ae.checkpoint("get pieces done"),P=R.worldDimToViewportRaw(ns);for(const L of x)!Zu(L)||(D=v[L.idx],g=R.worldToViewportRaw({x:Te+L.pos.x,y:Te+L.pos.y}),G.drawImage(D,0,0,D.width,D.height,g.x,g.y,P.w,P.h));window.DEBUG&&Ae.checkpoint("pieces done");const W=[];for(const L of U.getActivePlayers(e,l))r(L)&&(D=await b(L),g=R.worldToViewport(L),G.drawImage(D,g.x-Y,g.y-$),rs()&&W.push([`${L.name} (${L.points})`,g.x,g.y+O]));G.fillStyle="white",G.textAlign="center";for(const[L,ge,$e]of W)G.fillText(L,ge,$e);window.DEBUG&&Ae.checkpoint("players done"),et(l),window.DEBUG&&Ae.checkpoint("HUD done"),ls()&&z.render(),J=!1}}),Lo=()=>{Ao(),Ro.stop(),ce&&ce.unregisterEvents()};return{previewImageUrl:To,player:V,game:U.get(e),disconnect:Se.disconnect,connect:ne,unload:Lo}}const Hu=ie({name:"game",components:{PuzzleStatusComponent:Wt,Scores:Yt,SettingsOverlay:Ft,PreviewOverlay:Zt,InfoOverlay:Ht,ConnectionOverlay:eo,HelpOverlay:qt},data(){return{statusMessages:[],players:{active:[],idle:[]},status:{finished:!1,duration:0,piecesDone:0,piecesTotal:0},overlay:"",connectionState:0,cuttingPuzzle:!0,eventBus:Ds(),g:{player:Bs(),game:null,previewImageUrl:"",connect:()=>{},disconnect:()=>{},unload:()=>{}}}},async mounted(){if(!this.$route.params.id)return;this.eventBus.on("puzzleCut",()=>{this.cuttingPuzzle=!1}),this.eventBus.on("players",t=>{this.players=t}),this.eventBus.on("status",t=>{this.status=t}),this.eventBus.on("connectionState",t=>{this.connectionState=t}),this.eventBus.on("togglePreview",t=>{this.toggleTo("preview",t,!1)}),this.eventBus.on("toggleSoundsEnabled",t=>{this.g.player.soundsEnabled=!!t}),this.eventBus.on("togglePlayerNames",t=>{this.g.player.showPlayerNames=!!t}),this.eventBus.on("toggleShowTable",t=>{this.g.player.showTable=!!t}),this.$watch(()=>this.g.player.background,t=>{this.eventBus.emit("onBgChange",t)}),this.$watch(()=>this.g.player.showTable,t=>{this.eventBus.emit("onShowTableChange",t)}),this.$watch(()=>this.g.player.tableTexture,t=>{this.eventBus.emit("onTableTextureChange",t)}),this.$watch(()=>this.g.player.color,t=>{this.eventBus.emit("onColorChange",t)}),this.$watch(()=>this.g.player.name,t=>{this.eventBus.emit("onNameChange",t)}),this.$watch(()=>this.g.player.soundsEnabled,t=>{this.eventBus.emit("onSoundsEnabledChange",t)}),this.$watch(()=>this.g.player.otherPlayerClickSoundEnabled,t=>{this.eventBus.emit("onOtherPlayerClickSoundEnabledChange",t)}),this.$watch(()=>this.g.player.soundsVolume,t=>{this.eventBus.emit("onSoundsVolumeChange",t)}),this.$watch(()=>this.g.player.showPlayerNames,t=>{this.eventBus.emit("onShowPlayerNamesChange",t)});const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",this.onResize),this.g=await vo(`${this.$route.params.id}`,fe.clientId(),this.$config.WS_ADDRESS,je,e,this.eventBus),this.eventBus.on("statusMessage",t=>{this.addStatusMessage(t.what,t.value)})},unmounted(){this.g.unload(),this.g.disconnect(),window.removeEventListener("resize",this.onResize)},methods:{addStatusMessage(e,t){typeof t=="undefined"?this.statusMessages.push(`${e}`):t===!0||t===!1?this.statusMessages.push(`${e} ${t?"enabled":"disabled"}`):this.statusMessages.push(`${e} changed to ${t}`),setTimeout(()=>{this.statusMessages.shift()},3e3)},onResize(){const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,this.eventBus.emit("requireRerender")},reconnect(){this.g.connect()},toggleTo(e,t,o){t===!1?(this.overlay="",o&&this.eventBus.emit("setHotkeys",!0)):(this.overlay=e,o&&this.eventBus.emit("setHotkeys",!1))},toggle(e,t){this.overlay===""?(this.overlay=e,t&&this.eventBus.emit("setHotkeys",!1)):(this.overlay="",t&&this.eventBus.emit("setHotkeys",!0)),e==="preview"&&this.eventBus.emit("onPreviewChange",this.overlay==="preview")}}}),ju={id:"game"},Ku=s("div",null,[s("i",{class:"icon icon-hourglass"}),m(" Cutting puzzle, please wait... "),s("i",{class:"icon icon-hourglass"})],-1),qu={class:"menu-left"},Xu={key:0,class:"switch-game-replay"},Qu=s("i",{class:"icon icon-replay"},null,-1),Ju=m(" Watch replay"),ec={class:"menu"},tc={class:"tabs"},sc=s("i",{class:"icon icon-puzzle-piece"},null,-1),oc=m(" Puzzles"),nc=s("i",{class:"icon icon-preview"},null,-1),ic=m(" Preview"),lc=[nc,ic],ac=s("i",{class:"icon icon-settings"},null,-1),rc=m(" Settings"),uc=[ac,rc],cc=s("i",{class:"icon icon-info"},null,-1),dc=m(" Info"),hc=[cc,dc],pc=s("i",{class:"icon icon-hotkey"},null,-1),gc=m(" Hotkeys"),mc=[pc,gc],fc=s("a",{class:"opener",href:"https://ec.europa.eu/info/strategy/priorities-2019-2024/stronger-europe-world/eu-solidarity-ukraine/eu-assistance-ukraine/eu-stands-ukraine_en",target:"_blank"},[s("i",{class:"icon icon-ukraine-heart"}),m(" Stand with Ukraine ")],-1),_c={class:"menu-right"},yc={key:4,class:"status-messages"},wc={ref:"canvas"};function vc(e,t,o,n,i,a){const r=N("settings-overlay"),u=N("preview-overlay"),f=N("info-overlay"),d=N("help-overlay"),k=N("overlay"),M=N("connection-overlay"),E=N("puzzle-status"),_=N("router-link"),C=N("scores");return p(),y("div",ju,[e.overlay==="settings"?(p(),te(r,{key:0,onClose:t[0]||(t[0]=w=>e.toggle("settings",!0)),onBgclick:t[1]||(t[1]=w=>e.toggle("settings",!0)),modelValue:e.g.player,"onUpdate:modelValue":t[2]||(t[2]=w=>e.g.player=w)},null,8,["modelValue"])):B("",!0),e.overlay==="preview"?(p(),te(u,{key:1,onClose:t[3]||(t[3]=w=>e.toggle("preview",!1)),onClick:t[4]||(t[4]=w=>e.toggle("preview",!1)),img:e.g.previewImageUrl},null,8,["img"])):B("",!0),e.g.game&&e.overlay==="info"?(p(),te(f,{key:2,onClose:t[5]||(t[5]=w=>e.toggle("info",!0)),onBgclick:t[6]||(t[6]=w=>e.toggle("info",!0)),game:e.g.game},null,8,["game"])):B("",!0),e.overlay==="help"?(p(),te(d,{key:3,onClose:t[7]||(t[7]=w=>e.toggle("help",!0)),onBgclick:t[8]||(t[8]=w=>e.toggle("help",!0))})):B("",!0),j(ee(k,null,{default:ae(()=>[Ku]),_:1},512),[[zs,e.cuttingPuzzle]]),ee(M,{connectionState:e.connectionState,onReconnect:e.reconnect},null,8,["connectionState","onReconnect"]),s("div",qu,[ee(E,{status:e.status},null,8,["status"]),e.g.game&&e.g.game.hasReplay?(p(),y("div",Xu,[ee(_,{to:{name:"replay",params:{id:e.g.game.id}}},{default:ae(()=>[Qu,Ju]),_:1},8,["to"])])):B("",!0)]),s("div",ec,[s("div",tc,[ee(_,{class:"opener",to:{name:"index"},target:"_blank"},{default:ae(()=>[sc,oc]),_:1}),s("div",{class:"opener",onClick:t[9]||(t[9]=w=>e.toggle("preview",!1))},lc),s("div",{class:"opener",onClick:t[10]||(t[10]=w=>e.toggle("settings",!0))},uc),s("div",{class:"opener",onClick:t[11]||(t[11]=w=>e.toggle("info",!0))},hc),s("div",{class:"opener",onClick:t[12]||(t[12]=w=>e.toggle("help",!0))},mc),fc])]),s("div",_c,[ee(C,{players:e.players},null,8,["players"])]),e.statusMessages.length?(p(),y("div",yc,[(p(!0),y(re,null,_e(e.statusMessages,(w,Y)=>(p(),y("div",{key:Y},F(w),1))),128))])):B("",!0),s("canvas",wc,null,512)])}var Ec=se(Hu,[["render",vc]]);const Pc=ie({name:"replay",components:{PuzzleStatusComponent:Wt,Scores:Yt,SettingsOverlay:Ft,PreviewOverlay:Zt,InfoOverlay:Ht,HelpOverlay:qt},data(){return{statusMessages:[],players:{active:[],idle:[]},status:{finished:!1,duration:0,piecesDone:0,piecesTotal:0},overlay:"",connectionState:0,cuttingPuzzle:!0,eventBus:Ds(),g:{player:Bs(),game:null,previewImageUrl:"",connect:()=>{},disconnect:()=>{},unload:()=>{}},replay:{speed:1,paused:!1}}},async mounted(){if(!this.$route.params.id)return;this.eventBus.on("puzzleCut",()=>{this.cuttingPuzzle=!1}),this.eventBus.on("players",t=>{this.players=t}),this.eventBus.on("status",t=>{this.status=t}),this.eventBus.on("connectionState",t=>{this.connectionState=t}),this.eventBus.on("togglePreview",t=>{this.toggleTo("preview",t,!1)}),this.eventBus.on("toggleSoundsEnabled",t=>{this.g.player.soundsEnabled=!!t}),this.eventBus.on("togglePlayerNames",t=>{this.g.player.showPlayerNames=!!t}),this.eventBus.on("toggleShowTable",t=>{this.g.player.showTable=!!t}),this.eventBus.on("replaySpeed",t=>{this.replay.speed=t}),this.eventBus.on("replayPaused",t=>{this.replay.paused=t}),this.$watch(()=>this.g.player.background,t=>{this.eventBus.emit("onBgChange",t)}),this.$watch(()=>this.g.player.showTable,t=>{this.eventBus.emit("onShowTableChange",t)}),this.$watch(()=>this.g.player.tableTexture,t=>{this.eventBus.emit("onTableTextureChange",t)}),this.$watch(()=>this.g.player.color,t=>{this.eventBus.emit("onColorChange",t)}),this.$watch(()=>this.g.player.name,t=>{this.eventBus.emit("onNameChange",t)}),this.$watch(()=>this.g.player.soundsEnabled,t=>{this.eventBus.emit("onSoundsEnabledChange",t)}),this.$watch(()=>this.g.player.otherPlayerClickSoundEnabled,t=>{this.eventBus.emit("onOtherPlayerClickSoundEnabledChange",t)}),this.$watch(()=>this.g.player.soundsVolume,t=>{this.eventBus.emit("onSoundsVolumeChange",t)}),this.$watch(()=>this.g.player.showPlayerNames,t=>{this.eventBus.emit("onShowPlayerNamesChange",t)});const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",this.onResize),this.g=await vo(`${this.$route.params.id}`,fe.clientId(),this.$config.WS_ADDRESS,ve,e,this.eventBus),this.eventBus.on("statusMessage",t=>{this.addStatusMessage(t.what,t.value)})},unmounted(){this.g.unload(),this.g.disconnect(),window.removeEventListener("resize",this.onResize)},methods:{addStatusMessage(e,t){typeof t=="undefined"?this.statusMessages.push(`${e}`):t===!0||t===!1?this.statusMessages.push(`${e} ${t?"enabled":"disabled"}`):this.statusMessages.push(`${e} changed to ${t}`),setTimeout(()=>{this.statusMessages.shift()},3e3)},onResize(){const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,this.eventBus.emit("requireRerender")},toggleTo(e,t,o){t===!1?(this.overlay="",o&&this.eventBus.emit("setHotkeys",!0)):(this.overlay=e,o&&this.eventBus.emit("setHotkeys",!1))},toggle(e,t){this.overlay===""?(this.overlay=e,t&&this.eventBus.emit("setHotkeys",!1)):(this.overlay="",t&&this.eventBus.emit("setHotkeys",!0)),e==="preview"&&this.eventBus.emit("onPreviewChange",this.overlay==="preview")}},computed:{replayText(){return"Replay-Speed: "+(this.replay.speed+"x")+(this.replay.paused?" Paused":"")}}}),bc={id:"replay"},Tc={key:4,class:"overlay"},$c=s("div",{class:"overlay-content"},[s("div",null,[s("i",{class:"icon icon-hourglass"}),m(" Cutting puzzle, please wait... "),s("i",{class:"icon icon-hourglass"})])],-1),Sc=[$c],Cc={class:"menu-left"},kc={class:"playback-control"},Ac=s("i",{class:"icon icon-speed-up"},null,-1),Oc=[Ac],Nc=s("i",{class:"icon icon-speed-down"},null,-1),Uc=[Nc],Rc=s("i",{class:"icon icon-pause"},null,-1),Lc=[Rc],Vc={key:0,class:"switch-game-replay"},Mc=s("i",{class:"icon icon-puzzle-piece"},null,-1),zc=m(" To the game"),Dc={class:"menu"},Bc={class:"tabs"},Gc=s("i",{class:"icon icon-puzzle-piece"},null,-1),Ic=m(" Puzzles"),xc=s("i",{class:"icon icon-preview"},null,-1),Yc=m(" Preview"),Wc=[xc,Yc],Fc=s("i",{class:"icon icon-settings"},null,-1),Zc=m(" Settings"),Hc=[Fc,Zc],jc=s("i",{class:"icon icon-info"},null,-1),Kc=m(" Info"),qc=[jc,Kc],Xc=s("i",{class:"icon icon-hotkey"},null,-1),Qc=m(" Hotkeys"),Jc=[Xc,Qc],ed=s("a",{class:"opener",href:"https://ec.europa.eu/info/strategy/priorities-2019-2024/stronger-europe-world/eu-solidarity-ukraine/eu-assistance-ukraine/eu-stands-ukraine_en",target:"_blank"},[s("i",{class:"icon icon-ukraine-heart"}),m(" Stand with Ukraine ")],-1),td={class:"menu-right"},sd={key:5,class:"status-messages"},od={ref:"canvas"};function nd(e,t,o,n,i,a){const r=N("settings-overlay"),u=N("preview-overlay"),f=N("info-overlay"),d=N("help-overlay"),k=N("puzzle-status"),M=N("router-link"),E=N("scores");return p(),y("div",bc,[e.overlay==="settings"?(p(),te(r,{key:0,onClose:t[0]||(t[0]=_=>e.toggle("settings",!0)),onBgclick:t[1]||(t[1]=_=>e.toggle("settings",!0)),modelValue:e.g.player,"onUpdate:modelValue":t[2]||(t[2]=_=>e.g.player=_)},null,8,["modelValue"])):B("",!0),e.overlay==="preview"?(p(),te(u,{key:1,onClose:t[3]||(t[3]=_=>e.toggle("preview",!1)),onClick:t[4]||(t[4]=_=>e.toggle("preview",!1)),img:e.g.previewImageUrl},null,8,["img"])):B("",!0),e.g.game&&e.overlay==="info"?(p(),te(f,{key:2,onClose:t[5]||(t[5]=_=>e.toggle("info",!0)),onBgclick:t[6]||(t[6]=_=>e.toggle("info",!0)),game:e.g.game},null,8,["game"])):B("",!0),e.overlay==="help"?(p(),te(d,{key:3,onClose:t[7]||(t[7]=_=>e.toggle("help",!0)),onBgclick:t[8]||(t[8]=_=>e.toggle("help",!0))})):B("",!0),e.cuttingPuzzle?(p(),y("div",Tc,Sc)):B("",!0),s("div",Cc,[ee(k,{status:e.status},null,8,["status"]),s("div",kc,[s("div",null,F(e.replayText),1),s("button",{class:"btn",onClick:t[9]||(t[9]=_=>e.eventBus.emit("replayOnSpeedUp"))},Oc),s("button",{class:"btn",onClick:t[10]||(t[10]=_=>e.eventBus.emit("replayOnSpeedDown"))},Uc),s("button",{class:"btn",onClick:t[11]||(t[11]=_=>e.eventBus.emit("replayOnPauseToggle"))},Lc)]),e.g.game?(p(),y("div",Vc,[ee(M,{to:{name:"game",params:{id:e.g.game.id}}},{default:ae(()=>[Mc,zc]),_:1},8,["to"])])):B("",!0)]),s("div",Dc,[s("div",Bc,[ee(M,{class:"opener",to:{name:"index"},target:"_blank"},{default:ae(()=>[Gc,Ic]),_:1}),s("div",{class:"opener",onClick:t[12]||(t[12]=_=>e.toggle("preview",!1))},Wc),s("div",{class:"opener",onClick:t[13]||(t[13]=_=>e.toggle("settings",!0))},Hc),s("div",{class:"opener",onClick:t[14]||(t[14]=_=>e.toggle("info",!0))},qc),s("div",{class:"opener",onClick:t[15]||(t[15]=_=>e.toggle("help",!0))},Jc),ed])]),s("div",td,[ee(E,{players:e.players},null,8,["players"])]),e.statusMessages.length?(p(),y("div",sd,[(p(!0),y(re,null,_e(e.statusMessages,(_,C)=>(p(),y("div",{key:C},F(_),1))),128))])):B("",!0),s("canvas",od,null,512)])}var id=se(Pc,[["render",nd]]);let Eo=null;async function ld(){Eo=await(await fe.get("/api/me",{})).json()}var Po={getMe:()=>Eo,init:ld};const ad=ie({props:{image:{type:Object,required:!0}},data:()=>({me:Po.getMe()}),computed:{style(){return{backgroundImage:`url("${this.image.url.replace("uploads/","uploads/r/")+"-150x100.webp"}")`}},canEdit(){return this.me.id?this.me.id===this.image.uploaderUserId:!1}},emits:{click:null,editClick:null},methods:{onClick(){this.$emit("click")},onEditClick(){this.$emit("editClick")}}}),rd=s("i",{class:"icon icon-edit"},null,-1),ud=[rd];function cd(e,t,o,n,i,a){return p(),y("div",{class:"imageteaser",style:Ie(e.style),onClick:t[1]||(t[1]=(...r)=>e.onClick&&e.onClick(...r))},[e.canEdit?(p(),y("div",{key:0,class:"btn edit",onClick:t[0]||(t[0]=bt((...r)=>e.onEditClick&&e.onEditClick(...r),["stop"]))},ud)):B("",!0)],4)}var dd=se(ad,[["render",cd]]);const hd=ie({props:{animate:{type:Boolean,default:!0}},emits:{bgclick:null,close:null},data:()=>({classes:[]}),methods:{onKeyUp(e){e.code==="Escape"&&window.getComputedStyle(this.$el).display!=="none"&&this.$emit("close")}},mounted(){window.addEventListener("keyup",this.onKeyUp)},unmounted(){window.removeEventListener("keyup",this.onKeyUp)}}),pd={class:"overlay"};function gd(e,t,o,n,i,a){return p(),y("div",pd,[s("div",{class:Xe(["overlay-background",e.classes.map(r=>"overlay-background-"+r)]),onClick:t[0]||(t[0]=r=>e.$emit("bgclick"))},null,2),s("div",{class:Xe(["overlay-content",e.classes.map(r=>"overlay-content-"+r)])},[Do(e.$slots,"default")],2)])}var md=se(hd,[["render",gd]]);const fd={props:{src:String,title:{type:String,default:""},height:{type:String,default:"100%"},width:{type:String,default:"100%"}},computed:{style(){return{display:"inline-block",verticalAlign:"text-bottom",backgroundImage:`url('${this.src}')`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",width:this.width,height:this.height}}}},_d=["title"];function yd(e,t,o,n,i,a){return p(),y("div",{style:Ie(a.style),title:o.title},null,12,_d)}var wd=se(fd,[["render",yd]]);const vd=ie({props:{modelValue:{type:Array,required:!0},autocompleteTags:{type:Function}},emits:{"update:modelValue":null},data(){return{input:"",values:[],autocomplete:{idx:-1,values:[]}}},watch:{modelValue(e,t){this.values=e}},created(){this.values=this.modelValue},methods:{onKeyUp(e){if(e.code==="ArrowDown"&&this.autocomplete.values.length>0)return this.autocomplete.idx<this.autocomplete.values.length-1&&this.autocomplete.idx++,e.stopPropagation(),!1;if(e.code==="ArrowUp"&&this.autocomplete.values.length>0)return this.autocomplete.idx>0&&this.autocomplete.idx--,e.stopPropagation(),!1;if(e.key===",")return this.add(),e.stopPropagation(),!1;if(e.code==="Escape")return this.autocomplete.values=[],this.autocomplete.idx=-1,e.stopPropagation(),!1;this.input&&this.autocompleteTags?(this.autocomplete.values=this.autocompleteTags(this.input,this.values),this.autocomplete.idx=-1):(this.autocomplete.values=[],this.autocomplete.idx=-1)},addVal(e){const t=e.replace(/,/g,"").trim();!t||(this.values.includes(t)||this.values.push(t),this.input="",this.autocomplete.values=[],this.autocomplete.idx=-1,this.$emit("update:modelValue",this.values),this.$refs.input.focus())},add(){const e=this.autocomplete.idx>=0?this.autocomplete.values[this.autocomplete.idx]:this.input;this.addVal(e)},rm(e){this.values=this.values.filter(t=>t!==e),this.$emit("update:modelValue",this.values)}}}),Ed={class:"input-holder"},Pd={key:0,class:"enter-hint color-highlight"},bd={key:0,class:"autocomplete"},Td=["onClick"],$d=["onClick"];function Sd(e,t,o,n,i,a){return p(),y("div",null,[s("div",Ed,[j(s("input",{ref:"input",class:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>e.input=r),placeholder:"Plants, People",onKeydown:[t[1]||(t[1]=Ts(bt((...r)=>e.add&&e.add(...r),["prevent"]),["enter"])),t[2]||(t[2]=Ts(bt((...r)=>e.add&&e.add(...r),["prevent"]),["tab"]))],onKeyup:t[3]||(t[3]=(...r)=>e.onKeyUp&&e.onKeyUp(...r))},null,544),[[Re,e.input]]),e.input?(p(),y("div",Pd,"[Press ENTER/TAB to add]")):B("",!0)]),e.autocomplete.values?(p(),y("div",bd,[s("ul",null,[(p(!0),y(re,null,_e(e.autocomplete.values,(r,u)=>(p(),y("li",{key:u,class:Xe({active:u===e.autocomplete.idx}),onClick:f=>e.addVal(r)},F(r),11,Td))),128))])])):B("",!0),(p(!0),y(re,null,_e(e.values,(r,u)=>(p(),y("span",{key:u,class:"bit is-clickable",onClick:f=>e.rm(r)},F(r)+" \u2716",9,$d))),128))])}var Cd=se(vd,[["render",Sd],["__scopeId","data-v-8e01df40"]]);(async()=>{fe.init(),await Po.init();const t=await(await fe.get("/api/conf",{})).json(),o=Bo({history:Go(),routes:[{name:"index",path:"/",component:Mn},{name:"new-game",path:"/new-game",component:fl},{name:"game",path:"/g/:id",component:Ec},{name:"replay",path:"/replay/:id",component:id}]});o.beforeEach((i,a)=>{a.name&&document.documentElement.classList.remove(`view-${String(a.name)}`),document.documentElement.classList.add(`view-${String(i.name)}`)});const n=Io(qo);n.config.globalProperties.$config=t,n.use(o),n.component("connection-overlay",eo),n.component("edit-image-dialog",Hs),n.component("game-teaser",Ys),n.component("help-overlay",qt),n.component("image-library",Ws),n.component("image-teaser",dd),n.component("info-overlay",Ht),n.component("new-game-dialog",js),n.component("new-image-dialog",Zs),n.component("overlay",md),n.component("preview-overlay",Zt),n.component("puzzle-status",Wt),n.component("responsive-image",wd),n.component("scores",Yt),n.component("settings-overlay",Ft),n.component("tags-input",Cd),n.mount("#app")})();
//# sourceMappingURL=index.0cfe3ffb.js.map
