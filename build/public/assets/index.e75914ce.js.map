{"version":3,"file":"index.e75914ce.js","sources":["../../../vite/modulepreload-polyfill","../../../plugin-vue:export-helper","../../../src/frontend/App.vue","../../../src/frontend/xhr.ts","../../../src/common/Time.ts","../../../src/frontend/components/GameTeaser.vue","../../../src/frontend/views/Index.vue","../../../src/frontend/components/ImageLibrary.vue","../../../src/common/Rng.ts","../../../src/common/Util.ts","../../../src/frontend/components/NewImageDialog.vue","../../../src/frontend/components/EditImageDialog.vue","../../../src/common/Types.ts","../../../src/frontend/components/NewGameDialog.vue","../../../src/frontend/views/NewGame.vue","../../../src/frontend/components/Scores.vue","../../../src/frontend/components/PuzzleStatus.vue","../../../src/frontend/components/SettingsOverlay.vue","../../../src/frontend/components/PreviewOverlay.vue","../../../src/frontend/components/InfoOverlay.vue","../../../src/common/Protocol.ts","../../../src/frontend/Communication.ts","../../../src/frontend/components/ConnectionOverlay.vue","../../../src/frontend/components/HelpOverlay.vue","../../../src/frontend/click.mp3","../../../src/frontend/grab.png","../../../src/frontend/grab_mask.png","../../../src/frontend/hand.png","../../../src/frontend/hand_mask.png","../../../src/frontend/gameloop.ts","../../../src/frontend/Camera.ts","../../../src/frontend/Graphics.ts","../../../src/frontend/Debug.ts","../../../src/common/Geometry.ts","../../../src/frontend/PuzzleGraphics.ts","../../../src/common/GameCommon.ts","../../../src/frontend/Fireworks.ts","../../../src/frontend/settings.ts","../../../src/frontend/EventAdapter.ts","../../../src/frontend/game.ts","../../../src/frontend/views/Game.vue","../../../src/frontend/views/Replay.vue","../../../src/frontend/components/ImageTeaser.vue","../../../src/frontend/components/Overlay.vue","../../../src/frontend/components/ResponsiveImage.vue","../../../src/frontend/components/TagsInput.vue","../../../src/frontend/components/Upload.vue","../../../src/frontend/main.ts"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","\nexport default (sfc, props) => {\n  const target = sfc.__vccOpts || sfc;\n  for (const [key, val] of props) {\n    target[key] = val;\n  }\n  return target;\n}\n","<template>\n  <div id=\"app\">\n    <ul class=\"nav\" v-if=\"showNav\">\n      <li><router-link class=\"btn\" :to=\"{name: 'index'}\">Games overview</router-link></li>\n      <li><router-link class=\"btn\" :to=\"{name: 'new-game'}\">New game</router-link></li>\n    </ul>\n\n    <router-view />\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  name: 'app',\n  computed: {\n    showNav () {\n      // TODO: add info wether to show nav to route props\n      return !['game', 'replay'].includes(String(this.$route.name))\n    },\n  },\n})\n</script>\n","export interface Response {\n  status: number,\n  text: string,\n  json: () => Promise<any>,\n}\n\nexport interface Options {\n  body: FormData|string,\n  headers?: any,\n  onUploadProgress?: (ev: ProgressEvent<XMLHttpRequestEventTarget>) => any,\n}\n\nlet xhrClientId: string = ''\nlet xhrClientSecret: string = ''\nconst request = async (\n  method: string,\n  url: string,\n  options: Options\n): Promise<Response> => {\n  return new Promise((resolve, reject) => {\n    const xhr = new window.XMLHttpRequest()\n    xhr.open(method, url, true)\n    xhr.withCredentials = true\n    for (const k in options.headers || {}) {\n      xhr.setRequestHeader(k, options.headers[k])\n    }\n\n    xhr.setRequestHeader('Client-Id', xhrClientId)\n    xhr.setRequestHeader('Client-Secret', xhrClientSecret)\n\n    xhr.addEventListener('load', function (ev: ProgressEvent<XMLHttpRequestEventTarget>\n      ) {\n      resolve({\n        status: this.status,\n        text: this.responseText,\n        json: async () => JSON.parse(this.responseText),\n      })\n    })\n    xhr.addEventListener('error', function (ev: ProgressEvent<XMLHttpRequestEventTarget>) {\n      reject(new Error('xhr error'))\n    })\n    if (xhr.upload && options.onUploadProgress) {\n      xhr.upload.addEventListener('progress', function (ev: ProgressEvent<XMLHttpRequestEventTarget>) {\n        // typescript complains without this extra check\n        if (options.onUploadProgress) {\n          options.onUploadProgress(ev)\n        }\n      })\n    }\n    xhr.send(options.body || null)\n  })\n}\n\nexport default {\n  request,\n  get: (url: string, options: any): Promise<Response> => {\n    return request('get', url, options)\n  },\n  post: (url: string, options: any): Promise<Response> => {\n    return request('post', url, options)\n  },\n  setClientId: (clientId: string): void => {\n    xhrClientId = clientId\n  },\n  setClientSecret: (clientSecret: string): void => {\n    xhrClientSecret = clientSecret\n  },\n}\n","const MS = 1\nconst SEC = MS * 1000\nconst MIN = SEC * 60\nconst HOUR = MIN * 60\nconst DAY = HOUR * 24\n\nexport const timestamp = (): number => {\n  const d = new Date();\n  return Date.UTC(\n    d.getUTCFullYear(),\n    d.getUTCMonth(),\n    d.getUTCDate(),\n    d.getUTCHours(),\n    d.getUTCMinutes(),\n    d.getUTCSeconds(),\n    d.getUTCMilliseconds(),\n  )\n}\n\nexport const durationStr = (duration: number): string => {\n  const d = Math.floor(duration / DAY)\n  duration = duration % DAY\n\n  const h = Math.floor(duration / HOUR)\n  duration = duration % HOUR\n\n  const m = Math.floor(duration / MIN)\n  duration = duration % MIN\n\n  const s = Math.floor(duration / SEC)\n\n  return `${d}d ${h}h ${m}m ${s}s`\n}\n\nexport const timeDiffStr = (\n  from: number,\n  to: number\n): string => durationStr(to - from)\n\nexport default {\n  MS,\n  SEC,\n  MIN,\n  HOUR,\n  DAY,\n\n  timestamp,\n  timeDiffStr,\n  durationStr,\n}\n","<template>\n  <div class=\"game-teaser\" :style=\"style\">\n    <router-link class=\"game-info\" :to=\"{ name: 'game', params: { id: game.id } }\">\n      <span class=\"game-info-text\">\n        üß© {{game.tilesFinished}}/{{game.tilesTotal}}<br />\n        üë• {{game.players}}<br />\n        {{time(game.started, game.finished)}}<br />\n      </span>\n    </router-link>\n    <router-link v-if=\"game.hasReplay\" class=\"game-replay\" :to=\"{ name: 'replay', params: { id: game.id } }\">\n      ‚Ü™Ô∏è Watch replay\n    </router-link>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport Time from './../../common/Time'\n\nexport default defineComponent({\n  props: {\n    game: {\n      type: Object,\n      required: true,\n    },\n  },\n  computed: {\n    style (): object {\n      const url = this.game.imageUrl.replace('uploads/', 'uploads/r/') + '-375x210.webp'\n      return {\n        'background-image': `url(\"${url}\")`,\n      }\n    },\n  },\n  methods: {\n    time(start: number, end: number) {\n      const icon = end ? 'üèÅ' : '‚è≥'\n      const from = start;\n      const to = end || Time.timestamp()\n      const timeDiffStr = Time.timeDiffStr(from, to)\n      return `${icon} ${timeDiffStr}`\n    },\n  },\n})\n</script>\n","<template>\n  <div>\n    <h1>Running games</h1>\n    <div class=\"game-teaser-wrap\" v-for=\"(g, idx) in gamesRunning\" :key=\"idx\">\n      <game-teaser :game=\"g\" />\n    </div>\n\n    <h1>Finished games</h1>\n    <div class=\"game-teaser-wrap\" v-for=\"(g, idx) in gamesFinished\" :key=\"idx\">\n      <game-teaser :game=\"g\" />\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport xhr from '../xhr'\n\nimport GameTeaser from './../components/GameTeaser.vue'\n\nexport default defineComponent({\n  components: {\n    GameTeaser,\n  },\n  data() {\n    return {\n      gamesRunning: [],\n      gamesFinished: [],\n    }\n  },\n  async created() {\n    const res = await xhr.get('/api/index-data', {})\n    const json = await res.json()\n    this.gamesRunning = json.gamesRunning\n    this.gamesFinished = json.gamesFinished\n  },\n})\n</script>\n","<template>\n  <div>\n    <image-teaser v-for=\"(i,idx) in images\" :image=\"i\" @click=\"imageClicked(i)\" @editClick=\"imageEditClicked(i)\" :key=\"idx\" />\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport { Image } from '../../common/Types'\n\nexport default defineComponent({\n  props: {\n    images: {\n      type: Array,\n      required: true,\n    },\n  },\n  emits: {\n    imageClicked: null,\n    imageEditClicked: null,\n  },\n  methods: {\n    imageClicked (image: Image) {\n      this.$emit('imageClicked', image)\n    },\n    imageEditClicked (image: Image) {\n      this.$emit('imageEditClicked', image)\n    },\n  },\n})\n</script>\n","export interface RngSerialized {\n  rand_high: number,\n  rand_low: number,\n}\n\nexport class Rng {\n  rand_high: number\n  rand_low: number\n\n  constructor(seed: number) {\n    this.rand_high = seed || 0xDEADC0DE\n    this.rand_low = seed ^ 0x49616E42\n  }\n\n  random (min: number, max: number): number {\n    this.rand_high = ((this.rand_high << 16) + (this.rand_high >> 16) + this.rand_low) & 0xffffffff;\n    this.rand_low = (this.rand_low + this.rand_high) & 0xffffffff;\n    const n = (this.rand_high >>> 0) / 0xffffffff;\n    return (min + n * (max-min+1))|0;\n  }\n\n  // get one random item from the given array\n  choice<T> (array: Array<T>): T {\n    return array[this.random(0, array.length - 1)]\n  }\n\n  // return a shuffled (shallow) copy of the given array\n  shuffle<T> (array: Array<T>): Array<T> {\n    const arr = array.slice()\n    for (let i = 0; i <= arr.length - 2; i++) {\n      const j = this.random(i, arr.length -1)\n      const tmp = arr[i]\n      arr[i] = arr[j]\n      arr[j] = tmp\n    }\n    return arr\n  }\n\n  static serialize (rng: Rng): RngSerialized {\n    return {\n      rand_high: rng.rand_high,\n      rand_low: rng.rand_low\n    }\n  }\n\n  static unserialize (rngSerialized: RngSerialized): Rng {\n    const rng = new Rng(0)\n    rng.rand_high = rngSerialized.rand_high\n    rng.rand_low = rngSerialized.rand_low\n    return rng\n  }\n}\n","import { PuzzleCreationInfo } from '../server/Puzzle'\nimport {\n  EncodedGame,\n  EncodedPiece,\n  EncodedPieceShape,\n  EncodedPlayer,\n  Game,\n  Piece,\n  PieceShape,\n  Player,\n  PuzzleInfo,\n  ScoreMode,\n  ShapeMode,\n  SnapMode\n} from './Types'\nimport { Point } from './Geometry'\nimport { Rng } from './Rng'\n\nconst slug = (str: string): string => {\n  let tmp = str.toLowerCase()\n  tmp = tmp.replace(/[^a-z0-9]+/g, '-')\n  tmp = tmp.replace(/^-|-$/, '')\n  return tmp\n}\n\nconst pad = (x: number, pad: string): string => {\n  const str = `${x}`\n  if (str.length >= pad.length) {\n    return str\n  }\n  return pad.substr(0, pad.length - str.length) + str\n}\n\ntype LogArgs = Array<any>\ntype LogFn = (...args: LogArgs) => void\n\nexport const logger = (...pre: string[]): { log: LogFn, error: LogFn, info: LogFn } => {\n  const log = (m: 'log'|'info'|'error') => (...args: LogArgs): void => {\n    const d = new Date()\n    const hh = pad(d.getHours(), '00')\n    const mm = pad(d.getMinutes(), '00')\n    const ss = pad(d.getSeconds(), '00')\n    console[m](`${hh}:${mm}:${ss}`, ...pre, ...args)\n  }\n  return {\n    log: log('log'),\n    error: log('error'),\n    info: log('info'),\n  }\n}\n\n// get a unique id\nexport const uniqId = (): string => {\n  return Date.now().toString(36) + Math.random().toString(36).substring(2)\n}\n\nfunction encodeShape(data: PieceShape): EncodedPieceShape {\n  /* encoded in 1 byte:\n    00000000\n          ^^ top\n        ^^   right\n      ^^     bottom\n    ^^       left\n  */\n  return ((data.top    + 1) << 0)\n       | ((data.right  + 1) << 2)\n       | ((data.bottom + 1) << 4)\n       | ((data.left   + 1) << 6)\n}\n\nfunction decodeShape(data: EncodedPieceShape): PieceShape {\n  return {\n    top:    (data >> 0 & 0b11) - 1,\n    right:  (data >> 2 & 0b11) - 1,\n    bottom: (data >> 4 & 0b11) - 1,\n    left:   (data >> 6 & 0b11) - 1,\n  }\n}\n\nfunction encodePiece(data: Piece): EncodedPiece {\n  return [data.idx, data.pos.x, data.pos.y, data.z, data.owner, data.group]\n}\n\nfunction decodePiece(data: EncodedPiece): Piece {\n  return {\n    idx: data[0],\n    pos: {\n      x: data[1],\n      y: data[2],\n    },\n    z: data[3],\n    owner: data[4],\n    group: data[5],\n  }\n}\n\nfunction encodePlayer(data: Player): EncodedPlayer {\n  return [\n    data.id,\n    data.x,\n    data.y,\n    data.d,\n    data.name,\n    data.color,\n    data.bgcolor,\n    data.points,\n    data.ts,\n  ]\n}\n\nfunction decodePlayer(data: EncodedPlayer): Player {\n  return {\n    id: data[0],\n    x: data[1],\n    y: data[2],\n    d: data[3], // mouse down\n    name: data[4],\n    color: data[5],\n    bgcolor: data[6],\n    points: data[7],\n    ts: data[8],\n  }\n}\n\nfunction encodeGame(data: Game): EncodedGame {\n  return [\n    data.id,\n    data.rng.type || '',\n    Rng.serialize(data.rng.obj),\n    data.puzzle,\n    data.players,\n    data.evtInfos,\n    data.scoreMode,\n    data.shapeMode,\n    data.snapMode,\n    data.creatorUserId,\n  ]\n}\n\nfunction decodeGame(data: EncodedGame): Game {\n  return {\n    id: data[0],\n    rng: {\n      type: data[1],\n      obj: Rng.unserialize(data[2]),\n    },\n    puzzle: data[3],\n    players: data[4],\n    evtInfos: data[5],\n    scoreMode: data[6],\n    shapeMode: data[7],\n    snapMode: data[8],\n    creatorUserId: data[9],\n  }\n}\n\nfunction coordByPieceIdx(info: PuzzleInfo|PuzzleCreationInfo, pieceIdx: number): Point {\n  const wTiles = info.width / info.tileSize\n  return {\n    x: pieceIdx % wTiles,\n    y: Math.floor(pieceIdx / wTiles),\n  }\n}\n\nconst hash = (str: string): number => {\n  let hash = 0\n\n  for (let i = 0; i < str.length; i++) {\n    const chr = str.charCodeAt(i);\n    hash = ((hash << 5) - hash) + chr;\n    hash |= 0; // Convert to 32bit integer\n  }\n  return hash;\n}\n\nfunction asQueryArgs(data: Record<string, any>): string {\n  const q = []\n  for (const k in data) {\n    const pair = [k, data[k]].map(encodeURIComponent)\n    q.push(pair.join('='))\n  }\n  if (q.length === 0) {\n    return ''\n  }\n  return `?${q.join('&')}`\n}\n\nexport default {\n  hash,\n  slug,\n  uniqId,\n\n  encodeShape,\n  decodeShape,\n\n  encodePiece,\n  decodePiece,\n\n  encodePlayer,\n  decodePlayer,\n\n  encodeGame,\n  decodeGame,\n\n  coordByPieceIdx,\n\n  asQueryArgs,\n}\n","\"Upload image\" clicked: what it looks like when the image was uploaded.\nProbably needs a (x) in the upper right corner of the image to allow the\nuser to remove the image if a wrong one was selected. The image should\nbe uploaded to the actual gallery only when the user presses \"post to\ngallery\", if possible!\n<template>\n  <overlay class=\"new-image-dialog\">\n    <template v-slot:default>\n      <div\n        class=\"area-image\"\n        :class=\"{'has-image': !!previewUrl, 'no-image': !previewUrl, droppable: droppable}\"\n        @drop=\"onDrop\"\n        @dragover=\"onDragover\"\n        @dragleave=\"onDragleave\">\n        <!-- TODO: ...  -->\n        <div class=\"drop-target\"></div>\n        <div v-if=\"previewUrl\" class=\"has-image\">\n          <span class=\"remove btn\" @click=\"previewUrl=''\">X</span>\n          <responsive-image :src=\"previewUrl\" />\n        </div>\n        <div v-else>\n          <label class=\"upload\">\n            <input type=\"file\" style=\"display: none\" @change=\"onFileSelect\" accept=\"image/*\" />\n            <span class=\"btn\">Upload File</span>\n          </label>\n        </div>\n      </div>\n\n      <div class=\"area-settings\">\n        <table>\n          <tr>\n            <td><label>Title</label></td>\n            <td><input type=\"text\" v-model=\"title\" placeholder=\"Flower by @artist\" /></td>\n          </tr>\n          <tr>\n            <td colspan=\"2\">\n              <div class=\"hint\">Feel free to leave a credit to the artist/photographer in the title :)</div>\n            </td>\n          </tr>\n          <tr>\n            <!-- TODO: autocomplete tags -->\n            <td><label>Tags</label></td>\n            <td>\n              <tags-input v-model=\"tags\" :autocompleteTags=\"autocompleteTags\" />\n            </td>\n          </tr>\n        </table>\n      </div>\n\n      <div class=\"area-buttons\">\n        <button class=\"btn\"\n          :disabled=\"!canPostToGallery\"\n          @click=\"postToGallery\"\n        >\n          <template v-if=\"uploading === 'postToGallery'\">Uploading ({{uploadProgressPercent}}%)</template>\n          <template v-else>üñºÔ∏è Post to gallery</template>\n        </button>\n        <button class=\"btn\"\n          :disabled=\"!canSetupGameClick\"\n          @click=\"setupGameClick\"\n        >\n          <template v-if=\"uploading === 'setupGame'\">Uploading ({{uploadProgressPercent}}%)</template>\n          <template v-else>üß© Post to gallery <br /> + set up game</template>\n        </button>\n      </div>\n    </template>\n  </overlay>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport { logger } from '../../common/Util'\n\nconst log = logger('NewImageDialog.vue')\n\nexport default defineComponent({\n  props: {\n    autocompleteTags: {\n      type: Function,\n    },\n    uploadProgress: {\n      type: Number,\n    },\n    uploading: {\n      type: String,\n    },\n  },\n  emits: {\n    setupGameClick: null,\n    postToGalleryClick: null,\n  },\n  data () {\n    return {\n      previewUrl: '',\n      file: null as File|null,\n      title: '',\n      tags: [] as string[],\n      droppable: false,\n    }\n  },\n  computed: {\n    uploadProgressPercent (): number {\n      return this.uploadProgress ? Math.round(this.uploadProgress * 100) : 0\n    },\n    canPostToGallery (): boolean {\n      if (this.uploading) {\n        return false\n      }\n      return !!(this.previewUrl && this.file)\n    },\n    canSetupGameClick (): boolean {\n      if (this.uploading) {\n        return false\n      }\n      return !!(this.previewUrl && this.file)\n    },\n  },\n  methods: {\n    imageFromDragEvt (evt: DragEvent): DataTransferItem|null {\n      const items = evt.dataTransfer?.items\n      if (!items || items.length === 0) {\n        return null\n      }\n      const item = items[0]\n      if (!item.type.startsWith('image/')) {\n        return null\n      }\n      return item\n    },\n    onFileSelect (evt: Event) {\n      const target = (evt.target as HTMLInputElement)\n      if (!target.files) return;\n      const file = target.files[0]\n      if (!file) return;\n\n      this.preview(file)\n    },\n    preview (file: File) {\n      const r = new FileReader()\n      r.readAsDataURL(file)\n      r.onload = (ev: any) => {\n        this.previewUrl = ev.target.result\n        this.file = file\n      }\n    },\n    postToGallery () {\n      this.$emit('postToGalleryClick', {\n        file: this.file,\n        title: this.title,\n        tags: this.tags,\n      })\n    },\n    setupGameClick () {\n      this.$emit('setupGameClick', {\n        file: this.file,\n        title: this.title,\n        tags: this.tags,\n      })\n    },\n    onDrop (evt: DragEvent): boolean {\n      this.droppable = false\n      const img = this.imageFromDragEvt(evt)\n      if (!img) {\n        return false\n      }\n      const f = img.getAsFile()\n      if (!f) {\n        return false\n      }\n      this.file = f\n      this.preview(f)\n      evt.preventDefault()\n      return false\n    },\n    onDragover (evt: DragEvent): boolean {\n      const img = this.imageFromDragEvt(evt)\n      if (!img) {\n        return false\n      }\n      this.droppable = true\n      evt.preventDefault()\n      return false\n    },\n    onDragleave () {\n      log.info('onDragleave')\n      this.droppable = false\n    },\n  },\n})\n</script>\n\n// TODO: scoped vs .new-image-dialog\n<style>\n.new-image-dialog .overlay-content {\n  display: grid;\n  grid-template-columns: auto 450px;\n  grid-template-rows: auto;\n  grid-template-areas:\n    \"image settings\"\n    \"image buttons\";\n  height: 90%;\n  width: 80%;\n}\n@media (max-width: 1400px) and (min-height: 720px),\n       (max-width: 1000px) {\n  .new-image-dialog .overlay-content {\n    grid-template-columns: auto;\n    grid-template-rows: 1fr min-content min-content;\n    grid-template-areas:\n      \"image\"\n      \"settings\"\n      \"buttons\";\n  }\n  .new-image-dialog .overlay-content .area-buttons .btn br {\n    display: none;\n  }\n}\n\n.new-image-dialog .area-image {\n  grid-area: image;\n  margin: .5em;\n  border: solid 6px transparent;\n}\n.new-image-dialog .area-image.no-image {\n  align-content: center;\n  display: grid;\n  text-align: center;\n  border: solid 6px;\n  position: relative;\n}\n.new-image-dialog .area-image.droppable {\n  border: dashed 6px;\n}\n.new-image-dialog .area-image .has-image {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n.new-image-dialog .area-image .has-image .remove {\n  position: absolute;\n  top: .5em;\n  left: .5em;\n}\n\n.new-image-dialog .area-settings {\n  grid-area: settings;\n}\n\n.new-image-dialog .area-settings table input[type=\"text\"] {\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.new-image-dialog .area-buttons {\n  align-self: end;\n  grid-area: buttons;\n}\n.new-image-dialog .area-buttons button {\n  width: 100%;\n  margin-top: .5em;\n}\n.new-image-dialog .upload {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  cursor: pointer;\n}\n.new-image-dialog .upload .btn {\n  position: absolute;\n  top: 50%;\n  transform: translate(-50%,-50%);\n}\n.area-image .drop-target {\n  display: none;\n}\n.area-image.droppable .drop-target {\n  pointer-events: none;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 3;\n}\n</style>\n","<template>\n  <overlay class=\"edit-image-dialog\">\n    <template v-slot:default>\n      <div class=\"area-image\">\n        <div class=\"has-image\">\n          <responsive-image :src=\"image.url\" :title=\"image.title\" />\n        </div>\n      </div>\n\n      <div class=\"area-settings\">\n        <table>\n          <tr>\n            <td><label>Title</label></td>\n            <td><input type=\"text\" v-model=\"title\" placeholder=\"Flower by @artist\" /></td>\n          </tr>\n          <tr>\n            <td colspan=\"2\">\n              <div class=\"hint\">Feel free to leave a credit to the artist/photographer in the title :)</div>\n            </td>\n          </tr>\n          <tr>\n            <!-- TODO: autocomplete tags -->\n            <td><label>Tags</label></td>\n            <td>\n              <tags-input v-model=\"tags\" :autocompleteTags=\"autocompleteTags\" />\n            </td>\n          </tr>\n        </table>\n      </div>\n\n      <div class=\"area-buttons\">\n        <button class=\"btn\" @click=\"saveImage\">üñºÔ∏è Save image</button>\n      </div>\n    </template>\n  </overlay>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport { Image, Tag } from '../../common/Types'\n\nexport default defineComponent({\n  props: {\n    image: {\n      type: Object as PropType<Image>,\n      required: true,\n    },\n    autocompleteTags: {\n      type: Function,\n    },\n  },\n  emits: {\n    saveClick: null,\n  },\n  data () {\n    return {\n      title: '',\n      tags: [] as string[],\n    }\n  },\n  created () {\n    this.title = this.image.title\n    this.tags = this.image.tags.map((t: Tag) => t.title)\n  },\n  methods: {\n    saveImage () {\n      this.$emit('saveClick', {\n        id: this.image.id,\n        title: this.title,\n        tags: this.tags,\n      })\n    },\n  },\n})\n</script>\n\n// TODO: scoped vs .edit-image-dialog\n<style>\n.edit-image-dialog .overlay-content {\n  display: grid;\n  grid-template-columns: auto 450px;\n  grid-template-rows: auto;\n  grid-template-areas:\n    \"image settings\"\n    \"image buttons\";\n  height: 90%;\n  width: 80%;\n}\n@media (max-width: 1400px) and (min-height: 720px),\n       (max-width: 1000px) {\n  .edit-image-dialog .overlay-content {\n    grid-template-columns: auto;\n    grid-template-rows: 1fr min-content min-content;\n    grid-template-areas:\n      \"image\"\n      \"settings\"\n      \"buttons\";\n  }\n}\n.edit-image-dialog .area-image {\n  grid-area: image;\n  margin: 20px;\n}\n.edit-image-dialog .area-image.no-image {\n  align-content: center;\n  display: grid;\n  text-align: center;\n  border: dashed 6px;\n  position: relative;\n}\n.edit-image-dialog .area-image .has-image {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n.edit-image-dialog .area-image .has-image .remove {\n  position: absolute;\n  top: .5em;\n  left: .5em;\n}\n\n.edit-image-dialog .area-settings {\n  grid-area: settings;\n}\n\n.edit-image-dialog .area-settings table input[type=\"text\"] {\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.edit-image-dialog .area-buttons {\n  align-self: end;\n  grid-area: buttons;\n}\n.edit-image-dialog .area-buttons button {\n  width: 100%;\n  margin-top: .5em;\n}\n</style>\n","import { Point } from \"./Geometry\"\nimport { Rng, RngSerialized } from \"./Rng\"\n\n// @see https://stackoverflow.com/a/59906630/392905\ntype ArrayLengthMutationKeys = 'splice' | 'push' | 'pop' | 'shift' | 'unshift' | number\ntype ArrayItems<T extends Array<any>> = T extends Array<infer TItems> ? TItems : never\nexport type FixedLengthArray<T extends any[]> =\n  Pick<T, Exclude<keyof T, ArrayLengthMutationKeys>>\n  & { [Symbol.iterator]: () => IterableIterator< ArrayItems<T> > }\n\nexport type Timestamp = number\n\nexport type Input = any\nexport type Change = Array<any>\n\nexport type GameEvent = Array<any>\n\nexport type ServerEvent = Array<any>\nexport type ClientEvent = Array<any>\n\nexport type EncodedPlayer = FixedLengthArray<[\n  string,\n  number,\n  number,\n  0|1,\n  string|null,\n  string|null,\n  string|null,\n  number,\n  Timestamp,\n]>\n\nexport type EncodedPiece = FixedLengthArray<[\n  number,\n  number,\n  number,\n  number,\n  string|number,\n  number,\n]>\n\nexport type EncodedPieceShape = number\n\nexport type EncodedGame = FixedLengthArray<[\n  string,\n  string,\n  RngSerialized,\n  Puzzle,\n  Array<EncodedPlayer>,\n  Record<string, EvtInfo>,\n  ScoreMode,\n  ShapeMode,\n  SnapMode,\n  number|null,\n]>\n\nexport interface ReplayData {\n  log: any[],\n  game: EncodedGame|null\n}\n\nexport interface Tag {\n  id: number\n  slug: string\n  title: string\n  total: number\n}\n\ninterface GameRng {\n  obj: Rng\n  type?: string\n}\n\nexport interface Game {\n  id: string\n  creatorUserId: number|null\n  players: Array<EncodedPlayer>\n  puzzle: Puzzle\n  evtInfos: Record<string, EvtInfo>\n  scoreMode: ScoreMode\n  shapeMode: ShapeMode\n  snapMode: SnapMode\n  rng: GameRng\n}\n\nexport interface Image {\n  id: number\n  filename: string\n  file: string\n  url: string\n  title: string\n  tags: Array<Tag>\n  created: number\n}\n\nexport interface GameSettings {\n  tiles: number\n  image: ImageInfo\n  scoreMode: ScoreMode\n  shapeMode: ShapeMode\n  snapMode: SnapMode\n}\n\nexport interface Puzzle {\n  tiles: Array<EncodedPiece>\n  data: PuzzleData\n  info: PuzzleInfo\n}\n\nexport interface PuzzleData {\n  started: number\n  finished: number\n  maxGroup: number\n  maxZ: number\n}\n\nexport interface PuzzleDataChange {\n  started?: number\n  finished?: number\n  maxGroup?: number\n  maxZ?: number\n}\n\ninterface PuzzleTable {\n  width: number\n  height: number\n}\n\nenum PieceEdge {\n  Flat = 0,\n  Out = 1,\n  In = -1,\n}\nexport interface PieceShape {\n  top: PieceEdge\n  bottom: PieceEdge\n  left: PieceEdge\n  right: PieceEdge\n}\n\nexport interface Piece {\n  owner: string|number\n  idx: number\n  pos: Point\n  z: number\n  group: number\n}\n\nexport interface PieceChange {\n  owner?: string|number\n  idx?: number\n  pos?: Point\n  z?: number\n  group?: number\n}\n\nexport interface ImageInfo\n{\n  id: number\n  uploaderUserId: number|null\n  filename: string\n  url: string\n  title: string\n  tags: Tag[]\n  created: Timestamp\n  width: number\n  height: number\n}\n\nexport interface PuzzleInfo {\n  table: PuzzleTable\n  targetTiles: number\n  imageUrl?: string // deprecated, use image.url instead\n  image?: ImageInfo\n\n  width: number\n  height: number\n  tileSize: number\n  tileDrawSize: number\n  tileMarginWidth: number\n  tileDrawOffset: number\n  snapDistance: number\n\n  tiles: number\n  tilesX: number\n  tilesY: number\n\n  shapes: Array<EncodedPieceShape>\n}\n\nexport interface Player {\n  id: string\n  x: number\n  y: number\n  d: 0|1\n  name: string|null\n  color: string|null\n  bgcolor: string|null\n  points: number\n  ts: Timestamp\n}\n\nexport interface PuzzleStatus {\n  finished: boolean\n  duration: number\n  piecesDone: number\n  piecesTotal: number\n}\n\nexport interface PlayerChange {\n  id?: string\n  x?: number\n  y?: number\n  d?: 0|1\n  name?: string|null\n  color?: string|null\n  bgcolor?: string|null\n  points?: number\n  ts?: Timestamp\n}\n\nexport interface EvtInfo {\n  _last_mouse: Point|null\n  _last_mouse_down: Point|null\n}\n\nexport enum ScoreMode {\n  FINAL = 0,\n  ANY = 1,\n}\n\nexport enum ShapeMode {\n  NORMAL = 0,\n  ANY = 1,\n  FLAT = 2,\n}\n\nexport enum SnapMode {\n  NORMAL = 0,\n  REAL = 1,\n}\n\nexport const DefaultScoreMode = (v: any): ScoreMode => {\n  if (v === ScoreMode.FINAL || v === ScoreMode.ANY) {\n    return v\n  }\n  return ScoreMode.FINAL\n}\n\nexport const DefaultShapeMode = (v: any): ShapeMode => {\n  if (v === ShapeMode.NORMAL || v === ShapeMode.ANY || v === ShapeMode.FLAT) {\n    return v\n  }\n  return ShapeMode.NORMAL\n}\n\nexport const DefaultSnapMode = (v: any): SnapMode => {\n  if (v === SnapMode.NORMAL || v === SnapMode.REAL) {\n    return v\n  }\n  return SnapMode.NORMAL\n}\n","<template>\n  <overlay class=\"new-game-dialog\">\n    <template v-slot:default>\n      <div class=\"area-image\">\n        <div class=\"has-image\">\n          <responsive-image :src=\"image.url\" :title=\"image.title\" />\n        </div>\n        <div class=\"image-title\" v-if=\"image.title || image.width || image.height\">\n          <span class=\"image-title-title\" v-if=\"image.title\">\"{{image.title}}\"</span>\n          <span class=\"image-title-dim\" v-if=\"image.width || image.height\">({{image.width}} ‚úï {{image.height}})</span>\n        </div>\n      </div>\n\n      <div class=\"area-settings\">\n        <table>\n          <tr>\n            <td><label>Pieces</label></td>\n            <td><input type=\"text\" v-model=\"tiles\" /></td>\n          </tr>\n          <tr>\n            <td><label>Scoring: </label></td>\n            <td>\n              <label><input type=\"radio\" v-model=\"scoreMode\" value=\"1\" />\n              Any (Score when pieces are connected to each other or on final location)</label>\n              <br />\n              <label><input type=\"radio\" v-model=\"scoreMode\" value=\"0\" />\n              Final (Score when pieces are put to their final location)</label>\n            </td>\n          </tr>\n          <tr>\n            <td><label>Shapes: </label></td>\n            <td>\n              <label><input type=\"radio\" v-model=\"shapeMode\" value=\"0\" />\n              Normal</label>\n              <br />\n              <label><input type=\"radio\" v-model=\"shapeMode\" value=\"1\" />\n              Any (Flat pieces can occur anywhere)</label>\n              <br />\n              <label><input type=\"radio\" v-model=\"shapeMode\" value=\"2\" />\n              Flat (All pieces flat on all sides)</label>\n            </td>\n          </tr>\n          <tr>\n            <td><label>Snapping: </label></td>\n            <td>\n              <label><input type=\"radio\" v-model=\"snapMode\" value=\"0\" />\n              Normal (Pieces snap to final destination and to each other)</label>\n              <br />\n              <label><input type=\"radio\" v-model=\"snapMode\" value=\"1\" />\n              Real (Pieces snap only to corners, already snapped pieces and to each other)</label>\n            </td>\n          </tr>\n        </table>\n      </div>\n\n      <div class=\"area-buttons\">\n        <button class=\"btn\" :disabled=\"!canStartNewGame\" @click=\"onNewGameClick\">\n          üß© Generate Puzzle\n        </button>\n      </div>\n    </template>\n  </overlay>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nimport { GameSettings, ScoreMode, ShapeMode, SnapMode } from './../../common/Types'\n\nexport default defineComponent({\n  props: {\n    image: {\n      type: Object,\n      required: true,\n    },\n  },\n  emits: {\n    newGame: null,\n  },\n  data() {\n    return {\n      tiles: 1000,\n      scoreMode: ScoreMode.ANY,\n      shapeMode: ShapeMode.NORMAL,\n      snapMode: SnapMode.NORMAL,\n    }\n  },\n  methods: {\n    onNewGameClick () {\n      this.$emit('newGame', {\n        tiles: this.tilesInt,\n        image: this.image,\n        scoreMode: this.scoreModeInt,\n        shapeMode: this.shapeModeInt,\n        snapMode: this.snapModeInt,\n      } as GameSettings)\n    },\n  },\n  computed: {\n    canStartNewGame () {\n      if (\n        !this.tilesInt\n        || !this.image\n        || !this.image.url\n        || ![0, 1].includes(this.scoreModeInt)\n      ) {\n        return false\n      }\n      return true\n    },\n    scoreModeInt (): number {\n      return parseInt(`${this.scoreMode}`, 10)\n    },\n    shapeModeInt (): number {\n      return parseInt(`${this.shapeMode}`, 10)\n    },\n    snapModeInt (): number {\n      return parseInt(`${this.snapMode}`, 10)\n    },\n    tilesInt (): number {\n      return parseInt(`${this.tiles}`, 10)\n    },\n  },\n})\n</script>\n\n\n// TODO: scoped vs .new-game-dialog\n<style>\n.new-game-dialog .overlay-content {\n  display: grid;\n  grid-template-columns: auto 450px;\n  grid-template-rows: auto;\n  grid-template-areas:\n    \"image settings\"\n    \"image buttons\";\n  height: 90%;\n  width: 80%;\n}\n.new-game-dialog .area-image {\n  grid-area: image;\n  display: grid;\n  grid-template-rows: 1fr min-content;\n  grid-template-areas:\n    \"image\"\n    \"image-title\";\n  margin-right: 1em;\n}\n@media (max-width: 1400px) and (min-height: 720px),\n       (max-width: 1000px) {\n  .new-game-dialog .overlay-content {\n    grid-template-columns: auto;\n    grid-template-rows: 1fr min-content min-content;\n    grid-template-areas:\n      \"image\"\n      \"settings\"\n      \"buttons\";\n  }\n  .new-game-dialog .area-image {\n    margin-right: 0;\n  }\n}\n.new-game-dialog .area-settings {\n  grid-area: settings;\n}\n.new-game-dialog .area-settings table input[type=\"text\"] {\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.new-game-dialog .area-buttons {\n  align-self: end;\n  grid-area: buttons;\n}\n.new-game-dialog .area-buttons button {\n  width: 100%;\n}\n.new-game-dialog .has-image {\n  box-sizing: border-box;\n  grid-area: image;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  border: solid 1px;\n}\n\n.new-game-dialog .image-title {\n  grid-area: image-title;\n  text-align: center;\n  padding: .5em 0;\n  background: var(--main-color);\n  color: #262523;\n}\n\n.new-game-dialog .has-image .remove {\n  position: absolute;\n  top: .5em;\n  left: .5em;\n}\n\n.new-game-dialog .image-title > span { margin-right: .5em; }\n.new-game-dialog .image-title > span:last-child { margin-right: 0; }\n.image-title-dim { display: inline-block; white-space: no-wrap; }\n</style>\n","\"New Game\" page: Upload button big, centered, at the top of the page, as\nvisible as possible. Upload button has a warning that the image will\nbe added to public gallery, just so noone uploads anything naughty on\naccident. The page can show all the images by default, or one of the categories\nof images. Instead of categories, you can make the system tag-based, like\nin jigsawpuzzles.io\n\n<template>\n  <div>\n    <div class=\"upload-image-teaser\">\n      <div class=\"btn btn-big\" @click=\"dialog='new-image'\">Upload your image</div>\n      <div class=\"hint\">(The image you upload will be added to the public gallery.)</div>\n    </div>\n\n    <div>\n      <label v-if=\"tags.length > 0\">\n        Tags:\n        <span\n          class=\"bit\"\n          v-for=\"(t,idx) in relevantTags\"\n          :key=\"idx\"\n          @click=\"toggleTag(t)\"\n          :class=\"{on: filters.tags.includes(t.slug)}\">{{t.title}} ({{t.total}})</span>\n        <!-- <select v-model=\"filters.tags\" @change=\"filtersChanged\">\n          <option value=\"\">All</option>\n          <option v-for=\"(c, idx) in tags\" :key=\"idx\" :value=\"c.slug\">{{c.title}}</option>\n        </select> -->\n      </label>\n      <label>\n        Sort by:\n        <select v-model=\"filters.sort\" @change=\"filtersChanged\">\n          <option value=\"date_desc\">Newest first</option>\n          <option value=\"date_asc\">Oldest first</option>\n          <option value=\"alpha_asc\">A-Z</option>\n          <option value=\"alpha_desc\">Z-A</option>\n        </select>\n      </label>\n    </div>\n    <image-library\n      :images=\"images\"\n      @imageClicked=\"onImageClicked\"\n      @imageEditClicked=\"onImageEditClicked\" />\n    <new-image-dialog\n      v-show=\"dialog==='new-image'\"\n      :autocompleteTags=\"autocompleteTags\"\n      @bgclick=\"dialog=''\"\n      :uploadProgress=\"uploadProgress\"\n      :uploading=\"uploading\"\n      @postToGalleryClick=\"postToGalleryClick\"\n      @setupGameClick=\"setupGameClick\"\n      />\n    <edit-image-dialog\n      v-show=\"dialog==='edit-image'\"\n      :autocompleteTags=\"autocompleteTags\"\n      @bgclick=\"dialog=''\"\n      @saveClick=\"onSaveImageClick\"\n      :image=\"image\" />\n    <new-game-dialog\n      v-show=\"image && dialog==='new-game'\"\n      @bgclick=\"dialog=''\"\n      @newGame=\"onNewGame\"\n      :image=\"image\" />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nimport ImageLibrary from './../components/ImageLibrary.vue'\nimport NewImageDialog from './../components/NewImageDialog.vue'\nimport EditImageDialog from './../components/EditImageDialog.vue'\nimport NewGameDialog from './../components/NewGameDialog.vue'\nimport { GameSettings, Image, Tag } from '../../common/Types'\nimport Util from '../../common/Util'\nimport xhr from '../xhr'\n\nexport default defineComponent({\n  components: {\n    ImageLibrary,\n    NewImageDialog,\n    EditImageDialog,\n    NewGameDialog,\n  },\n  data() {\n    return {\n      filters: {\n        sort: 'date_desc',\n        tags: [] as string[],\n      },\n      images: [],\n      tags: [] as Tag[],\n\n      image: {\n        id: 0,\n        filename: '',\n        file: '',\n        url: '',\n        title: '',\n        tags: [],\n        created: 0,\n      } as Image,\n\n      dialog: '',\n\n      uploading: '',\n      uploadProgress: 0,\n    }\n  },\n  async created() {\n    await this.loadImages()\n  },\n  computed: {\n    relevantTags (): Tag[] {\n      return this.tags.filter((tag: Tag) => tag.total > 0)\n    },\n  },\n  methods: {\n    autocompleteTags (input: string, exclude: string[]): string[] {\n      return this.tags\n        .filter((tag: Tag) => {\n          return !exclude.includes(tag.title)\n            && tag.title.toLowerCase().startsWith(input.toLowerCase())\n        })\n        .slice(0, 10)\n        .map((tag: Tag) => tag.title)\n    },\n    toggleTag (t: Tag) {\n      if (this.filters.tags.includes(t.slug)) {\n        this.filters.tags = this.filters.tags.filter(slug => slug !== t.slug)\n      } else {\n        this.filters.tags.push(t.slug)\n      }\n      this.filtersChanged()\n    },\n    async loadImages () {\n      const res = await xhr.get(`/api/newgame-data${Util.asQueryArgs(this.filters)}`, {})\n      const json = await res.json()\n      this.images = json.images\n      this.tags = json.tags\n    },\n    async filtersChanged () {\n      await this.loadImages()\n    },\n    onImageClicked (image: Image) {\n      this.image = image\n      this.dialog = 'new-game'\n    },\n    onImageEditClicked (image: Image) {\n      this.image = image\n      this.dialog = 'edit-image'\n    },\n    async uploadImage (data: any) {\n      this.uploadProgress = 0\n      const formData = new FormData();\n      formData.append('file', data.file, data.file.name);\n      formData.append('title', data.title)\n      formData.append('tags', data.tags)\n      const res = await xhr.post('/api/upload', {\n        body: formData,\n        onUploadProgress: (evt: ProgressEvent<XMLHttpRequestEventTarget>): void => {\n          this.uploadProgress = evt.loaded / evt.total\n        },\n      })\n      this.uploadProgress = 1\n      return await res.json()\n    },\n    async saveImage (data: any) {\n      const res = await xhr.post('/api/save-image', {\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          id: data.id,\n          title: data.title,\n          tags: data.tags,\n        }),\n      })\n      return await res.json()\n    },\n    async onSaveImageClick(data: any) {\n      const res = await this.saveImage(data)\n      if (res.ok) {\n        this.dialog = ''\n        await this.loadImages()\n      } else {\n        alert(res.error)\n      }\n    },\n    async postToGalleryClick(data: any) {\n      this.uploading = 'postToGallery'\n      await this.uploadImage(data)\n      this.uploading = ''\n      this.dialog = ''\n      await this.loadImages()\n    },\n    async setupGameClick (data: any) {\n      this.uploading = 'setupGame'\n      const image = await this.uploadImage(data)\n      this.uploading = ''\n      this.loadImages() // load images in background\n      this.image = image\n      this.dialog = 'new-game'\n    },\n    async onNewGame(gameSettings: GameSettings) {\n      const res = await xhr.post('/api/newgame', {\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(gameSettings),\n      })\n      if (res.status === 200) {\n        const game = await res.json()\n        this.$router.push({ name: 'game', params: { id: game.id } })\n      }\n    },\n  },\n})\n</script>\n","<template>\n  <div class=\"scores\">\n    <div>Scores</div>\n    <table>\n      <tr v-for=\"(p, idx) in actives\" :key=\"idx\" :style=\"{color: p.color}\">\n        <td>‚ö°</td>\n        <td>{{p.name}}</td>\n        <td>{{p.points}}</td>\n      </tr>\n      <tr v-for=\"(p, idx) in idles\" :key=\"idx\" :style=\"{color: p.color}\">\n        <td>üí§</td>\n        <td>{{p.name}}</td>\n        <td>{{p.points}}</td>\n      </tr>\n    </table>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: {\n    players: {\n      type: Object,\n      required: true,\n    },\n  },\n  computed: {\n    actives (): Array<any> {\n      // TODO: dont sort in place\n      this.players.active.sort((a: any, b: any) => b.points - a.points)\n      return this.players.active\n    },\n    idles (): Array<any> {\n      // TODO: dont sort in place\n      this.players.idle.sort((a: any, b: any) => b.points - a.points)\n      return this.players.idle\n    },\n  },\n})\n</script>\n","<template>\n  <div class=\"puzzle-status\">\n    <div>\n      üß© {{status.piecesDone}}/{{status.piecesTotal}}\n    </div>\n    <div>\n      {{icon}} {{durationStr}}\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport { PuzzleStatus } from '../../common/Types'\nimport Time from './../../common/Time'\n\nexport default defineComponent({\n  props: {\n    status: {\n      type: Object as PropType<PuzzleStatus>,\n      required: true,\n    },\n  },\n  computed: {\n    icon (): string {\n      return this.status.finished ? 'üèÅ' : '‚è≥'\n    },\n    durationStr (): string {\n      return Time.durationStr(this.status.duration)\n    },\n  }\n})\n</script>\n","<template>\n  <overlay class=\"transparent\">\n    <template v-slot:default>\n      <table class=\"settings\">\n        <tr>\n          <td><label>Background: </label></td>\n          <td><input type=\"color\" v-model=\"modelValue.background\" /></td>\n        </tr>\n        <tr>\n          <td><label>Color: </label></td>\n          <td><input type=\"color\" v-model=\"modelValue.color\" /></td>\n        </tr>\n        <tr>\n          <td><label>Name: </label></td>\n          <td><input type=\"text\" maxLength=\"16\" v-model=\"modelValue.name\" /></td>\n        </tr>\n        <tr>\n          <td><label>Sounds: </label></td>\n          <td><input type=\"checkbox\" v-model=\"modelValue.soundsEnabled\" /></td>\n        </tr>\n        <tr>\n          <td><label>Sounds Volume: </label></td>\n          <td class=\"sound-volume\">\n            <span @click=\"decreaseVolume\">üîâ</span>\n            <input\n              type=\"range\"\n              min=\"0\"\n              max=\"100\"\n              :value=\"modelValue.soundsVolume\"\n              @change=\"updateVolume\"\n              />\n            <span @click=\"increaseVolume\">üîä</span>\n          </td>\n        </tr>\n        <tr>\n          <td><label>Show player names: </label></td>\n          <td><input type=\"checkbox\" v-model=\"modelValue.showPlayerNames\" /></td>\n        </tr>\n      </table>\n    </template>\n  </overlay>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  emits: {\n    'update:modelValue': null,\n  },\n  props: {\n    modelValue: {\n      type: Object,\n      required: true,\n    },\n  },\n  methods: {\n    updateVolume (ev: Event): void {\n      (this.modelValue as any).soundsVolume = (ev.target as HTMLInputElement).value\n    },\n    decreaseVolume (): void {\n      const vol = parseInt(this.modelValue.soundsVolume, 10) - 5\n      this.modelValue.soundsVolume = Math.max(0, vol)\n    },\n    increaseVolume (): void {\n      const vol = parseInt(this.modelValue.soundsVolume, 10) + 5\n      this.modelValue.soundsVolume = Math.min(100, vol)\n    },\n  },\n  created () {\n    // TODO: ts type PlayerSettings\n    this.$watch('modelValue', (val: any) => {\n      this.$emit('update:modelValue', val)\n    }, { deep: true })\n  },\n})\n</script>\n<style scoped>\n.sound-volume span { cursor: pointer; user-select: none; }\n.sound-volume input { vertical-align: middle; }\n</style>\n","<template>\n  <overlay class=\"preview-overlay\" :animate=\"false\">\n    <template v-slot:default>\n      <div class=\"preview\">\n        <div class=\"img\" :style=\"previewStyle\"></div>\n      </div>\n    </template>\n  </overlay>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: {\n    img: String,\n  },\n  computed: {\n    previewStyle (): object {\n      return {\n        backgroundImage: `url('${this.img}')`,\n      }\n    },\n  },\n})\n</script>\n","<template>\n  <overlay class=\"transparent\">\n    <template v-slot:default>\n      <table class=\"help\">\n        <tr>\n          <td colspan=\"2\">Info about this puzzle</td>\n        </tr>\n        <tr>\n          <td>Image Title: </td>\n          <td>{{game.puzzle.info.image.title}}</td>\n        </tr>\n        <tr>\n          <td>Scoring: </td>\n          <td><span :title=\"snapMode[1]\">{{scoreMode[0]}}</span></td>\n        </tr>\n        <tr>\n          <td>Shapes: </td>\n          <td><span :title=\"snapMode[1]\">{{shapeMode[0]}}</span></td>\n        </tr>\n        <tr>\n          <td>Snapping: </td>\n          <td><span :title=\"snapMode[1]\">{{snapMode[0]}}</span></td>\n        </tr>\n      </table>\n    </template>\n  </overlay>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\nimport { Game, ScoreMode, ShapeMode, SnapMode } from '../../common/Types'\n\nexport default defineComponent({\n  props: {\n    game: {\n      type: Object as PropType<Game>,\n      required: true,\n    },\n  },\n  computed: {\n    scoreMode () {\n      switch (this.game.scoreMode) {\n        case ScoreMode.ANY: return ['Any', 'Score when pieces are connected to each other or on final location']\n        case ScoreMode.FINAL:\n        default: return ['Final', 'Score when pieces are put to their final location']\n      }\n    },\n    shapeMode () {\n      switch (this.game.shapeMode) {\n        case ShapeMode.FLAT: return ['Flat', 'All pieces flat on all sides']\n        case ShapeMode.ANY: return ['Any', 'Flat pieces can occur anywhere']\n        case ShapeMode.NORMAL:\n        default:\n          return ['Normal', '']\n      }\n    },\n    snapMode () {\n      switch (this.game.snapMode) {\n        case SnapMode.REAL: return ['Real', 'Pieces snap only to corners, already snapped pieces and to each other']\n        case SnapMode.NORMAL:\n        default:\n          return ['Normal', 'Pieces snap to final destination and to each other']\n      }\n    },\n  },\n})\n</script>\n","/*\nSERVER_CLIENT_MESSAGE_PROTOCOL\nNOTE: clients always send game id and their id\n      when creating sockets (via socket.protocol), so\n      this doesn't need to be set in each message data\n\nNOTE: first value in the array is always the type of event/message\n      when describing them below, the value each has is used\n      instead of writing EVENT_TYPE or something ismilar\n\n\nEV_CLIENT_EVENT: event triggered by clients and sent to server\n[\n  EV_CLIENT_EVENT, // constant value, type of event\n  CLIENT_SEQ, // sequence number sent by client.\n  EV_DATA, // (eg. mouse input info)\n]\n\nEV_SERVER_EVENT: event sent to clients after recieving a client\n                 event and processing it\n[\n  EV_SERVER_EVENT, // constant value, type of event\n  CLIENT_ID, // user who sent the client event\n  CLIENT_SEQ, // sequence number of the client event msg\n  CHANGES_TRIGGERED_BY_CLIENT_EVENT,\n]\n\nEV_CLIENT_INIT: event sent by client to enter a game\n[\n  EV_CLIENT_INIT, // constant value, type of event\n]\n\nEV_SERVER_INIT: event sent to one client after that client\n                connects to a game\n[\n  EV_SERVER_INIT, // constant value, type of event\n  GAME, // complete game instance required by\n        // client to build client side of the game\n]\n*/\nconst EV_SERVER_EVENT = 1\nconst EV_SERVER_INIT = 4\nconst EV_CLIENT_EVENT = 2\nconst EV_CLIENT_INIT = 3\n\nconst LOG_HEADER = 1\nconst LOG_ADD_PLAYER = 2\nconst LOG_UPDATE_PLAYER = 4\nconst LOG_HANDLE_INPUT = 3\n\nconst INPUT_EV_MOUSE_DOWN = 1\nconst INPUT_EV_MOUSE_UP = 2\nconst INPUT_EV_MOUSE_MOVE = 3\nconst INPUT_EV_ZOOM_IN = 4\nconst INPUT_EV_ZOOM_OUT = 5\nconst INPUT_EV_BG_COLOR = 6\nconst INPUT_EV_PLAYER_COLOR = 7\nconst INPUT_EV_PLAYER_NAME = 8\nconst INPUT_EV_MOVE = 9\nconst INPUT_EV_TOGGLE_PREVIEW = 10\nconst INPUT_EV_TOGGLE_SOUNDS = 11\n\nconst INPUT_EV_REPLAY_TOGGLE_PAUSE = 12\nconst INPUT_EV_REPLAY_SPEED_UP = 13\nconst INPUT_EV_REPLAY_SPEED_DOWN = 14\n\nconst INPUT_EV_TOGGLE_PLAYER_NAMES = 15\nconst INPUT_EV_CENTER_FIT_PUZZLE = 16\n\nconst INPUT_EV_TOGGLE_FIXED_PIECES = 17\nconst INPUT_EV_TOGGLE_LOOSE_PIECES = 18\n\nconst INPUT_EV_STORE_POS = 19\nconst INPUT_EV_RESTORE_POS = 20\n\nconst INPUT_EV_CONNECTION_CLOSE = 21\n\nconst CHANGE_DATA = 1\nconst CHANGE_TILE = 2\nconst CHANGE_PLAYER = 3\n\nexport default {\n  EV_SERVER_EVENT,\n  EV_SERVER_INIT,\n  EV_CLIENT_EVENT,\n  EV_CLIENT_INIT,\n\n  LOG_HEADER,\n  LOG_ADD_PLAYER,\n  LOG_UPDATE_PLAYER,\n  LOG_HANDLE_INPUT,\n\n  INPUT_EV_MOVE, // move by x/y\n\n  INPUT_EV_MOUSE_DOWN,\n  INPUT_EV_MOUSE_UP,\n  INPUT_EV_MOUSE_MOVE,\n\n  INPUT_EV_ZOOM_IN,\n  INPUT_EV_ZOOM_OUT,\n  INPUT_EV_BG_COLOR,\n  INPUT_EV_PLAYER_COLOR,\n  INPUT_EV_PLAYER_NAME,\n\n  INPUT_EV_TOGGLE_PREVIEW,\n  INPUT_EV_TOGGLE_SOUNDS,\n\n  INPUT_EV_REPLAY_TOGGLE_PAUSE,\n  INPUT_EV_REPLAY_SPEED_UP,\n  INPUT_EV_REPLAY_SPEED_DOWN,\n\n  INPUT_EV_TOGGLE_PLAYER_NAMES,\n  INPUT_EV_CENTER_FIT_PUZZLE,\n\n  INPUT_EV_TOGGLE_FIXED_PIECES,\n  INPUT_EV_TOGGLE_LOOSE_PIECES,\n\n  INPUT_EV_STORE_POS,\n  INPUT_EV_RESTORE_POS,\n\n  INPUT_EV_CONNECTION_CLOSE,\n\n  CHANGE_DATA,\n  CHANGE_TILE,\n  CHANGE_PLAYER,\n}\n","\"use strict\"\n\nimport { ClientEvent, EncodedGame, GameEvent, ReplayData, ServerEvent } from '../common/Types'\nimport Util, { logger } from '../common/Util'\nimport Protocol from './../common/Protocol'\nimport xhr from './xhr'\n\nconst log = logger('Communication.js')\n\nconst CODE_GOING_AWAY = 1001\nconst CODE_CUSTOM_DISCONNECT = 4000\n\nconst CONN_STATE_NOT_CONNECTED = 0 // not connected yet\nconst CONN_STATE_DISCONNECTED = 1 // not connected, but was connected before\nconst CONN_STATE_CONNECTED = 2 // connected\nconst CONN_STATE_CONNECTING = 3 // connecting\nconst CONN_STATE_CLOSED = 4 // not connected (closed on purpose)\n\nlet ws: WebSocket\n\nlet missedMessages: ServerEvent[] = []\nlet changesCallback = (msg: ServerEvent) => {\n  missedMessages.push(msg)\n}\n\nlet missedStateChanges: Array<number> = []\nlet connectionStateChangeCallback = (state: number) => {\n  missedStateChanges.push(state)\n}\n\nfunction onServerChange(callback: (msg: ServerEvent) => void): void {\n  changesCallback = callback\n  for (const missedMessage of missedMessages) {\n    changesCallback(missedMessage)\n  }\n  missedMessages = []\n}\n\nfunction onConnectionStateChange(callback: (state: number) => void): void {\n  connectionStateChangeCallback = callback\n  for (const missedStateChange of missedStateChanges) {\n    connectionStateChangeCallback(missedStateChange)\n  }\n  missedStateChanges = []\n}\n\nlet connectionState = CONN_STATE_NOT_CONNECTED\nconst setConnectionState = (state: number): void => {\n  if (connectionState !== state) {\n    connectionState = state\n    connectionStateChangeCallback(state)\n  }\n}\nfunction send(message: ClientEvent): void {\n  if (connectionState === CONN_STATE_CONNECTED) {\n    try {\n      ws.send(JSON.stringify(message))\n    } catch (e) {\n      log.info('unable to send message.. maybe because ws is invalid?')\n    }\n  }\n}\n\nlet clientSeq: number\nlet events: Record<number, GameEvent>\n\nfunction connect(\n  address: string,\n  gameId: string,\n  clientId: string\n): Promise<EncodedGame> {\n  clientSeq = 0\n  events = {}\n  setConnectionState(CONN_STATE_CONNECTING)\n  return new Promise(resolve => {\n    ws = new WebSocket(address, clientId + '|' + gameId)\n    ws.onopen = () => {\n      setConnectionState(CONN_STATE_CONNECTED)\n      send([Protocol.EV_CLIENT_INIT])\n    }\n    ws.onmessage = (e: MessageEvent) => {\n      const msg: ServerEvent = JSON.parse(e.data)\n      const msgType = msg[0]\n      if (msgType === Protocol.EV_SERVER_INIT) {\n        const game = msg[1]\n        resolve(game)\n      } else if (msgType === Protocol.EV_SERVER_EVENT) {\n        const msgClientId = msg[1]\n        const msgClientSeq = msg[2]\n        if (msgClientId === clientId && events[msgClientSeq]) {\n          delete events[msgClientSeq]\n          // we have already calculated that change locally. probably\n          return\n        }\n        changesCallback(msg)\n      } else {\n        throw `[ 2021-05-09 invalid connect msgType ${msgType} ]`\n      }\n    }\n\n    ws.onerror = () => {\n      setConnectionState(CONN_STATE_DISCONNECTED)\n      throw `[ 2021-05-15 onerror ]`\n    }\n\n    ws.onclose = (e: CloseEvent) => {\n      if (e.code === CODE_CUSTOM_DISCONNECT || e.code === CODE_GOING_AWAY) {\n        setConnectionState(CONN_STATE_CLOSED)\n      } else {\n        setConnectionState(CONN_STATE_DISCONNECTED)\n      }\n    }\n  })\n}\n\nasync function requestReplayData(\n  gameId: string,\n  offset: number\n): Promise<ReplayData> {\n  const args = { gameId, offset }\n  const res = await xhr.get(`/api/replay-data${Util.asQueryArgs(args)}`, {})\n  const json: ReplayData = await res.json()\n  return json\n}\n\nfunction disconnect(): void {\n  if (ws) {\n    ws.close(CODE_CUSTOM_DISCONNECT)\n  }\n  clientSeq = 0\n  events = {}\n}\n\nfunction sendClientEvent(evt: GameEvent): void {\n  // when sending event, increase number of sent events\n  // and add the event locally\n  clientSeq++;\n  events[clientSeq] = evt\n  send([Protocol.EV_CLIENT_EVENT, clientSeq, events[clientSeq]])\n}\n\nexport default {\n  connect,\n  requestReplayData,\n  disconnect,\n  sendClientEvent,\n  onServerChange,\n  onConnectionStateChange,\n  CODE_CUSTOM_DISCONNECT,\n\n  CONN_STATE_NOT_CONNECTED,\n  CONN_STATE_DISCONNECTED,\n  CONN_STATE_CLOSED,\n  CONN_STATE_CONNECTED,\n  CONN_STATE_CONNECTING,\n}\n","<template>\n  <overlay class=\"connection-lost\" v-show=\"show\">\n    <template v-slot:default>\n      <div v-if=\"lostConnection\">‚ÅâÔ∏è LOST CONNECTION ‚ÅâÔ∏è</div>\n      <span v-if=\"lostConnection\" class=\"btn\" @click=\"$emit('reconnect')\">Reconnect</span>\n      <div v-if=\"connecting\">Connecting...</div>\n    </template>\n  </overlay>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nimport Communication from './../Communication'\n\nexport default defineComponent({\n  emits: {\n    reconnect: null,\n  },\n  props: {\n    connectionState: Number,\n  },\n  computed: {\n    lostConnection (): boolean {\n      return this.connectionState === Communication.CONN_STATE_DISCONNECTED\n    },\n    connecting (): boolean {\n      return this.connectionState === Communication.CONN_STATE_CONNECTING\n    },\n    show (): boolean {\n      return !!(this.lostConnection || this.connecting)\n    },\n  }\n})\n</script>\n","<template>\n  <overlay class=\"transparent\">\n    <template v-slot:default>\n      <table class=\"help\">\n        <tr><td>‚¨ÜÔ∏è Move up:</td><td><div><kbd>W</kbd>/<kbd>‚Üë</kbd>/üñ±Ô∏è</div></td></tr>\n        <tr><td>‚¨áÔ∏è Move down:</td><td><div><kbd>S</kbd>/<kbd>‚Üì</kbd>/üñ±Ô∏è</div></td></tr>\n        <tr><td>‚¨ÖÔ∏è Move left:</td><td><div><kbd>A</kbd>/<kbd>‚Üê</kbd>/üñ±Ô∏è</div></td></tr>\n        <tr><td>‚û°Ô∏è Move right:</td><td><div><kbd>D</kbd>/<kbd>‚Üí</kbd>/üñ±Ô∏è</div></td></tr>\n        <tr><td></td><td><div>Move faster by holding <kbd>Shift</kbd></div></td></tr>\n\n        <tr><td>üîç+ Zoom in:</td><td><div><kbd>E</kbd>/üñ±Ô∏è-Wheel</div></td></tr>\n        <tr><td>üîç- Zoom out:</td><td><div><kbd>Q</kbd>/üñ±Ô∏è-Wheel</div></td></tr>\n        <tr><td>üñºÔ∏è Toggle preview:</td><td><div><kbd>Space</kbd></div></td></tr>\n        <tr><td>üéØ Center puzzle in screen:</td><td><div><kbd>C</kbd></div></td></tr>\n\n        <tr><td>üß©‚úîÔ∏è Toggle fixed pieces:</td><td><div><kbd>F</kbd></div></td></tr>\n        <tr><td>üß©‚ùì Toggle loose pieces:</td><td><div><kbd>G</kbd></div></td></tr>\n\n        <tr><td>üë§ Toggle player names:</td><td><div><kbd>N</kbd></div></td></tr>\n        <tr><td>üîâ Toggle sounds:</td><td><div><kbd>M</kbd></div></td></tr>\n\n        <tr><td>‚è´ Speed up (replay):</td><td><div><kbd>I</kbd></div></td></tr>\n        <tr><td>‚è¨ Speed down (replay):</td><td><div><kbd>O</kbd></div></td></tr>\n        <tr><td>‚è∏Ô∏è Pause (replay):</td><td><div><kbd>P</kbd></div></td></tr>\n      </table>\n    </template>\n  </overlay>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n})\n</script>\n","export default \"__VITE_ASSET__bb97cb07__\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAW0lEQVQ4je1RywrAIAxLxP//5exixRWlVgZelpOKeTQFfnDypgy3eLIkSLLL8mxGPoHsU2hPAgDHBLvRX6hZZw/fwT0BtlLSONqCbWAmEIqMZOCDDlaDR3N03gOyDCn+y4DWmAAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAARElEQVQ4jWNgGAU0Af+hmBCbgYGBgYERhwHEAEYGBgYGJtIdiApYyLAZBVDsAqoagC1ACQJyY4ERg0GCISh6KA4DigEAou8LC+LnIJoAAAAASUVORK5CYII=\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAcUlEQVQ4ja1TQQ7AIAgD///n7jCozA2Hbk00jbG1KIrcARszTugoBs49qioZj7r2kKACptkyAOCJsJuA+GzglwHjvMSSWFVaENWVASxh5eRLiq5fN/ASjI89VcP2K3hHpq1cEXNaMfnrL3TDZP2tDuoOA6MzCCXWr38AAAAASUVORK5CYII=\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAU0lEQVQ4jWNgoAH4D8X42HDARKlt5BoAd82AuQAOGLGIYQQUPv0wF5CiCQUge4EsQ5C9QI4BjMguwBYeBAElscCIy1ZivMKIwSDBEBQ9FCckigEAU3QOD7TGvY4AAAAASUVORK5CYII=\"","\"use strict\"\n\ninterface GameLoopOptions {\n  fps?: number\n  slow?: number\n  update: (step: number) => void\n  render: (passed: number) => void\n}\n\nexport interface GameLoopInstance {\n  stop: () => void\n}\n\nexport const run = (options: GameLoopOptions): GameLoopInstance => {\n  let stopped = false\n  const stop = () => {\n    stopped = true\n  }\n\n  const fps = options.fps || 60\n  const slow = options.slow || 1\n  const update = options.update\n  const render = options.render\n  const raf = window.requestAnimationFrame\n  const step = 1 / fps\n  const slowStep = slow * step\n\n  let now\n  let dt = 0\n  let last = window.performance.now()\n\n  const frame = () => {\n    now = window.performance.now()\n    dt = dt + Math.min(1, (now - last) / 1000) // duration capped at 1.0 seconds\n    while (dt > slowStep) {\n      dt = dt - slowStep\n      update(step)\n    }\n    render(dt / slow)\n    last = now\n    if (!stopped) {\n      raf(frame)\n    }\n  }\n\n  raf(frame)\n  return {\n    stop,\n  }\n}\n\nexport default {\n  run\n}\n","import { Dim, Point } from \"../common/Geometry\"\n\nconst MIN_ZOOM = .1\nconst MAX_ZOOM = 6\nconst ZOOM_STEP = .05\n\ntype ZOOM_DIR = 'in'|'out'\n\nexport interface Snapshot {\n  x: number\n  y: number\n  curZoom: number\n}\n\nexport default function Camera () {\n  let x = 0\n  let y = 0\n  let curZoom = 1\n\n  const snapshot = (): Snapshot => ({ x, y, curZoom })\n\n  const fromSnapshot = (snapshot: Snapshot) => {\n    x = snapshot.x\n    y = snapshot.y\n    curZoom = snapshot.curZoom\n  }\n\n  const reset = () => {\n    x = 0\n    y = 0\n    curZoom = 1\n  }\n\n  const move = (byX: number, byY: number) => {\n    x += byX / curZoom\n    y += byY / curZoom\n  }\n\n  const calculateNewZoom = (inout: ZOOM_DIR): number => {\n    const factor = inout === 'in' ? 1 : -1\n    const newzoom = curZoom + ZOOM_STEP * curZoom * factor\n    const capped = Math.min(Math.max(newzoom, MIN_ZOOM), MAX_ZOOM)\n    return capped\n  }\n\n  const canZoom = (inout: ZOOM_DIR): boolean => {\n    return curZoom != calculateNewZoom(inout)\n  }\n\n  const setZoom = (newzoom: number, viewportCoordCenter: Point): boolean => {\n    if (curZoom == newzoom) {\n      return false\n    }\n\n    const zoomFactor = 1 - (curZoom / newzoom)\n    move(\n      -viewportCoordCenter.x * zoomFactor,\n      -viewportCoordCenter.y * zoomFactor,\n    )\n    curZoom = newzoom\n    return true\n  }\n\n  /**\n   * Zooms towards/away from the provided coordinate, if possible.\n   * If at max or min zoom respectively, no zooming is performed.\n   */\n  const zoom = (inout: ZOOM_DIR, viewportCoordCenter: Point): boolean => {\n    return setZoom(calculateNewZoom(inout), viewportCoordCenter)\n  }\n\n  /**\n   * Translate a coordinate in the viewport to a\n   * coordinate in the world, rounded\n   * @param {x, y} viewportCoord\n   */\n  const viewportToWorld = (viewportCoord: Point): Point => {\n    const { x, y } = viewportToWorldRaw(viewportCoord)\n    return { x: Math.round(x), y: Math.round(y) }\n  }\n\n  /**\n   * Translate a coordinate in the viewport to a\n   * coordinate in the world, not rounded\n   * @param {x, y} viewportCoord\n   */\n  const viewportToWorldRaw = (viewportCoord: Point): Point => {\n    return {\n      x: (viewportCoord.x / curZoom) - x,\n      y: (viewportCoord.y / curZoom) - y,\n    }\n  }\n\n  /**\n   * Translate a coordinate in the world to a\n   * coordinate in the viewport, rounded\n   * @param {x, y} worldCoord\n   */\n  const worldToViewport = (worldCoord: Point): Point => {\n    const { x, y } = worldToViewportRaw(worldCoord)\n    return { x: Math.round(x), y: Math.round(y) }\n  }\n\n  /**\n   * Translate a coordinate in the world to a\n   * coordinate in the viewport, not rounded\n   * @param {x, y} worldCoord\n   */\n  const worldToViewportRaw = (worldCoord: Point): Point => {\n    return {\n      x: (worldCoord.x + x) * curZoom,\n      y: (worldCoord.y + y) * curZoom,\n    }\n  }\n\n  /**\n   * Translate a 2d dimension (width/height) in the world to\n   * one in the viewport, rounded\n   * @param {w, h} worldDim\n   */\n  const worldDimToViewport = (worldDim: Dim): Dim => {\n    const { w, h } = worldDimToViewportRaw(worldDim)\n    return { w: Math.round(w), h: Math.round(h) }\n  }\n\n\n  /**\n   * Translate a 2d dimension (width/height) in the world to\n   * one in the viewport, not rounded\n   * @param {w, h} worldDim\n   */\n  const worldDimToViewportRaw = (worldDim: Dim): Dim => {\n    return {\n      w: worldDim.w * curZoom,\n      h: worldDim.h * curZoom,\n    }\n  }\n\n  const viewportDimToWorld = (viewportDim: Dim): Dim => {\n    const { w, h } = viewportDimToWorldRaw(viewportDim)\n    return { w: Math.round(w), h: Math.round(h) }\n  }\n\n  const viewportDimToWorldRaw = (viewportDim: Dim): Dim => {\n    return {\n      w: viewportDim.w / curZoom,\n      h: viewportDim.h / curZoom,\n    }\n  }\n\n  return {\n    getCurrentZoom: () => curZoom,\n    reset,\n    move,\n    canZoom,\n    zoom,\n    setZoom,\n    worldToViewport,\n    worldToViewportRaw,\n    worldDimToViewport, // not used outside\n    worldDimToViewportRaw,\n    viewportToWorld,\n    viewportToWorldRaw, // not used outside\n    viewportDimToWorld,\n    viewportDimToWorldRaw,\n    snapshot,\n    fromSnapshot,\n  }\n}\n","\"use strict\"\n\nfunction createCanvas(width:number = 0, height:number = 0): HTMLCanvasElement {\n    const c = document.createElement('canvas')\n    c.width = width\n    c.height = height\n    return c\n}\n\nasync function loadImageToBitmap(imagePath: string): Promise<ImageBitmap> {\n  return new Promise((resolve) => {\n    const img = new Image()\n    img.onload = () => {\n      createImageBitmap(img).then(resolve)\n    }\n    img.src = imagePath\n  })\n}\n\nasync function resizeBitmap (\n  bitmap: ImageBitmap,\n  width: number,\n  height: number\n): Promise<ImageBitmap> {\n  const c = createCanvas(width, height)\n  const ctx = c.getContext('2d') as CanvasRenderingContext2D\n  ctx.drawImage(bitmap, 0, 0, bitmap.width, bitmap.height, 0, 0, width, height)\n  return await createImageBitmap(c)\n}\n\nfunction colorizedCanvas(\n  bitmap: ImageBitmap,\n  mask: ImageBitmap,\n  color: string,\n): HTMLCanvasElement {\n  const c = createCanvas(bitmap.width, bitmap.height)\n  const ctx = c.getContext('2d') as CanvasRenderingContext2D\n  ctx.save()\n  ctx.drawImage(mask, 0, 0)\n  ctx.fillStyle = color\n  ctx.globalCompositeOperation = \"source-in\"\n  ctx.fillRect(0, 0, mask.width, mask.height)\n  ctx.restore()\n  ctx.save()\n  ctx.globalCompositeOperation = \"destination-over\"\n  ctx.drawImage(bitmap, 0, 0)\n  ctx.restore()\n  return c\n}\n\nexport default {\n  createCanvas,\n  loadImageToBitmap,\n  resizeBitmap,\n  colorizedCanvas,\n}\n","\"use strict\"\n\nimport { logger } from '../common/Util'\n\nconst log = logger('Debug.js')\n\nlet _pt = 0\nlet _mindiff = 0\n\nconst checkpoint_start = (mindiff: number): void => {\n  _pt = performance.now()\n  _mindiff = mindiff\n}\n\nconst checkpoint = (label: string): void => {\n  const now = performance.now()\n  const diff = now - _pt\n  if (diff > _mindiff) {\n    log.log(label + ': ' + (diff))\n  }\n  _pt = now\n}\n\nexport default {\n  checkpoint_start,\n  checkpoint,\n}\n","export interface Point {\n  x: number\n  y: number\n}\n\nexport interface Rect {\n  x: number\n  y: number\n  w: number\n  h: number\n}\nexport interface Dim {\n  w: number\n  h: number\n}\n\nfunction pointSub(a: Point, b: Point): Point {\n  return { x: a.x - b.x, y: a.y - b.y }\n}\n\nfunction pointAdd(a: Point, b: Point): Point {\n  return { x: a.x + b.x, y: a.y + b.y }\n}\n\nfunction pointDistance(a: Point, b: Point): number {\n  const diffX = a.x - b.x\n  const diffY = a.y - b.y\n  return Math.sqrt(diffX * diffX + diffY * diffY)\n}\n\nfunction pointInBounds(pt: Point, rect: Rect): boolean {\n  return pt.x >= rect.x\n    && pt.x <= rect.x + rect.w\n    && pt.y >= rect.y\n    && pt.y <= rect.y + rect.h\n}\n\nfunction rectCenter(rect: Rect): Point {\n  return {\n    x: rect.x + (rect.w / 2),\n    y: rect.y + (rect.h / 2),\n  }\n}\n\n/**\n * Returns a rectangle with same dimensions as the given one, but\n * location (x/y) moved by x and y.\n *\n * @param {x, y, w,, h} rect\n * @param number x\n * @param number y\n * @returns {x, y, w, h}\n */\nfunction rectMoved(rect: Rect, x: number, y: number): Rect {\n  return {\n    x: rect.x + x,\n    y: rect.y + y,\n    w: rect.w,\n    h: rect.h,\n  }\n}\n\n/**\n * Returns true if the rectangles overlap, including their borders.\n *\n * @param {x, y, w, h} rectA\n * @param {x, y, w, h} rectB\n * @returns bool\n */\nfunction rectsOverlap(rectA: Rect, rectB: Rect): boolean {\n  return !(\n    rectB.x > (rectA.x + rectA.w)\n    || rectA.x > (rectB.x + rectB.w)\n    || rectB.y > (rectA.y + rectA.h)\n    || rectA.y > (rectB.y + rectB.h)\n  )\n}\n\nfunction rectCenterDistance(rectA: Rect, rectB: Rect): number {\n  return pointDistance(rectCenter(rectA), rectCenter(rectB))\n}\n\nexport default {\n  pointSub,\n  pointAdd,\n  pointDistance,\n  pointInBounds,\n  rectCenter,\n  rectMoved,\n  rectCenterDistance,\n  rectsOverlap,\n}\n","\"use strict\"\n\nimport Geometry, { Rect } from '../common/Geometry'\nimport Graphics from './Graphics'\nimport Util, { logger } from './../common/Util'\nimport { Puzzle, PuzzleInfo, PieceShape, EncodedPiece } from './../common/Types'\n\nconst log = logger('PuzzleGraphics.js')\n\nasync function createPuzzleTileBitmaps(\n  img: ImageBitmap,\n  pieces: EncodedPiece[],\n  info: PuzzleInfo\n): Promise<Array<ImageBitmap>> {\n  log.log('start createPuzzleTileBitmaps')\n  const tileSize = info.tileSize\n  const tileMarginWidth = info.tileMarginWidth\n  const tileDrawSize = info.tileDrawSize\n  const tileRatio = tileSize / 100.0\n\n  const curvyCoords = [\n    0, 0, 40, 15, 37, 5,\n    37, 5, 40, 0, 38, -5,\n    38, -5, 20, -20, 50, -20,\n    50, -20, 80, -20, 62, -5,\n    62, -5, 60, 0, 63, 5,\n    63, 5, 65, 15, 100, 0\n  ];\n\n  const bitmaps: Array<ImageBitmap> = new Array(pieces.length)\n\n  const paths: Record<string, Path2D> = {}\n  function pathForShape(shape: PieceShape) {\n    const key = `${shape.top}${shape.right}${shape.left}${shape.bottom}`\n    if (paths[key]) {\n      return paths[key]\n    }\n\n    const path = new Path2D()\n    const topLeftEdge = { x: tileMarginWidth, y: tileMarginWidth }\n    const topRightEdge = Geometry.pointAdd(topLeftEdge, { x: tileSize, y: 0 })\n    const bottomRightEdge = Geometry.pointAdd(topRightEdge, { x: 0, y: tileSize })\n    const bottomLeftEdge = Geometry.pointSub(bottomRightEdge, { x: tileSize, y: 0 })\n\n    path.moveTo(topLeftEdge.x, topLeftEdge.y)\n    if (shape.top !== 0) {\n      for (let i = 0; i < curvyCoords.length / 6; i++) {\n        const p1 = Geometry.pointAdd(topLeftEdge, { x: curvyCoords[i * 6 + 0] * tileRatio, y: shape.top * curvyCoords[i * 6 + 1] * tileRatio })\n        const p2 = Geometry.pointAdd(topLeftEdge, { x: curvyCoords[i * 6 + 2] * tileRatio, y: shape.top * curvyCoords[i * 6 + 3] * tileRatio })\n        const p3 = Geometry.pointAdd(topLeftEdge, { x: curvyCoords[i * 6 + 4] * tileRatio, y: shape.top * curvyCoords[i * 6 + 5] * tileRatio })\n        path.bezierCurveTo(p1.x, p1.y, p2.x, p2.y, p3.x, p3.y);\n      }\n    } else {\n      path.lineTo(topRightEdge.x, topRightEdge.y)\n    }\n    if (shape.right !== 0) {\n      for (let i = 0; i < curvyCoords.length / 6; i++) {\n        const p1 = Geometry.pointAdd(topRightEdge, { x: -shape.right * curvyCoords[i * 6 + 1] * tileRatio, y: curvyCoords[i * 6 + 0] * tileRatio })\n        const p2 = Geometry.pointAdd(topRightEdge, { x: -shape.right * curvyCoords[i * 6 + 3] * tileRatio, y: curvyCoords[i * 6 + 2] * tileRatio })\n        const p3 = Geometry.pointAdd(topRightEdge, { x: -shape.right * curvyCoords[i * 6 + 5] * tileRatio, y: curvyCoords[i * 6 + 4] * tileRatio })\n        path.bezierCurveTo(p1.x, p1.y, p2.x, p2.y, p3.x, p3.y);\n      }\n    } else {\n      path.lineTo(bottomRightEdge.x, bottomRightEdge.y)\n    }\n    if (shape.bottom !== 0) {\n      for (let i = 0; i < curvyCoords.length / 6; i++) {\n        const p1 = Geometry.pointSub(bottomRightEdge, { x: curvyCoords[i * 6 + 0] * tileRatio, y: shape.bottom * curvyCoords[i * 6 + 1] * tileRatio })\n        const p2 = Geometry.pointSub(bottomRightEdge, { x: curvyCoords[i * 6 + 2] * tileRatio, y: shape.bottom * curvyCoords[i * 6 + 3] * tileRatio })\n        const p3 = Geometry.pointSub(bottomRightEdge, { x: curvyCoords[i * 6 + 4] * tileRatio, y: shape.bottom * curvyCoords[i * 6 + 5] * tileRatio })\n        path.bezierCurveTo(p1.x, p1.y, p2.x, p2.y, p3.x, p3.y);\n      }\n    } else {\n      path.lineTo(bottomLeftEdge.x, bottomLeftEdge.y)\n    }\n    if (shape.left !== 0) {\n      for (let i = 0; i < curvyCoords.length / 6; i++) {\n        const p1 = Geometry.pointSub(bottomLeftEdge, { x: -shape.left * curvyCoords[i * 6 + 1] * tileRatio, y: curvyCoords[i * 6 + 0] * tileRatio })\n        const p2 = Geometry.pointSub(bottomLeftEdge, { x: -shape.left * curvyCoords[i * 6 + 3] * tileRatio, y: curvyCoords[i * 6 + 2] * tileRatio })\n        const p3 = Geometry.pointSub(bottomLeftEdge, { x: -shape.left * curvyCoords[i * 6 + 5] * tileRatio, y: curvyCoords[i * 6 + 4] * tileRatio })\n        path.bezierCurveTo(p1.x, p1.y, p2.x, p2.y, p3.x, p3.y);\n      }\n    } else {\n      path.lineTo(topLeftEdge.x, topLeftEdge.y)\n    }\n    paths[key] = path\n    return path\n  }\n\n  const c = Graphics.createCanvas(tileDrawSize, tileDrawSize)\n  const ctx = c.getContext('2d') as CanvasRenderingContext2D\n\n  const c2 = Graphics.createCanvas(tileDrawSize, tileDrawSize)\n  const ctx2 = c2.getContext('2d') as CanvasRenderingContext2D\n\n  for (const p of pieces) {\n    const piece = Util.decodePiece(p)\n    const srcRect = srcRectByIdx(info, piece.idx)\n    const path = pathForShape(Util.decodeShape(info.shapes[piece.idx]))\n\n    ctx.clearRect(0, 0, tileDrawSize, tileDrawSize)\n\n    // stroke (slightly darker version of image)\n    // -----------------------------------------------------------\n    // -----------------------------------------------------------\n    ctx.save()\n    ctx.lineWidth = 2\n    ctx.stroke(path)\n    ctx.globalCompositeOperation = 'source-in'\n    ctx.drawImage(\n      img,\n      srcRect.x - tileMarginWidth,\n      srcRect.y - tileMarginWidth,\n      tileDrawSize,\n      tileDrawSize,\n      0,\n      0,\n      tileDrawSize,\n      tileDrawSize,\n    )\n    ctx.restore()\n    ctx.save()\n    ctx.globalCompositeOperation = 'source-in'\n    ctx.globalAlpha = .2\n    ctx.fillStyle = 'black'\n    ctx.fillRect(0,0, c.width, c.height)\n    ctx.restore()\n\n    // main image\n    // -----------------------------------------------------------\n    // -----------------------------------------------------------\n    ctx.save()\n    ctx.clip(path)\n    ctx.drawImage(\n      img,\n      srcRect.x - tileMarginWidth,\n      srcRect.y - tileMarginWidth,\n      tileDrawSize,\n      tileDrawSize,\n      0,\n      0,\n      tileDrawSize,\n      tileDrawSize,\n    )\n    ctx.restore()\n\n    // INSET SHADOW (bottom, right)\n    // -----------------------------------------------------------\n    // -----------------------------------------------------------\n    ctx.save()\n    ctx.clip(path)\n    ctx.strokeStyle = 'rgba(0,0,0,.4)'\n    ctx.lineWidth = 0\n    ctx.shadowColor = \"black\";\n    ctx.shadowBlur = 2;\n    ctx.shadowOffsetX = -1;\n    ctx.shadowOffsetY = -1;\n    ctx.stroke(path)\n    ctx.restore()\n\n    // INSET SHADOW (top, left)\n    // -----------------------------------------------------------\n    // -----------------------------------------------------------\n    ctx.save()\n    ctx.clip(path)\n    ctx.strokeStyle = 'rgba(255,255,255,.4)'\n    ctx.lineWidth = 0\n    ctx.shadowColor = \"white\";\n    ctx.shadowBlur = 2;\n    ctx.shadowOffsetX = 1;\n    ctx.shadowOffsetY = 1;\n    ctx.stroke(path)\n    ctx.restore()\n\n    // Redraw the path (border) in the color of the\n    // tile, this makes the tile look more realistic\n    // -----------------------------------------------------------\n    // -----------------------------------------------------------\n    ctx2.clearRect(0, 0, tileDrawSize, tileDrawSize)\n    ctx2.save()\n    ctx2.lineWidth = 1\n    ctx2.stroke(path)\n    ctx2.globalCompositeOperation = 'source-in'\n    ctx2.drawImage(\n      img,\n      srcRect.x - tileMarginWidth,\n      srcRect.y - tileMarginWidth,\n      tileDrawSize,\n      tileDrawSize,\n      0,\n      0,\n      tileDrawSize,\n      tileDrawSize,\n    )\n    ctx2.restore()\n    ctx.drawImage(c2, 0, 0)\n\n    bitmaps[piece.idx] = await createImageBitmap(c)\n  }\n\n  log.log('end createPuzzleTileBitmaps')\n  return bitmaps\n}\n\nfunction srcRectByIdx(puzzleInfo: PuzzleInfo, idx: number): Rect {\n  const c = Util.coordByPieceIdx(puzzleInfo, idx)\n  return {\n    x: c.x * puzzleInfo.tileSize,\n    y: c.y * puzzleInfo.tileSize,\n    w: puzzleInfo.tileSize,\n    h: puzzleInfo.tileSize,\n  }\n}\n\nasync function loadPuzzleBitmaps(puzzle: Puzzle): Promise<Array<ImageBitmap>> {\n  // load bitmap, to determine the original size of the image\n  const bmp = await Graphics.loadImageToBitmap(puzzle.info.imageUrl)\n\n  // creation of tile bitmaps\n  // then create the final puzzle bitmap\n  // NOTE: this can decrease OR increase in size!\n  const bmpResized = await Graphics.resizeBitmap(bmp, puzzle.info.width, puzzle.info.height)\n  return await createPuzzleTileBitmaps(bmpResized, puzzle.tiles, puzzle.info)\n}\n\nexport default {\n  loadPuzzleBitmaps,\n}\n","import Geometry, { Point, Rect } from './Geometry'\nimport Protocol from './Protocol'\nimport { Rng } from './Rng'\nimport Time from './Time'\nimport {\n  Change,\n  EncodedPiece,\n  EvtInfo,\n  Game,\n  Input,\n  Piece,\n  PieceChange,\n  Player,\n  PlayerChange,\n  Puzzle,\n  PuzzleData,\n  PuzzleDataChange,\n  ScoreMode,\n  SnapMode,\n  Timestamp\n} from './Types'\nimport Util from './Util'\n\nconst IDLE_TIMEOUT_SEC = 30\n\n// Map<gameId, Game>\nconst GAMES: Record<string, Game> = {}\n\nfunction exists(gameId: string): boolean {\n  return (!!GAMES[gameId]) || false\n}\n\nfunction __createPlayerObject(id: string, ts: Timestamp): Player {\n  return {\n    id: id,\n    x: 0,\n    y: 0,\n    d: 0, // mouse down\n    name: null, // 'anon'\n    color: null, // '#ffffff'\n    bgcolor: null, // '#222222'\n    points: 0,\n    ts: ts,\n  }\n}\n\nfunction setGame(gameId: string, game: Game): void {\n  GAMES[gameId] = game\n}\n\nfunction getPlayerIndexById(gameId: string, playerId: string): number {\n  let i = 0;\n  for (const player of GAMES[gameId].players) {\n    if (Util.decodePlayer(player).id === playerId) {\n      return i\n    }\n    i++\n  }\n  return -1\n}\n\nfunction getPlayerIdByIndex(gameId: string, playerIndex: number): string|null {\n  if (GAMES[gameId].players.length > playerIndex) {\n    return Util.decodePlayer(GAMES[gameId].players[playerIndex]).id\n  }\n  return null\n}\n\nfunction getPlayer(gameId: string, playerId: string): Player|null {\n  const idx = getPlayerIndexById(gameId, playerId)\n  if (idx === -1) {\n    return null\n  }\n  return Util.decodePlayer(GAMES[gameId].players[idx])\n}\n\nfunction setPlayer(\n  gameId: string,\n  playerId: string,\n  player: Player\n): void {\n  const idx = getPlayerIndexById(gameId, playerId)\n  if (idx === -1) {\n    GAMES[gameId].players.push(Util.encodePlayer(player))\n  } else {\n    GAMES[gameId].players[idx] = Util.encodePlayer(player)\n  }\n}\n\nfunction setPiece(gameId: string, pieceIdx: number, piece: Piece): void {\n  GAMES[gameId].puzzle.tiles[pieceIdx] = Util.encodePiece(piece)\n}\n\nfunction setPuzzleData(gameId: string, data: PuzzleData): void {\n  GAMES[gameId].puzzle.data = data\n}\n\nfunction playerExists(gameId: string, playerId: string): boolean {\n  const idx = getPlayerIndexById(gameId, playerId)\n  return idx !== -1\n}\n\nfunction getActivePlayers(gameId: string, ts: number): Array<Player> {\n  const minTs = ts - IDLE_TIMEOUT_SEC * Time.SEC\n  return getAllPlayers(gameId).filter((p: Player) => p.ts >= minTs)\n}\n\nfunction getIdlePlayers(gameId: string, ts: number): Array<Player> {\n  const minTs = ts - IDLE_TIMEOUT_SEC * Time.SEC\n  return getAllPlayers(gameId).filter((p: Player) => p.ts < minTs && p.points > 0)\n}\n\nfunction addPlayer(gameId: string, playerId: string, ts: Timestamp): void {\n  if (!playerExists(gameId, playerId)) {\n    setPlayer(gameId, playerId, __createPlayerObject(playerId, ts))\n  } else {\n    changePlayer(gameId, playerId, { ts })\n  }\n}\n\nfunction getEvtInfo(gameId: string, playerId: string): EvtInfo {\n  if (playerId in GAMES[gameId].evtInfos) {\n    return GAMES[gameId].evtInfos[playerId]\n  }\n  return {\n    _last_mouse: null,\n    _last_mouse_down: null,\n  }\n}\n\nfunction setEvtInfo(\n  gameId: string,\n  playerId: string,\n  evtInfo: EvtInfo\n): void {\n  GAMES[gameId].evtInfos[playerId] = evtInfo\n}\n\nfunction getAllGames(): Array<Game> {\n  return Object.values(GAMES).sort((a: Game, b: Game) => {\n    const finished = isFinished(a.id)\n    // when both have same finished state, sort by started\n    if (finished === isFinished(b.id)) {\n      if (finished) {\n        return  b.puzzle.data.finished - a.puzzle.data.finished\n      }\n      return b.puzzle.data.started - a.puzzle.data.started\n    }\n    // otherwise, sort: unfinished, finished\n    return finished ? 1 : -1\n  })\n}\n\nfunction getAllPlayers(gameId: string): Array<Player> {\n  return GAMES[gameId]\n    ? GAMES[gameId].players.map(Util.decodePlayer)\n    : []\n}\n\nfunction get(gameId: string): Game|null {\n  return GAMES[gameId] || null\n}\n\nfunction getPieceCount(gameId: string): number {\n  return GAMES[gameId].puzzle.tiles.length\n}\n\nfunction getImageUrl(gameId: string): string {\n  const imageUrl = GAMES[gameId].puzzle.info.image?.url\n    || GAMES[gameId].puzzle.info.imageUrl\n  if (!imageUrl) {\n    throw new Error('[2021-07-11] no image url set')\n  }\n  return imageUrl\n}\n\nfunction getScoreMode(gameId: string): ScoreMode {\n  return GAMES[gameId].scoreMode\n}\n\nfunction getSnapMode(gameId: string): SnapMode {\n  return GAMES[gameId].snapMode\n}\n\nfunction isFinished(gameId: string): boolean {\n  return getFinishedPiecesCount(gameId) === getPieceCount(gameId)\n}\n\nfunction getFinishedPiecesCount(gameId: string): number {\n  let count = 0\n  for (const t of GAMES[gameId].puzzle.tiles) {\n    if (Util.decodePiece(t).owner === -1) {\n      count++\n    }\n  }\n  return count\n}\n\nfunction getPiecesSortedByZIndex(gameId: string): Piece[] {\n  const pieces = GAMES[gameId].puzzle.tiles.map(Util.decodePiece)\n  return pieces.sort((t1, t2) => t1.z - t2.z)\n}\n\nfunction changePlayer(\n  gameId: string,\n  playerId: string,\n  change: PlayerChange\n): void {\n  const player = getPlayer(gameId, playerId)\n  if (player === null) {\n    return\n  }\n\n  for (const k of Object.keys(change)) {\n    // @ts-ignore\n    player[k] = change[k]\n  }\n  setPlayer(gameId, playerId, player)\n}\n\nfunction changeData(gameId: string, change: PuzzleDataChange): void {\n  for (const k of Object.keys(change)) {\n    // @ts-ignore\n    GAMES[gameId].puzzle.data[k] = change[k]\n  }\n}\n\nfunction changePiece(\n  gameId: string,\n  pieceIdx: number,\n  change: PieceChange\n): void {\n  for (const k of Object.keys(change)) {\n    const piece = Util.decodePiece(GAMES[gameId].puzzle.tiles[pieceIdx])\n    // @ts-ignore\n    piece[k] = change[k]\n    GAMES[gameId].puzzle.tiles[pieceIdx] = Util.encodePiece(piece)\n  }\n}\n\nconst getPiece = (gameId: string, pieceIdx: number): Piece => {\n  return Util.decodePiece(GAMES[gameId].puzzle.tiles[pieceIdx])\n}\n\nconst getPieceGroup = (gameId: string, tileIdx: number): number => {\n  const tile = getPiece(gameId, tileIdx)\n  return tile.group\n}\n\nconst isCornerPiece = (gameId: string, tileIdx: number): boolean => {\n  const info = GAMES[gameId].puzzle.info\n  return (\n    tileIdx === 0 // top left corner\n    || tileIdx === (info.tilesX - 1) // top right corner\n    || tileIdx === (info.tiles - info.tilesX) // bottom left corner\n    || tileIdx === (info.tiles - 1) // bottom right corner\n  )\n}\n\nconst getFinalPiecePos = (gameId: string, tileIdx: number): Point => {\n  const info = GAMES[gameId].puzzle.info\n  const boardPos = {\n    x: (info.table.width - info.width) / 2,\n    y: (info.table.height - info.height) / 2\n  }\n  const srcPos = srcPosByTileIdx(gameId, tileIdx)\n  return Geometry.pointAdd(boardPos, srcPos)\n}\n\nconst getPiecePos = (gameId: string, tileIdx: number): Point => {\n  const tile = getPiece(gameId, tileIdx)\n  return tile.pos\n}\n\n// todo: instead, just make the table bigger and use that :)\nconst getBounds = (gameId: string): Rect => {\n  const tw = getTableWidth(gameId)\n  const th = getTableHeight(gameId)\n\n  const overX = Math.round(tw / 4)\n  const overY = Math.round(th / 4)\n  return {\n    x: 0 - overX,\n    y: 0 - overY,\n    w: tw + 2 * overX,\n    h: th + 2 * overY,\n  }\n}\n\nconst getPieceBounds = (gameId: string, tileIdx: number): Rect => {\n  const s = getPieceSize(gameId)\n  const tile = getPiece(gameId, tileIdx)\n  return {\n    x: tile.pos.x,\n    y: tile.pos.y,\n    w: s,\n    h: s,\n  }\n}\n\nconst getPieceZIndex = (gameId: string, pieceIdx: number): number => {\n  return getPiece(gameId, pieceIdx).z\n}\n\nconst getFirstOwnedPieceIdx = (gameId: string, playerId: string): number => {\n  for (const t of GAMES[gameId].puzzle.tiles) {\n    const tile = Util.decodePiece(t)\n    if (tile.owner === playerId) {\n      return tile.idx\n    }\n  }\n  return -1\n}\n\nconst getFirstOwnedPiece = (\n  gameId: string,\n  playerId: string\n): EncodedPiece|null => {\n  const idx = getFirstOwnedPieceIdx(gameId, playerId)\n  return idx < 0 ? null : GAMES[gameId].puzzle.tiles[idx]\n}\n\nconst getPieceDrawOffset = (gameId: string): number => {\n  return GAMES[gameId].puzzle.info.tileDrawOffset\n}\n\nconst getPieceDrawSize = (gameId: string): number => {\n  return GAMES[gameId].puzzle.info.tileDrawSize\n}\n\nconst getPieceSize = (gameId: string): number => {\n  return GAMES[gameId].puzzle.info.tileSize\n}\n\nconst getStartTs = (gameId: string): Timestamp => {\n  return GAMES[gameId].puzzle.data.started\n}\n\nconst getFinishTs = (gameId: string): Timestamp => {\n  return GAMES[gameId].puzzle.data.finished\n}\n\nconst getMaxGroup = (gameId: string): number => {\n  return GAMES[gameId].puzzle.data.maxGroup\n}\n\nconst getMaxZIndex = (gameId: string): number => {\n  return GAMES[gameId].puzzle.data.maxZ\n}\n\nconst getMaxZIndexByPieceIdxs = (gameId: string, pieceIdxs: Array<number>): number => {\n  let maxZ = 0\n  for (const pieceIdx of pieceIdxs) {\n    const curZ = getPieceZIndex(gameId, pieceIdx)\n    if (curZ > maxZ) {\n      maxZ = curZ\n    }\n  }\n  return maxZ\n}\n\nfunction srcPosByTileIdx(gameId: string, tileIdx: number): Point {\n  const info = GAMES[gameId].puzzle.info\n\n  const c = Util.coordByPieceIdx(info, tileIdx)\n  const cx = c.x * info.tileSize\n  const cy = c.y * info.tileSize\n\n  return { x: cx, y: cy }\n}\n\nfunction getSurroundingTilesByIdx(gameId: string, tileIdx: number) {\n  const info = GAMES[gameId].puzzle.info\n\n  const c = Util.coordByPieceIdx(info, tileIdx)\n\n  return [\n    // top\n    (c.y > 0) ?               (tileIdx - info.tilesX) : -1,\n    // right\n    (c.x < info.tilesX - 1) ? (tileIdx + 1)           : -1,\n    // bottom\n    (c.y < info.tilesY - 1) ? (tileIdx + info.tilesX) : -1,\n    // left\n    (c.x > 0) ?               (tileIdx - 1)           : -1,\n  ]\n}\n\nconst setPiecesZIndex = (gameId: string, tileIdxs: Array<number>, zIndex: number): void => {\n  for (const tilesIdx of tileIdxs) {\n    changePiece(gameId, tilesIdx, { z: zIndex })\n  }\n}\n\nconst moveTileDiff = (gameId: string, tileIdx: number, diff: Point): void => {\n  const oldPos = getPiecePos(gameId, tileIdx)\n  const pos = Geometry.pointAdd(oldPos, diff)\n  changePiece(gameId, tileIdx, { pos })\n}\n\nconst movePiecesDiff = (\n  gameId: string,\n  pieceIdxs: Array<number>,\n  diff: Point\n): void => {\n  const drawSize = getPieceDrawSize(gameId)\n  const bounds = getBounds(gameId)\n  const cappedDiff = diff\n\n  for (const pieceIdx of pieceIdxs) {\n    const t = getPiece(gameId, pieceIdx)\n    if (t.pos.x + diff.x < bounds.x) {\n      cappedDiff.x = Math.max(bounds.x - t.pos.x, cappedDiff.x)\n    } else if (t.pos.x + drawSize + diff.x > bounds.x + bounds.w) {\n      cappedDiff.x = Math.min(bounds.x + bounds.w - t.pos.x + drawSize, cappedDiff.x)\n    }\n    if (t.pos.y + diff.y < bounds.y) {\n      cappedDiff.y = Math.max(bounds.y - t.pos.y, cappedDiff.y)\n    } else if (t.pos.y + drawSize + diff.y > bounds.y + bounds.h) {\n      cappedDiff.y = Math.min(bounds.y + bounds.h - t.pos.y + drawSize, cappedDiff.y)\n    }\n  }\n\n  for (const pieceIdx of pieceIdxs) {\n    moveTileDiff(gameId, pieceIdx, cappedDiff)\n  }\n}\n\nconst isFinishedPiece = (gameId: string, pieceIdx: number): boolean => {\n  return getPieceOwner(gameId, pieceIdx) === -1\n}\n\nconst getPieceOwner = (gameId: string, pieceIdx: number): string|number => {\n  return getPiece(gameId, pieceIdx).owner\n}\n\nconst finishPieces = (gameId: string, pieceIdxs: Array<number>): void => {\n  for (const pieceIdx of pieceIdxs) {\n    changePiece(gameId, pieceIdx, { owner: -1, z: 1 })\n  }\n}\n\nconst setTilesOwner = (\n  gameId: string,\n  pieceIdxs: Array<number>,\n  owner: string|number\n): void => {\n  for (const pieceIdx of pieceIdxs) {\n    changePiece(gameId, pieceIdx, { owner })\n  }\n}\n\n// get all grouped tiles for a tile\nfunction getGroupedPieceIdxs(gameId: string, pieceIdx: number): number[] {\n  const pieces = GAMES[gameId].puzzle.tiles\n  const piece = Util.decodePiece(pieces[pieceIdx])\n\n  const grouped = []\n  if (piece.group) {\n    for (const other of pieces) {\n      const otherPiece = Util.decodePiece(other)\n      if (otherPiece.group === piece.group) {\n        grouped.push(otherPiece.idx)\n      }\n    }\n  } else {\n    grouped.push(piece.idx)\n  }\n  return grouped\n}\n\n// Returns the index of the puzzle tile with the highest z index\n// that is not finished yet and that matches the position\nconst freePieceIdxByPos = (gameId: string, pos: Point): number => {\n  const info = GAMES[gameId].puzzle.info\n  const pieces = GAMES[gameId].puzzle.tiles\n\n  let maxZ = -1\n  let pieceIdx = -1\n  for (let idx = 0; idx < pieces.length; idx++) {\n    const piece = Util.decodePiece(pieces[idx])\n    if (piece.owner !== 0) {\n      continue\n    }\n\n    const collisionRect: Rect = {\n      x: piece.pos.x,\n      y: piece.pos.y,\n      w: info.tileSize,\n      h: info.tileSize,\n    }\n    if (Geometry.pointInBounds(pos, collisionRect)) {\n      if (maxZ === -1 || piece.z > maxZ) {\n        maxZ = piece.z\n        pieceIdx = idx\n      }\n    }\n  }\n  return pieceIdx\n}\n\nconst getPlayerBgColor = (gameId: string, playerId: string): string|null => {\n  const p = getPlayer(gameId, playerId)\n  return p ? p.bgcolor : null\n}\n\nconst getPlayerColor = (gameId: string, playerId: string): string|null => {\n  const p = getPlayer(gameId, playerId)\n  return p ? p.color : null\n}\n\nconst getPlayerName = (gameId: string, playerId: string): string|null => {\n  const p = getPlayer(gameId, playerId)\n  return p ? p.name : null\n}\n\nconst getPlayerPoints = (gameId: string, playerId: string): number => {\n  const p = getPlayer(gameId, playerId)\n  return p ? p.points : 0\n}\n\n// determine if two tiles are grouped together\nconst areGrouped = (\n  gameId: string,\n  tileIdx1: number,\n  tileIdx2: number\n): boolean => {\n  const g1 = getPieceGroup(gameId, tileIdx1)\n  const g2 = getPieceGroup(gameId, tileIdx2)\n  return !!(g1 && g1 === g2)\n}\n\nconst getTableWidth = (gameId: string): number => {\n  return GAMES[gameId].puzzle.info.table.width\n}\n\nconst getTableHeight = (gameId: string): number => {\n  return GAMES[gameId].puzzle.info.table.height\n}\n\nconst getPuzzle = (gameId: string): Puzzle => {\n  return GAMES[gameId].puzzle\n}\n\nconst getRng = (gameId: string): Rng => {\n  return GAMES[gameId].rng.obj\n}\n\nconst getPuzzleWidth = (gameId: string): number => {\n  return GAMES[gameId].puzzle.info.width\n}\n\nconst getPuzzleHeight = (gameId: string): number => {\n  return GAMES[gameId].puzzle.info.height\n}\n\nfunction handleInput(\n  gameId: string,\n  playerId: string,\n  input: Input,\n  ts: Timestamp,\n  onSnap?: (playerId: string) => void\n): Array<Change> {\n  const puzzle = GAMES[gameId].puzzle\n  const evtInfo = getEvtInfo(gameId, playerId)\n\n  const changes: Array<Change> = []\n\n  const _dataChange = (): void => {\n    changes.push([Protocol.CHANGE_DATA, puzzle.data])\n  }\n\n  const _pieceChange = (pieceIdx: number): void => {\n    changes.push([\n      Protocol.CHANGE_TILE,\n      Util.encodePiece(getPiece(gameId, pieceIdx)),\n    ])\n  }\n\n  const _pieceChanges = (pieceIdxs: Array<number>): void => {\n    for (const pieceIdx of pieceIdxs) {\n      _pieceChange(pieceIdx)\n    }\n  }\n\n  const _playerChange = (): void => {\n    const player = getPlayer(gameId, playerId)\n    if (!player) {\n      return\n    }\n    changes.push([\n      Protocol.CHANGE_PLAYER,\n      Util.encodePlayer(player),\n    ])\n  }\n\n  // put both tiles (and their grouped tiles) in the same group\n  const groupTiles = (\n    gameId: string,\n    pieceIdx1: number,\n    pieceIdx2: number\n  ): void => {\n    const pieces = GAMES[gameId].puzzle.tiles\n    const group1 = getPieceGroup(gameId, pieceIdx1)\n    const group2 = getPieceGroup(gameId, pieceIdx2)\n\n    let group\n    const searchGroups = []\n    if (group1) {\n      searchGroups.push(group1)\n    }\n    if (group2) {\n      searchGroups.push(group2)\n    }\n    if (group1) {\n      group = group1\n    } else if (group2) {\n      group = group2\n    } else {\n      const maxGroup = getMaxGroup(gameId) + 1\n      changeData(gameId, { maxGroup })\n      _dataChange()\n      group = getMaxGroup(gameId)\n    }\n\n    changePiece(gameId, pieceIdx1, { group })\n    _pieceChange(pieceIdx1)\n    changePiece(gameId, pieceIdx2, { group })\n    _pieceChange(pieceIdx2)\n\n    // TODO: strange\n    if (searchGroups.length > 0) {\n      for (const p of pieces) {\n        const piece = Util.decodePiece(p)\n        if (searchGroups.includes(piece.group)) {\n          changePiece(gameId, piece.idx, { group })\n          _pieceChange(piece.idx)\n        }\n      }\n    }\n  }\n\n  const type = input[0]\n  if (type === Protocol.INPUT_EV_CONNECTION_CLOSE) {\n    // player lost connection, so un-own all their pieces\n    const pieceIdx = getFirstOwnedPieceIdx(gameId, playerId)\n    if (pieceIdx >= 0) {\n      const pieceIdxs = getGroupedPieceIdxs(gameId, pieceIdx)\n      setTilesOwner(gameId, pieceIdxs, 0)\n      _pieceChanges(pieceIdxs)\n    }\n  } else if (type === Protocol.INPUT_EV_BG_COLOR) {\n    const bgcolor = input[1]\n    changePlayer(gameId, playerId, { bgcolor, ts })\n    _playerChange()\n  } else if (type === Protocol.INPUT_EV_PLAYER_COLOR) {\n    const color = input[1]\n    changePlayer(gameId, playerId, { color, ts })\n    _playerChange()\n  } else if (type === Protocol.INPUT_EV_PLAYER_NAME) {\n    const name = `${input[1]}`.substr(0, 16)\n    changePlayer(gameId, playerId, { name, ts })\n    _playerChange()\n  } else if (type === Protocol.INPUT_EV_MOVE) {\n    const w = input[1]\n    const h = input[2]\n    const player = getPlayer(gameId, playerId)\n    if (player) {\n      const x = player.x - w\n      const y = player.y - h\n      changePlayer(gameId, playerId, { ts, x, y })\n      _playerChange()\n    }\n  } else if (type === Protocol.INPUT_EV_MOUSE_DOWN) {\n    const x = input[1]\n    const y = input[2]\n    const pos = {x, y}\n\n    changePlayer(gameId, playerId, { d: 1, ts })\n    _playerChange()\n    evtInfo._last_mouse_down = pos\n\n    const tileIdxAtPos = freePieceIdxByPos(gameId, pos)\n    if (tileIdxAtPos >= 0) {\n      const maxZ = getMaxZIndex(gameId) + 1\n      changeData(gameId, { maxZ })\n      _dataChange()\n      const tileIdxs = getGroupedPieceIdxs(gameId, tileIdxAtPos)\n      setPiecesZIndex(gameId, tileIdxs, getMaxZIndex(gameId))\n      setTilesOwner(gameId, tileIdxs, playerId)\n      _pieceChanges(tileIdxs)\n    }\n    evtInfo._last_mouse = pos\n\n  } else if (type === Protocol.INPUT_EV_MOUSE_MOVE) {\n    const x = input[1]\n    const y = input[2]\n    const pos = {x, y}\n\n    if (evtInfo._last_mouse_down === null) {\n      // player is just moving the hand\n      changePlayer(gameId, playerId, {x, y, ts})\n      _playerChange()\n    } else {\n      const pieceIdx = getFirstOwnedPieceIdx(gameId, playerId)\n      if (pieceIdx >= 0) {\n        // player is moving a tile (and hand)\n        changePlayer(gameId, playerId, {x, y, ts})\n        _playerChange()\n\n        // check if pos is on the tile, otherwise dont move\n        // (mouse could be out of table, but tile stays on it)\n        const pieceIdxs = getGroupedPieceIdxs(gameId, pieceIdx)\n        let anyOk = Geometry.pointInBounds(pos, getBounds(gameId))\n          && Geometry.pointInBounds(evtInfo._last_mouse_down, getBounds(gameId))\n        for (const idx of pieceIdxs) {\n          const bounds = getPieceBounds(gameId, idx)\n          if (Geometry.pointInBounds(pos, bounds)) {\n            anyOk = true\n            break\n          }\n        }\n        if (anyOk) {\n          const diffX = x - evtInfo._last_mouse_down.x\n          const diffY = y - evtInfo._last_mouse_down.y\n\n          const diff = { x: diffX, y: diffY }\n          movePiecesDiff(gameId, pieceIdxs, diff)\n\n          _pieceChanges(pieceIdxs)\n        }\n      } else {\n        // player is just moving map, so no change in position!\n        changePlayer(gameId, playerId, {ts})\n        _playerChange()\n      }\n\n      evtInfo._last_mouse_down = pos\n    }\n    evtInfo._last_mouse = pos\n\n  } else if (type === Protocol.INPUT_EV_MOUSE_UP) {\n    const x = input[1]\n    const y = input[2]\n    const pos = {x, y}\n    const d = 0\n\n    evtInfo._last_mouse_down = null\n\n    const pieceIdx = getFirstOwnedPieceIdx(gameId, playerId)\n    if (pieceIdx >= 0) {\n      // drop the tile(s)\n      const pieceIdxs = getGroupedPieceIdxs(gameId, pieceIdx)\n      setTilesOwner(gameId, pieceIdxs, 0)\n      _pieceChanges(pieceIdxs)\n\n      // Check if the tile was dropped near the final location\n      const tilePos = getPiecePos(gameId, pieceIdx)\n      const finalPos = getFinalPiecePos(gameId, pieceIdx)\n\n      let canSnapToFinal = false\n      if (getSnapMode(gameId) === SnapMode.REAL) {\n        // only can snap to final if any of the grouped pieces are\n        // corner pieces\n        for (const pieceIdxTmp of pieceIdxs) {\n          if (isCornerPiece(gameId, pieceIdxTmp)) {\n            canSnapToFinal = true\n            break\n          }\n        }\n      } else {\n        canSnapToFinal = true\n      }\n\n      if (\n        canSnapToFinal\n        && Geometry.pointDistance(finalPos, tilePos) < puzzle.info.snapDistance\n      ) {\n        const diff = Geometry.pointSub(finalPos, tilePos)\n        // Snap the tile to the final destination\n        movePiecesDiff(gameId, pieceIdxs, diff)\n        finishPieces(gameId, pieceIdxs)\n        _pieceChanges(pieceIdxs)\n\n        let points = getPlayerPoints(gameId, playerId)\n        if (getScoreMode(gameId) === ScoreMode.FINAL) {\n          points += pieceIdxs.length\n        } else if (getScoreMode(gameId) === ScoreMode.ANY) {\n          points += 1\n        } else {\n          // no score mode... should never occur, because there is a\n          // fallback to ScoreMode.FINAL in getScoreMode function\n        }\n        changePlayer(gameId, playerId, { d, ts, points })\n        _playerChange()\n\n        // check if the puzzle is finished\n        if (getFinishedPiecesCount(gameId) === getPieceCount(gameId)) {\n          changeData(gameId, { finished: ts })\n          _dataChange()\n        }\n        if (onSnap) {\n          onSnap(playerId)\n        }\n      } else {\n        // Snap to other tiles\n        const check = (\n          gameId: string,\n          tileIdx: number,\n          otherTileIdx: number,\n          off: Array<number>\n        ): boolean => {\n          const info = GAMES[gameId].puzzle.info\n          if (otherTileIdx < 0) {\n            return false\n          }\n          if (areGrouped(gameId, tileIdx, otherTileIdx)) {\n            return false\n          }\n          const tilePos = getPiecePos(gameId, tileIdx)\n          const dstPos = Geometry.pointAdd(\n            getPiecePos(gameId, otherTileIdx),\n            {x: off[0] * info.tileSize, y: off[1] * info.tileSize}\n          )\n          if (Geometry.pointDistance(tilePos, dstPos) < info.snapDistance) {\n            const diff = Geometry.pointSub(dstPos, tilePos)\n            let pieceIdxs = getGroupedPieceIdxs(gameId, tileIdx)\n            movePiecesDiff(gameId, pieceIdxs, diff)\n            groupTiles(gameId, tileIdx, otherTileIdx)\n            pieceIdxs = getGroupedPieceIdxs(gameId, tileIdx)\n            if (isFinishedPiece(gameId, otherTileIdx)) {\n              finishPieces(gameId, pieceIdxs)\n            } else {\n              const zIndex = getMaxZIndexByPieceIdxs(gameId, pieceIdxs)\n              setPiecesZIndex(gameId, pieceIdxs, zIndex)\n            }\n            _pieceChanges(pieceIdxs)\n            return true\n          }\n          return false\n        }\n\n        let snapped = false\n        for (const pieceIdxTmp of getGroupedPieceIdxs(gameId, pieceIdx)) {\n          const othersIdxs = getSurroundingTilesByIdx(gameId, pieceIdxTmp)\n          if (\n            check(gameId, pieceIdxTmp, othersIdxs[0], [0, 1]) // top\n            || check(gameId, pieceIdxTmp, othersIdxs[1], [-1, 0]) // right\n            || check(gameId, pieceIdxTmp, othersIdxs[2], [0, -1]) // bottom\n            || check(gameId, pieceIdxTmp, othersIdxs[3], [1, 0]) // left\n          ) {\n            snapped = true\n            break\n          }\n        }\n        if (snapped && getScoreMode(gameId) === ScoreMode.ANY) {\n          const points = getPlayerPoints(gameId, playerId) + 1\n          changePlayer(gameId, playerId, { d, ts, points })\n          _playerChange()\n        } else {\n          changePlayer(gameId, playerId, { d, ts })\n          _playerChange()\n        }\n\n        if (snapped && getSnapMode(gameId) === SnapMode.REAL) {\n          if (getFinishedPiecesCount(gameId) === getPieceCount(gameId)) {\n            changeData(gameId, { finished: ts })\n            _dataChange()\n          }\n        }\n        if (snapped && onSnap) {\n          onSnap(playerId)\n        }\n      }\n    } else {\n      changePlayer(gameId, playerId, { d, ts })\n      _playerChange()\n    }\n    evtInfo._last_mouse = pos\n  } else if (type === Protocol.INPUT_EV_ZOOM_IN) {\n    const x = input[1]\n    const y = input[2]\n    changePlayer(gameId, playerId, { x, y, ts })\n    _playerChange()\n    evtInfo._last_mouse = { x, y }\n  } else if (type === Protocol.INPUT_EV_ZOOM_OUT) {\n    const x = input[1]\n    const y = input[2]\n    changePlayer(gameId, playerId, { x, y, ts })\n    _playerChange()\n    evtInfo._last_mouse = { x, y }\n  } else {\n    changePlayer(gameId, playerId, { ts })\n    _playerChange()\n  }\n\n  setEvtInfo(gameId, playerId, evtInfo)\n  return changes\n}\n\nexport default {\n  setGame,\n  exists,\n  playerExists,\n  getActivePlayers,\n  getIdlePlayers,\n  addPlayer,\n  getFinishedPiecesCount,\n  getPieceCount,\n  getImageUrl,\n  get,\n  getAllGames,\n  getPlayerBgColor,\n  getPlayerColor,\n  getPlayerName,\n  getPlayerIndexById,\n  getPlayerIdByIndex,\n  changePlayer,\n  setPlayer,\n  setPiece,\n  setPuzzleData,\n  getTableWidth,\n  getTableHeight,\n  getPuzzle,\n  getRng,\n  getPuzzleWidth,\n  getPuzzleHeight,\n  getPiecesSortedByZIndex,\n  getFirstOwnedPiece,\n  getPieceDrawOffset,\n  getPieceDrawSize,\n  getFinalPiecePos,\n  getStartTs,\n  getFinishTs,\n  handleInput,\n}\n","\"use strict\"\n\nimport { Rng } from '../common/Rng'\n\nlet minVx = -10\nlet deltaVx = 20\nlet minVy = 2\nlet deltaVy = 15\nconst minParticleV = 5\nconst deltaParticleV = 5\n\nconst gravity = 1\n\nconst explosionRadius = 200\nconst bombRadius = 10\nconst explodingDuration = 100\nconst explosionDividerFactor = 10\n\nconst nBombs = 1\nconst percentChanceNewBomb = 5\n\nfunction color(rng: Rng): string {\n  const r = rng.random(0, 255)\n  const g = rng.random(0, 255)\n  const b = rng.random(0, 255)\n  return 'rgba(' + r + ',' + g + ',' + b + ', 0.8)'\n}\n\n// A Bomb. Or firework.\nclass Bomb {\n  radius: number\n  previousRadius: number\n  explodingDuration: number\n  hasExploded: boolean\n  alive: boolean\n  color: string\n  px: number\n  py: number\n  vx: number\n  vy: number\n  duration: number\n\n  constructor(rng: Rng) {\n    this.radius = bombRadius\n    this.previousRadius = bombRadius\n    this.explodingDuration = explodingDuration\n    this.hasExploded = false\n    this.alive = true\n    this.color = color(rng)\n\n    this.px = (window.innerWidth / 4) + (Math.random() * window.innerWidth / 2)\n    this.py = window.innerHeight\n\n    this.vx = minVx + Math.random() * deltaVx\n    this.vy = (minVy + Math.random() * deltaVy) * -1 // because y grows downwards\n\n    this.duration = 0\n  }\n\n  update(particlesVector?: Array<Particle>) {\n    if (this.hasExploded) {\n      const deltaRadius = explosionRadius - this.radius\n      this.previousRadius = this.radius\n      this.radius += deltaRadius / explosionDividerFactor\n      this.explodingDuration--\n      if (this.explodingDuration == 0) {\n        this.alive = false\n      }\n    }\n    else {\n      this.vx += 0\n      this.vy += gravity\n      if (this.vy >= 0) { // invertion point\n        if (particlesVector) {\n          this.explode(particlesVector)\n        }\n      }\n\n      this.px += this.vx\n      this.py += this.vy\n    }\n  }\n\n  draw(ctx: CanvasRenderingContext2D) {\n    ctx.beginPath()\n    ctx.arc(this.px, this.py, this.previousRadius, 0, Math.PI * 2, false)\n    if (!this.hasExploded) {\n      ctx.fillStyle = this.color\n      ctx.lineWidth = 1\n      ctx.fill()\n    }\n  }\n\n  explode(particlesVector: Array<Particle>) {\n    this.hasExploded = true\n    const e = 3 + Math.floor(Math.random() * 3)\n    for (let j = 0; j < e; j++) {\n      const n = 10 + Math.floor(Math.random() * 21) // 10 - 30\n      const speed = minParticleV + Math.random() * deltaParticleV\n      const deltaAngle = 2 * Math.PI / n\n      const initialAngle = Math.random() * deltaAngle\n      for (let i = 0; i < n; i++) {\n        particlesVector.push(new Particle(this, i * deltaAngle + initialAngle, speed))\n      }\n    }\n  }\n}\n\nclass Particle {\n  px: number\n  py: number\n  vx: number\n  vy: number\n  color: string\n  duration: number\n  alive: boolean\n  radius: number\n  constructor(parent: Bomb, angle: number, speed: number) {\n    this.px = parent.px\n    this.py = parent.py\n    this.vx = Math.cos(angle) * speed\n    this.vy = Math.sin(angle) * speed\n    this.color = parent.color\n    this.duration = 40 + Math.floor(Math.random() * 20)\n    this.alive = true\n    this.radius = 0\n  }\n  update() {\n    this.vx += 0\n    this.vy += gravity / 10\n\n    this.px += this.vx\n    this.py += this.vy\n    this.radius = 3\n\n    this.duration--\n    if (this.duration <= 0) {\n      this.alive = false\n    }\n  }\n\n  draw(ctx: CanvasRenderingContext2D) {\n    ctx.beginPath()\n    ctx.arc(this.px, this.py, this.radius, 0, Math.PI * 2, false)\n    ctx.fillStyle = this.color\n    ctx.lineWidth = 1\n    ctx.fill()\n  }\n}\n\nclass Controller {\n  canvas: HTMLCanvasElement\n  rng: Rng\n  ctx: CanvasRenderingContext2D\n  readyBombs: Array<Bomb>\n  explodedBombs: Array<Bomb>\n  particles: Array<Particle>\n  constructor(canvas: HTMLCanvasElement, rng: Rng) {\n    this.canvas = canvas\n    this.rng = rng\n    this.ctx = this.canvas.getContext('2d') as CanvasRenderingContext2D\n    this.resize()\n\n    this.readyBombs = []\n    this.explodedBombs = []\n    this.particles = []\n\n    window.addEventListener('resize', () => {\n      this.resize()\n    })\n  }\n\n  setSpeedParams(): void {\n    let heightReached = 0\n    let vy = 0\n\n    while (heightReached < this.canvas.height && vy >= 0) {\n      vy += gravity\n      heightReached += vy\n    }\n\n    minVy = vy / 2\n    deltaVy = vy - minVy\n\n    const vx = (1 / 4) * this.canvas.width / (vy / 2)\n    minVx = -vx\n    deltaVx = 2 * vx\n  }\n\n  resize(): void {\n    this.setSpeedParams()\n  }\n\n  init(): void {\n    this.readyBombs = []\n    this.explodedBombs = []\n    this.particles = []\n\n    for (let i = 0; i < nBombs; i++) {\n      this.readyBombs.push(new Bomb(this.rng))\n    }\n  }\n\n  update(): void {\n    if (Math.random() * 100 < percentChanceNewBomb) {\n      this.readyBombs.push(new Bomb(this.rng))\n    }\n\n    const aliveBombs = []\n    while (this.explodedBombs.length > 0) {\n      const bomb = this.explodedBombs.shift()\n      if (!bomb) {\n        break;\n      }\n      bomb.update()\n      if (bomb.alive) {\n        aliveBombs.push(bomb)\n      }\n    }\n    this.explodedBombs = aliveBombs\n\n    const notExplodedBombs = []\n    while (this.readyBombs.length > 0) {\n      const bomb = this.readyBombs.shift()\n      if (!bomb) {\n        break\n      }\n      bomb.update(this.particles)\n      if (bomb.hasExploded) {\n        this.explodedBombs.push(bomb)\n      }\n      else {\n        notExplodedBombs.push(bomb)\n      }\n    }\n    this.readyBombs = notExplodedBombs\n\n    const aliveParticles = []\n    while (this.particles.length > 0) {\n      const particle = this.particles.shift()\n      if (!particle) {\n        break\n      }\n      particle.update()\n      if (particle.alive) {\n        aliveParticles.push(particle)\n      }\n    }\n    this.particles = aliveParticles\n  }\n\n  render(): void {\n    this.ctx.beginPath()\n    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.1)' // Ghostly effect\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n\n    for (let i = 0; i < this.readyBombs.length; i++) {\n      this.readyBombs[i].draw(this.ctx)\n    }\n\n    for (let i = 0; i < this.explodedBombs.length; i++) {\n      this.explodedBombs[i].draw(this.ctx)\n    }\n\n    for (let i = 0; i < this.particles.length; i++) {\n      this.particles[i].draw(this.ctx)\n    }\n  }\n}\n\nexport default Controller\n","/**\n * Player settings\n */\n\nexport const SETTINGS = {\n  SOUND_VOLUME: 'sound_volume',\n  SOUND_ENABLED: 'sound_enabled',\n  COLOR_BACKGROUND: 'bg_color',\n  PLAYER_COLOR: 'player_color',\n  PLAYER_NAME: 'player_name',\n  SHOW_PLAYER_NAMES: 'show_player_names',\n}\n\nexport const DEFAULTS = {\n  SOUND_VOLUME: 100,\n  SOUND_ENABLED: true,\n  COLOR_BACKGROUND: '#222222',\n  PLAYER_COLOR: '#ffffff',\n  PLAYER_NAME: 'anon',\n  SHOW_PLAYER_NAMES: true,\n}\n\nconst set = (setting: string, value: string): void => {\n  localStorage.setItem(setting, value)\n}\n\nconst get = (setting: string): any => {\n  return localStorage.getItem(setting)\n}\n\nconst setInt = (setting: string, val: number): void => {\n  set(setting, `${val}`)\n}\n\nconst getInt = (setting: string, def: number): number => {\n  const value = get(setting)\n  if (value === null) {\n    return def\n  }\n  const vol = parseInt(value, 10)\n  return isNaN(vol) ? def : vol\n}\n\nconst setBool = (setting: string, val: boolean): void => {\n  set(setting, val ? '1' : '0')\n}\n\nconst getBool = (setting: string, def: boolean): boolean => {\n  const value = get(setting)\n  if (value === null) {\n    return def\n  }\n  return value === '1'\n}\n\nconst setStr = (setting: string, val: string): void => {\n  set(setting, val)\n}\n\nconst getStr = (setting: string, def: string): string => {\n  const value = get(setting)\n  if (value === null) {\n    return def\n  }\n  return value\n}\n\nexport default {\n  setInt,\n  getInt,\n  setBool,\n  getBool,\n  setStr,\n  getStr,\n}\n","import Protocol from \"../common/Protocol\"\nimport { GameEvent } from \"../common/Types\"\nimport { MODE_REPLAY } from \"./game\"\n\nfunction EventAdapter (\n  canvas: HTMLCanvasElement,\n  window: any,\n  viewport: any,\n  MODE: string\n) {\n  let events: Array<GameEvent> = []\n\n  let KEYS_ON = true\n\n  let LEFT = false\n  let RIGHT = false\n  let UP = false\n  let DOWN = false\n  let ZOOM_IN = false\n  let ZOOM_OUT = false\n  let SHIFT = false\n\n  const toWorldPoint = (x: number, y: number): [number, number] => {\n    const pos = viewport.viewportToWorld({x, y})\n    return [pos.x, pos.y]\n  }\n\n  const mousePos = (ev: MouseEvent) => toWorldPoint(ev.offsetX, ev.offsetY)\n  const canvasCenter = () => toWorldPoint(canvas.width / 2, canvas.height / 2)\n\n  const key = (state: boolean, ev: KeyboardEvent) => {\n    if (!KEYS_ON) {\n      return\n    }\n\n    if (ev.code === 'ShiftLeft' || ev.code === 'ShiftRight') {\n      SHIFT = state\n    } else if (ev.code === 'ArrowUp' || ev.code === 'KeyW') {\n      UP = state\n    } else if (ev.code === 'ArrowDown' || ev.code === 'KeyS') {\n      DOWN = state\n    } else if (ev.code === 'ArrowLeft' || ev.code === 'KeyA') {\n      LEFT = state\n    } else if (ev.code === 'ArrowRight' || ev.code === 'KeyD') {\n      RIGHT = state\n    } else if (ev.code === 'KeyQ') {\n      ZOOM_OUT = state\n    } else if (ev.code === 'KeyE') {\n      ZOOM_IN = state\n    }\n  }\n\n  let lastMouse: [number, number]|null = null\n  canvas.addEventListener('mousedown', (ev) => {\n    lastMouse = mousePos(ev)\n    if (ev.button === 0) {\n      addEvent([Protocol.INPUT_EV_MOUSE_DOWN, ...lastMouse])\n    }\n  })\n\n  canvas.addEventListener('mouseup', (ev) => {\n    lastMouse = mousePos(ev)\n    if (ev.button === 0) {\n      addEvent([Protocol.INPUT_EV_MOUSE_UP, ...lastMouse])\n    }\n  })\n\n  canvas.addEventListener('mousemove', (ev) => {\n    lastMouse = mousePos(ev)\n    addEvent([Protocol.INPUT_EV_MOUSE_MOVE, ...lastMouse])\n  })\n\n  canvas.addEventListener('wheel', (ev) => {\n    lastMouse = mousePos(ev)\n    if (viewport.canZoom(ev.deltaY < 0 ? 'in' : 'out')) {\n      const evt = ev.deltaY < 0\n        ? Protocol.INPUT_EV_ZOOM_IN\n        : Protocol.INPUT_EV_ZOOM_OUT\n      addEvent([evt, ...lastMouse])\n    }\n  })\n\n  window.addEventListener('keydown', (ev: KeyboardEvent) => key(true, ev))\n  window.addEventListener('keyup', (ev: KeyboardEvent) => key(false, ev))\n\n  window.addEventListener('keypress', (ev: KeyboardEvent) => {\n    if (!KEYS_ON) {\n      return\n    }\n\n    if (MODE === MODE_REPLAY) {\n      if (ev.code === 'KeyI') {\n        addEvent([Protocol.INPUT_EV_REPLAY_SPEED_UP])\n      } else if (ev.code === 'KeyO') {\n        addEvent([Protocol.INPUT_EV_REPLAY_SPEED_DOWN])\n      } else if (ev.code === 'KeyP') {\n        addEvent([Protocol.INPUT_EV_REPLAY_TOGGLE_PAUSE])\n      }\n    }\n\n    if (ev.code === 'Space') {\n      addEvent([Protocol.INPUT_EV_TOGGLE_PREVIEW])\n    } else if (ev.code === 'KeyF') {\n      addEvent([Protocol.INPUT_EV_TOGGLE_FIXED_PIECES])\n    } else if (ev.code === 'KeyG') {\n      addEvent([Protocol.INPUT_EV_TOGGLE_LOOSE_PIECES])\n    } else if (ev.code === 'KeyM') {\n      addEvent([Protocol.INPUT_EV_TOGGLE_SOUNDS])\n    } else if (ev.code === 'KeyN') {\n      addEvent([Protocol.INPUT_EV_TOGGLE_PLAYER_NAMES])\n    } else if (ev.code === 'KeyC') {\n      addEvent([Protocol.INPUT_EV_CENTER_FIT_PUZZLE])\n    } else if (ev.code === 'Digit1') {\n      // store or restore pos+zoom in slot 1\n      const evt = ev.shiftKey ? Protocol.INPUT_EV_STORE_POS : Protocol.INPUT_EV_RESTORE_POS\n      addEvent([evt, 1])\n    } else if (ev.code === 'Digit2') {\n      // store or restore pos+zoom in slot 2\n      const evt = ev.shiftKey ? Protocol.INPUT_EV_STORE_POS : Protocol.INPUT_EV_RESTORE_POS\n      addEvent([evt, 2])\n    } else if (ev.code === 'Digit3') {\n      // store or restore pos+zoom in slot 3\n      const evt = ev.shiftKey ? Protocol.INPUT_EV_STORE_POS : Protocol.INPUT_EV_RESTORE_POS\n      addEvent([evt, 3])\n    }\n  })\n\n  const addEvent = (event: GameEvent) => {\n    events.push(event)\n  }\n\n  const consumeAll = (): GameEvent[] => {\n    if (events.length === 0) {\n      return []\n    }\n    const all = events.slice()\n    events = []\n    return all\n  }\n\n  const createKeyEvents = (): void => {\n    const w = (LEFT ? 1 : 0) - (RIGHT ? 1 : 0)\n    const h = (UP ? 1 : 0) - (DOWN ? 1 : 0)\n    if (w !== 0 || h !== 0) {\n      const amount = (SHIFT ? 24 : 12) * Math.sqrt(viewport.getCurrentZoom())\n      const pos = viewport.viewportDimToWorld({w: w * amount, h: h * amount})\n      addEvent([Protocol.INPUT_EV_MOVE, pos.w, pos.h])\n      if (lastMouse) {\n        lastMouse[0] -= pos.w\n        lastMouse[1] -= pos.h\n      }\n    }\n\n    if (ZOOM_IN && ZOOM_OUT) {\n      // cancel each other out\n    } else if (ZOOM_IN) {\n      if (viewport.canZoom('in')) {\n        const target = lastMouse || canvasCenter()\n        addEvent([Protocol.INPUT_EV_ZOOM_IN, ...target])\n      }\n    } else if (ZOOM_OUT) {\n      if (viewport.canZoom('out')) {\n        const target = lastMouse || canvasCenter()\n        addEvent([Protocol.INPUT_EV_ZOOM_OUT, ...target])\n      }\n    }\n  }\n\n  const setHotkeys = (state: boolean) => {\n    KEYS_ON = state\n  }\n\n  return {\n    addEvent,\n    consumeAll,\n    createKeyEvents,\n    setHotkeys,\n  }\n}\n\nexport default EventAdapter\n","\"use strict\"\n\nimport { GameLoopInstance, run } from './gameloop'\nimport Camera, { Snapshot } from './Camera'\nimport Graphics from './Graphics'\nimport Debug from './Debug'\nimport Communication from './Communication'\nimport Util, { logger } from './../common/Util'\nimport PuzzleGraphics from './PuzzleGraphics'\nimport Game from './../common/GameCommon'\nimport fireworksController from './Fireworks'\nimport Protocol from '../common/Protocol'\nimport Time from '../common/Time'\nimport settings from './settings'\nimport { SETTINGS, DEFAULTS } from './settings'\nimport { Dim, Point } from '../common/Geometry'\nimport {\n  FixedLengthArray,\n  Game as GameType,\n  Player,\n  Piece,\n  EncodedGame,\n  ReplayData,\n  Timestamp,\n  ServerEvent,\n  PuzzleStatus,\n} from '../common/Types'\nimport EventAdapter from './EventAdapter'\ndeclare global {\n  interface Window {\n      DEBUG?: boolean\n  }\n}\n\nconst log = logger('game.ts')\n\n// @ts-ignore\nconst images = import.meta.globEager('./*.png')\n\n// @ts-ignore\nconst sounds = import.meta.globEager('./*.mp3')\n\nexport const MODE_PLAY = 'play'\nexport const MODE_REPLAY = 'replay'\n\nlet PIECE_VIEW_FIXED = true\nlet PIECE_VIEW_LOOSE = true\n\ninterface Hud {\n  setPuzzleCut: () => void\n  setPlayers: (active: Player[], idle: Player[]) => void\n  setStatus: (status: PuzzleStatus) => void\n  setConnectionState: (v: number) => void\n  togglePreview: () => void\n  toggleSoundsEnabled: () => void\n  togglePlayerNames: () => void\n  setReplaySpeed?: (v: number) => void\n  setReplayPaused?: (v: boolean) => void\n}\ninterface Replay {\n  final: boolean\n  log: Array<any> // current log entries\n  logPointer: number // pointer to current item in the log array\n  speeds: Array<number>\n  speedIdx: number\n  paused: boolean\n  lastRealTs: number\n  lastGameTs: number\n  gameStartTs: number\n  skipNonActionPhases: boolean\n  //\n  dataOffset: number\n}\n\nconst shouldDrawPiece = (piece: Piece) => {\n  if (piece.owner === -1) {\n    return PIECE_VIEW_FIXED\n  }\n  return PIECE_VIEW_LOOSE\n}\n\nlet RERENDER = true\n\nfunction addCanvasToDom(TARGET_EL: HTMLElement, canvas: HTMLCanvasElement) {\n  canvas.width = window.innerWidth\n  canvas.height = window.innerHeight\n  TARGET_EL.appendChild(canvas)\n  window.addEventListener('resize', () => {\n    canvas.width = window.innerWidth\n    canvas.height = window.innerHeight\n    RERENDER = true\n  })\n  return canvas\n}\n\nexport async function main(\n  gameId: string,\n  clientId: string,\n  wsAddress: string,\n  MODE: string,\n  TARGET_EL: HTMLElement,\n  HUD: Hud\n) {\n  if (typeof window.DEBUG === 'undefined') window.DEBUG = false\n\n  const shouldDrawPlayer = (player: Player) => {\n    return MODE === MODE_REPLAY || player.id !== clientId\n  }\n\n  const click = sounds['./click.mp3'].default\n  const clickAudio = new Audio(click)\n\n  const cursorGrab = await Graphics.loadImageToBitmap(images['./grab.png'].default)\n  const cursorHand = await Graphics.loadImageToBitmap(images['./hand.png'].default)\n  const cursorGrabMask = await Graphics.loadImageToBitmap(images['./grab_mask.png'].default)\n  const cursorHandMask = await Graphics.loadImageToBitmap(images['./hand_mask.png'].default)\n\n  // all cursors must be of the same dimensions\n  const CURSOR_W = cursorGrab.width\n  const CURSOR_W_2 = Math.round(CURSOR_W / 2)\n  const CURSOR_H = cursorGrab.height\n  const CURSOR_H_2 = Math.round(CURSOR_H / 2)\n\n  const cursors: Record<string, ImageBitmap> = {}\n  const getPlayerCursor = async (p: Player) => {\n    const key = p.color + ' ' + p.d\n    if (!cursors[key]) {\n      const cursor = p.d ? cursorGrab : cursorHand\n      if (p.color) {\n        const mask = p.d ? cursorGrabMask : cursorHandMask\n        cursors[key] = await createImageBitmap(\n          Graphics.colorizedCanvas(cursor, mask, p.color)\n        )\n      } else {\n        cursors[key] = cursor\n      }\n    }\n    return cursors[key]\n  }\n\n  // Create a canvas and attach adapters to it so we can work with it\n  const canvas = addCanvasToDom(TARGET_EL, Graphics.createCanvas())\n\n  // stuff only available in replay mode...\n  // TODO: refactor\n  const REPLAY: Replay = {\n    final: false,\n    log: [],\n    logPointer: 0,\n    speeds: [0.5, 1, 2, 5, 10, 20, 50, 100, 250, 500],\n    speedIdx: 1,\n    paused: false,\n    lastRealTs: 0,\n    lastGameTs: 0,\n    gameStartTs: 0,\n    skipNonActionPhases: true,\n    dataOffset: 0,\n  }\n\n  Communication.onConnectionStateChange((state) => {\n    HUD.setConnectionState(state)\n  })\n\n  const queryNextReplayBatch = async (\n    gameId: string\n  ): Promise<ReplayData> => {\n    const offset = REPLAY.dataOffset\n    REPLAY.dataOffset += 10000 // meh\n    const replay: ReplayData = await Communication.requestReplayData(\n      gameId,\n      offset\n    )\n\n    // cut log that was already handled\n    REPLAY.log = REPLAY.log.slice(REPLAY.logPointer)\n    REPLAY.logPointer = 0\n    REPLAY.log.push(...replay.log)\n\n    if (replay.log.length === 0) {\n      REPLAY.final = true\n    }\n    return replay\n  }\n\n  let TIME: () => number = () => 0\n  const connect = async () => {\n    if (MODE === MODE_PLAY) {\n      const game: EncodedGame = await Communication.connect(wsAddress, gameId, clientId)\n      const gameObject: GameType = Util.decodeGame(game)\n      Game.setGame(gameObject.id, gameObject)\n      TIME = () => Time.timestamp()\n    } else if (MODE === MODE_REPLAY) {\n      const replay: ReplayData = await queryNextReplayBatch(gameId)\n      if (!replay.game) {\n        throw '[ 2021-05-29 no game received ]'\n      }\n      const gameObject: GameType = Util.decodeGame(replay.game)\n      Game.setGame(gameObject.id, gameObject)\n\n      REPLAY.lastRealTs = Time.timestamp()\n      REPLAY.gameStartTs = parseInt(replay.log[0][4], 10)\n      REPLAY.lastGameTs = REPLAY.gameStartTs\n\n      TIME = () => REPLAY.lastGameTs\n    } else {\n      throw '[ 2020-12-22 MODE invalid, must be play|replay ]'\n    }\n\n    // rerender after (re-)connect\n    RERENDER = true\n  }\n\n  await connect()\n\n  const PIECE_DRAW_OFFSET = Game.getPieceDrawOffset(gameId)\n  const PIECE_DRAW_SIZE = Game.getPieceDrawSize(gameId)\n  const PUZZLE_WIDTH = Game.getPuzzleWidth(gameId)\n  const PUZZLE_HEIGHT = Game.getPuzzleHeight(gameId)\n  const TABLE_WIDTH = Game.getTableWidth(gameId)\n  const TABLE_HEIGHT = Game.getTableHeight(gameId)\n\n  const BOARD_POS = {\n    x: (TABLE_WIDTH - PUZZLE_WIDTH) / 2,\n    y: (TABLE_HEIGHT - PUZZLE_HEIGHT) / 2\n  }\n  const BOARD_DIM = {\n    w: PUZZLE_WIDTH,\n    h: PUZZLE_HEIGHT,\n  }\n  const PIECE_DIM = {\n    w: PIECE_DRAW_SIZE,\n    h: PIECE_DRAW_SIZE,\n  }\n\n  const bitmaps = await PuzzleGraphics.loadPuzzleBitmaps(Game.getPuzzle(gameId))\n\n  const fireworks = new fireworksController(canvas, Game.getRng(gameId))\n  fireworks.init()\n\n  const ctx = canvas.getContext('2d') as CanvasRenderingContext2D\n  canvas.classList.add('loaded')\n  HUD.setPuzzleCut()\n\n  let viewportToggleSlot: string = '';\n  const viewportSnapshots: Record<string, Snapshot> = {}\n  // initialize some view data\n  // this global data will change according to input events\n  const viewport = Camera()\n\n  const centerPuzzle = () => {\n    // center on the puzzle\n    viewport.reset()\n    viewport.move(\n      -(TABLE_WIDTH - canvas.width) /2,\n      -(TABLE_HEIGHT - canvas.height) /2\n    )\n\n    // zoom viewport to fit whole puzzle in\n    const x = viewport.worldDimToViewport(BOARD_DIM)\n    const border = 20\n    const targetW = canvas.width - (border * 2)\n    const targetH = canvas.height - (border * 2)\n    if (\n      (x.w > targetW || x.h > targetH)\n      || (x.w < targetW && x.h < targetH)\n    ) {\n      const zoom = Math.min(targetW / x.w, targetH / x.h)\n      viewport.setZoom(zoom, {\n        x: canvas.width / 2,\n        y: canvas.height / 2,\n      })\n    }\n  }\n  const handleViewportSnapshot = (slot: string): void => {\n    if (viewportSnapshots['last'] && viewportToggleSlot === slot) {\n      viewport.fromSnapshot(viewportSnapshots['last'])\n      delete viewportSnapshots['last']\n    } else if (viewportSnapshots[slot]) {\n      viewportSnapshots['last'] = viewport.snapshot()\n      viewportToggleSlot = slot\n      viewport.fromSnapshot(viewportSnapshots[slot])\n    }\n  }\n\n  centerPuzzle()\n  viewportSnapshots['center'] = viewport.snapshot()\n\n  const evts = EventAdapter(canvas, window, viewport, MODE)\n\n  const previewImageUrl = Game.getImageUrl(gameId)\n\n  const updateStatus = (ts: number) => {\n    const startTs = Game.getStartTs(gameId)\n    const finishTs = Game.getFinishTs(gameId)\n\n    HUD.setStatus({\n      finished: !!(finishTs),\n      duration: (finishTs || ts) - startTs,\n      piecesDone: Game.getFinishedPiecesCount(gameId),\n      piecesTotal: Game.getPieceCount(gameId),\n    })\n    HUD.setPlayers(\n      Game.getActivePlayers(gameId, ts),\n      Game.getIdlePlayers(gameId, ts),\n    )\n  }\n\n  updateStatus(TIME())\n\n  const longFinished = !! Game.getFinishTs(gameId)\n  let finished = longFinished\n  const justFinished = () => finished && !longFinished\n\n  const playerSoundVolume = (): number => {\n    return settings.getInt(SETTINGS.SOUND_VOLUME, DEFAULTS.SOUND_VOLUME)\n  }\n  const playerSoundEnabled = (): boolean => {\n    return settings.getBool(SETTINGS.SOUND_ENABLED, DEFAULTS.SOUND_ENABLED)\n  }\n  const showPlayerNames = (): boolean => {\n    return settings.getBool(SETTINGS.SHOW_PLAYER_NAMES, DEFAULTS.SHOW_PLAYER_NAMES)\n  }\n\n  const playClick = () => {\n    const vol = playerSoundVolume()\n    clickAudio.volume = vol / 100\n    clickAudio.play()\n  }\n\n  const playerBgColor = () => {\n    if (MODE === MODE_REPLAY) {\n      return settings.getStr(SETTINGS.COLOR_BACKGROUND, DEFAULTS.COLOR_BACKGROUND)\n    }\n    return Game.getPlayerBgColor(gameId, clientId)\n        || settings.getStr(SETTINGS.COLOR_BACKGROUND, DEFAULTS.COLOR_BACKGROUND)\n  }\n  const playerColor = () => {\n    if (MODE === MODE_REPLAY) {\n      return settings.getStr(SETTINGS.PLAYER_COLOR, DEFAULTS.PLAYER_COLOR)\n    }\n    return Game.getPlayerColor(gameId, clientId)\n        || settings.getStr(SETTINGS.PLAYER_COLOR, DEFAULTS.PLAYER_COLOR)\n  }\n  const playerName = () => {\n    if (MODE === MODE_REPLAY) {\n      return settings.getStr(SETTINGS.PLAYER_NAME, DEFAULTS.PLAYER_NAME)\n    }\n    return Game.getPlayerName(gameId, clientId)\n        || settings.getStr(SETTINGS.PLAYER_NAME, DEFAULTS.PLAYER_NAME)\n  }\n\n  let cursorDown: string = ''\n  let cursor: string = ''\n  let cursorState: boolean = false\n  const updatePlayerCursorState = (d: boolean) => {\n    cursorState = d\n    const [url, fallback] = d ? [cursorDown, 'grab'] : [cursor, 'default']\n    canvas.style.cursor = `url('${url}') ${CURSOR_W_2} ${CURSOR_H_2}, ${fallback}`\n  }\n  const updatePlayerCursorColor = (color: string) => {\n    cursorDown = Graphics.colorizedCanvas(cursorGrab, cursorGrabMask, color).toDataURL()\n    cursor = Graphics.colorizedCanvas(cursorHand, cursorHandMask, color).toDataURL()\n    updatePlayerCursorState(cursorState)\n  }\n  updatePlayerCursorColor(playerColor())\n\n  const doSetSpeedStatus = () => {\n    if (HUD.setReplaySpeed) {\n      HUD.setReplaySpeed(REPLAY.speeds[REPLAY.speedIdx])\n    }\n    if (HUD.setReplayPaused) {\n      HUD.setReplayPaused(REPLAY.paused)\n    }\n  }\n\n  const replayOnSpeedUp = () => {\n    if (REPLAY.speedIdx + 1 < REPLAY.speeds.length) {\n      REPLAY.speedIdx++\n      doSetSpeedStatus()\n    }\n  }\n  const replayOnSpeedDown = () => {\n    if (REPLAY.speedIdx >= 1) {\n      REPLAY.speedIdx--\n      doSetSpeedStatus()\n    }\n  }\n  const replayOnPauseToggle = () => {\n    REPLAY.paused = !REPLAY.paused\n    doSetSpeedStatus()\n  }\n\n  const intervals: NodeJS.Timeout[] = []\n  let to: NodeJS.Timeout\n  const clearIntervals = () => {\n    intervals.forEach(inter => {\n      clearInterval(inter)\n    })\n    if (to) {\n      clearTimeout(to)\n    }\n  }\n\n  let gameLoopInstance: GameLoopInstance\n  const unload = () => {\n    clearIntervals()\n    if (gameLoopInstance) {\n      gameLoopInstance.stop()\n    }\n  }\n\n  if (MODE === MODE_PLAY) {\n    intervals.push(setInterval(() => {\n      updateStatus(TIME())\n    }, 1000))\n  } else if (MODE === MODE_REPLAY) {\n    doSetSpeedStatus()\n  }\n\n  if (MODE === MODE_PLAY) {\n    Communication.onServerChange((msg: ServerEvent) => {\n      const msgType = msg[0]\n      const evClientId = msg[1]\n      const evClientSeq = msg[2]\n      const evChanges = msg[3]\n      for (const [changeType, changeData] of evChanges) {\n        switch (changeType) {\n          case Protocol.CHANGE_PLAYER: {\n            const p = Util.decodePlayer(changeData)\n            if (p.id !== clientId) {\n              Game.setPlayer(gameId, p.id, p)\n              RERENDER = true\n            }\n          } break;\n          case Protocol.CHANGE_TILE: {\n            const t = Util.decodePiece(changeData)\n            Game.setPiece(gameId, t.idx, t)\n            RERENDER = true\n          } break;\n          case Protocol.CHANGE_DATA: {\n            Game.setPuzzleData(gameId, changeData)\n            RERENDER = true\n          } break;\n        }\n      }\n      finished = !! Game.getFinishTs(gameId)\n    })\n  } else if (MODE === MODE_REPLAY) {\n    const handleLogEntry = (logEntry: any[], ts: Timestamp) => {\n      const entry = logEntry\n      if (entry[0] === Protocol.LOG_ADD_PLAYER) {\n        const playerId = entry[1]\n        Game.addPlayer(gameId, playerId, ts)\n        return true\n      }\n      if (entry[0] === Protocol.LOG_UPDATE_PLAYER) {\n        const playerId = Game.getPlayerIdByIndex(gameId, entry[1])\n        if (!playerId) {\n          throw '[ 2021-05-17 player not found (update player) ]'\n        }\n        Game.addPlayer(gameId, playerId, ts)\n        return true\n      }\n      if (entry[0] === Protocol.LOG_HANDLE_INPUT) {\n        const playerId = Game.getPlayerIdByIndex(gameId, entry[1])\n        if (!playerId) {\n          throw '[ 2021-05-17 player not found (handle input) ]'\n        }\n        const input = entry[2]\n        Game.handleInput(gameId, playerId, input, ts)\n        return true\n      }\n      return false\n    }\n\n    let GAME_TS = REPLAY.lastGameTs\n    const next = async () => {\n      if (REPLAY.logPointer + 1 >= REPLAY.log.length) {\n        await queryNextReplayBatch(gameId)\n      }\n\n      const realTs = Time.timestamp()\n      if (REPLAY.paused) {\n        REPLAY.lastRealTs = realTs\n        to = setTimeout(next, 50)\n        return\n      }\n      const timePassedReal = realTs - REPLAY.lastRealTs\n      const timePassedGame = timePassedReal * REPLAY.speeds[REPLAY.speedIdx]\n      let maxGameTs = REPLAY.lastGameTs + timePassedGame\n      do {\n        if (REPLAY.paused) {\n          break\n        }\n        const nextIdx = REPLAY.logPointer + 1\n        if (nextIdx >= REPLAY.log.length) {\n          break\n        }\n\n        const currLogEntry = REPLAY.log[REPLAY.logPointer]\n        const currTs: Timestamp = GAME_TS + currLogEntry[currLogEntry.length - 1]\n\n        const nextLogEntry = REPLAY.log[nextIdx]\n        const diffToNext = nextLogEntry[nextLogEntry.length - 1]\n        const nextTs: Timestamp = currTs + diffToNext\n        if (nextTs > maxGameTs) {\n          // next log entry is too far into the future\n          if (REPLAY.skipNonActionPhases && (maxGameTs + 500 * Time.MS < nextTs)) {\n            maxGameTs += diffToNext\n          }\n          break\n        }\n\n        GAME_TS = currTs\n        if (handleLogEntry(nextLogEntry, nextTs)) {\n          RERENDER = true\n        }\n        REPLAY.logPointer = nextIdx\n      } while (true)\n      REPLAY.lastRealTs = realTs\n      REPLAY.lastGameTs = maxGameTs\n      updateStatus(TIME())\n\n      if (!REPLAY.final) {\n        to = setTimeout(next, 50)\n      }\n    }\n\n    next()\n  }\n\n  let _last_mouse_down: Point|null = null\n  const onUpdate = (): void => {\n    // handle key downs once per onUpdate\n    // this will create Protocol.INPUT_EV_MOVE events if something\n    // relevant is pressed\n    evts.createKeyEvents()\n\n    for (const evt of evts.consumeAll()) {\n      if (MODE === MODE_PLAY) {\n        // LOCAL ONLY CHANGES\n        // -------------------------------------------------------------\n        const type = evt[0]\n        if (type === Protocol.INPUT_EV_MOVE) {\n          const w = evt[1]\n          const h = evt[2]\n          const dim = viewport.worldDimToViewport({w, h})\n          RERENDER = true\n          viewport.move(dim.w, dim.h)\n          delete viewportSnapshots['last']\n        } else if (type === Protocol.INPUT_EV_MOUSE_MOVE) {\n          if (_last_mouse_down && !Game.getFirstOwnedPiece(gameId, clientId)) {\n            // move the cam\n            const pos = { x: evt[1], y: evt[2] }\n            const mouse = viewport.worldToViewport(pos)\n            const diffX = Math.round(mouse.x - _last_mouse_down.x)\n            const diffY = Math.round(mouse.y - _last_mouse_down.y)\n            RERENDER = true\n            viewport.move(diffX, diffY)\n\n            _last_mouse_down = mouse\n            delete viewportSnapshots['last']\n          }\n        } else if (type === Protocol.INPUT_EV_PLAYER_COLOR) {\n          updatePlayerCursorColor(evt[1])\n        } else if (type === Protocol.INPUT_EV_MOUSE_DOWN) {\n          const pos = { x: evt[1], y: evt[2] }\n          _last_mouse_down = viewport.worldToViewport(pos)\n          updatePlayerCursorState(true)\n        } else if (type === Protocol.INPUT_EV_MOUSE_UP) {\n          _last_mouse_down = null\n          updatePlayerCursorState(false)\n        } else if (type === Protocol.INPUT_EV_ZOOM_IN) {\n          const pos = { x: evt[1], y: evt[2] }\n          RERENDER = true\n          viewport.zoom('in', viewport.worldToViewport(pos))\n          delete viewportSnapshots['last']\n        } else if (type === Protocol.INPUT_EV_ZOOM_OUT) {\n          const pos = { x: evt[1], y: evt[2] }\n          RERENDER = true\n          viewport.zoom('out', viewport.worldToViewport(pos))\n          delete viewportSnapshots['last']\n        } else if (type === Protocol.INPUT_EV_TOGGLE_PREVIEW) {\n          HUD.togglePreview()\n        } else if (type === Protocol.INPUT_EV_TOGGLE_SOUNDS) {\n          HUD.toggleSoundsEnabled()\n        } else if (type === Protocol.INPUT_EV_TOGGLE_PLAYER_NAMES) {\n          HUD.togglePlayerNames()\n        } else if (type === Protocol.INPUT_EV_CENTER_FIT_PUZZLE) {\n          handleViewportSnapshot('center')\n        } else if (type === Protocol.INPUT_EV_TOGGLE_FIXED_PIECES) {\n          PIECE_VIEW_FIXED = !PIECE_VIEW_FIXED\n          RERENDER = true\n        } else if (type === Protocol.INPUT_EV_TOGGLE_LOOSE_PIECES) {\n          PIECE_VIEW_LOOSE = !PIECE_VIEW_LOOSE\n          RERENDER = true\n        } else if (type === Protocol.INPUT_EV_STORE_POS) {\n          const slot: string = `${evt[1]}`\n          viewportSnapshots[slot] = viewport.snapshot()\n        } else if (type === Protocol.INPUT_EV_RESTORE_POS) {\n          const slot: string = `${evt[1]}`\n          handleViewportSnapshot(slot)\n        }\n\n        // LOCAL + SERVER CHANGES\n        // -------------------------------------------------------------\n        const ts = TIME()\n        const changes = Game.handleInput(\n          gameId,\n          clientId,\n          evt,\n          ts,\n          (playerId: string) => {\n            if (playerSoundEnabled()) {\n              playClick()\n            }\n          }\n        )\n        if (changes.length > 0) {\n          RERENDER = true\n        }\n        Communication.sendClientEvent(evt)\n      } else if (MODE === MODE_REPLAY) {\n        // LOCAL ONLY CHANGES\n        // -------------------------------------------------------------\n        const type = evt[0]\n        if (type === Protocol.INPUT_EV_REPLAY_TOGGLE_PAUSE) {\n          replayOnPauseToggle()\n        } else if (type === Protocol.INPUT_EV_REPLAY_SPEED_DOWN) {\n          replayOnSpeedDown()\n        } else if (type === Protocol.INPUT_EV_REPLAY_SPEED_UP) {\n          replayOnSpeedUp()\n        } else if (type === Protocol.INPUT_EV_MOVE) {\n          const diffX = evt[1]\n          const diffY = evt[2]\n          RERENDER = true\n          viewport.move(diffX, diffY)\n        } else if (type === Protocol.INPUT_EV_MOUSE_MOVE) {\n          if (_last_mouse_down) {\n            // move the cam\n            const pos = { x: evt[1], y: evt[2] }\n            const mouse = viewport.worldToViewport(pos)\n            const diffX = Math.round(mouse.x - _last_mouse_down.x)\n            const diffY = Math.round(mouse.y - _last_mouse_down.y)\n            RERENDER = true\n            viewport.move(diffX, diffY)\n\n            _last_mouse_down = mouse\n          }\n        } else if (type === Protocol.INPUT_EV_PLAYER_COLOR) {\n          updatePlayerCursorColor(evt[1])\n        } else if (type === Protocol.INPUT_EV_MOUSE_DOWN) {\n          const pos = { x: evt[1], y: evt[2] }\n          _last_mouse_down = viewport.worldToViewport(pos)\n          updatePlayerCursorState(true)\n        } else if (type === Protocol.INPUT_EV_MOUSE_UP) {\n          _last_mouse_down = null\n          updatePlayerCursorState(false)\n        } else if (type === Protocol.INPUT_EV_ZOOM_IN) {\n          const pos = { x: evt[1], y: evt[2] }\n          RERENDER = true\n          viewport.zoom('in', viewport.worldToViewport(pos))\n        } else if (type === Protocol.INPUT_EV_ZOOM_OUT) {\n          const pos = { x: evt[1], y: evt[2] }\n          RERENDER = true\n          viewport.zoom('out', viewport.worldToViewport(pos))\n        } else if (type === Protocol.INPUT_EV_TOGGLE_PREVIEW) {\n          HUD.togglePreview()\n        } else if (type === Protocol.INPUT_EV_TOGGLE_SOUNDS) {\n          HUD.toggleSoundsEnabled()\n        } else if (type === Protocol.INPUT_EV_TOGGLE_PLAYER_NAMES) {\n          HUD.togglePlayerNames()\n        } else if (type === Protocol.INPUT_EV_CENTER_FIT_PUZZLE) {\n          handleViewportSnapshot('center')\n        } else if (type === Protocol.INPUT_EV_TOGGLE_FIXED_PIECES) {\n          PIECE_VIEW_FIXED = !PIECE_VIEW_FIXED\n          RERENDER = true\n        } else if (type === Protocol.INPUT_EV_TOGGLE_LOOSE_PIECES) {\n          PIECE_VIEW_LOOSE = !PIECE_VIEW_LOOSE\n          RERENDER = true\n        } else if (type === Protocol.INPUT_EV_STORE_POS) {\n          const slot: string = `${evt[1]}`\n          viewportSnapshots[slot] = viewport.snapshot()\n        } else if (type === Protocol.INPUT_EV_RESTORE_POS) {\n          const slot: string = `${evt[1]}`\n          handleViewportSnapshot(slot)\n        }\n      }\n    }\n\n    finished = !! Game.getFinishTs(gameId)\n    if (justFinished()) {\n      fireworks.update()\n      RERENDER = true\n    }\n  }\n\n  const onRender = async (): Promise<void> => {\n    if (!RERENDER) {\n      return\n    }\n\n    const ts = TIME()\n\n    let pos: Point\n    let dim: Dim\n    let bmp: ImageBitmap\n\n    if (window.DEBUG) Debug.checkpoint_start(0)\n\n    // CLEAR CTX\n    // ---------------------------------------------------------------\n    ctx.fillStyle = playerBgColor()\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\n    if (window.DEBUG) Debug.checkpoint('clear done')\n    // ---------------------------------------------------------------\n\n\n    // DRAW BOARD\n    // ---------------------------------------------------------------\n    pos = viewport.worldToViewportRaw(BOARD_POS)\n    dim = viewport.worldDimToViewportRaw(BOARD_DIM)\n    ctx.fillStyle = 'rgba(255, 255, 255, .3)'\n    ctx.fillRect(pos.x, pos.y, dim.w, dim.h)\n    if (window.DEBUG) Debug.checkpoint('board done')\n    // ---------------------------------------------------------------\n\n\n    // DRAW TILES\n    // ---------------------------------------------------------------\n    const tiles = Game.getPiecesSortedByZIndex(gameId)\n    if (window.DEBUG) Debug.checkpoint('get tiles done')\n\n    dim = viewport.worldDimToViewportRaw(PIECE_DIM)\n    for (const tile of tiles) {\n      if (!shouldDrawPiece(tile)) {\n        continue\n      }\n      bmp = bitmaps[tile.idx]\n      pos = viewport.worldToViewportRaw({\n        x: PIECE_DRAW_OFFSET + tile.pos.x,\n        y: PIECE_DRAW_OFFSET + tile.pos.y,\n      })\n      ctx.drawImage(bmp,\n        0, 0, bmp.width, bmp.height,\n        pos.x, pos.y, dim.w, dim.h\n      )\n    }\n    if (window.DEBUG) Debug.checkpoint('tiles done')\n    // ---------------------------------------------------------------\n\n\n    // DRAW PLAYERS\n    // ---------------------------------------------------------------\n    const texts: Array<FixedLengthArray<[string, number, number]>> = []\n    // Cursors\n    for (const p of Game.getActivePlayers(gameId, ts)) {\n      if (shouldDrawPlayer(p)) {\n        bmp = await getPlayerCursor(p)\n        pos = viewport.worldToViewport(p)\n        ctx.drawImage(bmp, pos.x - CURSOR_W_2, pos.y - CURSOR_H_2)\n        if (showPlayerNames()) {\n          // performance:\n          // not drawing text directly here, to have less ctx\n          // switches between drawImage and fillTxt\n          texts.push([`${p.name} (${p.points})`, pos.x, pos.y + CURSOR_H])\n        }\n      }\n    }\n\n    // Names\n    ctx.fillStyle = 'white'\n    ctx.textAlign = 'center'\n    for (const [txt, x, y] of texts) {\n      ctx.fillText(txt, x, y)\n    }\n\n    if (window.DEBUG) Debug.checkpoint('players done')\n\n    // propagate HUD changes\n    // ---------------------------------------------------------------\n    updateStatus(ts)\n    if (window.DEBUG) Debug.checkpoint('HUD done')\n    // ---------------------------------------------------------------\n\n    if (justFinished()) {\n      fireworks.render()\n    }\n\n    RERENDER = false\n  }\n\n  gameLoopInstance = run({\n    update: onUpdate,\n    render: onRender,\n  })\n\n  return {\n    setHotkeys: (state: boolean) => {\n      evts.setHotkeys(state)\n    },\n    onBgChange: (value: string) => {\n      settings.setStr(SETTINGS.COLOR_BACKGROUND, value)\n      evts.addEvent([Protocol.INPUT_EV_BG_COLOR, value])\n    },\n    onColorChange: (value: string) => {\n      settings.setStr(SETTINGS.PLAYER_COLOR, value)\n      evts.addEvent([Protocol.INPUT_EV_PLAYER_COLOR, value])\n    },\n    onNameChange: (value: string) => {\n      settings.setStr(SETTINGS.PLAYER_NAME, value)\n      evts.addEvent([Protocol.INPUT_EV_PLAYER_NAME, value])\n    },\n    onSoundsEnabledChange: (value: boolean) => {\n      settings.setBool(SETTINGS.SOUND_ENABLED, value)\n    },\n    onSoundsVolumeChange: (value: number) => {\n      settings.setInt(SETTINGS.SOUND_VOLUME, value)\n      playClick()\n    },\n    onShowPlayerNamesChange: (value: boolean) => {\n      settings.setBool(SETTINGS.SHOW_PLAYER_NAMES, value)\n    },\n    replayOnSpeedUp,\n    replayOnSpeedDown,\n    replayOnPauseToggle,\n    previewImageUrl,\n    player: {\n      background: playerBgColor(),\n      color: playerColor(),\n      name: playerName(),\n      soundsEnabled: playerSoundEnabled(),\n      soundsVolume: playerSoundVolume(),\n      showPlayerNames: showPlayerNames(),\n    },\n    game: Game.get(gameId),\n    disconnect: Communication.disconnect,\n    connect: connect,\n    unload: unload,\n  }\n}\n","<template>\n  <div id=\"game\">\n    <settings-overlay\n      v-show=\"overlay === 'settings'\"\n      @close=\"toggle('settings', true)\"\n      @bgclick=\"toggle('settings', true)\"\n      v-model=\"g.player\" />\n    <preview-overlay\n      v-show=\"overlay === 'preview'\"\n      @close=\"toggle('preview', false)\"\n      @click=\"toggle('preview', false)\"\n      :img=\"g.previewImageUrl\" />\n    <info-overlay\n      v-if=\"g.game\"\n      v-show=\"overlay === 'info'\"\n      @close=\"toggle('info', true)\"\n      @bgclick=\"toggle('info', true)\"\n      :game=\"g.game\" />\n    <help-overlay\n      v-show=\"overlay === 'help'\"\n      @close=\"toggle('help', true)\"\n      @bgclick=\"toggle('help', true)\" />\n\n    <overlay v-show=\"cuttingPuzzle\">\n      <template v-slot:default>\n        <div>‚è≥ Cutting puzzle, please wait... ‚è≥</div>\n      </template>\n    </overlay>\n\n    <connection-overlay\n      :connectionState=\"connectionState\"\n      @reconnect=\"reconnect\"\n      />\n\n    <div class=\"menu-left\">\n      <puzzle-status :status=\"status\" />\n    </div>\n\n    <div class=\"menu\">\n      <div class=\"tabs\">\n        <router-link class=\"opener\" :to=\"{name: 'index'}\" target=\"_blank\">üß© Puzzles</router-link>\n        <div class=\"opener\" @click=\"toggle('preview', false)\">üñºÔ∏è Preview</div>\n        <div class=\"opener\" @click=\"toggle('settings', true)\">üõ†Ô∏è Settings</div>\n        <div class=\"opener\" @click=\"toggle('info', true)\">‚ÑπÔ∏è Info</div>\n        <div class=\"opener\" @click=\"toggle('help', true)\">‚å®Ô∏è Hotkeys</div>\n      </div>\n    </div>\n\n    <div class=\"menu-right\">\n      <scores :players=\"players\" />\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nimport Scores from './../components/Scores.vue'\nimport PuzzleStatusComponent from './../components/PuzzleStatus.vue'\nimport SettingsOverlay from './../components/SettingsOverlay.vue'\nimport PreviewOverlay from './../components/PreviewOverlay.vue'\nimport InfoOverlay from './../components/InfoOverlay.vue'\nimport ConnectionOverlay from './../components/ConnectionOverlay.vue'\nimport HelpOverlay from './../components/HelpOverlay.vue'\n\nimport { main, MODE_PLAY } from './../game'\nimport { Game, Player, PuzzleStatus } from '../../common/Types'\n\nexport default defineComponent({\n  name: 'game',\n  components: {\n    PuzzleStatusComponent,\n    Scores,\n    SettingsOverlay,\n    PreviewOverlay,\n    InfoOverlay,\n    ConnectionOverlay,\n    HelpOverlay,\n  },\n  data() {\n    return {\n      players: {\n        active: [] as Player[],\n        idle: [] as Player[],\n      },\n\n      status: {\n        finished: false,\n        duration: 0,\n        piecesDone: 0,\n        piecesTotal: 0,\n      } as PuzzleStatus,\n\n      overlay: '',\n\n      connectionState: 0,\n      cuttingPuzzle: true,\n\n      g: {\n        player: {\n          background: '',\n          color: '',\n          name: '',\n          soundsEnabled: true,\n          soundsVolume: 100,\n          showPlayerNames: true,\n        },\n        game: null as Game|null,\n        previewImageUrl: '',\n        setHotkeys: (v: boolean) => {},\n        onBgChange: (v: string) => {},\n        onColorChange: (v: string) => {},\n        onNameChange: (v: string) => {},\n        onSoundsEnabledChange: (v: boolean) => {},\n        onSoundsVolumeChange: (v: number) => {},\n        onShowPlayerNamesChange: (v: boolean) => {},\n        connect: () => {},\n        disconnect: () => {},\n        unload: () => {},\n      },\n    }\n  },\n  async mounted() {\n    if (!this.$route.params.id) {\n      return\n    }\n    this.$watch(() => this.g.player.background, (value: string) => {\n      this.g.onBgChange(value)\n    })\n    this.$watch(() => this.g.player.color, (value: string) => {\n      this.g.onColorChange(value)\n    })\n    this.$watch(() => this.g.player.name, (value: string) => {\n      this.g.onNameChange(value)\n    })\n    this.$watch(() => this.g.player.soundsEnabled, (value: boolean) => {\n      this.g.onSoundsEnabledChange(value)\n    })\n    this.$watch(() => this.g.player.soundsVolume, (value: number) => {\n      this.g.onSoundsVolumeChange(value)\n    })\n    this.$watch(() => this.g.player.showPlayerNames, (value: boolean) => {\n      this.g.onShowPlayerNamesChange(value)\n    })\n    this.g = await main(\n      `${this.$route.params.id}`,\n      // @ts-ignore\n      this.$clientId,\n      // @ts-ignore\n      this.$config.WS_ADDRESS,\n      MODE_PLAY,\n      this.$el,\n      {\n        setPuzzleCut: () => { this.cuttingPuzzle = false },\n        setPlayers: (active: Player[], idle: Player[]) => { this.players = { active, idle } },\n        setStatus: (status: PuzzleStatus) => { this.status = status},\n        togglePreview: () => { this.toggle('preview', false) },\n        setConnectionState: (v: number) => { this.connectionState = v },\n        toggleSoundsEnabled: () => { this.g.player.soundsEnabled = !this.g.player.soundsEnabled },\n        togglePlayerNames: () => { this.g.player.showPlayerNames = !this.g.player.showPlayerNames },\n      }\n    )\n  },\n  unmounted () {\n    this.g.unload()\n    this.g.disconnect()\n  },\n  methods: {\n    reconnect(): void {\n      this.g.connect()\n    },\n    toggle(overlay: string, affectsHotkeys: boolean): void {\n      if (this.overlay === '') {\n        this.overlay = overlay\n        if (affectsHotkeys) {\n          this.g.setHotkeys(false)\n        }\n      } else {\n        // could check if overlay was the provided one\n        this.overlay = ''\n        if (affectsHotkeys) {\n          this.g.setHotkeys(true)\n        }\n      }\n    },\n  },\n})\n</script>\n","<template>\n  <div id=\"replay\">\n    <settings-overlay\n      v-show=\"overlay === 'settings'\"\n      @close=\"toggle('settings', true)\"\n      @bgclick=\"toggle('settings', true)\"\n      v-model=\"g.player\" />\n    <preview-overlay\n      v-show=\"overlay === 'preview'\"\n      @close=\"toggle('preview', false)\"\n      @click=\"toggle('preview', false)\"\n      :img=\"g.previewImageUrl\" />\n    <info-overlay\n      v-if=\"g.game\"\n      v-show=\"overlay === 'info'\"\n      @close=\"toggle('info', true)\"\n      @bgclick=\"toggle('info', true)\"\n      :game=\"g.game\" />\n    <help-overlay\n      v-show=\"overlay === 'help'\"\n      @close=\"toggle('help', true)\"\n      @bgclick=\"toggle('help', true)\" />\n\n    <div class=\"overlay\" v-if=\"cuttingPuzzle\">\n      <div class=\"overlay-content\">\n        <div>‚è≥ Cutting puzzle, please wait... ‚è≥</div>\n      </div>\n    </div>\n\n    <div class=\"menu-left\">\n      <puzzle-status :status=\"status\" />\n      <div class=\"playback-control\">\n        <div>{{replayText}}</div>\n        <button class=\"btn\" @click=\"g.replayOnSpeedUp()\">‚è´</button>\n        <button class=\"btn\" @click=\"g.replayOnSpeedDown()\">‚è¨</button>\n        <button class=\"btn\" @click=\"g.replayOnPauseToggle()\">‚è∏Ô∏è</button>\n      </div>\n    </div>\n\n    <div class=\"menu\">\n      <div class=\"tabs\">\n        <router-link class=\"opener\" :to=\"{name: 'index'}\" target=\"_blank\">üß© Puzzles</router-link>\n        <div class=\"opener\" @click=\"toggle('preview', false)\">üñºÔ∏è Preview</div>\n        <div class=\"opener\" @click=\"toggle('settings', true)\">üõ†Ô∏è Settings</div>\n        <div class=\"opener\" @click=\"toggle('info', true)\">‚ÑπÔ∏è Info</div>\n        <div class=\"opener\" @click=\"toggle('help', true)\">‚å®Ô∏è Hotkeys</div>\n      </div>\n    </div>\n\n    <div class=\"menu-right\">\n      <scores :players=\"players\" />\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nimport Scores from './../components/Scores.vue'\nimport PuzzleStatusComponent from './../components/PuzzleStatus.vue'\nimport SettingsOverlay from './../components/SettingsOverlay.vue'\nimport PreviewOverlay from './../components/PreviewOverlay.vue'\nimport InfoOverlay from './../components/InfoOverlay.vue'\nimport HelpOverlay from './../components/HelpOverlay.vue'\n\nimport { main, MODE_REPLAY } from './../game'\nimport { Game, Player, PuzzleStatus } from '../../common/Types'\n\nexport default defineComponent({\n  name: 'replay',\n  components: {\n    PuzzleStatusComponent,\n    Scores,\n    SettingsOverlay,\n    PreviewOverlay,\n    InfoOverlay,\n    HelpOverlay,\n  },\n  data() {\n    return {\n      players: {\n        active: [] as Player[],\n        idle: [] as Player[],\n      },\n\n      status: {\n        finished: false,\n        duration: 0,\n        piecesDone: 0,\n        piecesTotal: 0,\n      } as PuzzleStatus,\n\n      overlay: '',\n\n      connectionState: 0,\n      cuttingPuzzle: true,\n\n      g: {\n        player: {\n          background: '',\n          color: '',\n          name: '',\n          soundsEnabled: true,\n          soundsVolume: 100,\n          showPlayerNames: true,\n        },\n        game: null as Game|null,\n        previewImageUrl: '',\n        setHotkeys: (v: boolean) => {},\n        onBgChange: (v: string) => {},\n        onColorChange: (v: string) => {},\n        onNameChange: (v: string) => {},\n        onSoundsEnabledChange: (v: boolean) => {},\n        onSoundsVolumeChange: (v: number) => {},\n        onShowPlayerNamesChange: (v: boolean) => {},\n        replayOnSpeedUp: () => {},\n        replayOnSpeedDown: () => {},\n        replayOnPauseToggle: () => {},\n        connect: () => {},\n        disconnect: () => {},\n        unload: () => {},\n      },\n\n      replay: {\n        speed: 1,\n        paused: false,\n      },\n    }\n  },\n  async mounted() {\n    if (!this.$route.params.id) {\n      return\n    }\n    this.$watch(() => this.g.player.background, (value: string) => {\n      this.g.onBgChange(value)\n    })\n    this.$watch(() => this.g.player.color, (value: string) => {\n      this.g.onColorChange(value)\n    })\n    this.$watch(() => this.g.player.name, (value: string) => {\n      this.g.onNameChange(value)\n    })\n    this.$watch(() => this.g.player.soundsEnabled, (value: boolean) => {\n      this.g.onSoundsEnabledChange(value)\n    })\n    this.$watch(() => this.g.player.soundsVolume, (value: number) => {\n      this.g.onSoundsVolumeChange(value)\n    })\n    this.$watch(() => this.g.player.showPlayerNames, (value: boolean) => {\n      this.g.onShowPlayerNamesChange(value)\n    })\n    this.g = await main(\n      `${this.$route.params.id}`,\n      // @ts-ignore\n      this.$clientId,\n      // @ts-ignore\n      this.$config.WS_ADDRESS,\n      MODE_REPLAY,\n      this.$el,\n      {\n        setPuzzleCut: () => { this.cuttingPuzzle = false },\n        setPlayers: (active: Player[], idle: Player[]) => { this.players = { active, idle } },\n        setStatus: (status: PuzzleStatus) => { this.status = status },\n        togglePreview: () => { this.toggle('preview', false) },\n        setConnectionState: (v: number) => { this.connectionState = v },\n        setReplaySpeed: (v: number) => { this.replay.speed = v },\n        setReplayPaused: (v: boolean) => { this.replay.paused = v },\n        toggleSoundsEnabled: () => { this.g.player.soundsEnabled = !this.g.player.soundsEnabled },\n        togglePlayerNames: () => { this.g.player.showPlayerNames = !this.g.player.showPlayerNames },\n      }\n    )\n  },\n  unmounted () {\n    this.g.unload()\n    this.g.disconnect()\n  },\n  methods: {\n    toggle(overlay: string, affectsHotkeys: boolean): void {\n      if (this.overlay === '') {\n        this.overlay = overlay\n        if (affectsHotkeys) {\n          this.g.setHotkeys(false)\n        }\n      } else {\n        // could check if overlay was the provided one\n        this.overlay = ''\n        if (affectsHotkeys) {\n          this.g.setHotkeys(true)\n        }\n      }\n    },\n  },\n  computed: {\n    replayText (): string {\n      return 'Replay-Speed: ' +\n        (this.replay.speed + 'x') +\n        (this.replay.paused ? ' Paused' : '')\n    },\n  },\n})\n</script>\n","<template>\n  <div\n    class=\"imageteaser\"\n    :style=\"style\"\n    @click=\"onClick\">\n    <div class=\"btn edit\" v-if=\"canEdit\" @click.stop=\"onEditClick\">‚úèÔ∏è</div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: {\n    image: {\n      type: Object,\n      required: true,\n    },\n  },\n  computed: {\n    style(): object {\n      const url = this.image.url.replace('uploads/', 'uploads/r/') + '-150x100.webp'\n      return {\n        'backgroundImage': `url(\"${url}\")`,\n      }\n    },\n    canEdit(): boolean {\n      if (!this.$me.id) {\n        return false\n      }\n      return this.$me.id === this.image.uploaderUserId\n    },\n  },\n  emits: {\n    click: null,\n    editClick: null,\n  },\n  methods: {\n    onClick() {\n      this.$emit('click')\n    },\n    onEditClick() {\n      this.$emit('editClick')\n    },\n  },\n})\n</script>\n<style type=\"css\">\n.imageteaser { position: relative; }\n.imageteaser .edit { display: none; position: absolute; }\n.imageteaser:hover .edit { display: inline-block; }\n</style>\n","<template>\n  <transition name=\"overlay\"\n    :duration=\"animate ? { enter: 300, leave: 250 } : 0\"\n    @before-enter=\"classes=['enter-from']\"\n    @enter=\"classes=['enter-active']\"\n    @after-enter=\"classes=[]\"\n    @before-leave=\"classes=['leave-to', 'leave-active']\"\n  >\n    <div class=\"overlay\">\n      <div\n        class=\"overlay-background\"\n        @click=\"$emit('bgclick')\"\n        :class=\"classes.map(c => 'overlay-background-' + c)\">\n      </div>\n      <div\n        class=\"overlay-content\"\n        :class=\"classes.map(c => 'overlay-content-' + c)\">\n        <slot />\n      </div>\n    </div>\n  </transition>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: {\n    animate: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  emits: {\n    bgclick: null,\n    close: null,\n  },\n  data: () => ({\n    classes: [],\n  }),\n  methods: {\n    onKeyUp(ev: KeyboardEvent) {\n      if (ev.code === 'Escape' && window.getComputedStyle(this.$el).display !== 'none') {\n        this.$emit('close')\n      }\n    },\n  },\n  mounted () {\n    window.addEventListener('keyup', this.onKeyUp)\n  },\n  unmounted () {\n    window.removeEventListener('keyup', this.onKeyUp)\n  },\n})\n</script>\n","<template>\n  <div :style=\"style\" :title=\"title\"></div>\n</template>\n<script>\nexport default {\n  props: {\n    src: String,\n    title: {\n      type: String,\n      default: '',\n    },\n    height: {\n      type: String,\n      default: '100%',\n    },\n    width: {\n      type: String,\n      default: '100%',\n    },\n  },\n  computed: {\n    style() {\n      return {\n        display: 'inline-block',\n        verticalAlign: 'text-bottom',\n        backgroundImage: `url('${this.src}')`,\n        backgroundRepeat: 'no-repeat',\n        backgroundSize: 'contain',\n        backgroundPosition: 'center',\n        width: this.width,\n        height: this.height,\n      }\n    },\n  },\n}\n</script>\n","<template>\n  <div>\n    <input\n      ref=\"input\"\n      class=\"input\"\n      type=\"text\"\n      v-model=\"input\"\n      placeholder=\"Plants, People\"\n      @change=\"onChange\"\n      @keydown.enter=\"add\"\n      @keyup=\"onKeyUp\"\n      />\n    <div v-if=\"autocomplete.values\" class=\"autocomplete\">\n      <ul>\n        <li\n          v-for=\"(val,idx) in autocomplete.values\"\n          :key=\"idx\"\n          :class=\"{active: idx===autocomplete.idx}\"\n          @click=\"addVal(val)\"\n          >{{val}}</li>\n      </ul>\n    </div>\n    <span v-for=\"(tag,idx) in values\" :key=\"idx\" class=\"bit\" @click=\"rm(tag)\">{{tag}} ‚úñ</span>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue'\n\nexport default defineComponent({\n  props: {\n    modelValue: {\n      type: Array as PropType<string[]>,\n      required: true,\n    },\n    autocompleteTags: {\n      type: Function,\n    },\n  },\n  emits: {\n    'update:modelValue': null,\n  },\n  data () {\n    return {\n      input: '',\n      values: [] as string[],\n      autocomplete: {\n        idx: -1,\n        values: [] as string[],\n      },\n    }\n  },\n  created () {\n    this.values = this.modelValue\n  },\n  methods: {\n    onKeyUp (ev: KeyboardEvent) {\n      if (ev.code === 'ArrowDown' && this.autocomplete.values.length > 0) {\n        if (this.autocomplete.idx < this.autocomplete.values.length - 1) {\n          this.autocomplete.idx++\n        }\n        ev.stopPropagation()\n        return false\n      }\n      if (ev.code === 'ArrowUp' && this.autocomplete.values.length > 0) {\n        if (this.autocomplete.idx > 0) {\n          this.autocomplete.idx--\n        }\n        ev.stopPropagation()\n        return false\n      }\n      if (ev.key === ',') {\n        this.add()\n        ev.stopPropagation()\n        return false\n      }\n\n      if (this.input && this.autocompleteTags) {\n        this.autocomplete.values = this.autocompleteTags(\n          this.input,\n          this.values\n        )\n        this.autocomplete.idx = -1\n      } else {\n        this.autocomplete.values = []\n        this.autocomplete.idx = -1\n      }\n    },\n    addVal (value: string) {\n      const newval = value.replace(/,/g, '').trim()\n      if (!newval) {\n        return\n      }\n      if (!this.values.includes(newval)) {\n        this.values.push(newval)\n      }\n      this.input = ''\n      this.autocomplete.values = []\n      this.autocomplete.idx = -1\n      this.$emit('update:modelValue', this.values)\n      ;(this.$refs.input as HTMLInputElement).focus()\n    },\n    add () {\n      const value = this.autocomplete.idx >= 0\n        ? this.autocomplete.values[this.autocomplete.idx]\n        : this.input\n      this.addVal(value)\n    },\n    rm (val: string) {\n      this.values = this.values.filter(v => v !== val)\n      this.$emit('update:modelValue', this.values)\n    },\n  }\n})\n</script>\n<style scoped>\n.input {\n  margin-bottom: .5em;\n}\n.autocomplete {\n  position: relative;\n}\n.autocomplete ul { list-style: none;\n  padding: 0;\n  margin: 0;\n  position: absolute;\n  left: 0;\n  right: 0;\n  background: #333230;\n  top: -.5em;\n}\n.autocomplete ul li {\n  position: relative;\n  padding: .5em .5em .5em 1.5em;\n  cursor: pointer;\n}\n.autocomplete ul li.active {\n  color: var(--link-hover-color);\n  background: var(--input-bg-color);\n}\n.autocomplete ul li.active:before {\n  content: '‚ñ∂';\n  display: block;\n  position: absolute;\n  left: .5em;\n}\n</style>\n","<template>\n  <label>\n    <input type=\"file\" style=\"display: none\" @change=\"upload\" :accept=\"accept\" />\n    <span class=\"btn\">{{label || 'Upload File'}}</span>\n  </label>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport xhr from '../xhr'\n\nexport default defineComponent({\n  props: {\n    accept: String,\n    label: String,\n  },\n  methods: {\n    async upload(evt: Event) {\n      const target = (evt.target as HTMLInputElement)\n      if (!target.files) return;\n      const file = target.files[0]\n      if (!file) return;\n      const formData = new FormData();\n      formData.append('file', file, file.name);\n      const res = await xhr.post('/upload', {\n        body: formData,\n      })\n      const j = await res.json()\n      this.$emit('uploaded', j)\n    },\n  }\n})\n</script>\n","import * as VueRouter from 'vue-router'\nimport * as Vue from 'vue'\n\nimport App from './App.vue'\nimport Index from './views/Index.vue'\nimport NewGame from './views/NewGame.vue'\nimport Game from './views/Game.vue'\nimport Replay from './views/Replay.vue'\nimport Util from './../common/Util'\nimport settings from './settings'\nimport xhr from './xhr'\n\nimport ConnectionOverlay from './components/ConnectionOverlay.vue'\nimport EditImageDialog from './components/EditImageDialog.vue'\nimport GameTeaser from './components/GameTeaser.vue'\nimport HelpOverlay from './components/HelpOverlay.vue'\nimport ImageLibrary from './components/ImageLibrary.vue'\nimport ImageTeaser from './components/ImageTeaser.vue'\nimport InfoOverlay from './components/InfoOverlay.vue'\nimport NewGameDialog from './components/NewGameDialog.vue'\nimport NewImageDialog from './components/NewImageDialog.vue'\nimport Overlay from './components/Overlay.vue'\nimport PreviewOverlay from './components/PreviewOverlay.vue'\nimport PuzzleStatus from './components/PuzzleStatus.vue'\nimport ResponsiveImage from './components/ResponsiveImage.vue'\nimport Scores from './components/Scores.vue'\nimport SettingsOverlay from './components/SettingsOverlay.vue'\nimport TagsInput from './components/TagsInput.vue'\nimport Upload from './components/Upload.vue'\n\n(async () => {\n  function initClientSecret() {\n    let SECRET = settings.getStr('SECRET', '')\n    if (!SECRET) {\n      SECRET = Util.uniqId()\n      settings.setStr('SECRET', SECRET)\n    }\n    return SECRET\n  }\n  function initClientId() {\n    let ID = settings.getStr('ID', '')\n    if (!ID) {\n      ID = Util.uniqId()\n      settings.setStr('ID', ID)\n    }\n    return ID\n  }\n  const clientId = initClientId()\n  const clientSecret = initClientSecret()\n  xhr.setClientId(clientId)\n  xhr.setClientSecret(clientSecret)\n\n  const meRes = await xhr.get(`/api/me`, {})\n  const me = await meRes.json()\n\n  const confRes = await xhr.get(`/api/conf`, {})\n  const conf = await confRes.json()\n\n  const router = VueRouter.createRouter({\n    history: VueRouter.createWebHashHistory(),\n    routes: [\n      { name: 'index', path: '/', component: Index },\n      { name: 'new-game', path: '/new-game', component: NewGame },\n      { name: 'game', path: '/g/:id', component: Game },\n      { name: 'replay', path: '/replay/:id', component: Replay },\n    ],\n  })\n\n  router.beforeEach((to, from) => {\n    if (from.name) {\n      document.documentElement.classList.remove(`view-${String(from.name)}`)\n    }\n    document.documentElement.classList.add(`view-${String(to.name)}`)\n  })\n\n  const app = Vue.createApp(App)\n  app.config.globalProperties.$me = me\n  app.config.globalProperties.$config = conf\n  app.config.globalProperties.$clientId = clientId\n  app.use(router)\n  app.component('connection-overlay', ConnectionOverlay)\n  app.component('edit-image-dialog', EditImageDialog)\n  app.component('game-teaser', GameTeaser)\n  app.component('help-overlay', HelpOverlay)\n  app.component('image-library', ImageLibrary)\n  app.component('image-teaser', ImageTeaser)\n  app.component('info-overlay', InfoOverlay)\n  app.component('new-game-dialog', NewGameDialog)\n  app.component('new-image-dialog', NewImageDialog)\n  app.component('overlay', Overlay)\n  app.component('preview-overlay', PreviewOverlay)\n  app.component('puzzle-status', PuzzleStatus)\n  app.component('responsive-image', ResponsiveImage)\n  app.component('scores', Scores)\n  app.component('settings-overlay', SettingsOverlay)\n  app.component('tags-input', TagsInput)\n  app.component('upload', Upload)\n  app.mount('#app')\n})()\n"],"names":["_sfc_main","_openBlock","_createElementBlock","_createCommentVNode","_withCtx","_hoisted_1","_createTextVNode","_Fragment","_createBlock","log","_normalizeClass","_hoisted_3","_hoisted_4","_hoisted_6","_hoisted_7","_createElementVNode","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_14","_hoisted_5","_createVNode","_hoisted_2","_toDisplayString","_withDirectives","get","Game","fireworksController","PuzzleStatusComponent","_normalizeStyle","VueRouter.createRouter","VueRouter.createWebHashHistory","Vue.createApp"],"mappings":"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"}