import{m as Ft,d as Z,r as ve,a as k,o as c,c as F,w as le,b as o,e as H,v as Ce,f as w,u as Qn,g as Jn,h as Fe,i as y,j as qe,k as f,l as M,F as oe,n as De,t as C,p as de,q as Ve,s as Le,x as be,y as es,z as ts,A as tn,B as At,C as on,D as zo,E as os,G as ns,H as Do,I as ss,J as is,K as ls,L as as}from"./vendor.6d6835b9.js";const rs=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerpolicy&&(l.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?l.credentials="include":i.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}};rs();class ft{constructor(t){this.rand_high=t||3735929054,this.rand_low=t^1231121986}random(t,n){this.rand_high=(this.rand_high<<16)+(this.rand_high>>16)+this.rand_low&4294967295,this.rand_low=this.rand_low+this.rand_high&4294967295;const s=(this.rand_high>>>0)/4294967295;return t+s*(n-t+1)|0}choice(t){return t[this.random(0,t.length-1)]}shuffle(t){const n=t.slice();for(let s=0;s<=n.length-2;s++){const i=this.random(s,n.length-1),l=n[s];n[s]=n[i],n[i]=l}return n}static serialize(t){return{rand_high:t.rand_high,rand_low:t.rand_low}}static unserialize(t){const n=new ft(0);return n.rand_high=t.rand_high,n.rand_low=t.rand_low,n}}const us=e=>{let t=e.toLowerCase();return t=t.replace(/[^a-z0-9]+/g,"-"),t=t.replace(/^-|-$/,""),t},ct=(e,t)=>{const n=`${e}`;return n.length>=t.length?n:t.substr(0,t.length-n.length)+n},jt=(...e)=>{const t=n=>(...s)=>{const i=new Date,l=ct(i.getHours(),"00"),r=ct(i.getMinutes(),"00"),u=ct(i.getSeconds(),"00");console[n](`${l}:${r}:${u}`,...e,...s)};return{log:t("log"),error:t("error"),info:t("info")}},cs=()=>Date.now().toString(36)+Math.random().toString(36).substring(2);function ds(e){return e.top+1<<0|e.right+1<<2|e.bottom+1<<4|e.left+1<<6}function hs(e){return{top:(e>>0&3)-1,right:(e>>2&3)-1,bottom:(e>>4&3)-1,left:(e>>6&3)-1}}function ps(e){return[e.idx,e.pos.x,e.pos.y,e.z,e.owner,e.group]}function gs(e){return{idx:e[0],pos:{x:e[1],y:e[2]},z:e[3],owner:e[4],group:e[5]}}function ms(e){return[e.id,e.x,e.y,e.d,e.name,e.color,e.bgcolor,e.points,e.ts]}function fs(e){return{id:e[0],x:e[1],y:e[2],d:e[3],name:e[4],color:e[5],bgcolor:e[6],points:e[7],ts:e[8]}}function _s(e){return[e.id,e.rng.type||"",ft.serialize(e.rng.obj),e.puzzle,e.players,e.scoreMode,e.shapeMode,e.snapMode,e.creatorUserId,e.hasReplay,e.gameVersion,e.private]}function ys(e){return{id:e[0],rng:{type:e[1],obj:ft.unserialize(e[2])},puzzle:e[3],players:e[4],scoreMode:e[5],shapeMode:e[6],snapMode:e[7],creatorUserId:e[8],hasReplay:e[9],gameVersion:e[10],private:e[11]}}function ws(e,t){const n=e.width/e.tileSize;return{x:t%n,y:Math.floor(t/n)}}function vs(e,t){const n=e.width/e.pieceSize;return{x:t%n,y:Math.floor(t/n)}}const Es=e=>{let t=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t=(t<<5)-t+s,t|=0}return t};function Ps(e){const t=[];for(const n in e){const s=[n,e[n]].map(encodeURIComponent);t.push(s.join("="))}return t.length===0?"":`?${t.join("&")}`}var W={hash:Es,slug:us,pad:ct,uniqId:cs,encodeShape:ds,decodeShape:hs,encodePiece:ps,decodePiece:gs,encodePlayer:ms,decodePlayer:fs,encodeGame:_s,decodeGame:ys,coordByPieceIdxDeprecated:ws,coordByPieceIdx:vs,asQueryArgs:Ps};const ee={SOUND_VOLUME:"sound_volume",SOUND_ENABLED:"sound_enabled",OTHER_PLAYER_CLICK_SOUND_ENABLED:"other_player_click_sound_enabled",COLOR_BACKGROUND:"bg_color",SHOW_TABLE:"show_table",TABLE_TEXTURE:"table_texture",PLAYER_COLOR:"player_color",PLAYER_NAME:"player_name",SHOW_PLAYER_NAMES:"show_player_names"},fe={SOUND_VOLUME:100,SOUND_ENABLED:!0,OTHER_PLAYER_CLICK_SOUND_ENABLED:!0,COLOR_BACKGROUND:"#222222",SHOW_TABLE:!0,TABLE_TEXTURE:"dark",PLAYER_COLOR:"#ffffff",PLAYER_NAME:"anon",SHOW_PLAYER_NAMES:!0},nn=()=>({background:"",showTable:!0,tableTexture:"dark",color:"",name:"",soundsEnabled:!0,otherPlayerClickSoundEnabled:!0,soundsVolume:100,showPlayerNames:!0}),Ht=(e,t)=>{localStorage.setItem(e,t)},Zt=e=>localStorage.getItem(e),bs=(e,t)=>{Ht(e,`${t}`)},Ts=(e,t)=>{const n=Zt(e);if(n===null)return t;const s=parseInt(n,10);return isNaN(s)?t:s},$s=(e,t)=>{Ht(e,t?"1":"0")},Cs=(e,t)=>{const n=Zt(e);return n===null?t:n==="1"},Ss=(e,t)=>{Ht(e,t)},ks=(e,t)=>{const n=Zt(e);return n===null?t:n};var Q={setInt:bs,getInt:Ts,setBool:$s,getBool:Cs,setStr:Ss,getStr:ks};let Ot="",sn="";const $t=async(e,t,n)=>new Promise((s,i)=>{const l=new window.XMLHttpRequest;l.open(e,t,!0),l.withCredentials=!0;for(const r in n.headers||{})l.setRequestHeader(r,n.headers[r]);l.setRequestHeader("Client-Id",Ot),l.setRequestHeader("Client-Secret",sn),l.addEventListener("load",function(r){s({status:this.status,text:this.responseText,json:async()=>JSON.parse(this.responseText)})}),l.addEventListener("error",function(r){i(new Error("xhr error"))}),l.upload&&n.onUploadProgress&&l.upload.addEventListener("progress",function(r){n.onUploadProgress&&n.onUploadProgress(r)}),l.send(n.body||null)}),Bo=e=>{let t=Q.getStr(e,"");return t||(t=W.uniqId(),Q.setStr(e,t)),t};var ce={init:()=>{Ot=Bo("ID"),sn=Bo("SECRET")},request:$t,get:(e,t)=>$t("get",e,t),post:(e,t)=>$t("post",e,t),clientId:()=>Ot};const As=async(e,t)=>await ce.post("/api/auth",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({login:e,pass:t})}),Os=async()=>await ce.post("/api/logout",{headers:{Accept:"application/json","Content-Type":"application/json"},body:{}});var ln={auth:As,logout:Os};let ht=null;const Kt=Ft();async function an(){const e=await ce.get("/api/me",{});ht=e.status===200?await e.json():null,ht&&(console.log("loggedin"),Kt.emit("login"))}async function Ns(){return(await(await ln.logout()).json()).success?(ht=null,console.log("loggedout"),Kt.emit("logout"),{error:!1}):{error:"[2021-09-25 18:36]"}}async function Us(e,t){const n=await ln.auth(e,t);return n.status===200?(await an(),{error:!1}):n.status===401?{error:(await n.json()).reason}:{error:"Unknown error"}}var re={getMe:()=>ht,eventBus:Kt,logout:Ns,login:Us,init:an};const Rs=o("h2",null,"Login",-1),Ls=w("Name: "),Vs=w("Pass: "),Ms=Z({setup(e){const t=ve(""),n=ve("");async function s(){await re.login(t.value,n.value)}return(i,l)=>{const r=k("overlay");return c(),F(r,{class:"login-dialog"},{default:le(()=>[Rs,o("div",null,[Ls,H(o("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=u=>t.value=u)},null,512),[[Ce,t.value]])]),o("div",null,[Vs,H(o("input",{type:"password","onUpdate:modelValue":l[1]||(l[1]=u=>n.value=u)},null,512),[[Ce,n.value]])]),o("span",{class:"btn",onClick:s},"Login")]),_:1})}}}),zs={key:0,class:"nav"},Ds=w("Games overview"),Bs=w("New game"),Gs={href:"https://stand-with-ukraine.pp.ua/",class:"btn btn-ukraine",target:"_blank"},Is=w(" Stand with Ukraine "),xs={style:{float:"right"}},Ys=Z({setup(e){const t=ve(!1),n=ve(!1),s=Qn(),i=Jn(()=>!["game","replay"].includes(String(s.name)));async function l(){await re.logout()}const r=()=>{t.value=!0};return Fe(async()=>{var u;n.value=(u=re.getMe())==null?void 0:u.loggedIn,re.eventBus.on("login",()=>{console.log("login"),n.value=!0,t.value=!1}),re.eventBus.on("logout",()=>{console.log("logout"),n.value=!1})}),(u,h)=>{const g=k("router-link"),p=k("icon");return c(),y(oe,null,[qe(i)?(c(),y("ul",zs,[o("li",null,[f(g,{class:"btn",to:{name:"index"}},{default:le(()=>[Ds]),_:1})]),o("li",null,[f(g,{class:"btn",to:{name:"new-game"}},{default:le(()=>[Bs]),_:1})]),o("li",null,[o("a",Gs,[f(p,{icon:"ukraine-heart"}),Is,f(p,{icon:"ukraine-heart"})])]),o("li",xs,[n.value?(c(),y("span",{key:0,class:"btn",onClick:l},"Logout")):(c(),y("span",{key:1,class:"btn",onClick:r},"Login"))])])):M("",!0),t.value?(c(),F(Ms,{key:1,onClose:h[0]||(h[0]=B=>t.value=!1),onBgclick:h[1]||(h[1]=B=>t.value=!1)})):M("",!0)],64)}}}),Ws={id:"app"},Fs=Z({setup(e){return(t,n)=>{const s=k("router-view");return c(),y("div",Ws,[f(Ys),f(s)])}}}),rn=1,qt=rn*1e3,pt=qt*60,gt=pt*60,Nt=gt*24,js=()=>{const e=new Date;return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},un=e=>{const t=Math.floor(e/Nt);e=e%Nt;const n=Math.floor(e/gt);e=e%gt;const s=Math.floor(e/pt);e=e%pt;const i=Math.floor(e/qt);return`${t}d ${n}h ${s}m ${i}s`},Hs=(e,t)=>un(t-e);var $e={MS:rn,SEC:qt,MIN:pt,HOUR:gt,DAY:Nt,timestamp:js,timeDiffStr:Hs,durationStr:un},ae=(e,t)=>{const n=e.__vccOpts||e;for(const[s,i]of t)n[s]=i;return n};const Zs=Z({props:{game:{type:Object,required:!0}},computed:{style(){return{"background-image":`url("${this.game.imageUrl.replace("uploads/","uploads/r/")+"-375x210.webp"}")`}}},methods:{time(e,t){const n=e,s=t||$e.timestamp();return`${$e.timeDiffStr(n,s)}`}}}),Ks={class:"game-teaser"},qs={class:"game-info-text"},Xs=o("br",null,null,-1),Qs=o("br",null,null,-1),Js=o("br",null,null,-1),ei=w(" Watch replay ");function ti(e,t,n,s,i,l){const r=k("icon"),u=k("router-link");return c(),y("div",Ks,[o("div",{class:"game-teaser-inner",style:De(e.style)},[f(u,{class:"game-info",to:{name:"game",params:{id:e.game.id}}},{default:le(()=>[o("span",qs,[f(r,{icon:"puzzle-piece"}),w(" "+C(e.game.piecesFinished)+"/"+C(e.game.piecesTotal),1),Xs,f(r,{icon:"sillouette"}),w(" "+C(e.game.players),1),Qs,e.game.finished?(c(),F(r,{key:1,icon:"flag"})):(c(),F(r,{key:0,icon:"clock"})),w(" "+C(e.time(e.game.started,e.game.finished)),1),Js])]),_:1},8,["to"]),e.game.hasReplay?(c(),F(u,{key:0,class:"game-replay",to:{name:"replay",params:{id:e.game.id}}},{default:le(()=>[f(r,{icon:"replay"}),ei]),_:1},8,["to"])):M("",!0)],4)])}var cn=ae(Zs,[["render",ti]]);const oi=Z({components:{GameTeaser:cn},data(){return{gamesRunning:[],gamesFinished:[]}},async created(){const t=await(await ce.get("/api/index-data",{})).json();this.gamesRunning=t.gamesRunning,this.gamesFinished=t.gamesFinished}}),ni=o("h1",null,"Running games",-1),si=o("h1",null,"Finished games",-1);function ii(e,t,n,s,i,l){const r=k("game-teaser");return c(),y("div",null,[ni,(c(!0),y(oe,null,de(e.gamesRunning,(u,h)=>(c(),F(r,{key:h,game:u},null,8,["game"]))),128)),si,(c(!0),y(oe,null,de(e.gamesFinished,(u,h)=>(c(),F(r,{key:h,game:u},null,8,["game"]))),128))])}var li=ae(oi,[["render",ii]]);const ai=Z({props:{images:{type:Array,required:!0}},emits:{imageClicked:null,imageEditClicked:null},methods:{imageClicked(e){this.$emit("imageClicked",e)},imageEditClicked(e){this.$emit("imageEditClicked",e)}}});function ri(e,t,n,s,i,l){const r=k("image-teaser"),u=k("masonry-wall");return c(),F(u,{items:e.images,"column-width":320,gap:10},{default:le(({item:h,index:g})=>[(c(),F(r,{image:h,onClick:p=>e.imageClicked(h),onEditClick:p=>e.imageEditClicked(h),key:g},null,8,["image","onClick","onEditClick"]))]),_:1},8,["items"])}var dn=ae(ai,[["render",ri]]);const ui=async e=>{const t=await di(e),n=await ci(t);return hn(n.toDataURL())},ci=async e=>{const t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),t},di=async e=>new Promise((t,n)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{t(s)},s.onerror=i=>{n(i)},s.src=e});function hn(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],s=atob(t[1]),i=s.length,l=new Uint8Array(i);i--;)l[i]=s.charCodeAt(i);return new Blob([l],{type:n})}const hi=Z({props:{autocompleteTags:{type:Function},uploadProgress:{type:Number},uploading:{type:String}},emits:["setupGameClick","postToGalleryClick","close"],data(){return{previewUrl:"",file:null,title:"",tags:[],isPrivate:!1,droppable:!1,inputFocused:!1}},computed:{uploadProgressPercent(){return this.uploadProgress?Math.round(this.uploadProgress*100):0},canPostToGallery(){return this.uploading?!1:!!(this.previewUrl&&this.file)},canSetupGameClick(){return this.uploading?!1:!!(this.previewUrl&&this.file)}},mounted(){window.addEventListener("paste",this.onPaste)},unmounted(){window.removeEventListener("paste",this.onPaste)},methods:{reset(){this.previewUrl="",this.file=null,this.title="",this.tags=[],this.isPrivate=!1,this.droppable=!1},imageFromDragEvt(e){var s;const t=(s=e.dataTransfer)==null?void 0:s.items;if(!t||t.length===0)return null;const n=t[0];return n.type.startsWith("image/")?n:null},async onPaste(e){const t=e.clipboardData.getData("text");if(t){if(this.inputFocused)return;if(t.match(/^https?:\/\//)){const s="/api/proxy?"+new URLSearchParams({url:t});try{const i=await ui(s);this.preview(i)}catch(i){console.error("unable to transform image http url into blob",i)}}else if(t.match(/^data:image\/([a-z]+);base64,/))try{const s=hn(t);this.preview(s)}catch(s){console.error("unable to transform image data url into blob",s)}else console.log(t)}const n=e.clipboardData.files[0];!n||this.preview(n)},onFileSelect(e){const t=e.target;if(!t.files)return;const n=t.files[0];!n||this.preview(n)},preview(e){if(!e.type.startsWith("image/")){console.error("file type is not supported",e.type);return}const t=new FileReader;t.readAsDataURL(e),t.onload=n=>{this.previewUrl=n.target.result,this.file=e}},postToGallery(){this.$emit("postToGalleryClick",{file:this.file,title:this.title,tags:this.tags,isPrivate:this.isPrivate}),this.reset()},setupGameClick(){this.$emit("setupGameClick",{file:this.file,title:this.title,tags:this.tags,isPrivate:this.isPrivate}),this.reset()},onDrop(e){this.droppable=!1;const t=this.imageFromDragEvt(e);if(!t)return!1;const n=t.getAsFile();return n&&(this.file=n,this.preview(n),e.preventDefault()),!1},onDragover(e){return this.imageFromDragEvt(e)&&(this.droppable=!0,e.preventDefault()),!1},onDragleave(){this.droppable=!1}}}),pi=o("div",{class:"drop-target"},null,-1),gi={key:0,class:"has-image"},mi={key:1},fi={class:"upload"},_i=o("div",{class:"upload-content"},[w(" How to upload an image? Choose any of the following methods: "),o("ul",null,[o("li",null,"Click this area to select an image for upload "),o("li",null,"Drag and drop an image into the area"),o("li",null,"Paste an image URL"),o("li",null,"Paste an image")]),o("div",{class:"hint"},` Don't worry, the image will not show up in the gallery unless "Post to gallery" was clicked. `)],-1),yi={class:"area-settings"},wi=o("td",null,[o("label",null,"Title")],-1),vi=o("tr",null,[o("td",{colspan:"2"},[o("div",{class:"hint"},"Feel free to leave a credit to the artist/photographer in the title :)")])],-1),Ei=o("td",null,[o("label",null,"Private Image")],-1),Pi={class:"checkbox-only"},bi=o("tr",null,[o("td",{colspan:"2"},[o("div",{class:"hint"},"Private images won't show up in the gallery.")])],-1),Ti=o("td",null,[o("label",null,"Tags")],-1),$i={class:"area-buttons"},Ci=["disabled"],Si=w(" Post to gallery"),ki=["disabled"],Ai=w(" Set up game"),Oi=w(" Post to gallery "),Ni=o("br",null,null,-1),Ui=w(" + set up game");function Ri(e,t,n,s,i,l){const r=k("responsive-image"),u=k("tags-input"),h=k("icon"),g=k("overlay");return c(),F(g,{class:"new-image-dialog"},{default:le(()=>[o("div",{class:Ve(["area-image",{"has-image":!!e.previewUrl,"no-image":!e.previewUrl,droppable:e.droppable}]),onDrop:t[2]||(t[2]=(...p)=>e.onDrop&&e.onDrop(...p)),onDragover:t[3]||(t[3]=(...p)=>e.onDragover&&e.onDragover(...p)),onDragleave:t[4]||(t[4]=(...p)=>e.onDragleave&&e.onDragleave(...p))},[pi,e.previewUrl?(c(),y("div",gi,[o("span",{class:"remove btn",onClick:t[0]||(t[0]=p=>e.previewUrl="")},"X"),f(r,{src:e.previewUrl},null,8,["src"])])):(c(),y("div",mi,[o("label",fi,[o("input",{type:"file",style:{display:"none"},onChange:t[1]||(t[1]=(...p)=>e.onFileSelect&&e.onFileSelect(...p)),accept:"image/*"},null,32),_i])]))],34),o("div",yi,[o("table",null,[o("tr",null,[wi,o("td",null,[H(o("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=p=>e.title=p),placeholder:"Flower by @artist",onFocus:t[6]||(t[6]=p=>e.inputFocused=!0),onBlur:t[7]||(t[7]=p=>e.inputFocused=!1)},null,544),[[Ce,e.title]])])]),vi,o("tr",null,[Ei,o("td",Pi,[H(o("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=p=>e.isPrivate=p)},null,512),[[Le,e.isPrivate]])])]),bi,o("tr",null,[Ti,o("td",null,[f(u,{modelValue:e.tags,"onUpdate:modelValue":t[9]||(t[9]=p=>e.tags=p),autocompleteTags:e.autocompleteTags},null,8,["modelValue","autocompleteTags"])])])])]),o("div",$i,[e.isPrivate?M("",!0):(c(),y("button",{key:0,class:"btn",disabled:!e.canPostToGallery,onClick:t[10]||(t[10]=(...p)=>e.postToGallery&&e.postToGallery(...p))},[e.uploading==="postToGallery"?(c(),y(oe,{key:0},[w("Uploading ("+C(e.uploadProgressPercent)+"%)",1)],64)):(c(),y(oe,{key:1},[f(h,{icon:"preview"}),Si],64))],8,Ci)),o("button",{class:"btn",disabled:!e.canSetupGameClick,onClick:t[11]||(t[11]=(...p)=>e.setupGameClick&&e.setupGameClick(...p))},[e.uploading==="setupGame"?(c(),y(oe,{key:0},[w("Uploading ("+C(e.uploadProgressPercent)+"%)",1)],64)):e.isPrivate?(c(),y(oe,{key:1},[f(h,{icon:"puzzle-piece"}),Ai],64)):(c(),y(oe,{key:2},[f(h,{icon:"puzzle-piece"}),Oi,Ni,Ui],64))],8,ki),o("button",{class:"btn",onClick:t[12]||(t[12]=p=>e.$emit("close"))},"Cancel")])]),_:1})}var pn=ae(hi,[["render",Ri]]);const Li=Z({props:{image:{type:Object,required:!0},autocompleteTags:{type:Function}},emits:["saveClick","close"],data(){return{title:"",tags:[]}},watch:{image(e,t){this.init(e)}},created(){this.init(this.image)},methods:{init(e){this.title=e.title,this.tags=e.tags.map(t=>t.title)},saveImage(){this.$emit("saveClick",{id:this.image.id,title:this.title,tags:this.tags})}}}),Vi={class:"area-image"},Mi={class:"has-image"},zi={class:"area-settings"},Di=o("td",null,[o("label",null,"Title")],-1),Bi=o("tr",null,[o("td",{colspan:"2"},[o("div",{class:"hint"},"Feel free to leave a credit to the artist/photographer in the title :)")])],-1),Gi=o("td",null,[o("label",null,"Tags")],-1),Ii={class:"area-buttons"},xi=w(" Save image");function Yi(e,t,n,s,i,l){const r=k("responsive-image"),u=k("tags-input"),h=k("icon"),g=k("overlay");return c(),F(g,{class:"edit-image-dialog"},{default:le(()=>[o("div",Vi,[o("div",Mi,[f(r,{src:e.image.url,title:e.image.title},null,8,["src","title"])])]),o("div",zi,[o("table",null,[o("tr",null,[Di,o("td",null,[H(o("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=p=>e.title=p),placeholder:"Flower by @artist"},null,512),[[Ce,e.title]])])]),Bi,o("tr",null,[Gi,o("td",null,[f(u,{modelValue:e.tags,"onUpdate:modelValue":t[1]||(t[1]=p=>e.tags=p),autocompleteTags:e.autocompleteTags},null,8,["modelValue","autocompleteTags"])])])])]),o("div",Ii,[o("button",{class:"btn",onClick:t[2]||(t[2]=(...p)=>e.saveImage&&e.saveImage(...p))},[f(h,{icon:"preview"}),xi]),o("button",{class:"btn",onClick:t[3]||(t[3]=p=>e.$emit("close"))},"Cancel")])]),_:1})}var gn=ae(Li,[["render",Yi]]),Me=(e=>(e[e.FINAL=0]="FINAL",e[e.ANY=1]="ANY",e))(Me||{}),Je=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ANY=1]="ANY",e[e.FLAT=2]="FLAT",e))(Je||{}),We=(e=>(e[e.NORMAL=0]="NORMAL",e[e.REAL=1]="REAL",e))(We||{});const Wi=Z({props:{image:{type:Object,required:!0},forcePrivate:{type:Boolean,default:!1}},emits:["newGame","close"],data(){return{tiles:1e3,isPrivate:!1,scoreMode:Me.ANY,shapeMode:Je.NORMAL,snapMode:We.NORMAL}},mounted(){this.isPrivate=this.forcePrivate},methods:{onNewGameClick(){this.$emit("newGame",{tiles:this.tilesInt,private:this.isPrivate,image:this.image,scoreMode:this.scoreModeInt,shapeMode:this.shapeModeInt,snapMode:this.snapModeInt})}},computed:{canStartNewGame(){return!(!this.tilesInt||!this.image||!this.image.url||![0,1].includes(this.scoreModeInt))},scoreModeInt(){return parseInt(`${this.scoreMode}`,10)},shapeModeInt(){return parseInt(`${this.shapeMode}`,10)},snapModeInt(){return parseInt(`${this.snapMode}`,10)},tilesInt(){return parseInt(`${this.tiles}`,10)}}}),Fi={class:"area-image"},ji={class:"has-image"},Hi={key:0,class:"image-title"},Zi={key:0,class:"image-title-title"},Ki={key:1,class:"image-title-dim"},qi={class:"area-settings"},Xi=o("td",null,[o("label",null,"Pieces")],-1),Qi=o("td",null,[o("label",null,"Scoring: ")],-1),Ji=w(" Any (Score when pieces are connected to each other or on final location)"),el=o("br",null,null,-1),tl=w(" Final (Score when pieces are put to their final location)"),ol=o("td",null,[o("label",null,"Shapes: ")],-1),nl=w(" Normal"),sl=o("br",null,null,-1),il=w(" Any (Flat pieces can occur anywhere)"),ll=o("br",null,null,-1),al=w(" Flat (All pieces flat on all sides)"),rl=o("td",null,[o("label",null,"Snapping: ")],-1),ul=w(" Normal (Pieces snap to final destination and to each other)"),cl=o("br",null,null,-1),dl=w(" Real (Pieces snap only to corners, already snapped pieces and to each other)"),hl=o("td",null,[o("label",null,"Private Game")],-1),pl={class:"checkbox-only"},gl=["disabled"],ml=o("tr",null,[o("td",{colspan:"2"},[o("div",{class:"hint"},"Private games won't show up in the game overview.")])],-1),fl={key:0},_l=o("td",null,[o("label",null,"Tags: ")],-1),yl={class:"area-buttons"},wl=["disabled"],vl=w(" Generate Puzzle ");function El(e,t,n,s,i,l){const r=k("responsive-image"),u=k("icon"),h=k("overlay");return c(),F(h,{class:"new-game-dialog"},{default:le(()=>[o("div",Fi,[o("div",ji,[f(r,{src:e.image.url,title:e.image.title},null,8,["src","title"])]),e.image.title||e.image.width||e.image.height?(c(),y("div",Hi,[e.image.title?(c(),y("span",Zi,'"'+C(e.image.title)+'"',1)):M("",!0),e.image.width||e.image.height?(c(),y("span",Ki,"("+C(e.image.width)+" \u2715 "+C(e.image.height)+")",1)):M("",!0)])):M("",!0)]),o("div",qi,[o("table",null,[o("tr",null,[Xi,o("td",null,[H(o("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=g=>e.tiles=g)},null,512),[[Ce,e.tiles]])])]),o("tr",null,[Qi,o("td",null,[o("label",null,[H(o("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=g=>e.scoreMode=g),value:"1"},null,512),[[be,e.scoreMode]]),Ji]),el,o("label",null,[H(o("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=g=>e.scoreMode=g),value:"0"},null,512),[[be,e.scoreMode]]),tl])])]),o("tr",null,[ol,o("td",null,[o("label",null,[H(o("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=g=>e.shapeMode=g),value:"0"},null,512),[[be,e.shapeMode]]),nl]),sl,o("label",null,[H(o("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=g=>e.shapeMode=g),value:"1"},null,512),[[be,e.shapeMode]]),il]),ll,o("label",null,[H(o("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=g=>e.shapeMode=g),value:"2"},null,512),[[be,e.shapeMode]]),al])])]),o("tr",null,[rl,o("td",null,[o("label",null,[H(o("input",{type:"radio","onUpdate:modelValue":t[6]||(t[6]=g=>e.snapMode=g),value:"0"},null,512),[[be,e.snapMode]]),ul]),cl,o("label",null,[H(o("input",{type:"radio","onUpdate:modelValue":t[7]||(t[7]=g=>e.snapMode=g),value:"1"},null,512),[[be,e.snapMode]]),dl])])]),o("tr",null,[hl,o("td",pl,[H(o("input",{disabled:e.forcePrivate,type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=g=>e.isPrivate=g)},null,8,gl),[[Le,e.isPrivate]])])]),ml,e.image.tags.length?(c(),y("tr",fl,[_l,o("td",null,[(c(!0),y(oe,null,de(e.image.tags,(g,p)=>(c(),y("span",{key:p,class:"bit"},C(g.title),1))),128))])])):M("",!0)])]),o("div",yl,[o("button",{class:"btn",disabled:!e.canStartNewGame,onClick:t[9]||(t[9]=(...g)=>e.onNewGameClick&&e.onNewGameClick(...g))},[f(u,{icon:"puzzle-piece"}),vl],8,wl),o("button",{class:"btn",onClick:t[10]||(t[10]=g=>e.$emit("close"))},"Cancel")])]),_:1})}var mn=ae(Wi,[["render",El]]);const Pl=Z({components:{ImageLibrary:dn,NewImageDialog:pn,EditImageDialog:gn,NewGameDialog:mn},data(){return{filters:{sort:"date_desc",tags:[]},images:[],tags:[],image:{id:0,filename:"",file:"",url:"",title:"",tags:[],created:0},dialog:"",newGameForcePrivate:!1,uploading:"",uploadProgress:0}},async created(){await this.loadImages()},computed:{relevantTags(){return this.tags.filter(e=>e.total>0)}},methods:{autocompleteTags(e,t){return this.tags.filter(n=>!t.includes(n.title)&&n.title.toLowerCase().startsWith(e.toLowerCase())).slice(0,10).map(n=>n.title)},toggleTag(e){this.filters.tags.includes(e.slug)?this.filters.tags=this.filters.tags.filter(t=>t!==e.slug):this.filters.tags.push(e.slug),this.filtersChanged()},async loadImages(){const t=await(await ce.get(`/api/newgame-data${W.asQueryArgs(this.filters)}`,{})).json();this.images=t.images,this.tags=t.tags},async filtersChanged(){await this.loadImages()},onImageClicked(e){this.image=e,this.newGameForcePrivate=!1,this.dialog="new-game"},onImageEditClicked(e){this.image=e,this.dialog="edit-image"},async uploadImage(e){this.uploadProgress=0;const t=new FormData;t.append("file",e.file,e.file.name),t.append("title",e.title),t.append("tags",e.tags),t.append("private",e.isPrivate);const n=await ce.post("/api/upload",{body:t,onUploadProgress:s=>{this.uploadProgress=s.loaded/s.total}});return this.uploadProgress=1,await n.json()},async saveImage(e){return await(await ce.post("/api/save-image",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:e.id,title:e.title,tags:e.tags})})).json()},async onSaveImageClick(e){const t=await this.saveImage(e);t.ok?(this.dialog="",await this.loadImages()):alert(t.error)},async postToGalleryClick(e){this.uploading="postToGallery",await this.uploadImage(e),this.uploading="",this.dialog="",await this.loadImages()},async setupGameClick(e){this.uploading="setupGame";const t=await this.uploadImage(e);this.uploading="",this.loadImages(),this.image=t,this.newGameForcePrivate=e.isPrivate,this.dialog="new-game"},async onNewGame(e){const t=await ce.post("/api/newgame",{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status===200){const n=await t.json();this.$router.push({name:"game",params:{id:n.id}})}}}}),bl=o("div",{class:"hint"},"(The image you upload will be added to the public gallery.)",-1),Tl={key:0},$l=w(" Tags: "),Cl=["onClick"],Sl=w(" Sort by: "),kl=ts('<option value="date_desc">Newest first</option><option value="date_asc">Oldest first</option><option value="alpha_asc">A-Z</option><option value="alpha_desc">Z-A</option><option value="game_count_asc">Most plays first</option><option value="game_count_desc">Least plays first</option>',6),Al=[kl];function Ol(e,t,n,s,i,l){const r=k("image-library"),u=k("new-image-dialog"),h=k("edit-image-dialog"),g=k("new-game-dialog");return c(),y("div",null,[o("div",{class:Ve(["upload-image-teaser",{blurred:e.dialog!==""}])},[o("div",{class:"btn is-big",onClick:t[0]||(t[0]=p=>e.dialog="new-image")},"Upload your image"),bl],2),o("div",{class:Ve({blurred:e.dialog!==""})},[e.tags.length>0?(c(),y("label",Tl,[$l,(c(!0),y(oe,null,de(e.relevantTags,(p,B)=>(c(),y("span",{class:Ve(["bit is-clickable",{on:e.filters.tags.includes(p.slug)}]),key:B,onClick:P=>e.toggleTag(p)},C(p.title)+" ("+C(p.total)+")",11,Cl))),128))])):M("",!0),o("label",null,[Sl,H(o("select",{"onUpdate:modelValue":t[1]||(t[1]=p=>e.filters.sort=p),onChange:t[2]||(t[2]=(...p)=>e.filtersChanged&&e.filtersChanged(...p))},Al,544),[[es,e.filters.sort]])])],2),f(r,{class:Ve({blurred:e.dialog!==""}),images:e.images,onImageClicked:e.onImageClicked,onImageEditClicked:e.onImageEditClicked},null,8,["class","images","onImageClicked","onImageEditClicked"]),e.dialog==="new-image"?(c(),F(u,{key:0,autocompleteTags:e.autocompleteTags,onClose:t[3]||(t[3]=p=>e.dialog=""),onBgclick:t[4]||(t[4]=p=>e.dialog=""),uploadProgress:e.uploadProgress,uploading:e.uploading,onPostToGalleryClick:e.postToGalleryClick,onSetupGameClick:e.setupGameClick},null,8,["autocompleteTags","uploadProgress","uploading","onPostToGalleryClick","onSetupGameClick"])):M("",!0),e.dialog==="edit-image"?(c(),F(h,{key:1,autocompleteTags:e.autocompleteTags,onClose:t[5]||(t[5]=p=>e.dialog=""),onBgclick:t[6]||(t[6]=p=>e.dialog=""),onSaveClick:e.onSaveImageClick,image:e.image},null,8,["autocompleteTags","onSaveClick","image"])):M("",!0),e.image&&e.dialog==="new-game"?(c(),F(g,{key:2,onClose:t[7]||(t[7]=p=>e.dialog=""),onBgclick:t[8]||(t[8]=p=>e.dialog=""),onNewGame:e.onNewGame,image:e.image,forcePrivate:e.newGameForcePrivate},null,8,["onNewGame","image","forcePrivate"])):M("",!0)])}var Nl=ae(Pl,[["render",Ol]]);const Ul=Z({props:{players:{type:Object,required:!0}},methods:{playerStyle(e){return e.color==="ukraine"?{backgroundImage:"linear-gradient(180deg, rgba(0,87,183,1) 0%, rgba(0,87,183,1) 50%, rgba(255,221,0,1) 50%)","-webkit-background-clip":"text","-webkit-text-fill-color":"transparent"}:{color:e.color}}},computed:{actives(){return this.players.active.sort((e,t)=>t.points-e.points),this.players.active},idles(){return this.players.idle.sort((e,t)=>t.points-e.points),this.players.idle}}}),Rl={class:"scores"},Ll=o("div",null,"Scores",-1);function Vl(e,t,n,s,i,l){const r=k("icon");return c(),y("div",Rl,[Ll,o("table",null,[(c(!0),y(oe,null,de(e.actives,(u,h)=>(c(),y("tr",{key:h,style:De(e.playerStyle(u))},[o("td",null,[f(r,{icon:"lightning"})]),o("td",null,C(u.name),1),o("td",null,C(u.points),1)],4))),128)),(c(!0),y(oe,null,de(e.idles,(u,h)=>(c(),y("tr",{key:h,style:De(e.playerStyle(u))},[o("td",null,[f(r,{icon:"zzz"})]),o("td",null,C(u.name),1),o("td",null,C(u.points),1)],4))),128))])])}var Xt=ae(Ul,[["render",Vl]]);const Ml=Z({props:{status:{type:Object,required:!0}},computed:{durationStr(){return $e.durationStr(this.status.duration)}}}),zl={class:"puzzle-status"};function Dl(e,t,n,s,i,l){const r=k("icon");return c(),y("div",zl,[o("div",null,[f(r,{icon:"puzzle-piece"}),w(" "+C(e.status.piecesDone)+"/"+C(e.status.piecesTotal),1)]),o("div",null,[e.status.finished?(c(),F(r,{key:1,icon:"flag"})):(c(),F(r,{key:0,icon:"clock"})),w(" "+C(e.durationStr),1)])])}var Qt=ae(Ml,[["render",Dl]]);const Bl=Z({emits:{"update:modelValue":null},props:{modelValue:{type:Object,required:!0}},data:()=>({showTable:!1,tableTexture:"dark",background:"",color:"",isUkraineColor:!1,name:"",soundsEnabled:!0,otherPlayerClickSoundEnabled:!0,soundsVolume:100,showPlayerNames:!0,watches:[]}),methods:{updateVolume(e){const t=parseInt(e.target.value);this.soundsVolume=t},decreaseVolume(){this.soundsVolume=Math.max(0,this.soundsVolume-5)},increaseVolume(){this.soundsVolume=Math.min(100,this.soundsVolume+5)},apply(e){this.disableWatches(),this.showTable=!!e.showTable,this.tableTexture=e.tableTexture,this.background=`${e.background}`,this.color=`${e.color}`,this.isUkraineColor=this.color==="ukraine",this.name=`${e.name}`,this.soundsEnabled=!!e.soundsEnabled,this.otherPlayerClickSoundEnabled=!!e.otherPlayerClickSoundEnabled,this.soundsVolume=parseInt(`${e.soundsVolume}`,10),this.showPlayerNames=!!e.showPlayerNames,this.enableWatches()},emitChanges(){this.$emit("update:modelValue",{showTable:this.showTable,tableTexture:this.tableTexture,background:this.background,color:this.isUkraineColor?"ukraine":this.color,name:this.name,soundsEnabled:this.soundsEnabled,otherPlayerClickSoundEnabled:this.otherPlayerClickSoundEnabled,soundsVolume:this.soundsVolume,showPlayerNames:this.showPlayerNames})},enableWatches(){this.watches.push(this.$watch(()=>this.isUkraineColor,this.emitChanges)),this.watches.push(this.$watch(()=>this.background,this.emitChanges)),this.watches.push(this.$watch(()=>this.showTable,this.emitChanges)),this.watches.push(this.$watch(()=>this.tableTexture,this.emitChanges)),this.watches.push(this.$watch(()=>this.color,this.emitChanges)),this.watches.push(this.$watch(()=>this.name,this.emitChanges)),this.watches.push(this.$watch(()=>this.soundsEnabled,this.emitChanges)),this.watches.push(this.$watch(()=>this.otherPlayerClickSoundEnabled,this.emitChanges)),this.watches.push(this.$watch(()=>this.soundsVolume,this.emitChanges)),this.watches.push(this.$watch(()=>this.showPlayerNames,this.emitChanges))},disableWatches(){const e=this.watches;this.watches=[],e.forEach(t=>t())}},created(){this.apply(this.modelValue)}}),Gl={class:"settings"},Il=o("td",null,[o("label",null,"Background: ")],-1),xl=o("td",null,[o("label",null,"Table: ")],-1),Yl=w("Show"),Wl={key:0},Fl=w(" Dark"),jl={key:1},Hl=w(" Brown"),Zl={key:2},Kl=w(" Light"),ql=o("td",null,[o("label",null,"Color: ")],-1),Xl=o("td",null,[o("label",null,"Name: ")],-1),Ql=o("td",null,[o("label",null,"Sounds: ")],-1),Jl=o("td",null,[o("label",null,"Piece connect sounds of others: ")],-1),ea=["disabled"],ta=o("td",null,[o("label",null,"Sounds Volume: ")],-1),oa={class:"sound-volume"},na=["disabled","value"],sa=o("td",null,[o("label",null,"Show player names: ")],-1);function ia(e,t,n,s,i,l){const r=k("icon"),u=k("overlay");return c(),F(u,{class:"transparent"},{default:le(()=>[o("table",Gl,[o("tr",null,[Il,o("td",null,[H(o("input",{type:"color","onUpdate:modelValue":t[0]||(t[0]=h=>e.background=h)},null,512),[[Ce,e.background]])])]),o("tr",null,[xl,o("td",null,[o("label",null,[H(o("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=h=>e.showTable=h)},null,512),[[Le,e.showTable]]),Yl]),e.showTable?(c(),y("label",Wl,[H(o("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=h=>e.tableTexture=h),value:"dark"},null,512),[[be,e.tableTexture]]),Fl])):M("",!0),e.showTable?(c(),y("label",jl,[H(o("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=h=>e.tableTexture=h),value:"brown"},null,512),[[be,e.tableTexture]]),Hl])):M("",!0),e.showTable?(c(),y("label",Zl,[H(o("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=h=>e.tableTexture=h),value:"light"},null,512),[[be,e.tableTexture]]),Kl])):M("",!0)])]),o("tr",null,[ql,o("td",null,[e.isUkraineColor?M("",!0):H((c(),y("input",{key:0,type:"color","onUpdate:modelValue":t[5]||(t[5]=h=>e.color=h)},null,512)),[[Ce,e.color]]),o("label",null,[H(o("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=h=>e.isUkraineColor=h)},null,512),[[Le,e.isUkraineColor]]),f(r,{icon:"ukraine-heart"})])])]),o("tr",null,[Xl,o("td",null,[H(o("input",{type:"text",maxLength:"16","onUpdate:modelValue":t[7]||(t[7]=h=>e.name=h)},null,512),[[Ce,e.name]])])]),o("tr",null,[Ql,o("td",null,[H(o("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=h=>e.soundsEnabled=h)},null,512),[[Le,e.soundsEnabled]])])]),o("tr",null,[Jl,o("td",null,[H(o("input",{type:"checkbox",disabled:!e.soundsEnabled,"onUpdate:modelValue":t[9]||(t[9]=h=>e.otherPlayerClickSoundEnabled=h)},null,8,ea),[[Le,e.otherPlayerClickSoundEnabled]])])]),o("tr",null,[ta,o("td",oa,[o("span",{onClick:t[10]||(t[10]=(...h)=>e.decreaseVolume&&e.decreaseVolume(...h))},[f(r,{icon:"volume-down"})]),o("input",{disabled:!e.soundsEnabled,type:"range",min:"0",max:"100",value:e.soundsVolume,onChange:t[11]||(t[11]=(...h)=>e.updateVolume&&e.updateVolume(...h))},null,40,na),o("span",{onClick:t[12]||(t[12]=(...h)=>e.increaseVolume&&e.increaseVolume(...h))},[f(r,{icon:"volume-up"})])])]),o("tr",null,[sa,o("td",null,[H(o("input",{type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=h=>e.showPlayerNames=h)},null,512),[[Le,e.showPlayerNames]])])])])]),_:1})}var Jt=ae(Bl,[["render",ia]]);const la=Z({props:{img:String},computed:{previewStyle(){return{backgroundImage:`url('${this.img}')`}}}}),aa={class:"preview"};function ra(e,t,n,s,i,l){const r=k("overlay");return c(),F(r,{class:"preview-overlay"},{default:le(()=>[o("div",aa,[o("div",{class:"img",style:De(e.previewStyle)},null,4)])]),_:1})}var eo=ae(la,[["render",ra]]);const ua=Z({props:{game:{type:Object,required:!0}},computed:{scoreMode(){switch(this.game.scoreMode){case Me.ANY:return["Any","Score when pieces are connected to each other or on final location"];case Me.FINAL:default:return["Final","Score when pieces are put to their final location"]}},shapeMode(){switch(this.game.shapeMode){case Je.FLAT:return["Flat","All pieces flat on all sides"];case Je.ANY:return["Any","Flat pieces can occur anywhere"];case Je.NORMAL:default:return["Normal",""]}},snapMode(){switch(this.game.snapMode){case We.REAL:return["Real","Pieces snap only to corners, already snapped pieces and to each other"];case We.NORMAL:default:return["Normal","Pieces snap to final destination and to each other"]}}}}),ca={class:"help"},da=o("tr",null,[o("td",{colspan:"2"},"Info about this puzzle")],-1),ha=o("td",null,"Image Title: ",-1),pa=o("td",null,"Scoring: ",-1),ga=["title"],ma=o("td",null,"Shapes: ",-1),fa=["title"],_a=o("td",null,"Snapping: ",-1),ya=["title"];function wa(e,t,n,s,i,l){const r=k("overlay");return c(),F(r,{class:"transparent"},{default:le(()=>[o("table",ca,[da,o("tr",null,[ha,o("td",null,C(e.game.puzzle.info.image.title),1)]),o("tr",null,[pa,o("td",null,[o("span",{title:e.snapMode[1]},C(e.scoreMode[0]),9,ga)])]),o("tr",null,[ma,o("td",null,[o("span",{title:e.snapMode[1]},C(e.shapeMode[0]),9,fa)])]),o("tr",null,[_a,o("td",null,[o("span",{title:e.snapMode[1]},C(e.snapMode[0]),9,ya)])])])]),_:1})}var to=ae(ua,[["render",wa]]);const va=4,Ea=1,Pa=4,ba=2,Ta=3,$a=1,Ca=2,Sa=4,ka=3,Aa=1,Oa=2,Na=3,Ua=4,Ra=5,La=6,Va=7,Ma=8,za=9,Da=10,Ba=11,Ga=12,Ia=13,xa=14,Ya=15,Wa=16,Fa=17,ja=18,Ha=19,Za=20,Ka=21,qa=22,Xa=23,Qa=1,Ja=2,er=3,tr=4;var _={EV_SERVER_EVENT:Ea,EV_SERVER_INIT:Pa,EV_CLIENT_EVENT:ba,EV_CLIENT_INIT:Ta,GAME_VERSION:va,LOG_HEADER:$a,LOG_ADD_PLAYER:Ca,LOG_UPDATE_PLAYER:Sa,LOG_HANDLE_INPUT:ka,INPUT_EV_MOVE:za,INPUT_EV_MOUSE_DOWN:Aa,INPUT_EV_MOUSE_UP:Oa,INPUT_EV_MOUSE_MOVE:Na,INPUT_EV_ZOOM_IN:Ua,INPUT_EV_ZOOM_OUT:Ra,INPUT_EV_BG_COLOR:La,INPUT_EV_PLAYER_COLOR:Va,INPUT_EV_PLAYER_NAME:Ma,INPUT_EV_TOGGLE_INTERFACE:Xa,INPUT_EV_TOGGLE_PREVIEW:Da,INPUT_EV_TOGGLE_SOUNDS:Ba,INPUT_EV_REPLAY_TOGGLE_PAUSE:Ga,INPUT_EV_REPLAY_SPEED_UP:Ia,INPUT_EV_REPLAY_SPEED_DOWN:xa,INPUT_EV_TOGGLE_PLAYER_NAMES:Ya,INPUT_EV_CENTER_FIT_PUZZLE:Wa,INPUT_EV_TOGGLE_FIXED_PIECES:Fa,INPUT_EV_TOGGLE_LOOSE_PIECES:ja,INPUT_EV_TOGGLE_TABLE:qa,INPUT_EV_STORE_POS:Ha,INPUT_EV_RESTORE_POS:Za,INPUT_EV_CONNECTION_CLOSE:Ka,CHANGE_DATA:Qa,CHANGE_PIECE:Ja,CHANGE_PLAYER:er,PLAYER_SNAP:tr};const or=jt("Communication.js"),nr=1001,oo=4e3,fn=0,Ut=1,no=2,_n=3,yn=4;let we,Rt=[],Lt=e=>{Rt.push(e)},Vt=[],Mt=e=>{Vt.push(e)};function sr(e){Lt=e;for(const t of Rt)Lt(t);Rt=[]}function ir(e){Mt=e;for(const t of Vt)Mt(t);Vt=[]}let zt=fn;const Ke=e=>{zt!==e&&(zt=e,Mt(e))};function wn(e){if(zt===no)try{we.send(JSON.stringify(e))}catch{or.info("unable to send message.. maybe because ws is invalid?")}}let xe,Ye,Dt=0;function vn(e=2e4){we.readyState==we.OPEN&&we.send(""),Dt=setTimeout(vn,e)}function Go(){Dt&&clearTimeout(Dt)}function lr(e,t,n){return xe=0,Ye={},Ke(_n),new Promise(s=>{we=new WebSocket(e,n+"|"+t),we.onopen=()=>{Ke(no),wn([_.EV_CLIENT_INIT]),vn()},we.onmessage=i=>{const l=JSON.parse(i.data),r=l[0];if(r===_.EV_SERVER_INIT){const u=l[1];s(u)}else if(r===_.EV_SERVER_EVENT){const u=l[1],h=l[2];if(u===n&&Ye[h]){delete Ye[h];return}Lt(l)}else throw`[ 2021-05-09 invalid connect msgType ${r} ]`},we.onerror=()=>{throw Go(),Ke(Ut),"[ 2021-05-15 onerror ]"},we.onclose=i=>{Go(),i.code===oo||i.code===nr?Ke(yn):Ke(Ut)}})}async function ar(e,t){const n={gameId:e,offset:t};return await(await ce.get(`/api/replay-data${W.asQueryArgs(n)}`,{})).json()}function rr(){we&&we.close(oo),xe=0,Ye={}}function ur(e){xe++,Ye[xe]=e,wn([_.EV_CLIENT_EVENT,xe,Ye[xe]])}var Ae={connect:lr,requestReplayData:ar,disconnect:rr,sendClientEvent:ur,onServerChange:sr,onConnectionStateChange:ir,CODE_CUSTOM_DISCONNECT:oo,CONN_STATE_NOT_CONNECTED:fn,CONN_STATE_DISCONNECTED:Ut,CONN_STATE_CLOSED:yn,CONN_STATE_CONNECTED:no,CONN_STATE_CONNECTING:_n};const cr=Z({emits:{reconnect:null},props:{connectionState:Number},computed:{lostConnection(){return this.connectionState===Ae.CONN_STATE_DISCONNECTED},connecting(){return this.connectionState===Ae.CONN_STATE_CONNECTING},show(){return!!(this.lostConnection||this.connecting)}}}),dr={key:0},hr=w(" LOST CONNECTION "),pr={key:2};function gr(e,t,n,s,i,l){const r=k("icon"),u=k("overlay");return H((c(),F(u,{class:"connection-lost"},{default:le(()=>[e.lostConnection?(c(),y("div",dr,[f(r,{icon:"disconnect"}),hr,f(r,{icon:"disconnect"})])):M("",!0),e.lostConnection?(c(),y("span",{key:1,class:"btn",onClick:t[0]||(t[0]=h=>e.$emit("reconnect"))},"Reconnect")):M("",!0),e.connecting?(c(),y("div",pr,"Connecting...")):M("",!0)]),_:1},512)),[[tn,e.show]])}var En=ae(cr,[["render",gr]]);const mr={},fr={class:"help"},_r=w(" Move up:"),yr=o("kbd",null,"W",-1),wr=w("/"),vr=o("kbd",null,"\u2191",-1),Er=w("/"),Pr=w(" Move down:"),br=o("kbd",null,"S",-1),Tr=w("/"),$r=o("kbd",null,"\u2193",-1),Cr=w("/"),Sr=w(" Move left:"),kr=o("kbd",null,"A",-1),Ar=w("/"),Or=o("kbd",null,"\u2190",-1),Nr=w("/"),Ur=w(" Move right:"),Rr=o("kbd",null,"D",-1),Lr=w("/"),Vr=o("kbd",null,"\u2192",-1),Mr=w("/"),zr=o("tr",null,[o("td"),o("td",null,[o("div",null,[w("Move faster by holding "),o("kbd",null,"Shift")])])],-1),Dr=w(" Zoom in:"),Br=o("kbd",null,"E",-1),Gr=w("/"),Ir=w(" Zoom out:"),xr=o("kbd",null,"Q",-1),Yr=w("/"),Wr=w(" Toggle preview:"),Fr=o("td",null,[o("div",null,[o("kbd",null,"Space")])],-1),jr=w(" Center puzzle in screen:"),Hr=o("td",null,[o("div",null,[o("kbd",null,"C")])],-1),Zr=w(" Toggle fixed pieces:"),Kr=o("td",null,[o("div",null,[o("kbd",null,"F")])],-1),qr=w(" Toggle loose pieces:"),Xr=o("td",null,[o("div",null,[o("kbd",null,"G")])],-1),Qr=w(" Toggle table:"),Jr=o("td",null,[o("div",null,[o("kbd",null,"T")])],-1),eu=w(" Toggle interface:"),tu=o("td",null,[o("div",null,[o("kbd",null,"H")])],-1),ou=w(" Toggle player names:"),nu=o("td",null,[o("div",null,[o("kbd",null,"N")])],-1),su=w(" Toggle sounds:"),iu=o("td",null,[o("div",null,[o("kbd",null,"M")])],-1),lu=w(" Store position [0-9]:"),au=o("td",null,[o("div",null,[o("kbd",null,"Shift"),w(" + "),o("kbd",null,"0"),w("-"),o("kbd",null,"9")])],-1),ru=w(" Restore position [0-9]:"),uu=o("td",null,[o("div",null,[o("kbd",null,"0"),w("-"),o("kbd",null,"9")])],-1),cu=w(" Speed up (replay):"),du=o("td",null,[o("div",null,[o("kbd",null,"I")])],-1),hu=w(" Speed down (replay):"),pu=o("td",null,[o("div",null,[o("kbd",null,"O")])],-1),gu=w(" Pause (replay):"),mu=o("td",null,[o("div",null,[o("kbd",null,"P")])],-1);function fu(e,t){const n=k("icon"),s=k("overlay");return c(),F(s,{class:"transparent"},{default:le(()=>[o("table",fr,[o("tr",null,[o("td",null,[f(n,{icon:"arrow-up"}),_r]),o("td",null,[o("div",null,[yr,wr,vr,Er,f(n,{icon:"mouse-left"})])])]),o("tr",null,[o("td",null,[f(n,{icon:"arrow-down"}),Pr]),o("td",null,[o("div",null,[br,Tr,$r,Cr,f(n,{icon:"mouse-left"})])])]),o("tr",null,[o("td",null,[f(n,{icon:"arrow-left"}),Sr]),o("td",null,[o("div",null,[kr,Ar,Or,Nr,f(n,{icon:"mouse-left"})])])]),o("tr",null,[o("td",null,[f(n,{icon:"arrow-right"}),Ur]),o("td",null,[o("div",null,[Rr,Lr,Vr,Mr,f(n,{icon:"mouse-left"})])])]),zr,o("tr",null,[o("td",null,[f(n,{icon:"zoom-in"}),Dr]),o("td",null,[o("div",null,[Br,Gr,f(n,{icon:"mouse-wheel"})])])]),o("tr",null,[o("td",null,[f(n,{icon:"zoom-out"}),Ir]),o("td",null,[o("div",null,[xr,Yr,f(n,{icon:"mouse-wheel"})])])]),o("tr",null,[o("td",null,[f(n,{icon:"preview"}),Wr]),Fr]),o("tr",null,[o("td",null,[f(n,{icon:"center"}),jr]),Hr]),o("tr",null,[o("td",null,[f(n,{icon:"puzzle-piece-locked"}),Zr]),Kr]),o("tr",null,[o("td",null,[f(n,{icon:"puzzle-piece-free"}),qr]),Xr]),o("tr",null,[o("td",null,[f(n,{icon:"table"}),Qr]),Jr]),o("tr",null,[o("td",null,[f(n,{icon:"eye"}),eu]),tu]),o("tr",null,[o("td",null,[f(n,{icon:"player-name"}),ou]),nu]),o("tr",null,[o("td",null,[f(n,{icon:"volume-up"}),su]),iu]),o("tr",null,[o("td",null,[f(n,{icon:"save-pos"}),lu]),au]),o("tr",null,[o("td",null,[f(n,{icon:"load-pos"}),ru]),uu]),o("tr",null,[o("td",null,[f(n,{icon:"speed-up"}),cu]),du]),o("tr",null,[o("td",null,[f(n,{icon:"speed-down"}),hu]),pu]),o("tr",null,[o("td",null,[f(n,{icon:"pause"}),gu]),mu])])]),_:1})}var so=ae(mr,[["render",fu]]),_u="/assets/click.bb97cb07.mp3",yu=Object.freeze(Object.defineProperty({__proto__:null,default:_u},Symbol.toStringTag,{value:"Module"})),wu="/assets/click2.98536db5.mp3",vu=Object.freeze(Object.defineProperty({__proto__:null,default:wu},Symbol.toStringTag,{value:"Module"})),Eu="/assets/Oak-none-3275x2565mm-Architextures.cc917130.jpg",Pu=Object.freeze(Object.defineProperty({__proto__:null,default:Eu},Symbol.toStringTag,{value:"Module"})),bu="/assets/wood-dark.1e21ffc1.jpg",Tu=Object.freeze(Object.defineProperty({__proto__:null,default:bu},Symbol.toStringTag,{value:"Module"})),$u="/assets/wood-light.ae1bd383.jpg",Cu=Object.freeze(Object.defineProperty({__proto__:null,default:$u},Symbol.toStringTag,{value:"Module"})),Su="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAW0lEQVQ4je1RywrAIAxLxP//5exixRWlVgZelpOKeTQFfnDypgy3eLIkSLLL8mxGPoHsU2hPAgDHBLvRX6hZZw/fwT0BtlLSONqCbWAmEIqMZOCDDlaDR3N03gOyDCn+y4DWmAAAAABJRU5ErkJggg==",ku=Object.freeze(Object.defineProperty({__proto__:null,default:Su},Symbol.toStringTag,{value:"Module"})),Au="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAARElEQVQ4jWNgGAU0Af+hmBCbgYGBgYERhwHEAEYGBgYGJtIdiApYyLAZBVDsAqoagC1ACQJyY4ERg0GCISh6KA4DigEAou8LC+LnIJoAAAAASUVORK5CYII=",Ou=Object.freeze(Object.defineProperty({__proto__:null,default:Au},Symbol.toStringTag,{value:"Module"})),Nu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAcUlEQVQ4ja1TQQ7AIAgD///n7jCozA2Hbk00jbG1KIrcARszTugoBs49qioZj7r2kKACptkyAOCJsJuA+GzglwHjvMSSWFVaENWVASxh5eRLiq5fN/ASjI89VcP2K3hHpq1cEXNaMfnrL3TDZP2tDuoOA6MzCCXWr38AAAAASUVORK5CYII=",Uu=Object.freeze(Object.defineProperty({__proto__:null,default:Nu},Symbol.toStringTag,{value:"Module"})),Ru="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAU0lEQVQ4jWNgoAH4D8X42HDARKlt5BoAd82AuQAOGLGIYQQUPv0wF5CiCQUge4EsQ5C9QI4BjMguwBYeBAElscCIy1ZivMKIwSDBEBQ9FCckigEAU3QOD7TGvY4AAAAASUVORK5CYII=",Lu=Object.freeze(Object.defineProperty({__proto__:null,default:Ru},Symbol.toStringTag,{value:"Module"}));const Vu=e=>{let t=!1;const n=()=>{t=!0},s=e.fps||60,i=e.slow||1,l=e.update,r=e.render,u=window.requestAnimationFrame,h=1/s,g=i*h;let p,B=0,P=window.performance.now();const $=()=>{for(p=window.performance.now(),B=B+Math.min(1,(p-P)/1e3);B>g;)B=B-g,l(h);r(B/i),P=p,t||u($)};return u($),{stop:n}};let Io=.1;const Mu=6,zu=.05;class Bt{constructor(t=null){this.x=0,this.y=0,this.curZoom=1,t&&this.fromSnapshot(t)}calculateZoomCapping(t,n,s,i){Io=Math.max(.1,t/s,n/i)}snapshot(){return{x:this.x,y:this.y,curZoom:this.curZoom}}getCurrentZoom(){return this.curZoom}fromSnapshot(t){this.x=t.x,this.y=t.y,this.curZoom=t.curZoom}reset(){this.x=0,this.y=0,this.curZoom=1}move(t,n){this.x+=t/this.curZoom,this.y+=n/this.curZoom}calculateNewZoom(t){const n=t==="in"?1:-1,s=this.curZoom+zu*this.curZoom*n;return Math.min(Math.max(s,Io),Mu)}canZoom(t){return this.curZoom!=this.calculateNewZoom(t)}setZoom(t,n){if(this.curZoom==t)return!1;const s=1-this.curZoom/t;return this.move(-n.x*s,-n.y*s),this.curZoom=t,!0}zoom(t,n){return this.setZoom(this.calculateNewZoom(t),n)}viewportToWorld(t){const{x:n,y:s}=this.viewportToWorldRaw(t);return{x:Math.round(n),y:Math.round(s)}}viewportToWorldRaw(t){return{x:t.x/this.curZoom-this.x,y:t.y/this.curZoom-this.y}}worldToViewport(t){const{x:n,y:s}=this.worldToViewportRaw(t);return{x:Math.round(n),y:Math.round(s)}}worldToViewportRaw(t){return{x:(t.x+this.x)*this.curZoom,y:(t.y+this.y)*this.curZoom}}worldDimToViewport(t){const{w:n,h:s}=this.worldDimToViewportRaw(t);return{w:Math.round(n),h:Math.round(s)}}worldDimToViewportRaw(t){return{w:t.w*this.curZoom,h:t.h*this.curZoom}}viewportDimToWorld(t){const{w:n,h:s}=this.viewportDimToWorldRaw(t);return{w:Math.round(n),h:Math.round(s)}}viewportDimToWorldRaw(t){return{w:t.w/this.curZoom,h:t.h/this.curZoom}}}function et(e=0,t=0){const n=document.createElement("canvas");return n.width=e,n.height=t,n}async function Du(e){return new Promise(t=>{const n=new Image;n.onload=()=>{createImageBitmap(n).then(t)},n.src=e})}async function Bu(e,t,n){const s=et(t,n);return s.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,n),await createImageBitmap(s)}function Gu(e,t,n){if(n==="ukraine"){const l=et(e.width,e.height),r=l.getContext("2d"),u=t.height/1.75;r.save(),r.drawImage(t,0,0),r.fillStyle="#0057B7",r.globalCompositeOperation="source-in",r.fillRect(0,0,t.width,u),r.restore(),r.save(),r.globalCompositeOperation="destination-over",r.drawImage(e,0,0),r.restore();const h=et(e.width,e.height/2),g=h.getContext("2d");return g.save(),g.drawImage(t,0,-u),g.fillStyle="#FFDD00",g.globalCompositeOperation="source-in",g.fillRect(0,0,t.width,t.height),g.restore(),g.save(),g.globalCompositeOperation="destination-over",g.drawImage(e,0,-u),g.restore(),r.drawImage(h,0,u),l}const s=et(e.width,e.height),i=s.getContext("2d");return i.save(),i.drawImage(t,0,0),i.fillStyle=n,i.globalCompositeOperation="source-in",i.fillRect(0,0,t.width,t.height),i.restore(),i.save(),i.globalCompositeOperation="destination-over",i.drawImage(e,0,0),i.restore(),s}var ge={createCanvas:et,loadImageToBitmap:Du,resizeBitmap:Bu,colorizedCanvas:Gu};const Iu=jt("Debug.js");let Gt=0,Pn=0;const xu=e=>{Gt=performance.now(),Pn=e},Yu=e=>{const t=performance.now(),n=t-Gt;n>Pn&&Iu.log(e+": "+n),Gt=t};var Ne={checkpoint_start:xu,checkpoint:Yu};function Wu(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Fu(e,t){return{x:e.x+t.x,y:e.y+t.y}}function bn(e,t){const n=e.x-t.x,s=e.y-t.y;return Math.sqrt(n*n+s*s)}function ju(e,t){return e.x>=t.x&&e.x<=t.x+t.w&&e.y>=t.y&&e.y<=t.y+t.h}function It(e){return{x:e.x+e.w/2,y:e.y+e.h/2}}function Hu(e,t,n){return{x:e.x+t,y:e.y+n,w:e.w,h:e.h}}function Zu(e,t){return!(t.x>e.x+e.w||e.x>t.x+t.w||t.y>e.y+e.h||e.y>t.y+t.h)}function Ku(e,t){return bn(It(e),It(t))}var te={pointSub:Wu,pointAdd:Fu,pointDistance:bn,pointInBounds:ju,rectCenter:It,rectMoved:Hu,rectCenterDistance:Ku,rectsOverlap:Zu};const xo=jt("PuzzleGraphics.js");async function qu(e,t,n){xo.log("start createPuzzleTileBitmaps");const s=n.tileSize,i=n.tileMarginWidth,l=n.tileDrawSize,r=s/100,u=[0,0,40,15,37,5,37,5,40,0,38,-5,38,-5,20,-20,50,-20,50,-20,80,-20,62,-5,62,-5,60,0,63,5,63,5,65,15,100,0],h=new Array(t.length),g={};function p(E){const N=`${E.top}${E.right}${E.left}${E.bottom}`;if(g[N])return g[N];const R=new Path2D,O={x:i,y:i},A=te.pointAdd(O,{x:s,y:0}),S=te.pointAdd(A,{x:0,y:s}),z=te.pointSub(S,{x:s,y:0});if(R.moveTo(O.x,O.y),E.top!==0)for(let m=0;m<u.length/6;m++){const se=te.pointAdd(O,{x:u[m*6+0]*r,y:E.top*u[m*6+1]*r}),q=te.pointAdd(O,{x:u[m*6+2]*r,y:E.top*u[m*6+3]*r}),ie=te.pointAdd(O,{x:u[m*6+4]*r,y:E.top*u[m*6+5]*r});R.bezierCurveTo(se.x,se.y,q.x,q.y,ie.x,ie.y)}else R.lineTo(A.x,A.y);if(E.right!==0)for(let m=0;m<u.length/6;m++){const se=te.pointAdd(A,{x:-E.right*u[m*6+1]*r,y:u[m*6+0]*r}),q=te.pointAdd(A,{x:-E.right*u[m*6+3]*r,y:u[m*6+2]*r}),ie=te.pointAdd(A,{x:-E.right*u[m*6+5]*r,y:u[m*6+4]*r});R.bezierCurveTo(se.x,se.y,q.x,q.y,ie.x,ie.y)}else R.lineTo(S.x,S.y);if(E.bottom!==0)for(let m=0;m<u.length/6;m++){const se=te.pointSub(S,{x:u[m*6+0]*r,y:E.bottom*u[m*6+1]*r}),q=te.pointSub(S,{x:u[m*6+2]*r,y:E.bottom*u[m*6+3]*r}),ie=te.pointSub(S,{x:u[m*6+4]*r,y:E.bottom*u[m*6+5]*r});R.bezierCurveTo(se.x,se.y,q.x,q.y,ie.x,ie.y)}else R.lineTo(z.x,z.y);if(E.left!==0)for(let m=0;m<u.length/6;m++){const se=te.pointSub(z,{x:-E.left*u[m*6+1]*r,y:u[m*6+0]*r}),q=te.pointSub(z,{x:-E.left*u[m*6+3]*r,y:u[m*6+2]*r}),ie=te.pointSub(z,{x:-E.left*u[m*6+5]*r,y:u[m*6+4]*r});R.bezierCurveTo(se.x,se.y,q.x,q.y,ie.x,ie.y)}else R.lineTo(O.x,O.y);return g[N]=R,R}const B=ge.createCanvas(l,l),P=B.getContext("2d"),$=ge.createCanvas(l,l),T=$.getContext("2d");for(const E of t){const N=W.decodePiece(E),R=Xu(n,N.idx),O=p(W.decodeShape(n.shapes[N.idx]));P.clearRect(0,0,l,l),P.save(),P.lineWidth=2,P.stroke(O),P.globalCompositeOperation="source-in",P.drawImage(e,R.x-i,R.y-i,l,l,0,0,l,l),P.restore(),P.save(),P.globalCompositeOperation="source-in",P.globalAlpha=.2,P.fillStyle="black",P.fillRect(0,0,B.width,B.height),P.restore(),P.save(),P.clip(O),P.drawImage(e,R.x-i,R.y-i,l,l,0,0,l,l),P.restore(),P.save(),P.clip(O),P.strokeStyle="rgba(0,0,0,.4)",P.lineWidth=0,P.shadowColor="black",P.shadowBlur=2,P.shadowOffsetX=-1,P.shadowOffsetY=-1,P.stroke(O),P.restore(),P.save(),P.clip(O),P.strokeStyle="rgba(255,255,255,.4)",P.lineWidth=0,P.shadowColor="white",P.shadowBlur=2,P.shadowOffsetX=1,P.shadowOffsetY=1,P.stroke(O),P.restore(),T.clearRect(0,0,l,l),T.save(),T.lineWidth=1,T.stroke(O),T.globalCompositeOperation="source-in",T.drawImage(e,R.x-i,R.y-i,l,l,0,0,l,l),T.restore(),P.drawImage($,0,0),h[N.idx]=await createImageBitmap(B)}return xo.log("end createPuzzleTileBitmaps"),h}function Xu(e,t){const n=W.coordByPieceIdxDeprecated(e,t);return{x:n.x*e.tileSize,y:n.y*e.tileSize,w:e.tileSize,h:e.tileSize}}async function Qu(e){const t=await ge.loadImageToBitmap(e.info.imageUrl),n=await ge.resizeBitmap(t,e.info.width,e.info.height);return await qu(n,e.tiles,e.info)}var Ju={loadPuzzleBitmaps:Qu};const Tn=30,U={};function ec(e){return!!U[e]||!1}function tc(e,t){return{id:e,x:0,y:0,d:0,name:null,color:null,bgcolor:null,points:0,ts:t}}function oc(e,t){U[e]=t}function nc(e){delete U[e]}function _t(e,t){let n=0;for(const s of U[e].players){if(W.decodePlayer(s).id===t)return n;n++}return-1}function sc(e,t){return U[e].players.length>t?W.decodePlayer(U[e].players[t]).id:null}function Be(e,t){const n=_t(e,t);return n===-1?null:W.decodePlayer(U[e].players[n])}function io(e,t,n){const s=_t(e,t);s===-1?U[e].players.push(W.encodePlayer(n)):U[e].players[s]=W.encodePlayer(n)}function ic(e,t,n){U[e].puzzle.tiles[t]=W.encodePiece(n)}function lc(e,t){U[e].puzzle.data=t}function $n(e,t){return _t(e,t)!==-1}function ac(e,t){return Ln(U[e],t)}function rc(e,t){return Bc(U[e],t)}function uc(e,t,n){$n(e,t)?ue(e,t,{ts:n}):io(e,t,tc(t,n))}function cc(e){return U[e]||null}function xt(e){return ho(U[e])}function dc(e){return Vn(U[e])}function Ct(e){return U[e].scoreMode}function Cn(e){return U[e].snapMode}function Sn(e){return U[e].gameVersion}function Yt(e){return co(U[e])}function hc(e){return U[e].puzzle.tiles.map(W.decodePiece).sort((n,s)=>n.z-s.z)}function ue(e,t,n){const s=Be(e,t);if(s!==null){for(const i of Object.keys(n))s[i]=n[i];io(e,t,s)}}function at(e,t){for(const n of Object.keys(t))U[e].puzzle.data[n]=t[n]}function ze(e,t,n){for(const s of Object.keys(n)){const i=W.decodePiece(U[e].puzzle.tiles[t]);i[s]=n[s],U[e].puzzle.tiles[t]=W.encodePiece(i)}}const Ge=(e,t)=>W.decodePiece(U[e].puzzle.tiles[t]),mt=(e,t)=>Ge(e,t).group,pc=(e,t)=>{const n=U[e].puzzle.info;return t===0||t===n.tilesX-1||t===n.tiles-n.tilesX||t===n.tiles-1},kn=(e,t)=>{const n=U[e].puzzle.info,s={x:(n.table.width-n.width)/2,y:(n.table.height-n.height)/2},i=Ec(e,t);return te.pointAdd(s,i)},dt=(e,t)=>Ge(e,t).pos,lo=e=>Sn(e)<=3?mc(e):gc(e),gc=e=>({x:0,y:0,w:ro(e),h:uo(e)}),mc=e=>{const t=ro(e),n=uo(e),s=Math.round(t/4),i=Math.round(n/4);return{x:0-s,y:0-i,w:t+2*s,h:n+2*i}},fc=(e,t)=>Ge(e,t).z,Xe=(e,t)=>{for(const n of U[e].puzzle.tiles){const s=W.decodePiece(n);if(s.owner===t)return s.idx}return-1},_c=(e,t)=>{const n=Xe(e,t);return n<0?null:U[e].puzzle.tiles[n]},An=e=>U[e].puzzle.info.tileDrawOffset,ao=e=>U[e].puzzle.info.tileDrawSize,yc=e=>Nn(U[e]),wc=e=>Un(U[e]),Yo=e=>U[e].puzzle.data.maxGroup,Wo=e=>U[e].puzzle.data.maxZ,vc=(e,t)=>{let n=0;for(const s of t){const i=fc(e,s);i>n&&(n=i)}return n};function Ec(e,t){const n=U[e].puzzle.info,s=W.coordByPieceIdxDeprecated(n,t),i=s.x*n.tileSize,l=s.y*n.tileSize;return{x:i,y:l}}function Pc(e,t){const n=U[e].puzzle.info,s=W.coordByPieceIdxDeprecated(n,t);return[s.y>0?t-n.tilesX:-1,s.x<n.tilesX-1?t+1:-1,s.y<n.tilesY-1?t+n.tilesX:-1,s.x>0?t-1:-1]}const Fo=(e,t,n)=>{for(const s of t)ze(e,s,{z:n})},On=(e,t,n)=>{const s=dt(e,t),i=te.pointAdd(s,n);ze(e,t,{pos:i})},rt=(e,t,n)=>Sn(e)>=3?Tc(e,t,n):bc(e,t,n),bc=(e,t,n)=>{const s=ao(e),i=lo(e),l=n;for(const r of t){const u=Ge(e,r);u.pos.x+n.x<i.x?l.x=Math.max(i.x-u.pos.x,l.x):u.pos.x+s+n.x>i.x+i.w&&(l.x=Math.min(i.x+i.w-u.pos.x+s,l.x)),u.pos.y+n.y<i.y?l.y=Math.max(i.y-u.pos.y,l.y):u.pos.y+s+n.y>i.y+i.h&&(l.y=Math.min(i.y+i.h-u.pos.y+s,l.y))}if(!l.x&&!l.y)return!1;for(const r of t)On(e,r,l);return!0},Tc=(e,t,n)=>{const s=lo(e),i=ao(e)+2*An(e),l=s.x,r=s.y,u=l+s.w-i,h=r+s.h-i,g=n;for(const p of t){const B=Ge(e,p);n.x<0?g.x=Math.max(l-B.pos.x,g.x):g.x=Math.min(u-B.pos.x,g.x),n.y<0?g.y=Math.max(r-B.pos.y,g.y):g.y=Math.min(h-B.pos.y,g.y)}if(!g.x&&!g.y)return!1;for(const p of t)On(e,p,g);return!0},$c=(e,t)=>Cc(e,t)===-1,Cc=(e,t)=>Ge(e,t).owner,jo=(e,t)=>{for(const n of t)ze(e,n,{owner:-1,z:1})},St=(e,t,n)=>{for(const s of t)ze(e,s,{owner:n})};function Sc(e,t){return Te(e,t).length}function Te(e,t){const n=U[e].puzzle.tiles,s=W.decodePiece(n[t]),i=[];if(s.group)for(const l of n){const r=W.decodePiece(l);r.group===s.group&&i.push(r.idx)}else i.push(s.idx);return i}const kc=(e,t)=>{const n=U[e].puzzle.info,s=U[e].puzzle.tiles;let i=-1,l=-1;for(let r=0;r<s.length;r++){const u=W.decodePiece(s[r]);if(u.owner!==0)continue;const h={x:u.pos.x,y:u.pos.y,w:n.tileSize,h:n.tileSize};te.pointInBounds(t,h)&&(i===-1||u.z>i)&&(i=u.z,l=r)}return l},Ac=(e,t)=>{const n=Be(e,t);return n?n.bgcolor:null},Oc=(e,t)=>{const n=Be(e,t);return n?n.color:null},Nc=(e,t)=>{const n=Be(e,t);return n?n.name:null},Ho=(e,t)=>{const n=Be(e,t);return n?n.points:0},Uc=(e,t,n)=>{const s=mt(e,t),i=mt(e,n);return!!(s&&s===i)},ro=e=>U[e].puzzle.info.table.width,uo=e=>U[e].puzzle.info.table.height,Rc=e=>U[e].puzzle,Lc=e=>U[e].rng.obj,Vc=e=>U[e].puzzle.info.width,Mc=e=>U[e].puzzle.info.height,zc=(e,t)=>{if(Cn(e)===We.REAL){for(const n of t)if(pc(e,n))return!0;return!1}return!0};function Dc(e,t,n,s){const i=U[e].puzzle,l=[],r=()=>{l.push([_.CHANGE_DATA,i.data])},u=$=>{l.push([_.CHANGE_PIECE,W.encodePiece(Ge(e,$))])},h=$=>{for(const T of $)u(T)},g=()=>{const $=Be(e,t);!$||l.push([_.CHANGE_PLAYER,W.encodePlayer($)])};let p=!1;const B=($,T,E)=>{const N=U[$].puzzle.tiles,R=mt($,T),O=mt($,E);let A;const S=[];if(R&&S.push(R),O&&S.push(O),R)A=R;else if(O)A=O;else{const z=Yo($)+1;at($,{maxGroup:z}),r(),A=Yo($)}if(ze($,T,{group:A}),u(T),ze($,E,{group:A}),u(E),S.length>0)for(const z of N){const m=W.decodePiece(z);S.includes(m.group)&&(ze($,m.idx,{group:A}),u(m.idx))}},P=n[0];if(P===_.INPUT_EV_CONNECTION_CLOSE){const $=Xe(e,t);if($>=0){const T=Te(e,$);St(e,T,0),h(T)}}else if(P===_.INPUT_EV_BG_COLOR){const $=n[1];ue(e,t,{bgcolor:$,ts:s}),g()}else if(P===_.INPUT_EV_PLAYER_COLOR){const $=n[1];ue(e,t,{color:$,ts:s}),g()}else if(P===_.INPUT_EV_PLAYER_NAME){const $=`${n[1]}`.substr(0,16);ue(e,t,{name:$,ts:s}),g()}else if(P===_.INPUT_EV_MOVE){const $=n[1],T=n[2],E=Be(e,t);if(E){const N=E.x-$,R=E.y-T;ue(e,t,{ts:s,x:N,y:R}),g();const O=Xe(e,t);if(O>=0){const A=Te(e,O),S={x:-$,y:-T};rt(e,A,S)&&h(A)}}}else if(P===_.INPUT_EV_MOUSE_DOWN){const $=n[1],T=n[2],E={x:$,y:T};ue(e,t,{d:1,ts:s}),g();const N=kc(e,E);if(N>=0){const R=Wo(e)+1;at(e,{maxZ:R}),r();const O=Te(e,N);Fo(e,O,Wo(e)),St(e,O,t),h(O)}}else if(P===_.INPUT_EV_MOUSE_MOVE){const $=n[1],T=n[2];if(!n[5])ue(e,t,{x:$,y:T,ts:s}),g();else{const N=Xe(e,t);if(N<0)ue(e,t,{ts:s}),g();else{const R=n[1],O=n[2],A=n[3],S=n[4];ue(e,t,{x:R,y:O,ts:s}),g();const z=Te(e,N);rt(e,z,{x:A,y:S})&&h(z)}}}else if(P===_.INPUT_EV_MOUSE_UP){const T=Xe(e,t);if(T>=0){const E=Te(e,T);St(e,E,0),h(E);const N=dt(e,T),R=kn(e,T);if(zc(e,E)&&te.pointDistance(R,N)<i.info.snapDistance){const O=te.pointSub(R,N);rt(e,E,O),jo(e,E),h(E);let A=Ho(e,t);Ct(e)===Me.FINAL?A+=E.length:Ct(e)===Me.ANY&&(A+=1),ue(e,t,{d:0,ts:s,points:A}),g(),Yt(e)===xt(e)&&(at(e,{finished:s}),r()),p=!0}else{const O=(S,z,m,se)=>{const q=U[S].puzzle.info;if(m<0||Uc(S,z,m))return!1;const ie=dt(S,z),Se=te.pointAdd(dt(S,m),{x:se[0]*q.tileSize,y:se[1]*q.tileSize});if(te.pointDistance(ie,Se)<q.snapDistance){const Oe=te.pointSub(Se,ie);let _e=Te(S,z);if(rt(S,_e,Oe),B(S,z,m),_e=Te(S,z),$c(S,m))jo(S,_e);else{const Ie=vc(S,_e);Fo(S,_e,Ie)}return h(_e),!0}return!1};let A=!1;for(const S of Te(e,T)){const z=Pc(e,S);if(O(e,S,z[0],[0,1])||O(e,S,z[1],[-1,0])||O(e,S,z[2],[0,-1])||O(e,S,z[3],[1,0])){A=!0;break}}if(A&&Ct(e)===Me.ANY){const S=Ho(e,t)+1;ue(e,t,{d:0,ts:s,points:S}),g()}else ue(e,t,{d:0,ts:s}),g();A&&Cn(e)===We.REAL&&Yt(e)===xt(e)&&(at(e,{finished:s}),r()),A&&(p=!0)}}else ue(e,t,{d:0,ts:s}),g()}else if(P===_.INPUT_EV_ZOOM_IN){const $=n[1],T=n[2];ue(e,t,{x:$,y:T,ts:s}),g()}else if(P===_.INPUT_EV_ZOOM_OUT){const $=n[1],T=n[2];ue(e,t,{x:$,y:T,ts:s}),g()}else ue(e,t,{ts:s}),g();return p&&l.push([_.PLAYER_SNAP,t]),l}function Nn(e){return e.puzzle.data.started}function Un(e){return e.puzzle.data.finished}function co(e){let t=0;for(const n of e.puzzle.tiles)W.decodePiece(n).owner===-1&&t++;return t}function ho(e){return e.puzzle.tiles.length}function Rn(e){return e.players.map(W.decodePlayer)}function Ln(e,t){const n=t-Tn*$e.SEC;return Rn(e).filter(s=>s.ts>=n)}function Bc(e,t){const n=t-Tn*$e.SEC;return Rn(e).filter(s=>s.ts<n&&s.points>0)}function Vn(e){var n;const t=((n=e.puzzle.info.image)==null?void 0:n.url)||e.puzzle.info.imageUrl;if(!t)throw new Error("[2021-07-11] no image url set");return t}function Gc(e){return co(e)===ho(e)}var G={setGame:oc,unsetGame:nc,loaded:ec,playerExists:$n,getActivePlayers:ac,getIdlePlayers:rc,addPlayer:uc,getFinishedPiecesCount:Yt,getPieceCount:xt,getImageUrl:dc,get:cc,getGroupedPieceCount:Sc,getPlayerBgColor:Ac,getPlayerColor:Oc,getPlayerName:Nc,getPlayerIndexById:_t,getPlayerIdByIndex:sc,changePlayer:ue,setPlayer:io,setPiece:ic,setPuzzleData:lc,getBounds:lo,getTableWidth:ro,getTableHeight:uo,getPuzzle:Rc,getRng:Lc,getPuzzleWidth:Vc,getPuzzleHeight:Mc,getPiecesSortedByZIndex:hc,getFirstOwnedPiece:_c,getPieceDrawOffset:An,getPieceDrawSize:ao,getFinalPiecePos:kn,getStartTs:yc,getFinishTs:wc,handleInput:Dc,Game_getStartTs:Nn,Game_getFinishTs:Un,Game_getFinishedPiecesCount:co,Game_getPieceCount:ho,Game_getActivePlayers:Ln,Game_getImageUrl:Vn,Game_isFinished:Gc};let Mn=-10,zn=20,Wt=2,Dn=15;const Ic=5,xc=5,po=1,Yc=200,Zo=10,Wc=100,Fc=10,jc=1,Hc=5;function Zc(e){const t=e.random(0,255),n=e.random(0,255),s=e.random(0,255);return"rgba("+t+","+n+","+s+", 0.8)"}class Ko{constructor(t){this.radius=Zo,this.previousRadius=Zo,this.explodingDuration=Wc,this.hasExploded=!1,this.alive=!0,this.color=Zc(t),this.px=window.innerWidth/4+Math.random()*window.innerWidth/2,this.py=window.innerHeight,this.vx=Mn+Math.random()*zn,this.vy=(Wt+Math.random()*Dn)*-1,this.duration=0}update(t){if(this.hasExploded){const n=Yc-this.radius;this.previousRadius=this.radius,this.radius+=n/Fc,this.explodingDuration--,this.explodingDuration==0&&(this.alive=!1)}else this.vx+=0,this.vy+=po,this.vy>=0&&t&&this.explode(t),this.px+=this.vx,this.py+=this.vy}draw(t){t.beginPath(),t.arc(this.px,this.py,this.previousRadius,0,Math.PI*2,!1),this.hasExploded||(t.fillStyle=this.color,t.lineWidth=1,t.fill())}explode(t){this.hasExploded=!0;const n=3+Math.floor(Math.random()*3);for(let s=0;s<n;s++){const i=10+Math.floor(Math.random()*21),l=Ic+Math.random()*xc,r=2*Math.PI/i,u=Math.random()*r;for(let h=0;h<i;h++)t.push(new Kc(this,h*r+u,l))}}}class Kc{constructor(t,n,s){this.px=t.px,this.py=t.py,this.vx=Math.cos(n)*s,this.vy=Math.sin(n)*s,this.color=t.color,this.duration=40+Math.floor(Math.random()*20),this.alive=!0,this.radius=0}update(){this.vx+=0,this.vy+=po/10,this.px+=this.vx,this.py+=this.vy,this.radius=3,this.duration--,this.duration<=0&&(this.alive=!1)}draw(t){t.beginPath(),t.arc(this.px,this.py,this.radius,0,Math.PI*2,!1),t.fillStyle=this.color,t.lineWidth=1,t.fill()}}class qc{constructor(t,n){this.canvas=t,this.rng=n,this.ctx=this.canvas.getContext("2d"),this.resize(),this.readyBombs=[],this.explodedBombs=[],this.particles=[],window.addEventListener("resize",()=>{this.resize()})}setSpeedParams(){let t=0,n=0;for(;t<this.canvas.height&&n>=0;)n+=po,t+=n;Wt=n/2,Dn=n-Wt;const s=1/4*this.canvas.width/(n/2);Mn=-s,zn=2*s}resize(){this.setSpeedParams()}init(){this.readyBombs=[],this.explodedBombs=[],this.particles=[];for(let t=0;t<jc;t++)this.readyBombs.push(new Ko(this.rng))}update(){Math.random()*100<Hc&&this.readyBombs.push(new Ko(this.rng));const t=[];for(;this.explodedBombs.length>0;){const i=this.explodedBombs.shift();if(!i)break;i.update(),i.alive&&t.push(i)}this.explodedBombs=t;const n=[];for(;this.readyBombs.length>0;){const i=this.readyBombs.shift();if(!i)break;i.update(this.particles),i.hasExploded?this.explodedBombs.push(i):n.push(i)}this.readyBombs=n;const s=[];for(;this.particles.length>0;){const i=this.particles.shift();if(!i)break;i.update(),i.alive&&s.push(i)}this.particles=s}render(){this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.readyBombs.length;t++)this.readyBombs[t].draw(this.ctx);for(let t=0;t<this.explodedBombs.length;t++)this.explodedBombs[t].draw(this.ctx);for(let t=0;t<this.particles.length;t++)this.particles[t].draw(this.ctx)}}function Xc(e,t,n,s){let i=[],l=!0,r=!1,u=!1,h=!1,g=!1,p=!1,B=!1,P=!1;const $=(b,x)=>{const V=n.viewportToWorld({x:b,y:x});return[V.x,V.y]},T=(b,x)=>{const V=n.viewportDimToWorld({w:b,h:x});return[V.w,V.h]},E=b=>$(b.offsetX,b.offsetY),N=()=>$(e.width/2,e.height/2),R=(b,x)=>{!l||(x.code==="ShiftLeft"||x.code==="ShiftRight"?P=b:x.code==="ArrowUp"||x.code==="KeyW"?h=b:x.code==="ArrowDown"||x.code==="KeyS"?g=b:x.code==="ArrowLeft"||x.code==="KeyA"?r=b:x.code==="ArrowRight"||x.code==="KeyD"?u=b:x.code==="KeyQ"?B=b:x.code==="KeyE"&&(p=b))};let O=!1,A=null,S=null;const z=b=>{S=E(b),A=[b.offsetX,b.offsetY],b.button===0&&(O=!0,J([_.INPUT_EV_MOUSE_DOWN,...S]))},m=b=>{S=E(b),A=[b.offsetX,b.offsetY],b.button===0&&(O=!1,J([_.INPUT_EV_MOUSE_UP,...S]))},se=b=>{if(!A)return;S=E(b);const x=T(-(A[0]-b.offsetX),-(A[1]-b.offsetY));J([_.INPUT_EV_MOUSE_MOVE,...S,...x,O?1:0]),A=[b.offsetX,b.offsetY]},q=b=>{if(S=E(b),n.canZoom(b.deltaY<0?"in":"out")){const x=b.deltaY<0?_.INPUT_EV_ZOOM_IN:_.INPUT_EV_ZOOM_OUT;J([x,...S])}},ie=b=>R(!0,b),Se=b=>R(!1,b),Oe=b=>{if(!!l){if(s===Pe&&(b.code==="KeyI"?J([_.INPUT_EV_REPLAY_SPEED_UP]):b.code==="KeyO"?J([_.INPUT_EV_REPLAY_SPEED_DOWN]):b.code==="KeyP"&&J([_.INPUT_EV_REPLAY_TOGGLE_PAUSE])),b.code==="KeyH")J([_.INPUT_EV_TOGGLE_INTERFACE]);else if(b.code==="Space")J([_.INPUT_EV_TOGGLE_PREVIEW]);else if(b.code==="KeyF")J([_.INPUT_EV_TOGGLE_FIXED_PIECES]);else if(b.code==="KeyG")J([_.INPUT_EV_TOGGLE_LOOSE_PIECES]);else if(b.code==="KeyM")J([_.INPUT_EV_TOGGLE_SOUNDS]);else if(b.code==="KeyN")J([_.INPUT_EV_TOGGLE_PLAYER_NAMES]);else if(b.code==="KeyT")J([_.INPUT_EV_TOGGLE_TABLE]);else if(b.code==="KeyC")J([_.INPUT_EV_CENTER_FIT_PUZZLE]);else for(let x=0;x<=9;x++)if(b.code===`Digit${x}`){const V=b.shiftKey?_.INPUT_EV_STORE_POS:_.INPUT_EV_RESTORE_POS;J([V,x]);break}}},_e=()=>{e.addEventListener("mousedown",z),e.addEventListener("mouseup",m),e.addEventListener("mousemove",se),e.addEventListener("wheel",q),t.addEventListener("keydown",ie),t.addEventListener("keyup",Se),t.addEventListener("keypress",Oe)},Ie=()=>{e.removeEventListener("mousedown",z),e.removeEventListener("mouseup",m),e.removeEventListener("mousemove",se),e.removeEventListener("wheel",q),t.removeEventListener("keydown",ie),t.removeEventListener("keyup",Se),t.removeEventListener("keypress",Oe)},je=(b,x)=>{if(!A||!S)return;const V=new Bt(b).viewportToWorld({x:A[0],y:A[1]}),Ee=new Bt(x).viewportToWorld({x:A[0],y:A[1]}),he=[-(V.x-Ee.x),-(V.y-Ee.y)];J([_.INPUT_EV_MOUSE_MOVE,...S,...he,O?1:0])},J=b=>{i.push(b)};return{registerEvents:_e,unregisterEvents:Ie,addEvent:J,consumeAll:()=>{if(i.length===0)return[];const b=i.slice();return i=[],b},createKeyEvents:()=>{const b=(r?1:0)-(u?1:0),x=(h?1:0)-(g?1:0);if(b!==0||x!==0){const V=(P?24:12)*Math.sqrt(n.getCurrentZoom()),Ee=n.viewportDimToWorld({w:b*V,h:x*V});J([_.INPUT_EV_MOVE,Ee.w,Ee.h]),S&&(S[0]-=Ee.w,S[1]-=Ee.h)}if(!(p&&B)){if(p){if(n.canZoom("in")){const V=S||N();J([_.INPUT_EV_ZOOM_IN,...V])}}else if(B&&n.canZoom("out")){const V=S||N();J([_.INPUT_EV_ZOOM_OUT,...V])}}},createSnapshotEvents:je,setHotkeys:b=>{l=b}}}const ut={"./grab.png":ku,"./grab_mask.png":Ou,"./hand.png":Uu,"./hand_mask.png":Lu},kt={"./assets/textures/Oak-none-3275x2565mm-Architextures.jpg":Pu,"./assets/textures/wood-dark.jpg":Tu,"./assets/textures/wood-light.jpg":Cu},qo={"./click.mp3":yu,"./click2.mp3":vu},Qe="play",Pe="replay";let Ue=!0,Re=!0;const Qc=e=>e.owner===-1?Ue:Re;let ne=!0;async function Bn(e,t,n,s,i,l){typeof window.DEBUG=="undefined"&&(window.DEBUG=!1);const r=a=>s===Pe||a.id!==t,u=qo["./click.mp3"].default,h=qo["./click2.mp3"].default,g=new Audio(u),p=new Audio(h),B=await ge.loadImageToBitmap(ut["./grab.png"].default),P=await ge.loadImageToBitmap(ut["./hand.png"].default),$=await ge.loadImageToBitmap(ut["./grab_mask.png"].default),T=await ge.loadImageToBitmap(ut["./hand_mask.png"].default),E=B.width,N=Math.round(E/2),R=B.height,O=Math.round(R/2),A={},S=async a=>{const d=a.color+" "+a.d;if(!A[d]){const v=a.d?B:P;if(a.color){const Y=a.d?$:T;A[d]=await createImageBitmap(ge.colorizedCanvas(v,Y,a.color))}else A[d]=v}return A[d]},z=i,m={final:!1,log:[],logPointer:0,speeds:[.5,1,2,5,10,20,50,100,250,500],speedIdx:1,paused:!1,lastRealTs:0,lastGameTs:0,gameStartTs:0,skipNonActionPhases:!0,dataOffset:0};Ae.onConnectionStateChange(a=>{l.emit("connectionState",a)});const se=async a=>{const d=m.dataOffset;m.dataOffset+=1e4;const v=await Ae.requestReplayData(a,d);return m.log=m.log.slice(m.logPointer),m.logPointer=0,m.log.push(...v.log),v.log.length===0&&(m.final=!0),v};let q=()=>0;const ie=async()=>{if(s===Qe){const a=await Ae.connect(n,e,t),d=W.decodeGame(a);G.setGame(d.id,d),q=()=>$e.timestamp()}else if(s===Pe){const a=await se(e);if(!a.game)throw"[ 2021-05-29 no game received ]";const d=W.decodeGame(a.game);G.setGame(d.id,d),m.lastRealTs=$e.timestamp(),m.gameStartTs=parseInt(a.log[0][4],10),m.lastGameTs=m.gameStartTs,q=()=>m.lastGameTs}else throw"[ 2020-12-22 MODE invalid, must be play|replay ]";ne=!0};await ie();const Se=G.getPieceDrawOffset(e),Oe=G.getPieceDrawSize(e),_e=G.getPuzzleWidth(e),Ie=G.getPuzzleHeight(e),je=G.getTableWidth(e),J=G.getTableHeight(e),go={x:(je-_e)/2,y:(J-Ie)/2},yt={w:_e,h:Ie},mo={w:Oe,h:Oe},b=await Ju.loadPuzzleBitmaps(G.getPuzzle(e)),x=new qc(z,G.getRng(e));x.init();const V=z.getContext("2d");z.classList.add("loaded"),l.emit("puzzleCut");let Ee="";const he={},D=new Bt;D.calculateZoomCapping(window.innerWidth,window.innerHeight,je,J);const Gn=()=>{D.reset(),D.move(-(je-z.width)/2,-(J-z.height)/2);const a=D.worldDimToViewportRaw(yt),d=20,v=z.width-d*2,Y=z.height-d*2;if(a.w>v||a.h>Y||a.w<v&&a.h<Y){const j=Math.min(v/a.w,Y/a.h),K={x:z.width/2,y:z.height/2};D.setZoom(j,K)}},pe=Xc(z,window,D,s);pe.registerEvents();const ot=a=>{if(he.last&&Ee===a){const d=D.snapshot(),v=he.last;return D.fromSnapshot(v),pe.createSnapshotEvents(d,v),delete he.last,"last"}else if(he[a]){const d=he[a],v=D.snapshot();return he.last=v,Ee=a,D.fromSnapshot(d),pe.createSnapshotEvents(v,d),a}else return null};Gn(),he.center=D.snapshot();const In=G.getImageUrl(e),nt=a=>{const d=G.getStartTs(e),v=G.getFinishTs(e);l.emit("status",{finished:!!v,duration:(v||a)-d,piecesDone:G.getFinishedPiecesCount(e),piecesTotal:G.getPieceCount(e)}),l.emit("players",{active:G.getActivePlayers(e,a),idle:G.getIdlePlayers(e,a)})};nt(q());const fo=!!G.getFinishTs(e);let wt=fo;const _o=()=>wt&&!fo,vt=()=>Q.getInt(ee.SOUND_VOLUME,fe.SOUND_VOLUME),yo=()=>Q.getBool(ee.OTHER_PLAYER_CLICK_SOUND_ENABLED,fe.OTHER_PLAYER_CLICK_SOUND_ENABLED),Et=()=>Q.getBool(ee.SOUND_ENABLED,fe.SOUND_ENABLED),wo=()=>Q.getBool(ee.SHOW_PLAYER_NAMES,fe.SHOW_PLAYER_NAMES),xn=()=>Q.getBool(ee.SHOW_TABLE,fe.SHOW_TABLE),Yn=()=>Q.getStr(ee.TABLE_TEXTURE,fe.TABLE_TEXTURE),vo=()=>s===Pe?Q.getStr(ee.COLOR_BACKGROUND,fe.COLOR_BACKGROUND):G.getPlayerBgColor(e,t)||Q.getStr(ee.COLOR_BACKGROUND,fe.COLOR_BACKGROUND),Eo=()=>s===Pe?Q.getStr(ee.PLAYER_COLOR,fe.PLAYER_COLOR):G.getPlayerColor(e,t)||Q.getStr(ee.PLAYER_COLOR,fe.PLAYER_COLOR),Wn=()=>s===Pe?Q.getStr(ee.PLAYER_NAME,fe.PLAYER_NAME):G.getPlayerName(e,t)||Q.getStr(ee.PLAYER_NAME,fe.PLAYER_NAME),Po=()=>{const a=vt();g.volume=a/100,g.play()},Fn=()=>{const a=vt();p.volume=a/100,p.play()},I={background:vo(),showTable:xn(),tableTexture:Yn(),color:Eo(),name:Wn(),soundsEnabled:Et(),otherPlayerClickSoundEnabled:yo(),soundsVolume:vt(),showPlayerNames:wo()};pe.addEvent([_.INPUT_EV_BG_COLOR,I.background]),pe.addEvent([_.INPUT_EV_PLAYER_COLOR,I.color]),pe.addEvent([_.INPUT_EV_PLAYER_NAME,I.name]);let bo="",To="",$o=!1;const He=a=>{$o=a;const[d,v]=a?[bo,"grab"]:[To,"default"];z.style.cursor=`url('${d}') ${N} ${O}, ${v}`},Pt=a=>{bo=ge.colorizedCanvas(B,$,a).toDataURL(),To=ge.colorizedCanvas(P,T,a).toDataURL(),He($o)};Pt(Eo());const st=()=>{l.emit("replaySpeed",m.speeds[m.speedIdx]),l.emit("replayPaused",m.paused)},X=(a,d=void 0)=>{l.emit("statusMessage",{what:a,value:d})},Co=()=>{m.speedIdx+1<m.speeds.length&&(m.speedIdx++,st(),X("Speed Up"))},So=()=>{m.speedIdx>=1&&(m.speedIdx--,st(),X("Speed Down"))},ko=()=>{m.paused=!m.paused,st(),X(m.paused?"Paused":"Playing")};let it=!0;const Ao=()=>{it=!it,l.emit("toggleInterface",it),X("Interface",it)};let Ze=!1;const Oo=()=>{Ze=!Ze,l.emit("togglePreview",Ze)},No=()=>{I.soundsEnabled=!I.soundsEnabled;const a=I.soundsEnabled;l.emit("toggleSoundsEnabled",a),Q.setBool(ee.SOUND_ENABLED,a),X("Sounds",a)},Uo=()=>{I.showPlayerNames=!I.showPlayerNames;const a=I.showPlayerNames;l.emit("togglePlayerNames",a),Q.setBool(ee.SHOW_PLAYER_NAMES,a),X("Player names",a)},Ro=()=>{I.showTable=!I.showTable;const a=I.showTable;l.emit("toggleShowTable",a),Q.setBool(ee.SHOW_TABLE,a),X("Table",a)};l.on("replayOnSpeedUp",()=>{Co()}),l.on("replayOnSpeedDown",()=>{So()}),l.on("replayOnPauseToggle",()=>{ko()}),l.on("onPreviewChange",a=>{Ze!==a&&(Ze=a)}),l.on("onBgChange",a=>{I.background!==a&&(I.background=a,Q.setStr(ee.COLOR_BACKGROUND,a),pe.addEvent([_.INPUT_EV_BG_COLOR,a]),X("Background",a))}),l.on("onTableTextureChange",a=>{I.tableTexture!==a&&(I.tableTexture=a,Q.setStr(ee.TABLE_TEXTURE,a),X("Table texture",a),ne=!0)}),l.on("onShowTableChange",a=>{I.showTable!==a&&(I.showTable=a,Q.setStr(ee.SHOW_TABLE,a),X("Table",a),ne=!0)}),l.on("onColorChange",a=>{I.color!==a&&(I.color=a,Q.setStr(ee.PLAYER_COLOR,a),pe.addEvent([_.INPUT_EV_PLAYER_COLOR,a]),X("Color",a))}),l.on("onNameChange",a=>{I.name!==a&&(I.name=a,Q.setStr(ee.PLAYER_NAME,a),pe.addEvent([_.INPUT_EV_PLAYER_NAME,a]),X("Name",a))}),l.on("onOtherPlayerClickSoundEnabledChange",a=>{I.otherPlayerClickSoundEnabled!==a&&(I.otherPlayerClickSoundEnabled=a,Q.setBool(ee.OTHER_PLAYER_CLICK_SOUND_ENABLED,a),X("Other player sounds",a))}),l.on("onSoundsEnabledChange",a=>{I.soundsEnabled!==a&&(I.soundsEnabled=a,Q.setBool(ee.SOUND_ENABLED,a),X("Sounds",a))}),l.on("onSoundsVolumeChange",a=>{I.soundsVolume!==a&&(I.soundsVolume=a,Q.setInt(ee.SOUND_VOLUME,a),Po(),X("Volume",a))}),l.on("onShowPlayerNamesChange",a=>{I.showPlayerNames!==a&&(I.showPlayerNames=a,Q.setBool(ee.SHOW_PLAYER_NAMES,a),X("Player names",a))}),l.on("setHotkeys",a=>{pe.setHotkeys(a)}),l.on("requireRerender",()=>{ne=!0});const Lo=[];let lt;const jn=()=>{Lo.forEach(a=>{clearInterval(a)}),lt&&clearTimeout(lt)};if(s===Qe?Lo.push(setInterval(()=>{nt(q())},1e3)):s===Pe&&st(),s===Qe)Ae.onServerChange(a=>{a[0],a[1],a[2];const d=a[3];let v=!1,Y=!1;for(const[j,K]of d)switch(j){case _.CHANGE_PLAYER:{const L=W.decodePlayer(K);L.id!==t&&(G.setPlayer(e,L.id,L),v=!0)}break;case _.CHANGE_PIECE:{const L=W.decodePiece(K);G.setPiece(e,L.idx,L),v=!0}break;case _.CHANGE_DATA:G.setPuzzleData(e,K),v=!0;break;case _.PLAYER_SNAP:K!==t&&(Y=!0);break}Y&&Et()&&yo()&&Fn(),v&&(ne=!0),wt=!!G.getFinishTs(e)});else if(s===Pe){const a=(Y,j)=>{const K=Y;if(K[0]===_.LOG_ADD_PLAYER){const L=K[1];return G.addPlayer(e,L,j),!0}if(K[0]===_.LOG_UPDATE_PLAYER){const L=G.getPlayerIdByIndex(e,K[1]);if(!L)throw"[ 2021-05-17 player not found (update player) ]";return G.addPlayer(e,L,j),!0}if(K[0]===_.LOG_HANDLE_INPUT){const L=G.getPlayerIdByIndex(e,K[1]);if(!L)throw"[ 2021-05-17 player not found (handle input) ]";const ye=K[2];return G.handleInput(e,L,ye,j),!0}return!1};let d=m.lastGameTs;const v=async()=>{m.logPointer+1>=m.log.length&&await se(e);const Y=$e.timestamp();if(m.paused){m.lastRealTs=Y,lt=setTimeout(v,50);return}const K=(Y-m.lastRealTs)*m.speeds[m.speedIdx];let L=m.lastGameTs+K,ye=!0;do if(m.paused)ye=!1;else{const ke=m.logPointer+1;if(ke>=m.log.length)ye=!1;else{const me=m.log[m.logPointer],Vo=d+me[me.length-1],bt=m.log[ke],Mo=bt[bt.length-1],Tt=Vo+Mo;Tt>L?(L+500*$e.MS<Tt&&(L+=Mo),ye=!1):(d=Vo,a(bt,Tt)&&(ne=!0),m.logPointer=ke)}}while(ye);m.lastRealTs=Y,m.lastGameTs=L,nt(q()),m.final||(lt=setTimeout(v,50))};v()}const Hn=()=>{pe.createKeyEvents();for(const a of pe.consumeAll())if(s===Qe){const d=a[0];if(d===_.INPUT_EV_MOVE){const j=D.worldDimToViewportRaw({w:a[1],h:a[2]});ne=!0,D.move(j.w,j.h),delete he.last}else if(d===_.INPUT_EV_MOUSE_MOVE){if(a[5]&&!G.getFirstOwnedPiece(e,t)){const K=D.worldDimToViewportRaw({w:a[3],h:a[4]});ne=!0,D.move(K.w,K.h),delete he.last}}else if(d===_.INPUT_EV_PLAYER_COLOR)Pt(a[1]);else if(d===_.INPUT_EV_MOUSE_DOWN)He(!0);else if(d===_.INPUT_EV_MOUSE_UP)He(!1);else if(d===_.INPUT_EV_ZOOM_IN){const j={x:a[1],y:a[2]};ne=!0,D.zoom("in",D.worldToViewportRaw(j)),delete he.last}else if(d===_.INPUT_EV_ZOOM_OUT){const j={x:a[1],y:a[2]};ne=!0,D.zoom("out",D.worldToViewportRaw(j)),delete he.last}else if(d===_.INPUT_EV_TOGGLE_INTERFACE)Ao();else if(d===_.INPUT_EV_TOGGLE_PREVIEW)Oo();else if(d===_.INPUT_EV_TOGGLE_SOUNDS)No();else if(d===_.INPUT_EV_TOGGLE_PLAYER_NAMES)Uo();else if(d===_.INPUT_EV_CENTER_FIT_PUZZLE){const j="center",K=ot(j);X(K?`Restored position "${K}"`:`Position "${j}" not set`)}else if(d===_.INPUT_EV_TOGGLE_FIXED_PIECES)Ue=!Ue,X(`${Ue?"Showing":"Hiding"} finished pieces`),ne=!0;else if(d===_.INPUT_EV_TOGGLE_LOOSE_PIECES)Re=!Re,X(`${Re?"Showing":"Hiding"} unfinished pieces`),ne=!0;else if(d===_.INPUT_EV_TOGGLE_TABLE)Ro();else if(d===_.INPUT_EV_STORE_POS){const j=`${a[1]}`;he[j]=D.snapshot(),X(`Stored position ${j}`)}else if(d===_.INPUT_EV_RESTORE_POS){const j=`${a[1]}`,K=ot(j);X(K?`Restored position "${K}"`:`Position "${j}" not set`)}const v=q(),Y=G.handleInput(e,t,a,v);Et()&&Y.find(j=>j[0]===_.PLAYER_SNAP)&&Po(),Y.length>0&&(ne=!0),Ae.sendClientEvent(a)}else if(s===Pe){const d=a[0];if(d===_.INPUT_EV_REPLAY_TOGGLE_PAUSE)ko();else if(d===_.INPUT_EV_REPLAY_SPEED_DOWN)So();else if(d===_.INPUT_EV_REPLAY_SPEED_UP)Co();else if(d===_.INPUT_EV_MOVE){const v=D.worldDimToViewportRaw({w:a[1],h:a[2]});ne=!0,D.move(v.w,v.h)}else if(d===_.INPUT_EV_MOUSE_MOVE){if(a[5]){const Y=D.worldDimToViewportRaw({w:a[3],h:a[4]});ne=!0,D.move(Y.w,Y.h)}}else if(d===_.INPUT_EV_PLAYER_COLOR)Pt(a[1]);else if(d===_.INPUT_EV_MOUSE_DOWN)He(!0);else if(d===_.INPUT_EV_MOUSE_UP)He(!1);else if(d===_.INPUT_EV_ZOOM_IN){const v={x:a[1],y:a[2]};ne=!0,D.zoom("in",D.worldToViewportRaw(v))}else if(d===_.INPUT_EV_ZOOM_OUT){const v={x:a[1],y:a[2]};ne=!0,D.zoom("out",D.worldToViewportRaw(v))}else if(d===_.INPUT_EV_TOGGLE_INTERFACE)Ao();else if(d===_.INPUT_EV_TOGGLE_PREVIEW)Oo();else if(d===_.INPUT_EV_TOGGLE_SOUNDS)No();else if(d===_.INPUT_EV_TOGGLE_PLAYER_NAMES)Uo();else if(d===_.INPUT_EV_CENTER_FIT_PUZZLE){const v="center",Y=ot(v);X(Y?`Restored position "${Y}"`:`Position "${v}" not set`)}else if(d===_.INPUT_EV_TOGGLE_FIXED_PIECES)Ue=!Ue,X(`${Ue?"Showing":"Hiding"} finished pieces`),ne=!0;else if(d===_.INPUT_EV_TOGGLE_LOOSE_PIECES)Re=!Re,X(`${Re?"Showing":"Hiding"} unfinished pieces`),ne=!0;else if(d===_.INPUT_EV_TOGGLE_TABLE)Ro();else if(d===_.INPUT_EV_STORE_POS){const v=`${a[1]}`;he[v]=D.snapshot(),X(`Stored position ${v}`)}else if(d===_.INPUT_EV_RESTORE_POS){const v=`${a[1]}`,Y=ot(v);X(Y?`Restored position "${Y}"`:`Position "${v}" not set`)}}wt=!!G.getFinishTs(e),_o()&&(x.update(),ne=!0)},Zn=new DOMMatrix([1,0,0,1,0,0]),Kn={dark:await ge.loadImageToBitmap(kt["./assets/textures/wood-dark.jpg"].default),light:await ge.loadImageToBitmap(kt["./assets/textures/wood-light.jpg"].default),brown:await ge.loadImageToBitmap(kt["./assets/textures/Oak-none-3275x2565mm-Architextures.jpg"].default)},qn=Vu({update:Hn,render:async()=>{if(!ne)return;const a=q();let d,v,Y;if(window.DEBUG&&Ne.checkpoint_start(0),V.fillStyle=vo(),V.fillRect(0,0,z.width,z.height),I.showTable){const L=Kn[I.tableTexture];if(L){const ye=G.getBounds(e);d=D.worldToViewportRaw(ye),v=D.worldDimToViewportRaw(ye);const ke=V.createPattern(L,"repeat");ke.setTransform(Zn.translate(d.x,d.y).scale(D.getCurrentZoom()*3)),V.fillStyle=ke,V.fillRect(d.x,d.y,v.w,v.h);const me=D.worldDimToViewportRaw({w:16,h:16});V.fillStyle="rgba(0, 0, 0, .5)",V.fillRect(d.x,d.y,v.w,me.h),V.fillRect(d.x,d.y+me.h,me.w,v.h-2*me.h),V.fillRect(d.x+v.w-me.w,d.y+me.h,me.w,v.h-2*me.h),V.fillRect(d.x,d.y+v.h-me.h,v.w,me.w)}}if(window.DEBUG&&Ne.checkpoint("clear done"),d=D.worldToViewportRaw(go),v=D.worldDimToViewportRaw(yt),I.showTable){const L=D.worldDimToViewportRaw({w:8,h:8});V.fillStyle="rgba(0, 0, 0, .5)",V.fillRect(d.x-L.w,d.y-L.h,v.w+2*L.w,L.h),V.fillRect(d.x-L.w,d.y,L.h,v.h),V.fillRect(d.x+v.w,d.y,L.w,v.h),V.fillRect(d.x-L.w,d.y+v.h,v.w+2*L.w,L.h)}I.showTable&&["dark","brown"].includes(I.tableTexture)?V.fillStyle="rgba(0, 0, 0, .3)":V.fillStyle="rgba(255, 255, 255, .3)",V.fillRect(d.x,d.y,v.w,v.h),window.DEBUG&&Ne.checkpoint("board done");const j=G.getPiecesSortedByZIndex(e);window.DEBUG&&Ne.checkpoint("get pieces done"),v=D.worldDimToViewportRaw(mo);for(const L of j)!Qc(L)||(Y=b[L.idx],d=D.worldToViewportRaw({x:Se+L.pos.x,y:Se+L.pos.y}),V.drawImage(Y,0,0,Y.width,Y.height,d.x,d.y,v.w,v.h));window.DEBUG&&Ne.checkpoint("pieces done");const K=[];for(const L of G.getActivePlayers(e,a))r(L)&&(Y=await S(L),d=D.worldToViewport(L),V.drawImage(Y,d.x-N,d.y-O),wo()&&K.push([`${L.name} (${L.points})`,d.x,d.y+R]));V.fillStyle="white",V.textAlign="center";for(const[L,ye,ke]of K)V.fillText(L,ye,ke);window.DEBUG&&Ne.checkpoint("players done"),nt(a),window.DEBUG&&Ne.checkpoint("HUD done"),_o()&&x.render(),ne=!1}}),Xn=()=>{jn(),qn.stop(),pe&&pe.unregisterEvents()};return{previewImageUrl:In,player:I,game:G.get(e),disconnect:Ae.disconnect,connect:ie,unload:Xn}}const Jc=Z({name:"game",components:{PuzzleStatusComponent:Qt,Scores:Xt,SettingsOverlay:Jt,PreviewOverlay:eo,InfoOverlay:to,ConnectionOverlay:En,HelpOverlay:so},data(){return{statusMessages:[],players:{active:[],idle:[]},status:{finished:!1,duration:0,piecesDone:0,piecesTotal:0},overlay:"",connectionState:0,cuttingPuzzle:!0,interface:!0,eventBus:Ft(),g:{player:nn(),game:null,previewImageUrl:"",connect:()=>{},disconnect:()=>{},unload:()=>{}}}},async mounted(){if(!this.$route.params.id)return;this.eventBus.on("puzzleCut",()=>{this.cuttingPuzzle=!1}),this.eventBus.on("players",t=>{this.players=t}),this.eventBus.on("status",t=>{this.status=t}),this.eventBus.on("connectionState",t=>{this.connectionState=t}),this.eventBus.on("togglePreview",t=>{this.toggleTo("preview",t,!1)}),this.eventBus.on("toggleInterface",t=>{this.interface=!!t}),this.eventBus.on("toggleSoundsEnabled",t=>{this.g.player.soundsEnabled=!!t}),this.eventBus.on("togglePlayerNames",t=>{this.g.player.showPlayerNames=!!t}),this.eventBus.on("toggleShowTable",t=>{this.g.player.showTable=!!t}),this.$watch(()=>this.g.player.background,t=>{this.eventBus.emit("onBgChange",t)}),this.$watch(()=>this.g.player.showTable,t=>{this.eventBus.emit("onShowTableChange",t)}),this.$watch(()=>this.g.player.tableTexture,t=>{this.eventBus.emit("onTableTextureChange",t)}),this.$watch(()=>this.g.player.color,t=>{this.eventBus.emit("onColorChange",t)}),this.$watch(()=>this.g.player.name,t=>{this.eventBus.emit("onNameChange",t)}),this.$watch(()=>this.g.player.soundsEnabled,t=>{this.eventBus.emit("onSoundsEnabledChange",t)}),this.$watch(()=>this.g.player.otherPlayerClickSoundEnabled,t=>{this.eventBus.emit("onOtherPlayerClickSoundEnabledChange",t)}),this.$watch(()=>this.g.player.soundsVolume,t=>{this.eventBus.emit("onSoundsVolumeChange",t)}),this.$watch(()=>this.g.player.showPlayerNames,t=>{this.eventBus.emit("onShowPlayerNamesChange",t)});const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",this.onResize),this.g=await Bn(`${this.$route.params.id}`,ce.clientId(),this.$config.WS_ADDRESS,Qe,e,this.eventBus),this.eventBus.on("statusMessage",t=>{this.addStatusMessage(t.what,t.value)})},unmounted(){this.g.unload(),this.g.disconnect(),window.removeEventListener("resize",this.onResize)},methods:{addStatusMessage(e,t){typeof t=="undefined"?this.statusMessages.push(`${e}`):t===!0||t===!1?this.statusMessages.push(`${e} ${t?"enabled":"disabled"}`):this.statusMessages.push(`${e} changed to ${t}`),setTimeout(()=>{this.statusMessages.shift()},3e3)},onResize(){const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,this.eventBus.emit("requireRerender")},reconnect(){this.g.connect()},toggleTo(e,t,n){t===!1?(this.overlay="",n&&this.eventBus.emit("setHotkeys",!0)):(this.overlay=e,n&&this.eventBus.emit("setHotkeys",!1))},toggle(e,t){this.overlay===""?(this.overlay=e,t&&this.eventBus.emit("setHotkeys",!1)):(this.overlay="",t&&this.eventBus.emit("setHotkeys",!0)),e==="preview"&&this.eventBus.emit("onPreviewChange",this.overlay==="preview")}}}),ed={id:"game"},td=w(" Cutting puzzle, please wait... "),od={key:4,class:"menu-left"},nd={key:0,class:"switch-game-replay"},sd=w(" Watch replay"),id={key:5,class:"menu"},ld=w(" Puzzles"),ad=w(" Preview"),rd=w(" Settings"),ud=w(" Info"),cd=w(" Hotkeys"),dd={class:"opener",href:"https://stand-with-ukraine.pp.ua/",target:"_blank"},hd=w(" Stand with Ukraine "),pd={key:6,class:"menu-right"},gd={key:7,class:"status-messages"},md={ref:"canvas"};function fd(e,t,n,s,i,l){const r=k("settings-overlay"),u=k("preview-overlay"),h=k("info-overlay"),g=k("help-overlay"),p=k("icon"),B=k("overlay"),P=k("connection-overlay"),$=k("puzzle-status"),T=k("router-link"),E=k("scores");return c(),y("div",ed,[e.overlay==="settings"?(c(),F(r,{key:0,onClose:t[0]||(t[0]=N=>e.toggle("settings",!0)),onBgclick:t[1]||(t[1]=N=>e.toggle("settings",!0)),modelValue:e.g.player,"onUpdate:modelValue":t[2]||(t[2]=N=>e.g.player=N)},null,8,["modelValue"])):M("",!0),e.overlay==="preview"?(c(),F(u,{key:1,onClose:t[3]||(t[3]=N=>e.toggle("preview",!1)),onClick:t[4]||(t[4]=N=>e.toggle("preview",!1)),img:e.g.previewImageUrl},null,8,["img"])):M("",!0),e.g.game&&e.overlay==="info"?(c(),F(h,{key:2,onClose:t[5]||(t[5]=N=>e.toggle("info",!0)),onBgclick:t[6]||(t[6]=N=>e.toggle("info",!0)),game:e.g.game},null,8,["game"])):M("",!0),e.overlay==="help"?(c(),F(g,{key:3,onClose:t[7]||(t[7]=N=>e.toggle("help",!0)),onBgclick:t[8]||(t[8]=N=>e.toggle("help",!0))})):M("",!0),H(f(B,null,{default:le(()=>[o("div",null,[f(p,{icon:"hourglass"}),td,f(p,{icon:"hourglass"})])]),_:1},512),[[tn,e.cuttingPuzzle]]),f(P,{connectionState:e.connectionState,onReconnect:e.reconnect},null,8,["connectionState","onReconnect"]),e.interface?(c(),y("div",od,[f($,{status:e.status},null,8,["status"]),e.g.game&&e.g.game.hasReplay?(c(),y("div",nd,[f(T,{to:{name:"replay",params:{id:e.g.game.id}}},{default:le(()=>[f(p,{icon:"replay"}),sd]),_:1},8,["to"])])):M("",!0)])):M("",!0),e.interface?(c(),y("div",id,[f(T,{class:"opener",to:{name:"index"},target:"_blank"},{default:le(()=>[f(p,{icon:"puzzle-piece"}),ld]),_:1}),o("div",{class:"opener",onClick:t[9]||(t[9]=N=>e.toggle("preview",!1))},[f(p,{icon:"preview"}),ad]),o("div",{class:"opener",onClick:t[10]||(t[10]=N=>e.toggle("settings",!0))},[f(p,{icon:"settings"}),rd]),o("div",{class:"opener",onClick:t[11]||(t[11]=N=>e.toggle("info",!0))},[f(p,{icon:"info"}),ud]),o("div",{class:"opener",onClick:t[12]||(t[12]=N=>e.toggle("help",!0))},[f(p,{icon:"hotkey"}),cd]),o("a",dd,[f(p,{icon:"ukraine-heart"}),hd])])):M("",!0),e.interface?(c(),y("div",pd,[f(E,{players:e.players},null,8,["players"])])):M("",!0),e.statusMessages.length?(c(),y("div",gd,[(c(!0),y(oe,null,de(e.statusMessages,(N,R)=>(c(),y("div",{key:R},C(N),1))),128))])):M("",!0),o("canvas",md,null,512)])}var _d=ae(Jc,[["render",fd]]);const yd=Z({name:"replay",components:{PuzzleStatusComponent:Qt,Scores:Xt,SettingsOverlay:Jt,PreviewOverlay:eo,InfoOverlay:to,HelpOverlay:so},data(){return{statusMessages:[],players:{active:[],idle:[]},status:{finished:!1,duration:0,piecesDone:0,piecesTotal:0},overlay:"",connectionState:0,cuttingPuzzle:!0,interface:!0,eventBus:Ft(),g:{player:nn(),game:null,previewImageUrl:"",connect:()=>{},disconnect:()=>{},unload:()=>{}},replay:{speed:1,paused:!1}}},async mounted(){if(!this.$route.params.id)return;this.eventBus.on("puzzleCut",()=>{this.cuttingPuzzle=!1}),this.eventBus.on("players",t=>{this.players=t}),this.eventBus.on("status",t=>{this.status=t}),this.eventBus.on("connectionState",t=>{this.connectionState=t}),this.eventBus.on("togglePreview",t=>{this.toggleTo("preview",t,!1)}),this.eventBus.on("toggleInterface",t=>{this.interface=!!t}),this.eventBus.on("toggleSoundsEnabled",t=>{this.g.player.soundsEnabled=!!t}),this.eventBus.on("togglePlayerNames",t=>{this.g.player.showPlayerNames=!!t}),this.eventBus.on("toggleShowTable",t=>{this.g.player.showTable=!!t}),this.eventBus.on("replaySpeed",t=>{this.replay.speed=t}),this.eventBus.on("replayPaused",t=>{this.replay.paused=t}),this.$watch(()=>this.g.player.background,t=>{this.eventBus.emit("onBgChange",t)}),this.$watch(()=>this.g.player.showTable,t=>{this.eventBus.emit("onShowTableChange",t)}),this.$watch(()=>this.g.player.tableTexture,t=>{this.eventBus.emit("onTableTextureChange",t)}),this.$watch(()=>this.g.player.color,t=>{this.eventBus.emit("onColorChange",t)}),this.$watch(()=>this.g.player.name,t=>{this.eventBus.emit("onNameChange",t)}),this.$watch(()=>this.g.player.soundsEnabled,t=>{this.eventBus.emit("onSoundsEnabledChange",t)}),this.$watch(()=>this.g.player.otherPlayerClickSoundEnabled,t=>{this.eventBus.emit("onOtherPlayerClickSoundEnabledChange",t)}),this.$watch(()=>this.g.player.soundsVolume,t=>{this.eventBus.emit("onSoundsVolumeChange",t)}),this.$watch(()=>this.g.player.showPlayerNames,t=>{this.eventBus.emit("onShowPlayerNamesChange",t)});const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",this.onResize),this.g=await Bn(`${this.$route.params.id}`,ce.clientId(),this.$config.WS_ADDRESS,Pe,e,this.eventBus),this.eventBus.on("statusMessage",t=>{this.addStatusMessage(t.what,t.value)})},unmounted(){this.g.unload(),this.g.disconnect(),window.removeEventListener("resize",this.onResize)},methods:{addStatusMessage(e,t){typeof t=="undefined"?this.statusMessages.push(`${e}`):t===!0||t===!1?this.statusMessages.push(`${e} ${t?"enabled":"disabled"}`):this.statusMessages.push(`${e} changed to ${t}`),setTimeout(()=>{this.statusMessages.shift()},3e3)},onResize(){const e=this.$refs.canvas;e.width=window.innerWidth,e.height=window.innerHeight,this.eventBus.emit("requireRerender")},toggleTo(e,t,n){t===!1?(this.overlay="",n&&this.eventBus.emit("setHotkeys",!0)):(this.overlay=e,n&&this.eventBus.emit("setHotkeys",!1))},toggle(e,t){this.overlay===""?(this.overlay=e,t&&this.eventBus.emit("setHotkeys",!1)):(this.overlay="",t&&this.eventBus.emit("setHotkeys",!0)),e==="preview"&&this.eventBus.emit("onPreviewChange",this.overlay==="preview")}},computed:{replayText(){return"Replay-Speed: "+(this.replay.speed+"x")+(this.replay.paused?" Paused":"")}}}),wd={id:"replay"},vd={key:4,class:"overlay"},Ed={class:"overlay-content"},Pd=w(" Cutting puzzle, please wait... "),bd={key:5,class:"menu-left"},Td={class:"playback-control"},$d={key:0,class:"switch-game-replay"},Cd=w(" To the game"),Sd={key:6,class:"menu"},kd=w(" Puzzles"),Ad=w(" Preview"),Od=w(" Settings"),Nd=w(" Info"),Ud=w(" Hotkeys"),Rd={class:"opener",href:"https://stand-with-ukraine.pp.ua/",target:"_blank"},Ld=w(" Stand with Ukraine "),Vd={key:7,class:"menu-right"},Md={key:8,class:"status-messages"},zd={ref:"canvas"};function Dd(e,t,n,s,i,l){const r=k("settings-overlay"),u=k("preview-overlay"),h=k("info-overlay"),g=k("help-overlay"),p=k("icon"),B=k("puzzle-status"),P=k("router-link"),$=k("scores");return c(),y("div",wd,[e.overlay==="settings"?(c(),F(r,{key:0,onClose:t[0]||(t[0]=T=>e.toggle("settings",!0)),onBgclick:t[1]||(t[1]=T=>e.toggle("settings",!0)),modelValue:e.g.player,"onUpdate:modelValue":t[2]||(t[2]=T=>e.g.player=T)},null,8,["modelValue"])):M("",!0),e.overlay==="preview"?(c(),F(u,{key:1,onClose:t[3]||(t[3]=T=>e.toggle("preview",!1)),onClick:t[4]||(t[4]=T=>e.toggle("preview",!1)),img:e.g.previewImageUrl},null,8,["img"])):M("",!0),e.g.game&&e.overlay==="info"?(c(),F(h,{key:2,onClose:t[5]||(t[5]=T=>e.toggle("info",!0)),onBgclick:t[6]||(t[6]=T=>e.toggle("info",!0)),game:e.g.game},null,8,["game"])):M("",!0),e.overlay==="help"?(c(),F(g,{key:3,onClose:t[7]||(t[7]=T=>e.toggle("help",!0)),onBgclick:t[8]||(t[8]=T=>e.toggle("help",!0))})):M("",!0),e.cuttingPuzzle?(c(),y("div",vd,[o("div",Ed,[o("div",null,[f(p,{icon:"hourglass"}),Pd,f(p,{icon:"hourglass"})])])])):M("",!0),e.interface?(c(),y("div",bd,[f(B,{status:e.status},null,8,["status"]),o("div",Td,[o("div",null,C(e.replayText),1),o("button",{class:"btn",onClick:t[9]||(t[9]=T=>e.eventBus.emit("replayOnSpeedUp"))},[f(p,{icon:"speed-up"})]),o("button",{class:"btn",onClick:t[10]||(t[10]=T=>e.eventBus.emit("replayOnSpeedDown"))},[f(p,{icon:"speed-down"})]),o("button",{class:"btn",onClick:t[11]||(t[11]=T=>e.eventBus.emit("replayOnPauseToggle"))},[f(p,{icon:"pause"})])]),e.g.game?(c(),y("div",$d,[f(P,{to:{name:"game",params:{id:e.g.game.id}}},{default:le(()=>[f(p,{icon:"puzzle-piece"}),Cd]),_:1},8,["to"])])):M("",!0)])):M("",!0),e.interface?(c(),y("div",Sd,[f(P,{class:"opener",to:{name:"index"},target:"_blank"},{default:le(()=>[f(p,{icon:"puzzle-piece"}),kd]),_:1}),o("div",{class:"opener",onClick:t[12]||(t[12]=T=>e.toggle("preview",!1))},[f(p,{icon:"preview"}),Ad]),o("div",{class:"opener",onClick:t[13]||(t[13]=T=>e.toggle("settings",!0))},[f(p,{icon:"settings"}),Od]),o("div",{class:"opener",onClick:t[14]||(t[14]=T=>e.toggle("info",!0))},[f(p,{icon:"info"}),Nd]),o("div",{class:"opener",onClick:t[15]||(t[15]=T=>e.toggle("help",!0))},[f(p,{icon:"hotkey"}),Ud]),o("a",Rd,[f(p,{icon:"ukraine-heart"}),Ld])])):M("",!0),e.interface?(c(),y("div",Vd,[f($,{players:e.players},null,8,["players"])])):M("",!0),e.statusMessages.length?(c(),y("div",Md,[(c(!0),y(oe,null,de(e.statusMessages,(T,E)=>(c(),y("div",{key:E},C(T),1))),128))])):M("",!0),o("canvas",zd,null,512)])}var Bd=ae(yd,[["render",Dd]]);const Gd=Z({props:{icon:null},setup(e){return(t,n)=>(c(),y("i",{class:Ve(["icon",`icon-${e.icon}`])},null,2))}}),Id=Z({props:{image:{type:Object,required:!0}},data:()=>({me:re.getMe()}),computed:{url(){return this.image.url.replace("uploads/","uploads/r/")+"-375x0.webp"},canEdit(){return this.me.id?this.me.id===this.image.uploaderUserId:!1}},emits:{click:null,editClick:null},methods:{onClick(){this.$emit("click")},onEditClick(){this.$emit("editClick")}}}),xd=["src"],Yd={class:"imageteaser-info"};function Wd(e,t,n,s,i,l){const r=k("icon");return c(),y("div",{class:"imageteaser",onClick:t[1]||(t[1]=(...u)=>e.onClick&&e.onClick(...u))},[o("img",{src:e.url},null,8,xd),e.canEdit?(c(),y("div",{key:0,class:"btn edit",onClick:t[0]||(t[0]=At((...u)=>e.onEditClick&&e.onEditClick(...u),["stop"]))},[f(r,{icon:"edit"})])):M("",!0),o("div",Yd,C(e.image.gameCount)+"x plays ",1)])}var Fd=ae(Id,[["render",Wd]]);const jd=Z({emits:{bgclick:null,close:null},methods:{onKeyUp(e){e.code==="Escape"&&window.getComputedStyle(this.$el).display!=="none"&&this.$emit("close")}},mounted(){window.addEventListener("keyup",this.onKeyUp)},unmounted(){window.removeEventListener("keyup",this.onKeyUp)}}),Hd={class:"overlay"},Zd={class:"overlay-content"};function Kd(e,t,n,s,i,l){return c(),y("div",Hd,[o("div",{class:"overlay-background",onClick:t[0]||(t[0]=r=>e.$emit("bgclick"))}),o("div",Zd,[on(e.$slots,"default")])])}var qd=ae(jd,[["render",Kd]]);const Xd={props:{src:String,title:{type:String,default:""},height:{type:String,default:"100%"},width:{type:String,default:"100%"}},computed:{style(){return{display:"inline-block",verticalAlign:"text-bottom",backgroundImage:`url('${this.src}')`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",width:this.width,height:this.height}}}},Qd=["title"];function Jd(e,t,n,s,i,l){return c(),y("div",{style:De(l.style),title:n.title},null,12,Qd)}var eh=ae(Xd,[["render",Jd]]);const th=Z({props:{modelValue:{type:Array,required:!0},autocompleteTags:{type:Function}},emits:{"update:modelValue":null},data(){return{input:"",values:[],autocomplete:{idx:-1,values:[]}}},watch:{modelValue(e,t){this.values=e}},created(){this.values=this.modelValue},methods:{onKeyUp(e){if(e.code==="ArrowDown"&&this.autocomplete.values.length>0)return this.autocomplete.idx<this.autocomplete.values.length-1&&this.autocomplete.idx++,e.stopPropagation(),!1;if(e.code==="ArrowUp"&&this.autocomplete.values.length>0)return this.autocomplete.idx>0&&this.autocomplete.idx--,e.stopPropagation(),!1;if(e.key===",")return this.add(),e.stopPropagation(),!1;if(e.code==="Escape")return this.autocomplete.values=[],this.autocomplete.idx=-1,e.stopPropagation(),!1;this.input&&this.autocompleteTags?(this.autocomplete.values=this.autocompleteTags(this.input,this.values),this.autocomplete.idx=-1):(this.autocomplete.values=[],this.autocomplete.idx=-1)},addVal(e){const t=e.replace(/,/g,"").trim();!t||(this.values.includes(t)||this.values.push(t),this.input="",this.autocomplete.values=[],this.autocomplete.idx=-1,this.$emit("update:modelValue",this.values),this.$refs.input.focus())},add(){const e=this.autocomplete.idx>=0?this.autocomplete.values[this.autocomplete.idx]:this.input;this.addVal(e)},rm(e){this.values=this.values.filter(t=>t!==e),this.$emit("update:modelValue",this.values)}}}),oh={class:"input-holder"},nh={key:0,class:"enter-hint color-highlight"},sh={key:0,class:"autocomplete"},ih=["onClick"],lh=["onClick"];function ah(e,t,n,s,i,l){return c(),y("div",null,[o("div",oh,[H(o("input",{ref:"input",class:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>e.input=r),placeholder:"Plants, People",onKeydown:[t[1]||(t[1]=zo(At((...r)=>e.add&&e.add(...r),["prevent"]),["enter"])),t[2]||(t[2]=zo(At((...r)=>e.add&&e.add(...r),["prevent"]),["tab"]))],onKeyup:t[3]||(t[3]=(...r)=>e.onKeyUp&&e.onKeyUp(...r))},null,544),[[Ce,e.input]]),e.input?(c(),y("div",nh,"[Press ENTER/TAB to add]")):M("",!0)]),e.autocomplete.values?(c(),y("div",sh,[o("ul",null,[(c(!0),y(oe,null,de(e.autocomplete.values,(r,u)=>(c(),y("li",{key:u,class:Ve({active:u===e.autocomplete.idx}),onClick:h=>e.addVal(r)},C(r),11,ih))),128))])])):M("",!0),(c(!0),y(oe,null,de(e.values,(r,u)=>(c(),y("span",{key:u,class:"bit is-clickable",onClick:h=>e.rm(r)},C(r)+" \u2716",9,lh))),128))])}var rh=ae(th,[["render",ah]]);const uh=["data-index"],ch=Z({props:{columnWidth:{default:400},items:null,gap:{default:0},rtl:{type:Boolean,default:!1},ssrColumns:{default:0}},emits:["redraw","redraw-skip"],setup(e,{emit:t}){const n=e,{columnWidth:s,items:i,gap:l,rtl:r,ssrColumns:u}=os(n),h=ve([]),g=ve();function p(){g.value.getBoundingClientRect().width+l.value,s.value+l.value;const E=Math.floor((g.value.getBoundingClientRect().width+l.value)/(s.value+l.value));return E>0?E:1}function B(E){return[...new Array(E)].map(()=>[])}if(u.value>0){const E=B(u.value);i.value.forEach((N,R)=>E[R%u.value].push(R)),h.value=E}async function P(E){if(E>=i.value.length)return;await ss();const N=[...g.value.children];r.value&&N.reverse();const R=N.reduce((O,A)=>A.getBoundingClientRect().height<O.getBoundingClientRect().height?A:O);h.value[+R.dataset.index].push(E),await P(E+1)}async function $(E=!1){if(h.value.length===p()&&!E){t("redraw-skip");return}h.value=B(p());const N=window.scrollY;await P(0),window.scrollTo({top:N}),t("redraw")}const T=new ResizeObserver(()=>$());return Fe(()=>{$(),T.observe(g.value)}),ns(()=>T.unobserve(g.value)),Do([i,r],()=>$(!0)),Do([s,l],()=>$()),(E,N)=>(c(),y("div",{ref_key:"wall",ref:g,class:"masonry-wall",style:De({display:"flex",gap:`${qe(l)}px`})},[(c(!0),y(oe,null,de(h.value,(R,O)=>(c(),y("div",{key:O,class:"masonry-column","data-index":O,style:De({display:"flex",flexBasis:0,flexDirection:"column",flexGrow:1,height:["-webkit-max-content","-moz-max-content","max-content"],gap:`${qe(l)}px`})},[(c(!0),y(oe,null,de(R,A=>(c(),y("div",{key:A,class:"masonry-item"},[on(E.$slots,"default",{item:qe(i)[A],index:A},()=>[w(C(qe(i)[A]),1)])]))),128))],12,uh))),128))],4))}}),dh={class:"nav"},tt=Z({setup(e){const t=ve(["admin_games","admin_images","admin_users","admin_groups"]);return(n,s)=>{const i=k("router-link");return c(),y("ul",dh,[(c(!0),y(oe,null,de(t.value,(l,r)=>(c(),y("li",{key:r},[f(i,{to:{name:l}},{default:le(()=>[w(C(l),1)]),_:2},1032,["to"])]))),128))])}}}),hh=Z({setup(e){return(t,n)=>(c(),y("div",null,[f(tt)]))}}),Xo=async()=>await(await ce.get("/admin/api/games",{})).json(),Qo=async()=>await(await ce.get("/admin/api/users",{})).json(),Jo=async()=>await(await ce.get("/admin/api/images",{})).json(),en=async()=>await(await ce.get("/admin/api/groups",{})).json(),ph=w(" GAMES "),gh={class:"data-table"},mh=o("tr",null,[o("th",null,"Id"),o("th",null,"Creator"),o("th",null,"Image"),o("th",null,"Created"),o("th",null,"Finished"),o("th",null,"Private"),o("th",null,"Data")],-1),fh=Z({setup(e){const t=ve([]);return Fe(async()=>{var n;(n=re.getMe())!=null&&n.loggedIn&&(t.value=await Xo()),re.eventBus.on("login",async()=>{t.value=await Xo()}),re.eventBus.on("logout",()=>{t.value=[]})}),(n,s)=>(c(),y("div",null,[f(tt),ph,o("table",gh,[mh,(c(!0),y(oe,null,de(t.value,(i,l)=>(c(),y("tr",{key:l},[o("td",null,C(i.id),1),o("td",null,C(i.creator_user_id||"-"),1),o("td",null,C(i.image_id),1),o("td",null,C(i.created),1),o("td",null,C(i.finished),1),o("td",null,C(i.private?"\u2713":"\u2716"),1),o("td",null,C(i.data),1)]))),128))])]))}}),_h=w(" USERS "),yh={class:"data-table"},wh=o("tr",null,[o("th",null,"Id"),o("th",null,"Created"),o("th",null,"Client Id"),o("th",null,"Client Secret"),o("th",null,"Login"),o("th",null,"Pass"),o("th",null,"Salt")],-1),vh=Z({setup(e){const t=ve([]);return Fe(async()=>{var n;(n=re.getMe())!=null&&n.loggedIn&&(t.value=await Qo()),re.eventBus.on("login",async()=>{t.value=await Qo()}),re.eventBus.on("logout",()=>{t.value=[]})}),(n,s)=>(c(),y("div",null,[f(tt),_h,o("table",yh,[wh,(c(!0),y(oe,null,de(t.value,(i,l)=>(c(),y("tr",{key:l},[o("td",null,C(i.id),1),o("td",null,C(i.created),1),o("td",null,C(i.client_id),1),o("td",null,C(i.client_secret),1),o("td",null,C(i.login),1),o("td",null,C(i.pass),1),o("td",null,C(i.salt),1)]))),128))])]))}}),Eh=w(" IMAGES "),Ph={class:"data-table"},bh=o("tr",null,[o("th",null,"Id"),o("th",null,"Uploader"),o("th",null,"Created"),o("th",null,"Filename"),o("th",null,"Filename Original"),o("th",null,"Title"),o("th",null,"Width"),o("th",null,"Height"),o("th",null,"Private")],-1),Th=Z({setup(e){const t=ve([]);return Fe(async()=>{var n;(n=re.getMe())!=null&&n.loggedIn&&(t.value=await Jo()),re.eventBus.on("login",async()=>{t.value=await Jo()}),re.eventBus.on("logout",()=>{t.value=[]})}),(n,s)=>(c(),y("div",null,[f(tt),Eh,o("table",Ph,[bh,(c(!0),y(oe,null,de(t.value,(i,l)=>(c(),y("tr",{key:l},[o("td",null,C(i.id),1),o("td",null,C(i.uploader_user_id||"-"),1),o("td",null,C(i.created),1),o("td",null,C(i.filename),1),o("td",null,C(i.filename_original),1),o("td",null,C(i.title),1),o("td",null,C(i.width),1),o("td",null,C(i.height),1),o("td",null,C(i.private?"\u2713":"\u2716"),1)]))),128))])]))}}),$h=w(" GROUPS "),Ch={class:"data-table"},Sh=o("tr",null,[o("th",null,"Id"),o("th",null,"Name")],-1),kh=Z({setup(e){const t=ve([]);return Fe(async()=>{var n;(n=re.getMe())!=null&&n.loggedIn&&(t.value=await en()),re.eventBus.on("login",async()=>{t.value=await en()}),re.eventBus.on("logout",()=>{t.value=[]})}),(n,s)=>(c(),y("div",null,[f(tt),$h,o("table",Ch,[Sh,(c(!0),y(oe,null,de(t.value,(i,l)=>(c(),y("tr",{key:l},[o("td",null,C(i.id),1),o("td",null,C(i.name),1)]))),128))])]))}});(async()=>{ce.init(),await re.init();const t=await(await ce.get("/api/conf",{})).json(),n=is({history:ls(),routes:[{name:"index",path:"/",component:li},{name:"new-game",path:"/new-game",component:Nl},{name:"game",path:"/g/:id",component:_d},{name:"replay",path:"/replay/:id",component:Bd},{name:"admin",path:"/admin",component:hh},{name:"admin_games",path:"/admin/games",component:fh},{name:"admin_users",path:"/admin/users",component:vh},{name:"admin_images",path:"/admin/images",component:Th},{name:"admin_groups",path:"/admin/groups",component:kh}]});n.beforeEach((i,l)=>{l.name&&document.documentElement.classList.remove(`view-${String(l.name)}`),document.documentElement.classList.add(`view-${String(i.name)}`)});const s=as(Fs);s.config.globalProperties.$config=t,s.use(n),s.component("connection-overlay",En),s.component("edit-image-dialog",gn),s.component("game-teaser",cn),s.component("help-overlay",so),s.component("icon",Gd),s.component("image-library",dn),s.component("image-teaser",Fd),s.component("info-overlay",to),s.component("masonry-wall",ch),s.component("new-game-dialog",mn),s.component("new-image-dialog",pn),s.component("overlay",qd),s.component("preview-overlay",eo),s.component("puzzle-status",Qt),s.component("responsive-image",eh),s.component("scores",Xt),s.component("settings-overlay",Jt),s.component("tags-input",rh),s.mount("#app")})();
//# sourceMappingURL=index.367a756a.js.map
