CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,

  created TIMESTAMP NOT NULL,

  client_id TEXT NOT NULL,
  client_secret TEXT NOT NULL
);

CREATE TABLE images_new (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  uploader_user_id INTEGER,

  created TIMESTAMP NOT NULL,

  filename TEXT NOT NULL UNIQUE,
  filename_original TEXT NOT NULL,
  title TEXT NOT NULL,

  width INTEGER NOT NULL,
  height INTEGER NOT NULL
);

CREATE TABLE image_x_category_new (
  image_id INTEGER NOT NULL,
  category_id INTEGER NOT NULL
);

INSERT INTO images_new
SELECT id, NULL, created, filename, filename_original, title, width, height
FROM images;

INSERT INTO image_x_category_new
SELECT image_id, category_id
FROM image_x_category;

PRAGMA foreign_keys = OFF;

DROP TABLE images;
DROP TABLE image_x_category;

ALTER TABLE images_new RENAME TO images;
ALTER TABLE image_x_category_new RENAME TO image_x_category;

PRAGMA foreign_keys = ON;
